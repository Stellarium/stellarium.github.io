<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Stellarium: Coding Style Conventions in Stellarium</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extrastyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stellarium-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Stellarium
   &#160;<span id="projectnumber">0.19.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Coding Style Conventions in Stellarium </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#stylistic_conventions_sec">Stylistic Conventions</a></li>
<li class="level1"><a href="#file_names_sec">File Names</a></li>
<li class="level1"><a href="#comments_sec">Doxygen Comments</a></li>
<li class="level1"><a href="#cpp_code">C/C++ Code</a></li>
<li class="level1"><a href="#translation_sec">Translatable Strings and Console Output</a></li>
</ul>
</div>
<div class="textblock"><p>The increasing number of contributors require that we clearly define coding rules and guidelines. Although for historical reasons the current code of Stellarium does not always comply to these rules, they should now be respected for any addition or modification of the code.</p>
<p>Settings for <a href="http://doc.qt.io/qtcreator/index.html">QtCreator</a> IDE you can get <a href="http://www.stellarium.org/files/ide/stellarium-ide.xml">here</a> (or <a href="http://www.stellarium.org/files/ide/stellarium-ide.xml.tgz">TGZ archive</a> for it).</p>
<h1><a class="anchor" id="stylistic_conventions_sec"></a>
Stylistic Conventions</h1>
<ul>
<li>Source code should use the ASCII character set. Characters such as '&egrave;' or '&ouml;' are not portable when hard-coded. Gettext translated strings should be used for text using such characters.</li>
<li>Variable names and comments should be in English.</li>
<li>Class names are nouns, in mixed-case, with an initial upper-case letter and the first letter of each subsequent word capitalized (e.g. <code>CoreFactory</code>).</li>
<li>Method names are verbs or nouns in mixed-case, starting with a lower-case letter (e.g. <code>update()</code> or <code>addElement()</code>).</li>
<li>Names of methods that return a value should start with a suitable verb, such as <code>getSize()</code>.</li>
<li>For methods, only names of Qt signals should be in passive voice (<code>valueChanged()</code>). Names of Qt slots should use active verbs to avoid confusion with signals: <div class="fragment"><div class="line"><span class="comment">// BAD:</span></div><div class="line"><span class="keywordtype">void</span> buttonBoomClicked(); <span class="comment">// Causes an explosion.</span></div><div class="line"><span class="comment">// BETTER:</span></div><div class="line"><span class="keywordtype">void</span> handleButtonBoom();  <span class="comment">// Connected to buttonBoom::clicked().</span></div><div class="line"><span class="comment">// EVEN BETTER:</span></div><div class="line"><span class="keywordtype">void</span> explode();           <span class="comment">// Connected to buttonBoom::clicked().</span></div></div><!-- fragment --> The only exception is names of slots that use Qt's automatic connections to controls in .ui files. (See <code>QMetaObject::connectSlotsByName()</code>.)</li>
<li>The names of local variables should be in mixed case, starting with a lower-case letter (e.g. <code>packetSize</code>). This also applies to the formal parameters of methods. Do not use names starting with underscore.</li>
<li>The names of macro or static const should be all upper-case words, separated by underscore: <div class="fragment"><div class="line"><span class="preprocessor">#define MIN_WIDTH 3</span></div><div class="line"><span class="preprocessor">static const QString VERSION = &quot;0.10.1&quot;;</span></div></div><!-- fragment --></li>
<li>Indentation should be done with tabs, not spaces. This allows developers to use their favorite indent size without changing the code.</li>
<li>When wrapping lines from long function calls, where the wrapped line does not start at the same level of indentation as the start of the function call, tab up to the start of the function call, and then use spaces to the opening parenthesis. <pre class="fragment"> [--tab-][--tab-][--tab-]someFunction(param, ...
 [--tab-][--tab-][--tab-][  spaces   ]moreparams, ...);</pre> This method will handle different tab widths gracefully.</li>
<li>Use the following layout for braces: <pre class="fragment">void MyClass::myMethod(int x)
{
    if (x&gt;10)
    {
        cout &lt;&lt; "You won." &lt;&lt; endl;
    }
}</pre></li>
<li>Use blank lines as follows:<ul>
<li>1 between methods, before (block or single line) comment</li>
<li>1 between logical sections of a method</li>
<li>2 between sections of a source file</li>
</ul>
</li>
<li><code>enums</code> should follow the Qt conventions. i.e. CamelCase with First letter capitalization for both enum type and enum values. Document with doxygen. The <b>//!&lt; </b>tag can be used to add descriptions on the same line as an enum value, e.g. <pre class="fragment">//! @enum EnumName Here is a description of the enum
enum EnumName
{
    EnumValueOne,  //!&lt; Some doxygen description of EnumValueOne
    EnumValueTwo,  //!&lt; Some doxygen description of EnumValueTwo
    EnumValueThree //!&lt; Some doxygen description of EnumValueThree
};
</pre></li>
<li>You can use the <a href="http://astyle.sourceforge.net/">astyle</a> program to format your code according to these conventions. Use the following options: <pre class="fragment"> astyle --style=ansi -tU source.cpp
</pre> Note that this command will replace the file source.cpp with the re-formatted one, and create a backup of the original with the .orig suffix. Also note that the -U option (used to un-pad parenthesis) may not be available in older versions of <code>astyle</code>.</li>
</ul>
<h1><a class="anchor" id="file_names_sec"></a>
File Names</h1>
<p>The extensions are .hpp/.cpp for C++ headers/code, .h/.c for C headers/code. C++ files should have the same name and case than the class they contain. For example class StelFontMgr should be declared in file StelFontMgr.hpp and implemented in StelFontMgr.cpp.</p>
<h1><a class="anchor" id="comments_sec"></a>
Doxygen Comments</h1>
<p>Stellarium source code should be documented with <a href="http://www.doxygen.org">Doxygen</a>. From Doxygen webpage:</p>
<p><em>"Doxygen is a documentation system for C++, C, Java, [...] It can generate an on-line documentation browser (in HTML) and/or an off-line reference manual (in LaTeX) from a set of documented source files. [...] The documentation is extracted directly from the sources, which makes it much easier to keep the documentation consistent with the source code. [...] You can also visualize the relations between the various elements by means of include dependency graphs, inheritance diagrams, and collaboration diagrams, which are all generated automatically.</em></p>
<p>All public and protected classes and methods from Stellarium should be fully documented in the headers (.hpp).</p>
<p>There are different ways to comment C++ code with Doxygen, in Stellarium use the following for headers files: </p><pre class="fragment"> //! Find and return the list of at most maxNbItem objects auto-completing the passed object I18n name.
 //! @param objPrefix the case insensitive first letters of the searched object.
 //! @param maxNbItem the maximum number of returned object names.
 //! @return a vector of matching object name by order of relevance, or an empty vector if nothing match.
 QList&lt;QString&gt; listMatchingObjectsI18n(const QString&amp; objPrefix, unsigned int maxNbItem=5) const;
</pre><p>Brief descriptions are single line only, and stop at the first full stop (period). Any subsequent sentences which occur before @param or a similar tag are considered to be part of a detailed description.</p>
<p>For methods definitions in .cpp files, a simpler comment for each method is sufficient:</p>
<div class="fragment"><div class="line"><span class="comment">// Find and return the list of at most maxNbItem objects auto-completing the </span></div><div class="line"><span class="comment">// passed object I18n name.</span></div><div class="line">QList&lt;QString&gt; listMatchingObjectsI18n(<span class="keyword">const</span> QString&amp; objPrefix, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxNbItem=5)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">     etc..</div></div><!-- fragment --><h1><a class="anchor" id="cpp_code"></a>
C/C++ Code</h1>
<p>Use C++ replacement for C functions and Qt replacements for C++ functions/STL wherever possible.</p><ul>
<li>Use <a href="http://doc.qt.io/qt-5/qstring.html">QString</a> instead of <code>std::string</code> or <code>char *</code></li>
<li>Use <a href="http://doc.qt.io/qt-5/qiodevice.html">QIODevice</a> instead of C file managment with <code>fopen()</code> </li>
<li>Pass objects as references when needed instead of using pointers.</li>
<li>Include standard headers the C++ way, it is more portable: <div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span> <span class="comment">// Bad</span></div><div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span>  <span class="comment">// Good</span></div><div class="line"><span class="preprocessor">#include &lt;QString&gt;</span> <span class="comment">// Good</span></div></div><!-- fragment --></li>
<li>Use <a href="http://doc.qt.io/qt-5/containers.html">Qt containers</a> instead of STL ones. They are easier to use, allow for the foreach keyword. Only if speed is really critical, use STL containers such as <code>std::vector</code> or <code>std::map</code>, they are extremely efficient. Documentation is <a href="http://www.sgi.com/tech/stl/">there</a>.</li>
<li>Avoid public global functions and variables. Encapsulate them in classes or namespaces as static members/variables.</li>
<li>Avoid using C macros, use <code>static const</code> variables instead. It is safer because it is type safe. <div class="fragment"><div class="line"><span class="preprocessor">#define RADIUS 12 // Bad </span></div><div class="line"><span class="preprocessor">static const int RADIUS = 12; // Good</span></div></div><!-- fragment --></li>
<li>Use stdc++ math functions instead of C ones. There are more portable and are also overrided for float, thus may be faster. <div class="fragment"><div class="line"><span class="keywordtype">double</span> cosLat = cos(lat);     <span class="comment">// Bad </span></div><div class="line"><span class="keywordtype">double</span> cosLat = std::cos(lat); <span class="comment">// Good</span></div></div><!-- fragment --></li>
</ul>
<h1><a class="anchor" id="translation_sec"></a>
Translatable Strings and Console Output</h1>
<p>Translatable strings are translated using the <a class="el" href="classStelTranslator.html" title="Class used to translate strings to any language. ">StelTranslator</a> class, which is a C++ wrapper around <a href="http://www.gnu.org/software/gettext/">gettext</a>. A string literal can be marked for translation in with three different macros, <code>q_()</code>, <code>qc_()</code> or <code>N_()</code> , and you need to pick one for the appropriate purpose:</p><ul>
<li>The <code>q_()</code> macro takes a string in English and returns the translation as a QString using the current global language. This also allows calling <code>q_()</code> with a QString parameter to return a translation.</li>
<li>The <code>qc_()</code> macro is similar previous - he takes a two parameters - string in English and context of the string, and returns the translation as a QString using the current global language. This also allows calling qc_() with a two QString parameters to return a translation.</li>
<li>When a string literal needs to be marked for translation without returning a translation, use the <code>N_()</code> macro. It returns the original string.</li>
</ul>
<p>Several guidelines:</p><ul>
<li>Translatable text in sources or data files should be written in English, encoded in ASCII or UTF-8 if needed.</li>
<li>Translatable strings should be modified only if really necessary. Any modification to one of them means that all the translators for all the langages will have to re-translate the new string. This also means that new strings should be chosen carefully, to avoid the need to modify them later.</li>
<li>Do not concatenate strings, use <code>QString::arg()</code> instead. Concatenated strings are very hard (or even impossible) to translate. <div class="fragment"><div class="line">text &lt;&lt; q_(<span class="stringliteral">&quot;Distance: &quot;</span>) &lt;&lt; distance &lt;&lt; q_(<span class="stringliteral">&quot;AU&quot;</span>);   <span class="comment">// Bad</span></div><div class="line">text = q_(<span class="stringliteral">&quot;Distance: %1AU&quot;</span>).arg(distance);          <span class="comment">// Good</span></div></div><!-- fragment --></li>
<li>Translatable text should obey English typographic conventions. For example, there should be no space before the colon: <div class="fragment"><div class="line">QString myTranslatedText(q_(<span class="stringliteral">&quot;Distance of the planet :&quot;</span>)); <span class="comment">// Bad</span></div><div class="line">QString myTranslatedText(q_(<span class="stringliteral">&quot;Distance of the planet:&quot;</span>));  <span class="comment">// Good</span></div></div><!-- fragment --></li>
<li>In general no translated text should be output on the console because there are problems when string and wstring are output on the same console. This means that you should never use wcout, wcerr or wprintf(). Console output should be used for informations, errors and warnings which are not required by the user in nominal use.</li>
<li>Errors and warnings should be output in the stderr file, not stdout. [OBSOLETE? We use qDebug() and qWarning() now.] <div class="fragment"><div class="line">std::cout &lt;&lt; <span class="stringliteral">&quot;Error while opening file &quot;</span> &lt;&lt; qPrintable(myFileName) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl; <span class="comment">// Bad </span></div><div class="line">std::cerr &lt;&lt; <span class="stringliteral">&quot;Error while opening file &quot;</span> &lt;&lt; qPrintable(myFileName) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl; <span class="comment">// Good</span></div></div><!-- fragment --></li>
</ul>
<p>Further technical notes and tips:</p><ul>
<li><b>Important:</b> When using Qt format strings, if a letter follows a digit immediately, xgettext might erroneously mark the extracted string as a C format string. <em>Depending on the actual translation, this might cause errors when uploading the message catalog to Rosetta, or when compiling it to binary format.</em> To prevent this, add an <code>xgettext:no-c-format</code> comment to the line preceding the format string: <div class="fragment"><div class="line"><span class="comment">// xgettext:no-c-format</span></div><div class="line">text = q_(<span class="stringliteral">&quot;Distance: %1AU&quot;</span>).arg(distance);</div></div><!-- fragment --></li>
<li>You can add clarifying remarks for the translators by adding a special comment before the line marking the string. They will be automatically extracted and visible in the .po files and in the web interface: <div class="fragment"><div class="line"><span class="comment">// TRANSLATORS: Message displayed when an error occurs.</span></div><div class="line">QString errorMessage(q_(<span class="stringliteral">&quot;Loading failed.&quot;</span>));</div></div><!-- fragment --></li>
<li>User-visible strings in Qt <code>.ui</code> files (used for GUI windows) are marked for translation, unless the "translate" flag is unchecked. Note that these strings are actually extracted from the files generated by the <code>.ui</code> file compiler (<code>uic</code>) during compilation, and not from the <code>.ui</code> files themselves, so translation comments in the <code>.ui</code> files will be ignored.</li>
<li>When creating a <code>.ui</code> file with a new <a href="http://doc.qt.io/qt-5/qwidget.html">QWidget</a>, Qt Designer/Qt Creator sets the widget's <code>windowTitle</code> property to "Form", which then appears in translation templates and puzzles translators. It needs to be manually reset to an empty string.</li>
<li>Stellarium also supports <a href="http://www.gnu.org/software/gettext/manual/gettext.html#Contexts">gettext contexts</a> for the cases when identical English strings are used in different places with different meanings and therefore need to have different translations. Contexts are short strings used to indicate the difference both to the program and the people making the translations.<ul>
<li>In <code>.ui</code> files, for every property that holds a user-visible string, there's a "disambiguation" sub-property that can be used to indicate the context. It will be extracted together with the message (see above).</li>
<li>The <code>qc_()</code> macro can be used in the cases when context needs to be handled in the code itself. It is analogous to the <code>q_()</code> macro, but with two parameters - the second parameter is the context string. </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Dec 22 2019 18:00:53 for Stellarium by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
