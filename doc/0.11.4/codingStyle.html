<?xml version="1.0" encoding="utf-8"?>
<html>
    <head>
      <title>Stellarium: Coding Style Conventions in Stellarium</title>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32" rowspan="2"><a href="http://www.stellarium.org"><img src="stellarium-logo.png" align="left" border="0" /></a></td>
<td width="1" rowspan="2">&nbsp;&nbsp;</td>
<td style="font-size:120%;font-weight:bolder;">Stellarium 0.11.4</td>
<td align="right" valign="top" width="230" rowspan="2"></td></tr><tr>
<td class="postheader" valign="center">
 <a href="index.html">Home</a>&nbsp;&middot;
 <a href="namespaces.html">All&nbsp;Namespaces</a>&nbsp;&middot;
 <a href="classes.html">All&nbsp;Classes</a>&nbsp;&middot;
 <a href="functions.html">Functions</a>&nbsp;&middot;
 <a href="codingStyle.html">Coding Style</a>&nbsp;&middot;
 <a href="scripting.html">Scripting</a>&nbsp;&middot;
 <a href="plugins.html">Plugins</a>&nbsp;&middot;
 <a href="fileStructure.html">File Structure</a>
</td>
</tr>
</table>
<!-- Generated by Doxygen 1.6.3 -->
<div class="contents">


<h1><a class="anchor" id="codingStyle">Coding Style Conventions in Stellarium </a></h1><p>The increasing number of contributors require that we clearly define coding rules and guidelines. Although for historical reasons the current code of Stellarium does not always comply to these rules, they should now be respected for any addition or modification of the code.</p>
<h2><a class="anchor" id="stylistic_conventions_sec">
Stylistic Conventions</a></h2>
<ul>
<li>
Source code should use ASCII character set. Characters such as '&egrave;' or '&ouml;' are not portable when hard-coded. Gettext translated strings should be used for such characters. </li>
<li>
Variable names and comments should be in English. </li>
<li>
Class names are nouns, in mixed-case, with an initial upper-case letter and the first letter of each subsequent word capitalized (e.g. CoreFactory). </li>
<li>
Method names are verbs or nouns in mixed-case, starting with a lower-case letter (e.g. update() or addElement()). </li>
<li>
Methods that return a value should take the form getSize(). </li>
<li>
The names of local variables should be in mixed case, starting with a lower-case letter (e.g. packetSize). This also applies to the formal parameters of methods. Do not use names starting with underscore. </li>
<li>
The names of macro or static const should be all upper-case words, separated by underscore: <div class="fragment"><pre class="fragment"><span class="preprocessor">#define MIN_WIDTH 3</span>
<span class="preprocessor">static const QString VERSION = &quot;0.10.1&quot;;</span>
</pre></div> </li>
<li>
Indentation should be done with tabs, not spaces. This allows each developers to use his favorite indent size without changing the code. </li>
<li>
When wrapping lines from long function calls, where the wrapped line does not start at the same level of indentation as the start of the function call, tab up to the start of the function call, and then use spaces to the opening parenthesis. <div class="fragment"><pre class="fragment">
 [--tab-][--tab-][--tab-]someFunction(param, ...
 [--tab-][--tab-][--tab-][  spaces   ]moreparams, ...);
</pre></div> This method will handle different tab widths gracefully. </li>
<li>
Use the following layout for braces: <div class="fragment"><pre class="fragment"><span class="keywordtype">void</span> MyClass::myMethod(<span class="keywordtype">int</span> x)
{
    <span class="keywordflow">if</span> (x&gt;10)
    {
        cout &lt;&lt; <span class="stringliteral">&quot;You won.&quot;</span> &lt;&lt; endl;
    }
}
</pre></div> </li>
<li>
Use blank lines as follows: <ul>
<li>
1 between methods, before (block or single line) comment </li>
<li>
1 between logical sections of a method </li>
<li>
2 between sections of a source file </li>
</ul>
</li>
<li>
<p class="startli"><em>enums</em> should follow the Qt conventions. i.e. CamelCase with First letter capitalization for both enum type and enum values. Document with doxygen. The <b>//!&lt; </b>tag can be used to add descriptions on the same line as an enum value, e.g. </p>
<div class="fragment"><pre class="fragment">
//! @enum EnumName Here is a description of the enum
enum EnumName
{
	EnumValueOne,  //!&lt; Some doxygen description of EnumValueOne
	EnumValueTwo,  //!&lt; Some doxygen description of EnumValueTwo
	EnumValueThree //!&lt; Some doxygen description of EnumValueThree
};
</pre></div><p class="endli"></p>
</li>
<li>
You can use the <a href="http://astyle.sourceforge.net/">astyle</a> program to format your code according to these conventions. Use the following options: <div class="fragment"><pre class="fragment">
 astyle --style=ansi -tU source.cpp
</pre></div> Note that this command will replace the file source.cpp with the re-formatted one, and create a backup of the original with the .orig suffix. Also note that the -U option (used to un-pad parenthesis) is only available recent version of astyle. </li>
</ul>
<h2><a class="anchor" id="file_names_sec">
File Names</a></h2>
<p>The extensions are .hpp/.cpp for C++ headers/code, .h/.c for C headers/code. C++ files should have the same name and case than the class they contain. For example class StelFontMgr should be declared in file StelFontMgr.hpp and implemented in StelFontMgr.cpp.</p>
<h2><a class="anchor" id="comments_sec">
Doxygen Comments</a></h2>
<p>Stellarium source code should be documented with <a href="http://www.doxygen.org">Doxygen</a>. From Doxygen webpage:</p>
<p><em>"Doxygen is a documentation system for C++, C, Java, [...] It can generate an on-line documentation browser (in HTML) and/or an off-line reference manual (in LaTeX) from a set of documented source files. [...] The documentation is extracted directly from the sources, which makes it much easier to keep the documentation consistent with the source code. [...] You can also visualize the relations between the various elements by means of include dependency graphs, inheritance diagrams, and collaboration diagrams, which are all generated automatically.</em></p>
<p>All public and protected classes and methods from Stellarium should be fully documented in the headers (.hpp).</p>
<p>There are different ways to comment C++ code with Doxygen, in Stellarium use the following for headers files: </p>
<div class="fragment"><pre class="fragment">
 //! Find and return the list of at most maxNbItem objects auto-completing the passed object I18n name.
 //! @param objPrefix the case insensitive first letters of the searched object.
 //! @param maxNbItem the maximum number of returned object names.
 //! @return a vector of matching object name by order of relevance, or an empty vector if nothing match.
 QList&lt;QString&gt; listMatchingObjectsI18n(const QString&amp; objPrefix, unsigned int maxNbItem=5) const;
</pre></div><p>Brief descriptions are single line only, and stop at the first full stop (period). Any subsequent sentences which occur before @param or a similar tag are considered to be part of a detailed description.</p>
<p>For methods definitions in .cpp files, a simpler comment for each method is sufficient:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Find and return the list of at most maxNbItem objects auto-completing the </span>
<span class="comment">// passed object I18n name.</span>
QList&lt;QString&gt; listMatchingObjectsI18n(<span class="keyword">const</span> QString&amp; objPrefix, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> maxNbItem=5)<span class="keyword"> const</span>
<span class="keyword"></span>{
     etc..
</pre></div><h2><a class="anchor" id="cpp_code">
C/C++ Code</a></h2>
<p>Use C++ replacement for C functions and Qt replacements for C++ functions/STL wherever possible. </p>
<ul>
<li>
Use <a href="http://doc.trolltech.com/stable/qstring.html">QString</a> instead of <code>std::string</code> or <code>char *</code> </li>
<li>
Use <a href="http://doc.trolltech.com/stable/qiodevice.html">QIODevice</a> instead of C file managment with <code>fopen()</code> </li>
<li>
Pass objects as references when needed instead of using pointers. </li>
<li>
Include standard headers the C++ way, it is more portable: <div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;stdio.h&gt;</span> <span class="comment">// Bad</span>
<span class="preprocessor">#include &lt;cstdio&gt;</span>  <span class="comment">// Good</span>
<span class="preprocessor">#include &lt;QString&gt;</span> <span class="comment">// Good</span>
</pre></div> </li>
<li>
Use <a href="http://doc.trolltech.com/stable/containers.html">Qt containers</a> instead of STL ones. They are easier to use, allow for the foreach keyword. Only if speed is really critical, use STL containers such as <code>std::vector</code> or <code>std::map</code>, they are extremely efficient. Documentation is <a href="http://www.sgi.com/tech/stl/">there</a>. </li>
<li>
Avoid public global function and variable. Encapsulate them in classes or namespaces as static members/variable. </li>
<li>
Avoid using C macro, use static const variables instead. It is safer because it is type safe. <div class="fragment"><pre class="fragment"><span class="preprocessor">#define RADIUS 12 // Bad </span>
<span class="preprocessor">static const int RADIUS = 12; // Good</span>
</pre></div> </li>
<li>
Use stdc++ math functions instead of C ones. There are more portable and are also overrided for float, thus may be faster. <div class="fragment"><pre class="fragment"><span class="keywordtype">double</span> cosLat = cos(lat);     <span class="comment">// Bad </span>
<span class="keywordtype">double</span> cosLat = std::cos(lat); <span class="comment">// Good</span>
</pre></div> </li>
</ul>
<h2><a class="anchor" id="translation_sec">
Translatable Strings and Console Output</a></h2>
<p>Translatable strings are translated using the <a class="el" href="classStelTranslator.html" title="Class used to translate strings to any language.">StelTranslator</a> class, which is a C++ wrapper around gettext. The strings should be marked using the <code><a class="el" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_()</a></code> macro: it takes a QString in English and returns the translation as a QString using the current global language. Note that you can also call <a class="el" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_()</a> with a QString object to return a translation. In cases when a string literal needs to be marked for translation without returning a string, use the <a class="el" href="StelTranslator_8hpp.html#a2091f4107eaba5336ec06bb5e38a5711" title="A pseudo function call that serves as a marker for the automated extraction of messages...">N_()</a> macro.</p>
<ul>
<li>
Translatable text in sources or data files should be written in English, encoded in ASCII or UTF-8 if needed. </li>
<li>
Do not concatenate strings, use <code>QString::arg()</code> instead. Concatenated strings are very hard (or even impossible) to translate. <div class="fragment"><pre class="fragment"> text &lt;&lt; <a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;Distance: &quot;</span>) &lt;&lt; distance &lt;&lt; <a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;AU&quot;</span>);   <span class="comment">// Bad</span>
 text = <a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;Distance: %1AU&quot;</span>).arg(distance);          <span class="comment">// Good</span>
</pre></div> </li>
<li>
<p class="startli">When using Qt format strings, if a letter follows a digit immediately, xgettext might erroneously mark the extracted string as a C format string. ''Depending on the actual translation, this might cause errors when uploading the message catalog to Rosetta, or when compiling it to binary format.'' To prevent this, add an <code>xgettext:no-c-format</code> comment to the line preceding the format string: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// xgettext:no-c-format</span>
text = <a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;Distance: %1AU&quot;</span>).arg(distance);
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Translatable text should obey English typographic conventions. For example, there should be no space before the colon: </p>
<div class="fragment"><pre class="fragment">QString myTranslatedText(<a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;Distance of the planet :&quot;</span>)); <span class="comment">// Bad</span>
QString myTranslatedText(<a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;Distance of the planet:&quot;</span>));  <span class="comment">// Good</span>
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">You can add clarifying comments for the translators. They will be automatically extracted and visible in the .po files and in the web interface: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// TRANSLATORS: Message displayed when an error occurs.</span>
QString errorMessage(<a class="code" href="StelTranslator_8hpp.html#a70ee7d3ff903c868378e7f0647e99de2" title="Return the gettext translated english text str using the current global translator...">q_</a>(<span class="stringliteral">&quot;Loading failed.&quot;</span>));
</pre></div><p class="endli"></p>
</li>
<li>
<p class="startli">Strings in Qt .ui files (used for GUI windows) are marked for translation, unless the "translate" flag is unchecked. Note that these strings are actually extracted from the files generated by the .ui file compiler (uic), and not from the .ui files themselves, so translation comments in the .ui files will be ignored.</p>
<p class="endli"></p>
</li>
<li>
Translatable strings should be modified only if really necessary. Any modification to one of them means that all the translators for all the langages will have to re-translate the new string. </li>
<li>
In general no translated text should be output on the console because there are problems when string and wstring are output on the same console. This means that you should never use wcout, wcerr or wprintf(). Console output should be used for informations, errors and warnings which are not required by the user in nominal use. </li>
<li>
Errors and warnings should be output in the stderr file, not stdout. <div class="fragment"><pre class="fragment"> std::cout &lt;&lt; <span class="stringliteral">&quot;Error while opening file &quot;</span> &lt;&lt; qPrintable(myFileName) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl; <span class="comment">// Bad </span>
 std::cerr &lt;&lt; <span class="stringliteral">&quot;Error while opening file &quot;</span> &lt;&lt; qPrintable(myFileName) &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl; <span class="comment">// Good</span>
</pre></div> </li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Sat Aug 25 22:13:31 2012 for Stellarium by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
