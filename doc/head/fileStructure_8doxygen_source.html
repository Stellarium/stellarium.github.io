<?xml version="1.0" encoding="utf-8"?>
<html>
    <head>
      <title>Stellarium: /home/aw/devel/stellarium/trunk/doc/fileStructure.doxygen Source File</title>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32" rowspan="2"><a href="http://www.stellarium.org"><img src="stellarium-logo.png" align="left" border="0" /></a></td>
<td width="1" rowspan="2">&nbsp;&nbsp;</td>
<td style="font-size:120%;font-weight:bolder;">Stellarium 0.12.0</td>
<td align="right" valign="top" width="230" rowspan="2"></td></tr><tr>
<td class="postheader" valign="center">
 <a href="index.html">Home</a>&nbsp;&middot;
 <a href="namespaces.html">All&nbsp;Namespaces</a>&nbsp;&middot;
 <a href="classes.html">All&nbsp;Classes</a>&nbsp;&middot;
 <a href="functions.html">Functions</a>&nbsp;&middot;
 <a href="codingStyle.html">Coding Style</a>&nbsp;&middot;
 <a href="scripting.html">Scripting</a>&nbsp;&middot;
 <a href="plugins.html">Plugins</a>&nbsp;&middot;
 <a href="renderer.html">Renderer</a>&nbsp;&middot;
 <a href="fileStructure.html">File Structure</a>
</td>
</tr>
</table>
<!-- Generated by Doxygen 1.6.3 -->
  <div class="navpath"><a class="el" href="dir_fab2ffb31a9ca3269bc527080f43ff61.html">doc</a>
  </div>
<div class="contents">
<h1>fileStructure.doxygen</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Stellarium</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2009 Matthew Gates</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00007"></a>00007 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00008"></a>00008 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> *</span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> *</span>
<a name="l00015"></a>00015 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 *&lt;/tt&gt;: landscape textures and data files&lt;/li&gt;
<a name="l00068"></a>00068 &lt;/ul&gt;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 &lt;/li&gt;
<a name="l00071"></a>00071 &lt;/ul&gt;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 If a file exists in the &lt;em&gt;User Data Directory&lt;/em&gt;, it will be used in preference to a file with the same name existing in the &lt;em&gt;Installation Data Directory&lt;/em&gt;. This allows users to customise data files, textures and so on without modifying the originally installed files.
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 There are several reasons <span class="keywordflow">for</span> doing <span class="keyword">this</span>:
<a name="l00076"></a>00076 &lt;ul&gt;
<a name="l00077"></a>00077  &lt;li&gt;On machines which multiple user accounts, the &lt;em&gt;Installation Data Directory&lt;/em&gt; will likely not be writable by all users.  Without allowing the &lt;em&gt;User Data Directory&lt;/em&gt; files to over-ride &lt;em&gt;Installation Data Directory&lt;/em&gt; files such users could not customise the program without doing an entirely separate installation.&lt;/li&gt;
<a name="l00078"></a>00078  &lt;li&gt;On multi-user systems, different users can customise Stellarium without affecting other users of the program.&lt;/li&gt;
<a name="l00079"></a>00079  &lt;li&gt;Users who modify files in the &lt;em&gt;Installation Data Directory&lt;/em&gt; will likely have their work deleted or overwritten when they upgrade Stellarium. By keeping user-customised files separate from the installation, the upgrade procedure is easier to manage, and users have better security <span class="keywordflow">for</span> their work.&lt;/li&gt;
<a name="l00080"></a>00080  &lt;li&gt;Users who mess up a customisation attempt need only <span class="keyword">remove</span> the &lt;em&gt;User Data Directory&lt;/em&gt; copy of a file to <span class="keywordflow">return</span> to the original (working) copy.&lt;/li&gt;
<a name="l00081"></a>00081 &lt;/ul&gt;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 @section findingFile Finding files with the <a class="code" href="classStelFileMgr.html" title="Provides utilities for locating and handling files.">StelFileMgr</a> class
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 Whenever a file is needed in Stellarium, it should be located using the <a class="code" href="classStelFileMgr.html" title="Provides utilities for locating and handling files.">StelFileMgr</a> class. This class will find the file in the first location in the search path. An instance of this class is maintained by the <a class="code" href="classStelApp.html" title="Singleton main Stellarium application class.">StelApp</a> singleton. <a class="code" href="classStelFileMgr.html" title="Provides utilities for locating and handling files.">StelFileMgr</a>::findFile() will throw exceptions when a problem is encountered, so it is important to always use &lt;tt&gt;try ... catch ...&lt;/tt&gt; exception handling when using it.
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 For example. You are writing a class called <a class="code" href="classComet.html">Comet</a>, and wish to search for a data file called &lt;tt&gt;comets.dat&lt;/tt&gt; located in the &lt;tt&gt;data&lt;/tt&gt; directory, you would go about it like this:
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 @code
<a name="l00090"></a>00090 QString path;
<a name="l00091"></a>00091 try
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093     path = <a class="code" href="classStelApp.html#a1737cdc7266e4ecc8f2f259048e6f1b6" title="Get the StelApp singleton instance.">StelApp::getInstance</a>().getFileMgr().findFile(<span class="stringliteral">&quot;data/comets.dat&quot;</span>);
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 <span class="keywordflow">catch</span>(std::runtime_error&amp; e)
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     qWarning() &lt;&lt; <span class="stringliteral">&quot;Could not locate file: data/comets.dat : &quot;</span> &lt;&lt; e.what();
<a name="l00098"></a>00098 }
<a name="l00099"></a>00099 ...
<a name="l00100"></a>00100 @endcode
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 As you can see, the file is specified only by the partial path. This partial path is appended first to the &lt;em&gt;User Data Directory&lt;/em&gt;. If, and only <span class="keywordflow">if</span> the file is not found there, it is searched <span class="keywordflow">for</span> in the &lt;em&gt;Installation Data Directory&lt;/em&gt;.  Thus <span class="keywordflow">if</span> the user has a customised copy at: &lt;tt&gt;\&lt;User Data Directory&gt;/data/comets.dat&lt;/tt&gt; it will be used, <span class="keywordflow">else</span> the version in the &lt;em&gt;Installation Data Directory&lt;/em&gt; will be used.
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 @section exampleStarCatalogTool Example: Star Catalogue Download Tool
<a name="l00105"></a>00105 Stellarium ships with the first four star catalogue files of nine files. The implementation of a catalogue downloading tool helps ease the task <span class="keywordflow">for</span> users wanting the extra catalogues by automating the download and installation procedure.
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 The files which come with Stellarium are found by the partial paths:
<a name="l00108"></a>00108 @verbatim
<a name="l00109"></a>00109 stars/<span class="keywordflow">default</span>/stars_0_0v0_1.cat
<a name="l00110"></a>00110 stars/<span class="keywordflow">default</span>/stars_1_0v0_1.cat
<a name="l00111"></a>00111 stars/<span class="keywordflow">default</span>/stars_2_0v0_1.cat
<a name="l00112"></a>00112 stars/<span class="keywordflow">default</span>/stars_3_1v0_1.cat
<a name="l00113"></a>00113 <span class="keyword">@end</span>verbatim
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 Naturally, these files are to be located in the &lt;em&gt;Installation Data Directory&lt;/em&gt; (because they ship with the installer).
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 The catalogue downloader tool runs within Stellarium.  When it downloads extra star catalogue files, it should place them in the &lt;em&gt;User Data Directory&lt;/em&gt;. After downloading all the catalogues, the paths to the various files should look like <span class="keyword">this</span>:
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 @verbatim
<a name="l00120"></a>00120 &lt;Installation Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_0_0v0_1.cat
<a name="l00121"></a>00121 &lt;Installation Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_1_0v0_1.cat
<a name="l00122"></a>00122 &lt;Installation Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_2_0v0_1.cat
<a name="l00123"></a>00123 &lt;Installation Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_3_1v0_1.cat
<a name="l00124"></a>00124 &lt;User Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_4_1v0_0.cat
<a name="l00125"></a>00125 &lt;User Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_5_2v0_0.cat
<a name="l00126"></a>00126 &lt;User Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_6_2v0_0.cat
<a name="l00127"></a>00127 &lt;User Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_7_2v0_0.cat
<a name="l00128"></a>00128 &lt;User Data Directory&gt;/stars/<span class="keywordflow">default</span>/stars_8_2v0_0.cat
<a name="l00129"></a>00129 @endverbatim
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 It might be that someone makes a customised installer of Stellarium which includes all the star catalogues with the main installation - perhaps on a special edition DVD.  In <span class="keyword">this</span> <span class="keywordflow">case</span>, all the files would be in the &lt;em&gt; \&lt;Installation Data Directory&gt;/stars/default&lt;/em&gt; directory.  The downloader tool should be able to cope with <span class="keyword">this</span>, not re-downloading files into the &lt;em&gt;User Data Directory&lt;/em&gt; which already reside in the &lt;em&gt;Installation Data Directory&lt;/em&gt;.
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 */
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Nov 22 16:11:43 2012 for Stellarium by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
