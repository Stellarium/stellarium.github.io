<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Stellarium: File and Directory Structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extrastyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="stellarium-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Stellarium
   &#160;<span id="projectnumber">HEAD</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">File and Directory Structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro_structire">Introduction</a></li>
<li class="level1"><a href="#directoryStructure">Directory Structure</a></li>
<li class="level1"><a href="#installationDirectories">User and Installation directory separation</a></li>
<li class="level1"><a href="#findingFile">Finding files with the StelFileMgr class</a></li>
<li class="level1"><a href="#exampleStarCatalogTool">Example: Star Catalogue Download Tool</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="intro_structire"></a>
Introduction</h1>
<p>This article explains the directory and file layout which Stellarium uses from a programmer's perspective, lays out the rationale behind it, and uses examples to illustrate the way things work.</p>
<h1><a class="anchor" id="directoryStructure"></a>
Directory Structure</h1>
<p>Files are broadly separated by the type of data. For <em>StelModules</em> which need many data files, there is one directory. e.g. <em><a class="el" href="classStarMgr.html">StarMgr</a></em> files are stored in the <code>stars</code> directory, <em><a class="el" href="classLandscapeMgr.html">LandscapeMgr</a></em> files may be found in the <code>landscapes</code> directory.</p>
<p>There are also directories which are shared among modules and other parts of the program, for example the <code>textures</code> directory.</p>
<h1><a class="anchor" id="installationDirectories"></a>
User and Installation directory separation</h1>
<p>When Stellarium searches for data, texture and other files it looks in two separate locations: </p><ul>
<li>
<p class="startli">The <b><em>User Data Directory</em></b>, which stores per-user copies of any customised data files. It is the place where Stellarium saves the configuration file, recorded scripts and can also be used to override files in the <em>Installation Data Directory</em> if the user wishes to customise Stellarium. The location of this directory varies depending on the operating system.</p>
<table class="stel">
<tr class="header">
<td>OS</td><td>Location </td></tr>
<tr class="stel">
<td>Linux / BSD / other POSIX</td><td><code>$HOME/.stellarium</code> where <code>$HOME</code> is your home directory. </td></tr>
<tr class="stel">
<td>Windows 2000 / XP</td><td>This is the <code>Stellarium</code> sub-directory of your users application data directory (usually something like <code>C:\Documents and Settings\YOURUSERNAME\Application Data\Stellarium</code> </td></tr>
<tr class="stel">
<td>Windows Vista / 7 / 8 / 10</td><td>This is the <code>Stellarium</code> sub-directory of your users application data directory (usually something like <code>C:\Users\YOURUSERNAME\AppData\Roaming\Stellarium</code> </td></tr>
<tr class="stel">
<td>MacOS X</td><td><code>$HOME/Library/Application Support/Stellarium</code> where <code>$HOME</code> is your home directory. Note that you may have to change explorer's settings so you can view hidden files before you can navigate to this directory. </td></tr>
</table>
<p class="interli">The directory tree structure within the <em>User Data Directory</em> is the same as the <em>Installation Data Directory</em>. Any file which exists in the <em>User Data Directory</em> will over-ride that in the <em>Installation Data Directory</em>.</p>
<p class="interli">For example, to modify the position of a nebula texture, the user may copy the <code>nebulae/default/textures.json</code> file from the <em>Installation Data Directory</em> to the <code>nebulae/default</code> sub-directory of the <em>User Data Directory</em> and modify it there. In this manner, each user on a multi-user system may have their own customized Stellarium data files. </p>
<p class="endli"></p>
</li>
<li>
<p class="startli">The <b><em>Installation Data Directory</em></b>, which is where the program executable, libraries and all data files which are distributed with the program are installed. It is the place where Stellarium's data files are installed on your computer. This directory varies depending on the operating system.</p>
<table class="stel">
<tr class="header">
<td>OS</td><td>Location </td></tr>
<tr class="stel">
<td>Linux / BSD / other POSIX</td><td>It depends on the installation prefix used when building Stellarium. If you built from source, and didn't explicitly specify an install prefix, the prefix will be <code>/usr/local</code>. Typically, pre-built packages for distros will use the <code>/usr</code> prefix. The <em>Installation Data Directory</em> is <code>$PREFIX/share/stellarium</code> </td></tr>
<tr class="stel">
<td>Windows</td><td>It depends on where Stellarium is installed. The main Stellarium installation directory is the <em>Installation Data Directory</em>. Typically this will be <code>C:\Program Files\Stellarium\</code> </td></tr>
<tr class="stel">
<td>MacOS X</td><td>The Installation Data Directory is found inside the application bundle. </td></tr>
</table>
<p class="interli">Important data files which may be found in the <em>Installation Data Directory</em> include: </p><ul>
<li>
<code>data/ssystem_major.ini</code>: the solar system bodies description file (major planets and moons) </li>
<li>
<code>data/ssystem_minor.ini</code>: the solar system bodies description file (minor planets and comets) </li>
<li>
<code>stars/default/</code>: star catalogues </li>
<li>
<code>nebulae/default/</code>: nebula textures and data files </li>
<li>
<code>scripts/</code>: script files </li>
<li>
<code>textures/</code>: general purpose texture files (button icons etc) </li>
<li>
<code>landscapes/</code>: landscape textures and data files </li>
</ul>
<p class="endli"></p>
</li>
</ul>
<p>If a file exists in the <em>User Data Directory</em>, it will be used in preference to a file with the same name existing in the <em>Installation Data Directory</em>. This allows users to customise data files, textures and so on without modifying the originally installed files.</p>
<p>There are several reasons for doing this: </p><ul>
<li>
On machines which multiple user accounts, the <em>Installation Data Directory</em> will likely not be writable by all users. Without allowing the <em>User Data Directory</em> files to over-ride <em>Installation Data Directory</em> files such users could not customise the program without doing an entirely separate installation. </li>
<li>
On multi-user systems, different users can customise Stellarium without affecting other users of the program. </li>
<li>
Users who modify files in the <em>Installation Data Directory</em> will likely have their work deleted or overwritten when they upgrade Stellarium. By keeping user-customised files separate from the installation, the upgrade procedure is easier to manage, and users have better security for their work. </li>
<li>
Users who mess up a customisation attempt need only remove the <em>User Data Directory</em> copy of a file to return to the original (working) copy. </li>
</ul>
<h1><a class="anchor" id="findingFile"></a>
Finding files with the StelFileMgr class</h1>
<p>Whenever a file is needed in Stellarium, it should be located using the <a class="el" href="classStelFileMgr.html" title="Provides utilities for locating and handling files.">StelFileMgr</a> class. This class will find the file in the first location in the search path. An instance of this class is maintained by the <a class="el" href="classStelApp.html">StelApp</a> singleton. <a class="el" href="classStelFileMgr.html#a246035057fe810af5bd20f20d94eca4e" title="Search for a path within the search paths, for example &quot;textures/fog.png&quot;.">StelFileMgr::findFile()</a> will throw exceptions when a problem is encountered, so it is important to always use <code>try ... catch ...</code> exception handling when using it.</p>
<p>For example. You are writing a class called <a class="el" href="classComet.html">Comet</a>, and wish to search for a data file called <code>comets.dat</code> located in the <code>data</code> directory, you would go about it like this:</p>
<div class="fragment"><div class="line">QString path;</div>
<div class="line"><span class="keywordflow">try</span></div>
<div class="line">{</div>
<div class="line">    path = <a class="code" href="classStelApp.html#a1737cdc7266e4ecc8f2f259048e6f1b6" title="Get the StelApp singleton instance.">StelApp::getInstance</a>().getFileMgr().findFile(<span class="stringliteral">&quot;data/comets.dat&quot;</span>);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">catch</span>(std::runtime_error&amp; e)</div>
<div class="line">{</div>
<div class="line">    qWarning() &lt;&lt; <span class="stringliteral">&quot;Could not locate file: data/comets.dat : &quot;</span> &lt;&lt; e.what();</div>
<div class="line">}</div>
<div class="line">...</div>
</div><!-- fragment --><p>As you can see, the file is specified only by the partial path. This partial path is appended first to the <em>User Data Directory</em>. If, and only if the file is not found there, it is searched for in the <em>Installation Data Directory</em>. Thus if the user has a customised copy at: <code>&lt;User Data Directory&gt;/data/comets.dat</code> it will be used, else the version in the <em>Installation Data Directory</em> will be used.</p>
<h1><a class="anchor" id="exampleStarCatalogTool"></a>
Example: Star Catalogue Download Tool</h1>
<p>Stellarium ships with the first four star catalogue files of nine files. The implementation of a catalogue downloading tool helps ease the task for users wanting the extra catalogues by automating the download and installation procedure.</p>
<p>The files which come with Stellarium are found by the partial paths: </p><pre class="fragment">stars/default/stars_0_0v0_1.cat
stars/default/stars_1_0v0_1.cat
stars/default/stars_2_0v0_1.cat
stars/default/stars_3_1v0_1.cat
</pre><p>Naturally, these files are to be located in the <em>Installation Data Directory</em> (because they ship with the installer).</p>
<p>The catalogue downloader tool runs within Stellarium. When it downloads extra star catalogue files, it should place them in the <em>User Data Directory</em>. After downloading all the catalogues, the paths to the various files should look like this:</p>
<pre class="fragment">&lt;Installation Data Directory&gt;/stars/default/stars_0_0v0_1.cat
&lt;Installation Data Directory&gt;/stars/default/stars_1_0v0_1.cat
&lt;Installation Data Directory&gt;/stars/default/stars_2_0v0_1.cat
&lt;Installation Data Directory&gt;/stars/default/stars_3_1v0_1.cat
&lt;User Data Directory&gt;/stars/default/stars_4_1v0_0.cat
&lt;User Data Directory&gt;/stars/default/stars_5_2v0_0.cat
&lt;User Data Directory&gt;/stars/default/stars_6_2v0_0.cat
&lt;User Data Directory&gt;/stars/default/stars_7_2v0_0.cat
&lt;User Data Directory&gt;/stars/default/stars_8_2v0_0.cat
</pre><p>It might be that someone makes a customised installer of Stellarium which includes all the star catalogues with the main installation - perhaps on a special edition DVD. In this case, all the files would be in the <em> &lt;Installation Data Directory&gt;/stars/default</em> directory. The downloader tool should be able to cope with this, not re-downloading files into the <em>User Data Directory</em> which already reside in the <em>Installation Data Directory</em>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 13 2021 16:08:05 for Stellarium by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
