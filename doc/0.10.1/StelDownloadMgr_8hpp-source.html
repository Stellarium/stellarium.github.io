<?xml version="1.0" encoding="utf-8"?>
<html>
    <head>
      <title>Stellarium: core/StelDownloadMgr.hpp Source File</title>
      <LINK HREF="doxygen.css" REL="stylesheet" TYPE="text/css">
    </HEAD>
    <BODY BGCOLOR="#FFFFFF">
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><a href="http://www.stellarium.org"><img src="stellarium-logo.png" align="left" border="0" /></a></td>
<td width="1">&nbsp;&nbsp;</td>
<td class="postheader" valign="center">
 <a href="index.html">Home</a>&nbsp;&middot;
 <a href="namespaces.html">All&nbsp;Namespaces</a>&nbsp;&middot;
 <a href="classes.html">All&nbsp;Classes</a>&nbsp;&middot;
 <a href="functions.html">Functions</a>&nbsp;&middot;
 <a href="codingStyle.html">Coding Style</a>&nbsp;&middot;
 <a href="plugins.html">Plugins</a>&nbsp;&middot;
 <a href="fileStructure.html">File Structure</a>
</td>
<td align="right" valign="top" width="230"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.5.5 -->
<h1>core/StelDownloadMgr.hpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Stellarium</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2008 Fabien Chereau</span>
<a name="l00004"></a>00004 <span class="comment"> * </span>
<a name="l00005"></a>00005 <span class="comment"> * This program is free software; you can redistribute it and/or</span>
<a name="l00006"></a>00006 <span class="comment"> * modify it under the terms of the GNU General Public License</span>
<a name="l00007"></a>00007 <span class="comment"> * as published by the Free Software Foundation; either version 2</span>
<a name="l00008"></a>00008 <span class="comment"> * of the License, or (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="comment"> * </span>
<a name="l00010"></a>00010 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="comment"> * </span>
<a name="l00015"></a>00015 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="comment"> * along with this program; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="comment"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<a name="l00018"></a>00018 <span class="comment">*/</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#ifndef _STELDOWNLOADMGR_HPP_</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define _STELDOWNLOADMGR_HPP_ 1</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span> 
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;QObject&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;QNetworkReply&gt;</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">class </span>QProgressBar;
<a name="l00027"></a>00027 <span class="keyword">class </span>QDataStream;
<a name="l00028"></a>00028 <span class="keyword">class </span>QFile;
<a name="l00029"></a>00029 
<a name="l00034"></a><a class="code" href="classStelDownloadMgr.html">00034</a> <span class="keyword">class </span><a class="code" href="classStelDownloadMgr.html" title="Used to download files from the Internet.">StelDownloadMgr</a> : <span class="keyword">public</span> QObject
<a name="l00035"></a>00035 {
<a name="l00036"></a>00036     Q_OBJECT
<a name="l00037"></a>00037 <span class="keyword">public</span>:
<a name="l00038"></a>00038     <a class="code" href="classStelDownloadMgr.html" title="Used to download files from the Internet.">StelDownloadMgr</a>();
<a name="l00039"></a>00039     ~<a class="code" href="classStelDownloadMgr.html" title="Used to download files from the Internet.">StelDownloadMgr</a>();
<a name="l00040"></a>00040 
<a name="l00052"></a>00052     <span class="keywordtype">void</span> <span class="keyword">get</span>(<span class="keyword">const</span> QString&amp; <a class="code" href="classStelDownloadMgr.html#60e3bec7496cb44b56dc7b5b39298440" title="Get the URL of the remote file.">url</a>, <span class="keyword">const</span> QString&amp; filePath, quint16 csum);
<a name="l00053"></a>00053     <span class="comment">// Overridden version, needed because the default parameter csum=0 can't</span>
<a name="l00054"></a>00054     <span class="comment">// reliably set useChecksum to false - the actual checksum might be 0.</span>
<a name="l00055"></a>00055     <span class="keywordtype">void</span> <span class="keyword">get</span>(<span class="keyword">const</span> QString&amp; <a class="code" href="classStelDownloadMgr.html#60e3bec7496cb44b56dc7b5b39298440" title="Get the URL of the remote file.">url</a>, <span class="keyword">const</span> QString&amp; filePath);
<a name="l00056"></a>00056 
<a name="l00058"></a>00058     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#11e04c0b5d15aa71bb6ac47bc80a90f7" title="Abort the download and remove the partially downloaded file.">abort</a>();
<a name="l00059"></a>00059 
<a name="l00061"></a><a class="code" href="classStelDownloadMgr.html#60e3bec7496cb44b56dc7b5b39298440">00061</a>     QString <a class="code" href="classStelDownloadMgr.html#60e3bec7496cb44b56dc7b5b39298440" title="Get the URL of the remote file.">url</a>() {<span class="keywordflow">return</span> address;}
<a name="l00062"></a>00062 
<a name="l00064"></a><a class="code" href="classStelDownloadMgr.html#05e84a55a122c4b29af3e80db31e4509">00064</a>     QString <a class="code" href="classStelDownloadMgr.html#05e84a55a122c4b29af3e80db31e4509" title="Get a description of the last error that occurred.">errorString</a>() {<span class="keywordflow">return</span> reply ? reply-&gt;errorString() : QString();}
<a name="l00065"></a>00065 
<a name="l00067"></a>00067     QString <a class="code" href="classStelDownloadMgr.html#997d968a9a496017136fe17661c2d772" title="Get the local file name.">name</a>();
<a name="l00068"></a>00068     
<a name="l00073"></a><a class="code" href="classStelDownloadMgr.html#87498bb28d421732d368f229836e02c7">00073</a>     <span class="keywordtype">bool</span> <a class="code" href="classStelDownloadMgr.html#87498bb28d421732d368f229836e02c7" title="Whether or not to pop up a warning box if the user tries to quit.">blockQuit</a>() {<span class="keywordflow">return</span> inProgress &amp;&amp; block;}
<a name="l00074"></a>00074 
<a name="l00081"></a><a class="code" href="classStelDownloadMgr.html#efaf9212f9fb828f36a750eccdcf2083">00081</a>     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#efaf9212f9fb828f36a750eccdcf2083" title="If set to true and the user tries to quit Stellarium while downloading, a warning...">setBlockQuit</a>(<span class="keywordtype">bool</span> b) {block = b;}
<a name="l00082"></a>00082     
<a name="l00085"></a><a class="code" href="classStelDownloadMgr.html#d81ca8a1735dd02da824f90f2508557a">00085</a>     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#d81ca8a1735dd02da824f90f2508557a" title="If set to true, a progress bar will appear in the lower right-hand corner of the...">setBarVisible</a>(<span class="keywordtype">bool</span> b) {barVisible = b;}
<a name="l00086"></a>00086     
<a name="l00090"></a><a class="code" href="classStelDownloadMgr.html#2cd47dc8d4ffaed2a7d1ee00b0f56c71">00090</a>     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#2cd47dc8d4ffaed2a7d1ee00b0f56c71" title="Set the text format of the progress bar.">setBarFormat</a>(<span class="keyword">const</span> QString&amp; format) {barFormat = format;}
<a name="l00091"></a>00091 
<a name="l00093"></a><a class="code" href="classStelDownloadMgr.html#1567c74cce8a17455258e054dc761fca">00093</a>     <span class="keywordtype">bool</span> <a class="code" href="classStelDownloadMgr.html#1567c74cce8a17455258e054dc761fca" title="Find out if the download is still in progress.">isDownloading</a>() {<span class="keywordflow">return</span> inProgress;}
<a name="l00094"></a>00094 <span class="keyword">private</span>:
<a name="l00095"></a>00095     QString address;
<a name="l00096"></a>00096     QString path;
<a name="l00097"></a>00097     QNetworkReply* reply;
<a name="l00098"></a>00098     QFile* target;
<a name="l00099"></a>00099     <span class="keywordtype">bool</span> useChecksum;
<a name="l00100"></a>00100     quint16 checksum;
<a name="l00101"></a>00101     QDataStream* stream;
<a name="l00102"></a>00102     QProgressBar* progressBar;
<a name="l00103"></a>00103     QString barFormat;
<a name="l00104"></a>00104     qint64 received;
<a name="l00105"></a>00105     qint64 total;
<a name="l00106"></a>00106     <span class="keywordtype">bool</span> barVisible;
<a name="l00107"></a>00107     <span class="keywordtype">bool</span> inProgress;
<a name="l00108"></a>00108     <span class="keywordtype">bool</span> block;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="keyword">private</span> slots:
<a name="l00111"></a>00111     <span class="keywordtype">void</span> readData();
<a name="l00112"></a>00112     <span class="keywordtype">void</span> updateDownloadBar(qint64, qint64);
<a name="l00113"></a>00113     <span class="keywordtype">void</span> fin();
<a name="l00114"></a>00114     <span class="keywordtype">void</span> err(QNetworkReply::NetworkError);
<a name="l00115"></a>00115 signals:
<a name="l00123"></a>00123     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#0ac9e506da0d0b972643bf271efde7ac" title="Emitted when the file is completely downloaded and successfully verified (this differs...">finished</a>();
<a name="l00124"></a>00124     
<a name="l00132"></a>00132     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#c6e73954aaa6727815ed7153ed7a3c89" title="Emitted whenever the internal QNetworkReply object emits an error, except that QNetworkReply::Operat...">error</a>(QNetworkReply::NetworkError code, QString <a class="code" href="classStelDownloadMgr.html#05e84a55a122c4b29af3e80db31e4509" title="Get a description of the last error that occurred.">errorString</a>);
<a name="l00133"></a>00133     
<a name="l00135"></a>00135     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#6430d9ab2be99b81cca90bc2dccf9e84" title="Emitted when verifying a checksum.">verifying</a>();
<a name="l00136"></a>00136     
<a name="l00139"></a>00139     <span class="keywordtype">void</span> <a class="code" href="classStelDownloadMgr.html#9d36528f8bd55db2e8f66e1c5555f16a" title="Emitted if the provided checksum and downloaded file checksum do not match.">badChecksum</a>();
<a name="l00140"></a>00140 };
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="preprocessor">#endif // _STELDOWNLOADMGR_HPP_</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 2 17:23:47 2009 for Stellarium by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.5 </small></address>
</body>
</html>
