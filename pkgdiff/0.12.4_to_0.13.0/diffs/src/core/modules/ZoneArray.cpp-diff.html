<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: ZoneArray.cpp - ZoneArray.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;ZoneArray.cpp&nbsp;</th><th> </th><th>&nbsp;ZoneArray.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 20</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 20</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * This program is distributed in the hope that it will be useful,</td><td> </td><td class="right"> * This program is distributed in the hope that it will be useful,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td> </td><td class="right"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td> </td><td class="right"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * GNU General Public License for more details.</td><td> </td><td class="right"> * GNU General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with this program; if not, write to the Free Software</td><td> </td><td class="right"> * along with this program; if not, write to the Free Software</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td> </td><td class="right"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "ZoneArray.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelApp.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelFileMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelGeodesicGrid.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelObject.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelPainter.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QFile&gt;</td><td> </td><td class="right">#include &lt;QFile&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDir&gt;</td><td> </td><td class="right">#include &lt;QDir&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef Q_OS_WIN</td><td> </td><td class="right">#ifdef Q_OS_WIN</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;io.h&gt;</td><td> </td><td class="right">#include &lt;io.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;windows.h&gt;</td><td> </td><td class="right">#include &lt;windows.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "ZoneArray.hpp"</span></td><td> </td><td class="rblock">static unsigned int stel_bswap_32(unsigned int val)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "renderer/StelRenderer.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelApp.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelFileMgr.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelGeodesicGrid.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelObject.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">static unsigned int stel_bswap_32(unsigned int val) <span class="delete">{</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">  return (((val) &amp; 0xff000000) &gt;&gt; 24) | (((val) &amp; 0x00ff0000) &gt;&gt;  8) |</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       (((val) &amp; 0x0000ff00) &lt;&lt;  8) | (((val) &amp; 0x000000ff) &lt;&lt; 24);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">namespace BigStarCatalogExtension</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">return (((val) &amp; 0xff000000) &gt;&gt; 24) | (((val) &amp; 0x00ff0000) &gt;&gt;  8) |</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">              (((val) &amp; 0x0000ff00) &lt;&lt;  8) | (((val) &amp; 0x000000ff) &lt;&lt; 24);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static const Vec3f north(0,0,1);</td><td> </td><td class="right">static const Vec3f north(0,0,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void ZoneArray::initTriangle(int index, const Vec3f &amp;c0, const Vec3f &amp;c1,</td><td> </td><td class="rblock">void ZoneArray::initTriangle(int index, const Vec3f &amp;c0, const Vec3f &amp;c1, <span class="insert">c</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                             <span class="delete">const</span> Vec3f &amp;c2)</td><td> </td><td class="rblock"><span class="insert">onst</span> Vec3f &amp;c2)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // initialize center,axis0,axis1:</td><td> </td><td class="right">       // initialize center,axis0,axis1:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ZoneData &amp;z(zones[index]);</td><td> </td><td class="right">       ZoneData &amp;z(zones[index]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.center = c0+c1+c2;</td><td> </td><td class="right">       z.center = c0+c1+c2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.center.normalize();</td><td> </td><td class="right">       z.center.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.axis0 = north ^ z.center;</td><td> </td><td class="right">       z.axis0 = north ^ z.center;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.axis0.normalize();</td><td> </td><td class="right">       z.axis0.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.axis1 = z.center ^ z.axis0;</td><td> </td><td class="right">       z.axis1 = z.center ^ z.axis0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // <span class="delete">initialize star_position_scale:</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       double</span> mu0,mu1,f,h;</td><td> </td><td class="rblock">       // <span class="insert">Initialize star_position_scale. This scale is used to multiply st</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ars position</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // encoded as integers so that it optimize precision over the triang</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">le.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // It has to be computed for each triangle because the relative orie</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ntation of the 2 axis is different for each triangle.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       float</span> mu0,mu1,f,h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mu0 = (c0-z.center)*z.axis0;</td><td> </td><td class="right">       mu0 = (c0-z.center)*z.axis0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mu1 = (c0-z.center)*z.axis1;</td><td> </td><td class="right">       mu1 = (c0-z.center)*z.axis1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       f = <span class="delete">1.0/sqrt(1.0-mu0*mu0-mu1*mu1);</span></td><td> </td><td class="rblock">       f = <span class="insert">1.f/std::sqrt(1.f-mu0*mu0-mu1*mu1);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       h = <span class="delete">fabs(mu0)*f;</span></td><td> </td><td class="rblock">       h = <span class="insert">std::fabs(mu0)*f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (star_position_scale &lt; h) star_position_scale = h;</td><td> </td><td class="right">       if (star_position_scale &lt; h) star_position_scale = h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       h = fabs(mu1)*f;</td><td> </td><td class="rblock">       h = <span class="insert">std::</span>fabs(mu1)*f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (star_position_scale &lt; h) star_position_scale = h;</td><td> </td><td class="right">       if (star_position_scale &lt; h) star_position_scale = h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mu0 = (c1-z.center)*z.axis0;</td><td> </td><td class="right">       mu0 = (c1-z.center)*z.axis0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mu1 = (c1-z.center)*z.axis1;</td><td> </td><td class="right">       mu1 = (c1-z.center)*z.axis1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       f = <span class="delete">1.0/sqrt(1.0-mu0*mu0-mu1*mu1);</span></td><td> </td><td class="rblock">       f = <span class="insert">1.f/std::sqrt(1.f-mu0*mu0-mu1*mu1);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       h = <span class="delete">fabs(mu0)*f;</span></td><td> </td><td class="rblock">       h = <span class="insert">std::fabs(mu0)*f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (star_position_scale &lt; h) star_position_scale = h;</td><td> </td><td class="right">       if (star_position_scale &lt; h) star_position_scale = h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       h = fabs(mu1)*f;</td><td> </td><td class="rblock">       h = <span class="insert">std::</span>fabs(mu1)*f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (star_position_scale &lt; h) star_position_scale = h;</td><td> </td><td class="right">       if (star_position_scale &lt; h) star_position_scale = h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mu0 = (c2-z.center)*z.axis0;</td><td> </td><td class="right">       mu0 = (c2-z.center)*z.axis0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mu1 = (c2-z.center)*z.axis1;</td><td> </td><td class="right">       mu1 = (c2-z.center)*z.axis1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       f = <span class="delete">1.0/sqrt(1.0-mu0*mu0-mu1*mu1);</span></td><td> </td><td class="rblock">       f = <span class="insert">1.f/std::sqrt(1.f-mu0*mu0-mu1*mu1);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       h = <span class="delete">fabs(mu0)*f;</span></td><td> </td><td class="rblock">       h = <span class="insert">std::fabs(mu0)*f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (star_position_scale &lt; h) star_position_scale = h;</td><td> </td><td class="right">       if (star_position_scale &lt; h) star_position_scale = h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       h = fabs(mu1)*f;</td><td> </td><td class="rblock">       h = <span class="insert">std::</span>fabs(mu1)*f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (star_position_scale &lt; h) star_position_scale = h;</td><td> </td><td class="right">       if (star_position_scale &lt; h) star_position_scale = h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static inline int ReadInt(QFile&amp; file, unsigned int &amp;x)</td><td> </td><td class="right">static inline int ReadInt(QFile&amp; file, unsigned int &amp;x)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int rval = (4 == file.read((char*)&amp;x, 4)) ? 0 : -1;</td><td> </td><td class="right">       const int rval = (4 == file.read((char*)&amp;x, 4)) ? 0 : -1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return rval;</td><td> </td><td class="right">       return rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#if (!defined(__GNUC__))</td><td> </td><td class="right">#if (!defined(__GNUC__))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 170</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 170</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               dbStr += "error - not a catalogue file.";</td><td> </td><td class="right">               dbStr += "error - not a catalogue file.";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qDebug() &lt;&lt; dbStr;</td><td> </td><td class="right">               qDebug() &lt;&lt; dbStr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return 0;</td><td> </td><td class="right">               return 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ZoneArray *rval = 0;</td><td> </td><td class="right">       ZoneArray *rval = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       dbStr += QString("%1_%2v%3_%4; ").arg(level).arg(type).arg(major).ar
g(minor);</td><td> </td><td class="right">       dbStr += QString("%1_%2v%3_%4; ").arg(level).arg(type).arg(major).ar
g(minor);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       switch (type)</td><td> </td><td class="right">       switch (type)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       case 0:</td><td> </td><td class="rblock">               case 0:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (major &gt; MAX_MAJOR_FILE_VERSION)</td><td> </td><td class="rblock">                       if (major &gt; MAX_MAJOR_FILE_VERSION)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               {</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       dbStr += "warning - unsupported version ";</td><td> </td><td class="rblock">                               dbStr += "warning - unsupported version ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               }</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               else</td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               {</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // When this assertion fails you must <span class="delete">redefine</span> Star1</td><td> </td><td class="rblock">                               // When this assertion fails you must <span class="insert">redefi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // for your compiler.</td><td> </td><td class="rblock"><span class="insert">ne</span> Star1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // Because your compiler does not pack the <span class="delete">data,</span></td><td> </td><td class="rblock">                               // for your compiler.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // which is crucial for this application.</td><td> </td><td class="rblock">                               // Because your compiler does not pack the <span class="insert">d</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       Q_ASSERT(sizeof(Star1) == 28);</td><td> </td><td class="rblock"><span class="insert">ata,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       rval = new HipZoneArray(file, byte_swap, <span class="delete">use_mmap, l</span></td><td> </td><td class="rblock">                               // which is crucial for this application.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">evel,</span> mag_min, mag_range, mag_steps);</td><td> </td><td class="rblock">                               Q_ASSERT(sizeof(Star1) == 28);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if (rval == 0)</td><td> </td><td class="rblock">                               rval = new HipZoneArray(file, byte_swap, <span class="insert">use</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       {</td><td> </td><td class="rblock"><span class="insert">_mmap, level,</span> mag_min, mag_range, mag_steps);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               dbStr += "error - no memory ";</td><td> </td><td class="rblock">                               if (rval == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       }</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               }</td><td> </td><td class="rblock">                                       dbStr += "error - no memory ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               break;</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       case 1:</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (major &gt; MAX_MAJOR_FILE_VERSION)</td><td> </td><td class="rblock">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               {</td><td> </td><td class="rblock">               case 1:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       dbStr += "warning - unsupported version ";</td><td> </td><td class="rblock">                       if (major &gt; MAX_MAJOR_FILE_VERSION)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               }</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               else</td><td> </td><td class="rblock">                               dbStr += "warning - unsupported version ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               {</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // When this assertion fails you must <span class="delete">redefine</span> Star2</td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // for your compiler.</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // Because your compiler does not pack the <span class="delete">data,</span></td><td> </td><td class="rblock">                               // When this assertion fails you must <span class="insert">redefi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // which is crucial for this application.</td><td> </td><td class="rblock"><span class="insert">ne</span> Star2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               // for your compiler.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               // Because your compiler does not pack the <span class="insert">d</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ata,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               // which is crucial for this application.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef _MSC_BUILD</td><td> </td><td class="right">#ifndef _MSC_BUILD</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       Q_ASSERT(sizeof(Star2) == 10);</td><td> </td><td class="rblock">                       <span class="insert">        </span>Q_ASSERT(sizeof(Star2) == 10);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       rval = new SpecialZoneArray&lt;Star2&gt;(file, <span class="delete">byte_swap,</span> </td><td> </td><td class="rblock">                               rval = new SpecialZoneArray&lt;Star2&gt;(file, <span class="insert">byt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">use_mmap, level, mag_min, mag_range, mag_steps);</td><td> </td><td class="rblock"><span class="insert">e_swap,</span> use_mmap, level, mag_min, mag_range, mag_steps);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if (rval == 0)</td><td> </td><td class="rblock">                               if (rval == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               <span class="insert">{</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       dbStr += "error - no memory ";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       break;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               case 2:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (major &gt; MAX_MAJOR_FILE_VERSION)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               dbStr += "<span class="delete">error - no memory</span> ";</td><td> </td><td class="rblock">                               dbStr += "<span class="insert">warning - unsupported version</span> ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">}</span></td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               break;</span></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       case 2:</span></td><td> </td><td class="rblock">                               // When this assertion fails you must <span class="insert">redefi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               if (major &gt; MAX_MAJOR_FILE_VERSION)</span></td><td> </td><td class="rblock"><span class="insert">ne</span> Star3</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               {</span></td><td> </td><td class="rblock">                               // for your compiler.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       dbStr += "warning - unsupported version ";</span></td><td> </td><td class="rblock">                               // Because your compiler does not pack the <span class="insert">d</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               }</span></td><td> </td><td class="rblock"><span class="insert">ata,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               else</td><td> </td><td class="rblock">                               // which is crucial for this application.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               {</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // When this assertion fails you must <span class="delete">redefine</span> Star3</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // for your compiler.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // Because your compiler does not pack the <span class="delete">data,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // which is crucial for this application.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef _MSC_BUILD</td><td> </td><td class="right">#ifndef _MSC_BUILD</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       Q_ASSERT(sizeof(Star3) == 6);</td><td> </td><td class="rblock">                       <span class="insert">        </span>Q_ASSERT(sizeof(Star3) == 6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       rval = new SpecialZoneArray&lt;Star3&gt;(file, <span class="delete">byte_swap,</span> </td><td> </td><td class="rblock">                               rval = new SpecialZoneArray&lt;Star3&gt;(file, <span class="insert">byt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">use_mmap, level, mag_min, mag_range, mag_steps);</td><td> </td><td class="rblock"><span class="insert">e_swap,</span> use_mmap, level, mag_min, mag_range, mag_steps);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if (rval == 0)</td><td> </td><td class="rblock">                               if (rval == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       {</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               dbStr += "error - no memory ";</td><td> </td><td class="rblock">                                       dbStr += "error - no memory ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               <span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">}</span></td><td> </td><td class="rblock">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               break;</td><td> </td><td class="rblock">               default:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       default:</td><td> </td><td class="rblock">                       dbStr += "error - bad file type ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               dbStr += "error - bad file type ";</td><td> </td><td class="rblock">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               break;</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rval &amp;&amp; rval-&gt;isInitialized())</td><td> </td><td class="right">       if (rval &amp;&amp; rval-&gt;isInitialized())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               dbStr += QString("%1").arg(rval-&gt;getNrOfStars());</td><td> </td><td class="right">               dbStr += QString("%1").arg(rval-&gt;getNrOfStars());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qDebug() &lt;&lt; dbStr;</td><td> </td><td class="right">               qDebug() &lt;&lt; dbStr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               dbStr += " - initialization failed";</td><td> </td><td class="right">               dbStr += " - initialization failed";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qDebug() &lt;&lt; dbStr;</td><td> </td><td class="right">               qDebug() &lt;&lt; dbStr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rval)</td><td> </td><td class="right">               if (rval)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       delete rval;</td><td> </td><td class="right">                       delete rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rval = 0;</td><td> </td><td class="right">                       rval = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return rval;</td><td> </td><td class="right">       return rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">ZoneArray::ZoneArray(const QString&amp; fname, QFile* file, int level, int mag_
min,</td><td> </td><td class="right">ZoneArray::ZoneArray(const QString&amp; fname, QFile* file, int level, int mag_
min,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                     int mag_range, int mag_steps)</td><td> </td><td class="rblock">                        int mag_range, int mag_steps)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       : fname(fname), level(level), mag_min(mag_min),</td><td> </td><td class="rblock">                       : fname(fname), level(level), mag_min(mag_min),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         mag_range(mag_range), mag_steps(mag_steps),</td><td> </td><td class="rblock">                         mag_range(mag_range), mag_steps(mag_steps),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         star_position_scale(0.0), zones(0), file(file)</td><td> </td><td class="rblock">                         star_position_scale(0.0), zones(0), file(file)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_zones = StelGeodesicGrid::nrOfZones(level);</td><td> </td><td class="right">       nr_of_zones = StelGeodesicGrid::nrOfZones(level);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_stars = 0;</td><td> </td><td class="right">       nr_of_stars = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool ZoneArray::readFile(QFile&amp; file, void *data, qint64 size)</td><td> </td><td class="right">bool ZoneArray::readFile(QFile&amp; file, void *data, qint64 size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int parts = 256;</td><td> </td><td class="right">       int parts = 256;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int part_size = (size + (parts&gt;&gt;1)) / parts;</td><td> </td><td class="right">       int part_size = (size + (parts&gt;&gt;1)) / parts;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (part_size &lt; 64*1024)</td><td> </td><td class="right">       if (part_size &lt; 64*1024)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 308</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 308</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               hipIndex[hip].a = this;</td><td> </td><td class="right">                               hipIndex[hip].a = this;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               hipIndex[hip].z = z;</td><td> </td><td class="right">                               hipIndex[hip].z = z;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               hipIndex[hip].s = s;</td><td> </td><td class="right">                               hipIndex[hip].s = s;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">template&lt;class Star&gt;</td><td> </td><td class="right">template&lt;class Star&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SpecialZoneArray&lt;Star&gt;::scaleAxis(<span class="delete">void</span>)</td><td> </td><td class="rblock">void SpecialZoneArray&lt;Star&gt;::scaleAxis()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       star_position_scale /= Star::MaxPosVal;</td><td> </td><td class="right">       star_position_scale /= Star::MaxPosVal;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (ZoneData *z=zones+(nr_of_zones-1);z&gt;=zones;z--)</td><td> </td><td class="right">       for (ZoneData *z=zones+(nr_of_zones-1);z&gt;=zones;z--)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               z-&gt;axis0 *= star_position_scale;</td><td> </td><td class="right">               z-&gt;axis0 *= star_position_scale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               z-&gt;axis1 *= star_position_scale;</td><td> </td><td class="right">               z-&gt;axis1 *= star_position_scale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">template&lt;class Star&gt;</td><td> </td><td class="right">template&lt;class Star&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 484</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 484</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (zones)</td><td> </td><td class="right">       if (zones)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete[] getZones();</td><td> </td><td class="right">               delete[] getZones();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               zones = NULL;</td><td> </td><td class="right">               zones = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_zones = 0;</td><td> </td><td class="right">       nr_of_zones = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_stars = 0;</td><td> </td><td class="right">       nr_of_stars = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">template&lt;class Star&gt;</td><td> </td><td class="right">template&lt;class Star&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">SpecialZoneArray&lt;Star&gt;::draw</span></td><td> </td><td class="rblock">void <span class="insert">SpecialZoneArray&lt;Star&gt;::draw(StelPainter* sPainter,</span> int index, bool <span class="insert">is</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       (StelProjectorP projector, StelRenderer* renderer,</span> int index, bool <span class="delete">i</span></td><td> </td><td class="rblock"><span class="insert">InsideViewport,</span> const <span class="insert">RCMag* rcmag_table,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">s_inside,</span></td><td> </td><td class="rblock"><span class="insert">       int limitMagIndex,</span> StelCore* core, int <span class="insert">maxMagStarName,</span> float <span class="insert">names_b</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        const <span class="delete">float *rcmag_table,</span> StelCore* core, <span class="delete">unsigned</span> int <span class="delete">maxMagStarNa</span></td><td> </td><td class="rblock"><span class="insert">rightness, const QVector&lt;SphericalCap&gt; &amp;boundingCaps)</span> const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">me,</span></td><td> </td><td class="rblock">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        float <span class="delete">names_brightness)</span> const</td><td> </td><td class="rblock">    StelSkyDrawer* drawer = core-&gt;getSkyDrawer();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">{</td><td> </td><td class="rblock">    Vec3f vf;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       StelSkyDrawer* drawer = core-&gt;getSkyDrawer();</td><td> </td><td class="rblock">    static const double d2000 = 2451545.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">SpecialZoneData&lt;Star&gt; *const z = getZones() + index;</span></td><td> </td><td class="rblock">    const <span class="insert">float</span> movementFactor = (M_PI/180)*(0.0001/3600) * <span class="insert">((core-&gt;getJDay</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Vec3f vf;</td><td> </td><td class="rblock"><span class="insert">()-d2000)/365.25)</span> / star_position_scale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const Star *const end = z-&gt;getStars() + z-&gt;size;</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       static const double d2000 = 2451545.0;</td><td> </td><td class="rblock">    // <span class="insert">GZ, added for extinction</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const <span class="delete">double</span> movementFactor = (M_PI/180)*(0.0001/3600) * <span class="delete">((core-&gt;get</span></td><td> </td><td class="rblock"><span class="insert">    const Extinction&amp;</span> extinction=core-&gt;getSkyDrawer()-&gt;getExtinction();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">JDay()-d2000)/365.25)</span> / star_position_scale;</td><td> </td><td class="rblock">    const bool <span class="insert">withExtinction=drawer-&gt;getFlagHasAtmosphere()</span> &amp;&amp; <span class="insert">extinction.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const float* tmpRcmag;</span> // <span class="delete">will point to precomputed rC in table</span></td><td> </td><td class="rblock"><span class="insert">getExtinctionCoefficient()&gt;=0.01f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Extinction</span> extinction=core-&gt;getSkyDrawer()-&gt;getExtinction();</td><td> </td><td class="rblock">    const float k = <span class="insert">0.001f*mag_range/mag_steps;</span> // from StarMgr.cpp <span class="insert">line 65</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const bool <span class="delete">withExtinction=(drawer-&gt;getFlagHasAtmosphere()</span> &amp;&amp; <span class="delete">extinct</span></td><td> </td><td class="rblock"><span class="insert">4</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ion.getExtinctionCoefficient()&gt;=0.01f);</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const float k = <span class="delete">(0.001f*mag_range)/mag_steps;</span> // from StarMgr.cpp <span class="delete">li</span></td><td> </td><td class="rblock">       // <span class="insert">Allow</span> artificial cutoff:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ne 654</span></td><td> </td><td class="rblock">       // find the <span class="insert">(integer) mag at</span> which is just bright enough to be <span class="insert">drawn</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // <span class="delete">GZ: allow</span> artificial cutoff:</td><td> </td><td class="rblock"><span class="insert">.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const int clampStellarMagnitude_mmag = (int) floor(drawer-&gt;getCustom</span></td><td> </td><td class="rblock">       int <span class="insert">cutoffMagStep=limitMagIndex;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">StarMagnitudeLimit() * 1000.0f);</span></td><td> </td><td class="rblock"><span class="insert">       if (drawer-&gt;getFlagStarMagnitudeLimit())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // find <span class="delete">s-&gt;mag, which is</span> the <span class="delete">step into the magnitudes</span> which is just </td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">bright enough to be <span class="delete">drawn.</span></td><td> </td><td class="rblock"><span class="insert">               cutoffMagStep = ((int)(drawer-&gt;getCustomStarMagnitudeLimit()</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       int <span class="delete">cutoffMagStep=(drawer-&gt;getFlagStarMagnitudeLimit() ? (clampStell</span></td><td> </td><td class="rblock"><span class="insert">*1000.f)</span> - <span class="insert">mag_min)*mag_steps/mag_range;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">arMagnitude_mmag</span> - <span class="delete">mag_min)*mag_steps/mag_range : mag_steps);</span></td><td> </td><td class="rblock"><span class="insert">               if (cutoffMagStep&gt;limitMagIndex)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">                       cutoffMagStep = limitMagIndex;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // <span class="delete">go</span> through all stars, which are sorted by magnitude (bright stars</td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> first)</td><td> </td><td class="rblock"><span class="insert">       Q_ASSERT(cutoffMagStep&lt;RCMAG_TABLE_SIZE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       for (const <span class="delete">Star *s=z-&gt;getStars();s&lt;end;++s)</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       {</td><td> </td><td class="rblock">       // <span class="insert">Go</span> through all stars, which are sorted by magnitude (bright stars</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (s-&gt;mag &gt; cutoffMagStep) break; // <span class="delete">e.g. naked-eye stars o</span></td><td> </td><td class="rblock"> first)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">nly.</span></td><td> </td><td class="rblock">       <span class="insert">const SpecialZoneData&lt;Star&gt;* zoneToDraw = getZones() + index;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               tmpRcmag = <span class="delete">rcmag_table+2*s-&gt;mag;</span></td><td> </td><td class="rblock"><span class="insert">       const Star* lastStar = zoneToDraw-&gt;getStars() + zoneToDraw-&gt;size;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               if (*tmpRcmag&lt;=0.f) break;</span> // <span class="delete">no size for this and following</span></td><td> </td><td class="rblock">    for (const <span class="insert">Star* s=zoneToDraw-&gt;getStars();s&lt;lastStar;++s)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"> (even dimmer, unextincted) stars? --&gt; early exit</span></td><td> </td><td class="rblock">    {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               s-&gt;getJ2000Pos(z,movementFactor,</span> vf);</td><td> </td><td class="rblock">               <span class="insert">// Artifical cutoff per magnitude</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               if (s-&gt;mag &gt; cutoffMagStep)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">const Vec3d vd(vf[0], vf[1], vf[2]);</span></td><td> </td><td class="rblock">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if <span class="delete">(withExtinction)</span></td><td> </td><td class="rblock">               // <span class="insert">Because of the test above, the star should always be visi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               {</td><td> </td><td class="rblock"><span class="insert">ble from this point.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">//GZ: We must compute position first, then shift mag</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">nitude.</span></td><td> </td><td class="rblock"><span class="insert">               // Array of 2 numbers containing radius and magnitude</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       Vec3d altAz = core-&gt;j2000ToAltAz(vd, StelCore::Refra</span></td><td> </td><td class="rblock"><span class="insert">               const RCMag*</span> tmpRcmag = <span class="insert">&amp;rcmag_table[s-&gt;mag];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ctionOn);</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       float extMagShift = 0.0f;</span></td><td> </td><td class="rblock">               // <span class="insert">Get the star position from the array</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       extinction.forward(&amp;altAz, &amp;extMagShift);</span></td><td> </td><td class="rblock"><span class="insert">               s-&gt;getJ2000Pos(zoneToDraw, movementFactor,</span> vf);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       const int extMagShiftStep</span> =</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">qMin((int)floor(extMagShift / k), RCMAG_TABL</span></td><td> </td><td class="rblock">               <span class="insert">// If the star zone is not strictly contained inside the vie</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">E_SIZE-mag_steps);</span></td><td> </td><td class="rblock"><span class="insert">wport, eliminate from the</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if <span class="delete">((s-&gt;mag + extMagShiftStep) &gt; cutoffMagStep)</span> // <span class="delete">i</span></td><td> </td><td class="rblock"><span class="insert">               // beginning the stars actually outside viewport.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">.e.,</span> if <span class="delete">extincted it is dimmer than cutoff, so remove [draw with hopefully </span></td><td> </td><td class="rblock">               if <span class="insert">(!isInsideViewport)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">zero size].</span></td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       {</td><td> </td><td class="rblock">                       <span class="insert">bool isVisible</span> = <span class="insert">true;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">tmpRcmag</span> = <span class="delete">rcmag_table + 2 * (RCMAG_TABLE_SI</span></td><td> </td><td class="rblock"><span class="insert">                       foreach (const SphericalCap&amp; cap, boundingCaps)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ZE-1);</span></td><td> </td><td class="rblock"><span class="insert">                       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       }</td><td> </td><td class="rblock"><span class="insert">                               // Don't use</span> if <span class="insert">(!cap.contains(vf)) here bec</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">else</span></td><td> </td><td class="rblock"><span class="insert">ause we don't want to normalize the vector yet, but know</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock">                               // <span class="insert">that it's almost normalized, enough for m</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               tmpRcmag = rcmag_table + 2 * (s-&gt;mag+extMagS</span></td><td> </td><td class="rblock"><span class="insert">anually computing the intersection avoiding the assert.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">hiftStep);</span></td><td> </td><td class="rblock">                               if <span class="insert">(vf[0]*static_cast&lt;float&gt;(cap.n[0])+vf[1]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">*static_cast&lt;float&gt;(cap.n[1])+vf[2]*static_cast&lt;float&gt;(cap.n[2])&lt;static_cas</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">t&lt;float&gt;(cap.d))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                       <span class="insert">isVisible</span> = <span class="insert">false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       continue;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       <span class="insert">if (!isVisible)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               continue;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">Vec3f win;</span></td><td> </td><td class="rblock">               <span class="insert">int extinctedMagIndex = s-&gt;mag;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               if(drawer-&gt;pointSourceVisible(&amp;(*projector), vf, tmpRcmag, !</span></td><td> </td><td class="rblock"><span class="insert">               if (withExtinction)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">is_inside, win))</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">drawer-&gt;drawPointSource(win, tmpRcmag, s-&gt;bV);</span></td><td> </td><td class="rblock">                       <span class="insert">Vec3f altAz(vf);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       if(s-&gt;hasName() &amp;&amp;</span> s-&gt;mag &lt; maxMagStarName &amp;&amp; <span class="delete">s-&gt;has</span></td><td> </td><td class="rblock"><span class="insert">                       altAz.normalize();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ComponentID()&lt;=1)</span></td><td> </td><td class="rblock"><span class="insert">                       core-&gt;j2000ToAltAzInPlaceNoRefraction(&amp;altAz);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       {</td><td> </td><td class="rblock"><span class="insert">                       float extMagShift=0.0f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               const float offset = <span class="delete">*tmpRcmag*0.7f;</span></td><td> </td><td class="rblock"><span class="insert">                       extinction.forward(altAz, &amp;extMagShift);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               const <span class="delete">Vec3f&amp;</span> colorr = <span class="delete">(StelApp::getInstance(</span></td><td> </td><td class="rblock"><span class="insert">                       extinctedMagIndex =</span> s-&gt;mag <span class="insert">+ (int)(extMagShift/k);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">).getVisionModeNight() ? Vec3f(0.8f, 0.0f, 0.0f) : StelSkyDrawer::indexToCo</span></td><td> </td><td class="rblock"><span class="insert">                       if (extinctedMagIndex &gt;= cutoffMagStep) // i.e., if </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">lor(s-&gt;bV))*0.75f;</span></td><td> </td><td class="rblock"><span class="insert">extincted it is dimmer than cutoff, so remove</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">                               continue;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               renderer-&gt;setGlobalColor(colorr[0], colorr[1</span></td><td> </td><td class="rblock"><span class="insert">                       tmpRcmag = &amp;rcmag_table[extinctedMagIndex];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">], colorr[2], names_brightness);</span></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               renderer-&gt;drawText(TextParams(vf, projector,</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"> s-&gt;getNameI18n())</span></td><td> </td><td class="rblock"><span class="insert">               if (drawer-&gt;drawPointSource(sPainter, vf, *tmpRcmag, s-&gt;bV, </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                                  .shift(offset, offset).us</span></td><td> </td><td class="rblock"><span class="insert">!isInsideViewport) &amp;&amp; s-&gt;hasName() &amp;&amp; extinctedMagIndex</span> &lt; maxMagStarName &amp;&amp;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">eGravity());</span></td><td> </td><td class="rblock"> <span class="insert">s-&gt;hasComponentID()&lt;=1)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       const float offset = <span class="insert">tmpRcmag-&gt;radius*0.7f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       const <span class="insert">Vec3f</span> colorr = <span class="insert">StelSkyDrawer::indexToColor(s-&gt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">bV)*0.75f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;setColor(colorr[0], colorr[1], colorr[2],n</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ames_brightness);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;drawText(Vec3d(vf[0], vf[1], vf[2]), s-&gt;ge</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">tNameI18n(), 0, offset, offset, false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">   </span>}</td><td> </td><td class="rblock">    }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">template&lt;class Star&gt;</td><td> </td><td class="right">template&lt;class Star&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">SpecialZoneArray&lt;Star&gt;::searchAround</span></td><td> </td><td class="rblock">void <span class="insert">SpecialZoneArray&lt;Star&gt;::searchAround(const</span> StelCore* core, int index, </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       (const</span> StelCore* core, int index, const Vec3d &amp;v, double cosLimFov,</td><td> </td><td class="rblock">const Vec3d &amp;v, double cosLimFov,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        QList&lt;StelObjectP &gt; &amp;result)</td><td> </td><td class="rblock">                                         QList&lt;StelObjectP &gt; &amp;result)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static const double d2000 = 2451545.0;</td><td> </td><td class="right">       static const double d2000 = 2451545.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double movementFactor = (M_PI/180.)*(0.0001/3600.) * ((core-&gt;g
etJDay()-d2000)/365.25)/ star_position_scale;</td><td> </td><td class="right">       const double movementFactor = (M_PI/180.)*(0.0001/3600.) * ((core-&gt;g
etJDay()-d2000)/365.25)/ star_position_scale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const SpecialZoneData&lt;Star&gt; *const z = getZones()+index;</td><td> </td><td class="right">       const SpecialZoneData&lt;Star&gt; *const z = getZones()+index;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f tmp;</td><td> </td><td class="right">       Vec3f tmp;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f vf(v[0], v[1], v[2]);</td><td> </td><td class="right">       Vec3f vf(v[0], v[1], v[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (const Star* s=z-&gt;getStars();s&lt;z-&gt;getStars()+z-&gt;size;++s)</td><td> </td><td class="right">       for (const Star* s=z-&gt;getStars();s&lt;z-&gt;getStars()+z-&gt;size;++s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               s-&gt;getJ2000Pos(z,movementFactor, tmp);</td><td> </td><td class="right">               s-&gt;getJ2000Pos(z,movementFactor, tmp);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               tmp.normalize();</td><td> </td><td class="right">               tmp.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (tmp*vf &gt;= cosLimFov)</td><td> </td><td class="right">               if (tmp*vf &gt;= cosLimFov)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // TODO: do not select stars that are too faint to d
isplay</td><td> </td><td class="right">                       // TODO: do not select stars that are too faint to d
isplay</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       result.push_back(s-&gt;createStelObject(this,z));</td><td> </td><td class="right">                       result.push_back(s-&gt;createStelObject(this,z));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">} // namespace BigStarCatalogExtension</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 28 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>177 lines changed or deleted</i></th><th><i> </i></th><th><i>201 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
