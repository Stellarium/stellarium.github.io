<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.home 4.4.0-67-generic #88-Ubuntu SMP Wed Mar 8 16:34:45 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.1.3, API: 1.1 (GNU MPFR 3.1.4, GNU MP 6.1.0) --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Scenery3d.cpp - Scenery3d.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Scenery3d.cpp&nbsp;</th><th> </th><th>&nbsp;Scenery3d.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 23</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 23</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td> </td><td class="right"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * GNU General Public License for more details.</td><td> </td><td class="right"> * GNU General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with this program; if not, write to the Free Software</td><td> </td><td class="right"> * along with this program; if not, write to the Free Software</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td> </td><td class="right"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtGlobal&gt;</td><td> </td><td class="right">#include &lt;QtGlobal&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#if !defined(Q_OS_WIN)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">//exclude StelOpenGL here on windows because of conflicts with GLFuncs.hpp </span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">otherwise (uses QOpenGLFunctions_1_0 directly)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelOpenGL.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#endif</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">//needs to be included before StelOpenGL on Windows</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "GLFuncs.hpp"</td><td> </td><td class="right">#include "GLFuncs.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                                                           </span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "Scenery3d.hpp"</td><td> </td><td class="right">#include "Scenery3d.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelFileMgr.hpp"</td><td> </td><td class="right">#include "StelFileMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelPainter.hpp"</td><td> </td><td class="right">#include "StelPainter.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelModuleMgr.hpp"</td><td> </td><td class="right">#include "StelModuleMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelMovementMgr.hpp"</td><td> </td><td class="right">#include "StelMovementMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTranslator.hpp"</td><td> </td><td class="right">#include "StelTranslator.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelUtils.hpp"</td><td> </td><td class="right">#include "StelUtils.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 52</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 46</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "SolarSystem.hpp"</td><td> </td><td class="right">#include "SolarSystem.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "Scenery3dMgr.hpp"</td><td> </td><td class="right">#include "Scenery3dMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "AABB.hpp"</td><td> </td><td class="right">#include "AABB.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QKeyEvent&gt;</td><td> </td><td class="right">#include &lt;QKeyEvent&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QSettings&gt;</td><td> </td><td class="right">#include &lt;QSettings&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;stdexcept&gt;</td><td> </td><td class="right">#include &lt;stdexcept&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;cmath&gt;</td><td> </td><td class="right">#include &lt;cmath&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QOpenGLShaderProgram&gt;</td><td> </td><td class="right">#include &lt;QOpenGLShaderProgram&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include &lt;QOpenGLFramebufferObject&gt;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#define GET_GLERROR()                                   <span class="delete">\</span></td><td> </td><td class="rblock">#define GET_GLERROR() <span class="insert">StelOpenGL::checkGLErrors(__FILE__,__LINE__);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">{                                                       \</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    GLenum err = glGetError();                          \</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    if (err != GL_NO_ERROR) {                           \</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    qWarning("[line %d] GL Error: %d",__LINE__, err);   \</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    }                                                   \</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//macro for easier uniform setting</td><td> </td><td class="right">//macro for easier uniform setting</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define SET_UNIFORM(shd,uni,val) shd-&gt;setUniformValue(shaderManager.uniform
Location(shd,uni),val)</td><td> </td><td class="right">#define SET_UNIFORM(shd,uni,val) shd-&gt;setUniformValue(shaderManager.uniform
Location(shd,uni),val)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static const float LUNAR_BRIGHTNESS_FACTOR=0.2f;</td><td> </td><td class="right">static const float LUNAR_BRIGHTNESS_FACTOR=0.2f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static const float VENUS_BRIGHTNESS_FACTOR=0.005f;</td><td> </td><td class="right">static const float VENUS_BRIGHTNESS_FACTOR=0.005f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef QT_OPENGL_ES_2</td><td> </td><td class="right">#ifndef QT_OPENGL_ES_2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//this is the place where this is initialized</td><td> </td><td class="right">//this is the place where this is initialized</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">GLExtFuncs* glExtFuncs;</td><td> </td><td class="right">GLExtFuncs* glExtFuncs;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 115</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 102</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.openglES = false;</td><td> </td><td class="right">       shaderParameters.openglES = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.shadowTransform = false;</td><td> </td><td class="right">       shaderParameters.shadowTransform = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.pixelLighting = false;</td><td> </td><td class="right">       shaderParameters.pixelLighting = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.bump = false;</td><td> </td><td class="right">       shaderParameters.bump = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.shadows = false;</td><td> </td><td class="right">       shaderParameters.shadows = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.shadowFilterQuality = S3DEnum::SFQ_LOW;</td><td> </td><td class="right">       shaderParameters.shadowFilterQuality = S3DEnum::SFQ_LOW;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.pcss = false;</td><td> </td><td class="right">       shaderParameters.pcss = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.geometryShader = false;</td><td> </td><td class="right">       shaderParameters.geometryShader = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.torchLight = false;</td><td> </td><td class="right">       shaderParameters.torchLight = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.frustumSplits = 0;</td><td> </td><td class="right">       shaderParameters.frustumSplits = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       shaderParameters.hwShadowSamplers = false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sceneBoundingBox = AABB(Vec3f(0.0f), Vec3f(0.0f));</td><td> </td><td class="right">       sceneBoundingBox = AABB(Vec3f(0.0f), Vec3f(0.0f));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       debugTextFont.setFamily("Courier");</td><td> </td><td class="right">       debugTextFont.setFamily("Courier");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       debugTextFont.setPixelSize(16);</td><td> </td><td class="right">       debugTextFont.setPixelSize(16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       #ifndef NDEBUG</td><td> </td><td class="right">       #ifndef NDEBUG</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       qDebug()&lt;&lt;"Scenery3d constructor...done";</td><td> </td><td class="right">       qDebug()&lt;&lt;"Scenery3d constructor...done";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       #endif</td><td> </td><td class="right">       #endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 256</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 244</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               heightmapLoad = NULL;</td><td> </td><td class="right">               heightmapLoad = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       parent-&gt;updateProgress(q_("Finalizing load..."),6,0,6);</td><td> </td><td class="right">       parent-&gt;updateProgress(q_("Finalizing load..."),6,0,6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Scenery3d::finalizeLoad()</td><td> </td><td class="right">void Scenery3d::finalizeLoad()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">//must ensure the correct GL context is active!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       //this is not guaranteed with the new QOpenGLWidget outside of init(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">) and draw()!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       StelApp::getInstance().ensureGLContextCurrent();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       currentScene = loadingScene;</td><td> </td><td class="right">       currentScene = loadingScene;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //move load data to current one</td><td> </td><td class="right">       //move load data to current one</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       objModel = objModelLoad;</td><td> </td><td class="right">       objModel = objModelLoad;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       objModelLoad.clear();</td><td> </td><td class="right">       objModelLoad.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       groundModel = groundModelLoad;</td><td> </td><td class="right">       groundModel = groundModelLoad;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       groundModelLoad.clear();</td><td> </td><td class="right">       groundModelLoad.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //upload GL</td><td> </td><td class="right">       //upload GL</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       objModel-&gt;uploadBuffersGL();</td><td> </td><td class="right">       objModel-&gt;uploadBuffersGL();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 593</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 585</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       SET_UNIFORM(shader,static_cast&lt;ShaderMgr::UNIFORM&gt;(S
haderMgr::UNIFORM_MAT_SHADOW0+i), shadowCPM.at(i));</td><td> </td><td class="right">                       SET_UNIFORM(shader,static_cast&lt;ShaderMgr::UNIFORM&gt;(S
haderMgr::UNIFORM_MAT_SHADOW0+i), shadowCPM.at(i));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               //Send squared splits to the shader</td><td> </td><td class="right">               //Send squared splits to the shader</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               shader-&gt;setUniformValue(loc, splitData.v[0], splitData.v[1],
 splitData.v[2], splitData.v[3]);</td><td> </td><td class="right">               shader-&gt;setUniformValue(loc, splitData.v[0], splitData.v[1],
 splitData.v[2], splitData.v[3]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if(shaderParameters.shadowFilterQuality&gt;S3DEnum::SFQ_HARDWAR
E)</td><td> </td><td class="right">               if(shaderParameters.shadowFilterQuality&gt;S3DEnum::SFQ_HARDWAR
E)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //send size of light ortho for each frustum</td><td> </td><td class="right">                       //send size of light ortho for each frustum</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       loc = shaderManager.uniformLocation(shader,ShaderMgr
::UNIFORM_VEC_LIGHTORTHOSCALE);</td><td> </td><td class="right">                       loc = shaderManager.uniformLocation(shader,ShaderMgr
::UNIFORM_VEC_LIGHTORTHOSCALE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       shader-&gt;setUniformValueArray(loc,shadowFrustumSize.c
onstData(),<span class="delete">4</span>);</td><td> </td><td class="rblock">                       shader-&gt;setUniformValueArray(loc,shadowFrustumSize.c
onstData(),<span class="insert">shaderParameters.frustumSplits</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       loc = shaderManager.uniformLocation(shader,ShaderMgr::UNIFORM_MAT_CU
BEMVP);</td><td> </td><td class="right">       loc = shaderManager.uniformLocation(shader,ShaderMgr::UNIFORM_MAT_CU
BEMVP);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(loc&gt;=0)</td><td> </td><td class="right">       if(loc&gt;=0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               //upload cube mvp matrices</td><td> </td><td class="right">               //upload cube mvp matrices</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               shader-&gt;setUniformValueArray(loc,cubeMVP,6);</td><td> </td><td class="right">               shader-&gt;setUniformValueArray(loc,cubeMVP,6);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 801</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 793</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glDisable(GL_CULL_FACE);</td><td> </td><td class="right">                               glDisable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               backfaceCullState = false;</td><td> </td><td class="right">                               backfaceCullState = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else if(!backfaceCullState &amp;&amp; pMaterial-&gt;backfacecul
l)</td><td> </td><td class="right">                       else if(!backfaceCullState &amp;&amp; pMaterial-&gt;backfacecul
l)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glEnable(GL_CULL_FACE);</td><td> </td><td class="right">                               glEnable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               backfaceCullState = true;</td><td> </td><td class="right">                               backfaceCullState = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               GET_GLERROR()</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glDrawElements(GL_TRIANGLES, pStelModel-&gt;triangleCount * 3, 
indexDataType, reinterpret_cast&lt;const void*&gt;(pStelModel-&gt;startIndex * index
DataTypeSize));</td><td> </td><td class="right">               glDrawElements(GL_TRIANGLES, pStelModel-&gt;triangleCount * 3, 
indexDataType, reinterpret_cast&lt;const void*&gt;(pStelModel-&gt;startIndex * index
DataTypeSize));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawnTriangles+=pStelModel-&gt;triangleCount;</td><td> </td><td class="right">               drawnTriangles+=pStelModel-&gt;triangleCount;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(!backfaceCullState)</td><td> </td><td class="right">       if(!backfaceCullState)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glEnable(GL_CULL_FACE);</td><td> </td><td class="right">               glEnable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(curShader)</td><td> </td><td class="right">       if(curShader)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               curShader-&gt;release();</td><td> </td><td class="right">               curShader-&gt;release();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 1125</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 1118</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //Draw the scene</td><td> </td><td class="right">                       //Draw the scene</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if(!drawArrays(false))</td><td> </td><td class="right">                       if(!drawArrays(false))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               success = false;</td><td> </td><td class="right">                               success = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               break;</td><td> </td><td class="right">                               break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //Unbind</td><td> </td><td class="right">       //Unbind</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       glBindFramebuffer(GL_FRAMEBUFFER, <span class="delete">0</span>);</td><td> </td><td class="rblock">       glBindFramebuffer(GL_FRAMEBUFFER, <span class="insert">defaultFBO</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //reset viewport (see StelPainter::setProjector)</td><td> </td><td class="right">       //reset viewport (see StelPainter::setProjector)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec4i&amp; vp = altAzProjector-&gt;getViewport();</td><td> </td><td class="right">       const Vec4i&amp; vp = altAzProjector-&gt;getViewport();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glViewport(vp[0], vp[1], vp[2], vp[3]);</td><td> </td><td class="right">       glViewport(vp[0], vp[1], vp[2], vp[3]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //Move polygons back to normal position</td><td> </td><td class="right">       //Move polygons back to normal position</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_POLYGON_OFFSET_FILL);</td><td> </td><td class="right">       glDisable(GL_POLYGON_OFFSET_FILL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glPolygonOffset(0.0f,0.0f);</td><td> </td><td class="right">       glPolygonOffset(0.0f,0.0f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //Reset</td><td> </td><td class="right">       //Reset</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 1571</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 1564</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               //In this mode, only the "perspective" shadow mode can be us
ed (otherwise it would need up to 6*4 shadowmaps at once)</td><td> </td><td class="right">               //In this mode, only the "perspective" shadow mode can be us
ed (otherwise it would need up to 6*4 shadowmaps at once)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               renderIntoCubemapGeometryShader();</td><td> </td><td class="right">               renderIntoCubemapGeometryShader();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               renderIntoCubemapSixPasses();</td><td> </td><td class="right">               renderIntoCubemapSixPasses();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //cubemap fbo must be released</td><td> </td><td class="right">       //cubemap fbo must be released</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       glBindFramebuffer(GL_FRAMEBUFFER,<span class="delete">0</span>);</td><td> </td><td class="rblock">       glBindFramebuffer(GL_FRAMEBUFFER,<span class="insert">defaultFBO</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //reset GL state</td><td> </td><td class="right">       //reset GL state</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDepthMask(GL_FALSE);</td><td> </td><td class="right">       glDepthMask(GL_FALSE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_DEPTH_TEST);</td><td> </td><td class="right">       glDisable(GL_DEPTH_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_CULL_FACE);</td><td> </td><td class="right">       glDisable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //reset viewport (see StelPainter::setProjector)</td><td> </td><td class="right">       //reset viewport (see StelPainter::setProjector)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec4i&amp; vp = altAzProjector-&gt;getViewport();</td><td> </td><td class="right">       const Vec4i&amp; vp = altAzProjector-&gt;getViewport();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glViewport(vp[0], vp[1], vp[2], vp[3]);</td><td> </td><td class="right">       glViewport(vp[0], vp[1], vp[2], vp[3]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 2046</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 2039</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               //assume everything is available on Desktop GL for now (shou
ld be ok on GL&gt;2.0 as Stellarium base requires)</td><td> </td><td class="right">               //assume everything is available on Desktop GL for now (shou
ld be ok on GL&gt;2.0 as Stellarium base requires)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               supportsShadows = true;</td><td> </td><td class="right">               supportsShadows = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               supportsShadowFiltering = true;</td><td> </td><td class="right">               supportsShadowFiltering = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Scenery3d::init()</td><td> </td><td class="right">void Scenery3d::init()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       initializeOpenGLFunctions();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       OBJ::setupGL();</td><td> </td><td class="right">       OBJ::setupGL();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QOpenGLContext* ctx = QOpenGLContext::currentContext();</td><td> </td><td class="right">       QOpenGLContext* ctx = QOpenGLContext::currentContext();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Q_ASSERT(ctx);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef QT_OPENGL_ES_2</td><td> </td><td class="right">#ifndef QT_OPENGL_ES_2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //initialize additional functions needed and not provided through St
elOpenGL</td><td> </td><td class="right">       //initialize additional functions needed and not provided through St
elOpenGL</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glExtFuncs = new GLExtFuncs();</td><td> </td><td class="right">       glExtFuncs = new GLExtFuncs();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glExtFuncs-&gt;init(ctx);</td><td> </td><td class="right">       glExtFuncs-&gt;init(ctx);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //save opengl ES state</td><td> </td><td class="right">       //save opengl ES state</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shaderParameters.openglES = ctx-&gt;isOpenGLES();</td><td> </td><td class="right">       shaderParameters.openglES = ctx-&gt;isOpenGLES();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l10" /><small>skipping to change at</small><em> line 2361</em></th><th> </th><th><a name="part-r10" /><small>skipping to change at</small><em> line 2356</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               qWarning() &lt;&lt; "[Scenery3D] glCheckFramebuffe
rStatus failed, probably can't use cube map";</td><td> </td><td class="right">                               qWarning() &lt;&lt; "[Scenery3D] glCheckFramebuffe
rStatus failed, probably can't use cube map";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               ret = false;</td><td> </td><td class="right">                               ret = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               break;</td><td> </td><td class="right">                               break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else</td><td> </td><td class="right">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               ret = true;</td><td> </td><td class="right">                               ret = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //unbind last framebuffer</td><td> </td><td class="right">       //unbind last framebuffer</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       glBindFramebuffer(GL_FRAMEBUFFER,<span class="delete">0</span>);</td><td> </td><td class="rblock">       glBindFramebuffer(GL_FRAMEBUFFER,<span class="insert">defaultFBO</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //initialize cube rotations... found by trial and error :)</td><td> </td><td class="right">       //initialize cube rotations... found by trial and error :)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QMatrix4x4 stackBase;</td><td> </td><td class="right">       QMatrix4x4 stackBase;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //all angles were found using some experimenting :)</td><td> </td><td class="right">       //all angles were found using some experimenting :)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //this is the EAST face (y=1)</td><td> </td><td class="right">       //this is the EAST face (y=1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       stackBase.rotate(90.0f,-1.0f,0.0f,0.0f);</td><td> </td><td class="right">       stackBase.rotate(90.0f,-1.0f,0.0f,0.0f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(cubemappingMode &gt;= S3DEnum::CM_CUBEMAP)</td><td> </td><td class="right">       if(cubemappingMode &gt;= S3DEnum::CM_CUBEMAP)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l11" /><small>skipping to change at</small><em> line 2624</em></th><th> </th><th><a name="part-r11" /><small>skipping to change at</small><em> line 2619</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#else</td><td> </td><td class="right">#else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       GLenum depthPcss = GL_DEPTH_COMPONENT;</td><td> </td><td class="right">                       GLenum depthPcss = GL_DEPTH_COMPONENT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       GLenum depthNormal = GL_DEPTH_COMPONENT;</td><td> </td><td class="right">                       GLenum depthNormal = GL_DEPTH_COMPONENT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //pcss is only enabled if filtering is also enabled</td><td> </td><td class="right">                       //pcss is only enabled if filtering is also enabled</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       bool pcssEnabled = shaderParameters.pcss &amp;&amp; (shaderP
arameters.shadowFilterQuality == S3DEnum::SFQ_LOW || shaderParameters.shado
wFilterQuality == S3DEnum::SFQ_HIGH);</td><td> </td><td class="right">                       bool pcssEnabled = shaderParameters.pcss &amp;&amp; (shaderP
arameters.shadowFilterQuality == S3DEnum::SFQ_LOW || shaderParameters.shado
wFilterQuality == S3DEnum::SFQ_HIGH);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //for OpenGL ES2, type has to be UNSIGNED_SHORT or U
NSIGNED_INT for depth textures, desktop does probably not care</td><td> </td><td class="right">                       //for OpenGL ES2, type has to be UNSIGNED_SHORT or U
NSIGNED_INT for depth textures, desktop does probably not care</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexImage2D(GL_TEXTURE_2D, 0, (pcssEnabled ? depthP
css : depthNormal), shadowmapSize, shadowmapSize, 0, GL_DEPTH_COMPONENT, GL
_UNSIGNED_SHORT, NULL);</td><td> </td><td class="right">                       glTexImage2D(GL_TEXTURE_2D, 0, (pcssEnabled ? depthP
css : depthNormal), shadowmapSize, shadowmapSize, 0, GL_DEPTH_COMPONENT, GL
_UNSIGNED_SHORT, NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       GLint filter = (shaderParameters.shadowFilterQuality</td><td> </td><td class="rblock">                       <span class="insert">//we use hardware-accelerated depth compare mode, un</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> == S3DEnum::SFQ_HARDWARE</td><td> </td><td class="rblock"><span class="insert">less pcss is used</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       shaderParameters.hwShadowSamplers = false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       //NOTE: cant use depth compare mode on ES2</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if(!pcssEnabled)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#ifndef QT_OPENGL_ES_2</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               if(!isEs)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       glTexParameteri(GL_TEXTURE_2D, GL_TE</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">XTURE_COMPARE_MODE, GL_COMPARE_R_TO_TEXTURE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       glTexParameteri(GL_TEXTURE_2D, GL_TE</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">XTURE_COMPARE_FUNC, GL_LEQUAL);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       shaderParameters.hwShadowSamplers = </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">true;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#endif</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       //IF we support hw shadow sampling, then we may enab</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">le linear filtering, otherwise filtering depth values directly would not ma</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ke much sense</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       GLint filter = <span class="insert">shaderParameters.hwShadowSamplers &amp;&amp;</span> </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">(shaderParameters.shadowFilterQuality == S3DEnum::SFQ_HARDWARE</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       || shaderParameters.shadowFilterQual
ity == S3DEnum::SFQ_LOW_HARDWARE</td><td> </td><td class="right">                                       || shaderParameters.shadowFilterQual
ity == S3DEnum::SFQ_LOW_HARDWARE</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       || shaderParameters.shadowFilterQual
ity == S3DEnum::SFQ_HIGH_HARDWARE) ? GL_LINEAR : GL_NEAREST;</td><td> </td><td class="right">                                       || shaderParameters.shadowFilterQual
ity == S3DEnum::SFQ_HIGH_HARDWARE) ? GL_LINEAR : GL_NEAREST;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER
, filter);</td><td> </td><td class="right">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER
, filter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER
, filter);</td><td> </td><td class="right">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER
, filter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef QT_OPENGL_ES_2</td><td> </td><td class="right">#ifndef QT_OPENGL_ES_2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if(!isEs)</td><td> </td><td class="right">                       if(!isEs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_BA
SE_LEVEL,0);</td><td> </td><td class="right">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_BA
SE_LEVEL,0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MA
X_LEVEL,0);</td><td> </td><td class="right">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MA
X_LEVEL,0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WR
AP_S, GL_CLAMP_TO_BORDER);</td><td> </td><td class="right">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WR
AP_S, GL_CLAMP_TO_BORDER);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WR
AP_T, GL_CLAMP_TO_BORDER);</td><td> </td><td class="right">                               glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WR
AP_T, GL_CLAMP_TO_BORDER);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               const float ones[] = {1.0f, 1.0f, 1.0f, 1.0f
};</td><td> </td><td class="right">                               const float ones[] = {1.0f, 1.0f, 1.0f, 1.0f
};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_B
ORDER_COLOR, ones);</td><td> </td><td class="right">                               glTexParameterfv(GL_TEXTURE_2D, GL_TEXTURE_B
ORDER_COLOR, ones);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">//we use hardware-accelerated depth compare mode, un</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">less pcss is used</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       //NOTE: cant use depth compare mode on ES2</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       if(!pcssEnabled)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#ifndef QT_OPENGL_ES_2</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               if(!isEs)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                       glTexParameteri(GL_TEXTURE_2D, GL_TE</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">XTURE_COMPARE_MODE, GL_COMPARE_R_TO_TEXTURE);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                       glTexParameteri(GL_TEXTURE_2D, GL_TE</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">XTURE_COMPARE_FUNC, GL_LEQUAL);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#endif</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //Attach the depthmap to the Buffer</td><td> </td><td class="right">                       //Attach the depthmap to the Buffer</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glFramebufferTexture2D(GL_FRAMEBUFFER, GL_DEPTH_ATTA
CHMENT, GL_TEXTURE_2D, shadowMapsArray[i], 0);</td><td> </td><td class="right">                       glFramebufferTexture2D(GL_FRAMEBUFFER, GL_DEPTH_ATTA
CHMENT, GL_TEXTURE_2D, shadowMapsArray[i], 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //NOTE: disabling the drawbuffer should be required</td><td> </td><td class="right">                       //NOTE: disabling the drawbuffer should be required</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //but the respective functions are not available on 
GLES2?</td><td> </td><td class="right">                       //but the respective functions are not available on 
GLES2?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //On ANGLE, it seems to work without this settings (
framebuffer is complete, etc.)</td><td> </td><td class="right">                       //On ANGLE, it seems to work without this settings (
framebuffer is complete, etc.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //but I don't know if it will work on other ES platf
orms?</td><td> </td><td class="right">                       //but I don't know if it will work on other ES platf
orms?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef QT_OPENGL_ES_2</td><td> </td><td class="right">#ifndef QT_OPENGL_ES_2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if(!isEs)</td><td> </td><td class="right">                       if(!isEs)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l12" /><small>skipping to change at</small><em> line 2680</em></th><th> </th><th><a name="part-r12" /><small>skipping to change at</small><em> line 2679</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               qWarning() &lt;&lt; "[Scenery3D] glCheckFramebuffe
rStatus failed, can't use FBO";</td><td> </td><td class="right">                               qWarning() &lt;&lt; "[Scenery3D] glCheckFramebuffe
rStatus failed, can't use FBO";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               break;</td><td> </td><td class="right">                               break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else if (i==shaderParameters.frustumSplits-1)</td><td> </td><td class="right">                       else if (i==shaderParameters.frustumSplits-1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               valid = true;</td><td> </td><td class="right">                               valid = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               //Done. Unbind and switch to normal texture unit 0</td><td> </td><td class="right">               //Done. Unbind and switch to normal texture unit 0</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               glBindFramebuffer(GL_FRAMEBUFFER, <span class="delete">0</span>);</td><td> </td><td class="rblock">               glBindFramebuffer(GL_FRAMEBUFFER, <span class="insert">defaultFBO</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glActiveTexture(GL_TEXTURE0);</td><td> </td><td class="right">               glActiveTexture(GL_TEXTURE0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qDebug()&lt;&lt;"[Scenery3D] shadowmapping initialized";</td><td> </td><td class="right">               qDebug()&lt;&lt;"[Scenery3D] shadowmapping initialized";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning()&lt;&lt;"[Scenery3D] shadowmapping not supported or disa
bled";</td><td> </td><td class="right">               qWarning()&lt;&lt;"[Scenery3D] shadowmapping not supported or disa
bled";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(!valid)</td><td> </td><td class="right">       if(!valid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l13" /><small>skipping to change at</small><em> line 2704</em></th><th> </th><th><a name="part-r13" /><small>skipping to change at</small><em> line 2703</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return valid;</td><td> </td><td class="right">       return valid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Scenery3d::draw(StelCore* core)</td><td> </td><td class="right">void Scenery3d::draw(StelCore* core)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //cant draw if no models</td><td> </td><td class="right">       //cant draw if no models</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(!objModel || !objModel-&gt;hasStelModels())</td><td> </td><td class="right">       if(!objModel || !objModel-&gt;hasStelModels())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">//find out the default FBO</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       defaultFBO = StelApp::getInstance().getDefaultFBO();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //reset render statistic</td><td> </td><td class="right">       //reset render statistic</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       drawnTriangles = drawnModels = materialSwitches = shaderSwitches = 0
;</td><td> </td><td class="right">       drawnTriangles = drawnModels = materialSwitches = shaderSwitches = 0
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       requiresCubemap = core-&gt;getCurrentProjectionType() != StelCore::Proj
ectionPerspective;</td><td> </td><td class="right">       requiresCubemap = core-&gt;getCurrentProjectionType() != StelCore::Proj
ectionPerspective;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //update projector from core</td><td> </td><td class="right">       //update projector from core</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       altAzProjector = core-&gt;getProjection(StelCore::FrameAltAz, StelCore:
:RefractionOff);</td><td> </td><td class="right">       altAzProjector = core-&gt;getProjection(StelCore::FrameAltAz, StelCore:
:RefractionOff);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //perform Z-sorting for correct transparency</td><td> </td><td class="right">       //perform Z-sorting for correct transparency</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //this uses the object's centroids for sorting, so the OBJ must be c
reated correctly</td><td> </td><td class="right">       //this uses the object's centroids for sorting, so the OBJ must be c
reated correctly</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       objModel-&gt;transparencyDepthSort(-absolutePosition.toVec3f());</td><td> </td><td class="right">       objModel-&gt;transparencyDepthSort(-absolutePosition.toVec3f());</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 17 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>37 lines changed or deleted</i></th><th><i> </i></th><th><i>42 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
