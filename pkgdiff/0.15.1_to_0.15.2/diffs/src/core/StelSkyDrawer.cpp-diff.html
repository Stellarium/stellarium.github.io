<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.home 4.4.0-67-generic #88-Ubuntu SMP Wed Mar 8 16:34:45 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.1.3, API: 1.1 (GNU MPFR 3.1.4, GNU MP 6.1.0) --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: StelSkyDrawer.cpp - StelSkyDrawer.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;StelSkyDrawer.cpp&nbsp;</th><th> </th><th>&nbsp;StelSkyDrawer.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 20</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 20</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * This program is distributed in the hope that it will be useful,</td><td> </td><td class="right"> * This program is distributed in the hope that it will be useful,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td> </td><td class="right"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td> </td><td class="right"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * GNU General Public License for more details.</td><td> </td><td class="right"> * GNU General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with this program; if not, write to the Free Software</td><td> </td><td class="right"> * along with this program; if not, write to the Free Software</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td> </td><td class="right"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#ifndef GL_POINT_SPRITE</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"> #define GL_POINT_SPRITE 0x8861</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#endif</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#ifndef GL_VERTEX_PROGRAM_POINT_SIZE</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"> #define GL_VERTEX_PROGRAM_POINT_SIZE 0x8642</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#endif</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelSkyDrawer.hpp"</td><td> </td><td class="right">#include "StelSkyDrawer.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelProjector.hpp"</td><td> </td><td class="right">#include "StelProjector.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelFileMgr.hpp"</td><td> </td><td class="right">#include "StelFileMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelToneReproducer.hpp"</td><td> </td><td class="right">#include "StelToneReproducer.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTextureMgr.hpp"</td><td> </td><td class="right">#include "StelTextureMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelUtils.hpp"</td><td> </td><td class="right">#include "StelUtils.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelMovementMgr.hpp"</td><td> </td><td class="right">#include "StelMovementMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelPainter.hpp"</td><td> </td><td class="right">#include "StelPainter.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelModuleMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "LandscapeMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "Landscape.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QOpenGLContext&gt;</td><td> </td><td class="right">#include &lt;QOpenGLContext&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QOpenGLShaderProgram&gt;</td><td> </td><td class="right">#include &lt;QOpenGLShaderProgram&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QStringList&gt;</td><td> </td><td class="right">#include &lt;QStringList&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QSettings&gt;</td><td> </td><td class="right">#include &lt;QSettings&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtGlobal&gt;</td><td> </td><td class="right">#include &lt;QtGlobal&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// The 0.025 corresponds to the maximum eye resolution in degree</td><td> </td><td class="right">// The 0.025 corresponds to the maximum eye resolution in degree</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define EYE_RESOLUTION (0.25f)</td><td> </td><td class="right">#define EYE_RESOLUTION (0.25f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define MAX_LINEAR_RADIUS 8.f</td><td> </td><td class="right">#define MAX_LINEAR_RADIUS 8.f</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelSkyDrawer::StelSkyDrawer(StelCore* acore) :</td><td> </td><td class="right">StelSkyDrawer::StelSkyDrawer(StelCore* acore) :</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       core(acore),</td><td> </td><td class="right">       core(acore),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eye(acore-&gt;getToneReproducer()),</td><td> </td><td class="right">       eye(acore-&gt;getToneReproducer()),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       maxAdaptFov(180.f),</td><td> </td><td class="right">       maxAdaptFov(180.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       minAdaptFov(0.1f),</td><td> </td><td class="right">       minAdaptFov(0.1f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       lnfovFactor(0.f),</td><td> </td><td class="right">       lnfovFactor(0.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">flagStarTwinkle(false),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       flagForcedTwinkle(false),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       twinkleAmount(0.0),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       flagStarMagnitudeLimit(false),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       flagNebulaMagnitudeLimit(false),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       flagPlanetMagnitudeLimit(false),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starRelativeScale(1.f),</td><td> </td><td class="right">       starRelativeScale(1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starAbsoluteScaleF(1.f),</td><td> </td><td class="right">       starAbsoluteScaleF(1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starLinearScale(19.569f),</td><td> </td><td class="right">       starLinearScale(19.569f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       limitMagnitude(-100.f),</td><td> </td><td class="right">       limitMagnitude(-100.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       limitLuminance(0.f),</td><td> </td><td class="right">       limitLuminance(0.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">customStarMagLimit(0.0),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       customNebulaMagLimit(0.0),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       customPlanetMagLimit(0.0),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bortleScaleIndex(3),</td><td> </td><td class="right">       bortleScaleIndex(3),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       inScale(1.f),</td><td> </td><td class="right">       inScale(1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderProgram(NULL),</td><td> </td><td class="right">       starShaderProgram(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderVars(StarShaderVars()),</td><td> </td><td class="right">       starShaderVars(StarShaderVars()),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">nbPointSources(0),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       maxPointSources(1000),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       maxLum(0.f),</td><td> </td><td class="right">       maxLum(0.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oldLum(-1.f),</td><td> </td><td class="right">       oldLum(-1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       flagLuminanceAdaptation(false),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       big3dModelHaloRadius(150.f)</td><td> </td><td class="right">       big3dModelHaloRadius(150.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setObjectName("StelSkyDrawer");</td><td> </td><td class="right">       setObjectName("StelSkyDrawer");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QSettings* conf = StelApp::getInstance().getSettings();</td><td> </td><td class="right">       QSettings* conf = StelApp::getInstance().getSettings();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       initColorTableFromConfigFile(conf);</td><td> </td><td class="right">       initColorTableFromConfigFile(conf);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setFlagHasAtmosphere(conf-&gt;value("landscape/flag_atmosphere", true).
toBool());</td><td> </td><td class="right">       setFlagHasAtmosphere(conf-&gt;value("landscape/flag_atmosphere", true).
toBool());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setTwinkleAmount(conf-&gt;value("stars/star_twinkle_amount",0.3).toFloa
t());</td><td> </td><td class="right">       setTwinkleAmount(conf-&gt;value("stars/star_twinkle_amount",0.3).toFloa
t());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setFlagTwinkle(conf-&gt;value("stars/flag_star_twinkle",true).toBool())
;</td><td> </td><td class="right">       setFlagTwinkle(conf-&gt;value("stars/flag_star_twinkle",true).toBool())
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setFlagForcedTwinkle(conf-&gt;value("stars/flag_forced_twinkle",false).
toBool());</td><td> </td><td class="right">       setFlagForcedTwinkle(conf-&gt;value("stars/flag_forced_twinkle",false).
toBool());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 121</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 130</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setAtmosphereTemperature(conf-&gt;value("landscape/temperature_C",15.0)
.toDouble(&amp;ok));</td><td> </td><td class="right">       setAtmosphereTemperature(conf-&gt;value("landscape/temperature_C",15.0)
.toDouble(&amp;ok));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!ok)</td><td> </td><td class="right">       if (!ok)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setAtmosphereTemperature(15.0);</td><td> </td><td class="right">               setAtmosphereTemperature(15.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setAtmospherePressure(conf-&gt;value("landscape/pressure_mbar",1013.0).
toDouble(&amp;ok));</td><td> </td><td class="right">       setAtmospherePressure(conf-&gt;value("landscape/pressure_mbar",1013.0).
toDouble(&amp;ok));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!ok)</td><td> </td><td class="right">       if (!ok)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setAtmospherePressure(1013.0);</td><td> </td><td class="right">               setAtmospherePressure(1013.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Initialize buffers for use by gl vertex array</td><td> </td><td class="right">       // Initialize buffers for use by gl vertex array</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">nbPointSources = 0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       maxPointSources = 1000;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       vertexArray = new StarVertex[maxPointSources*6];</td><td> </td><td class="right">       vertexArray = new StarVertex[maxPointSources*6];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       textureCoordArray = new unsigned char[maxPointSources*6*2];</td><td> </td><td class="right">       textureCoordArray = new unsigned char[maxPointSources*6*2];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (unsigned int i=0;i&lt;maxPointSources; ++i)</td><td> </td><td class="right">       for (unsigned int i=0;i&lt;maxPointSources; ++i)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               static const unsigned char texElems[] = {0, 0, 255, 0, 255, 
255, 0, 0, 255, 255, 0, 255};</td><td> </td><td class="right">               static const unsigned char texElems[] = {0, 0, 255, 0, 255, 
255, 0, 0, 255, 255, 0, 255};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               unsigned char* elem = &amp;textureCoordArray[i*6*2];</td><td> </td><td class="right">               unsigned char* elem = &amp;textureCoordArray[i*6*2];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               memcpy(elem, texElems, 12);</td><td> </td><td class="right">               memcpy(elem, texElems, 12);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 149</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 156</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       delete[] textureCoordArray;</td><td> </td><td class="right">       delete[] textureCoordArray;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       textureCoordArray = NULL;</td><td> </td><td class="right">       textureCoordArray = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       delete starShaderProgram;</td><td> </td><td class="right">       delete starShaderProgram;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderProgram = NULL;</td><td> </td><td class="right">       starShaderProgram = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Init parameters from config file</td><td> </td><td class="right">// Init parameters from config file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelSkyDrawer::init()</td><td> </td><td class="right">void StelSkyDrawer::init()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">initializeOpenGLFunctions();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Load star texture no mipmap:</td><td> </td><td class="right">       // Load star texture no mipmap:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texHalo = StelApp::getInstance().getTextureManager().createTexture(S
telFileMgr::getInstallationDir()+"/textures/star16x16.png");</td><td> </td><td class="right">       texHalo = StelApp::getInstance().getTextureManager().createTexture(S
telFileMgr::getInstallationDir()+"/textures/star16x16.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texBigHalo = StelApp::getInstance().getTextureManager().createTextur
e(StelFileMgr::getInstallationDir()+"/textures/haloLune.png");</td><td> </td><td class="right">       texBigHalo = StelApp::getInstance().getTextureManager().createTextur
e(StelFileMgr::getInstallationDir()+"/textures/haloLune.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texSunHalo = StelApp::getInstance().getTextureManager().createTextur
e(StelFileMgr::getInstallationDir()+"/textures/halo.png");</td><td> </td><td class="right">       texSunHalo = StelApp::getInstance().getTextureManager().createTextur
e(StelFileMgr::getInstallationDir()+"/textures/halo.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texSunCorona = StelApp::getInstance().getTextureManager().createText
ure(StelFileMgr::getInstallationDir()+"/textures/corona.png");</td><td> </td><td class="right">       texSunCorona = StelApp::getInstance().getTextureManager().createText
ure(StelFileMgr::getInstallationDir()+"/textures/corona.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Create shader program</td><td> </td><td class="right">       // Create shader program</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QOpenGLShader vshader(QOpenGLShader::Vertex);</td><td> </td><td class="right">       QOpenGLShader vshader(QOpenGLShader::Vertex);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const char *vsrc =</td><td> </td><td class="right">       const char *vsrc =</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "attribute mediump vec2 pos;\n"</td><td> </td><td class="right">               "attribute mediump vec2 pos;\n"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 375</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 384</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelSkyDrawer::preDrawPointSource(StelPainter* p)</td><td> </td><td class="right">void StelSkyDrawer::preDrawPointSource(StelPainter* p)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(p);</td><td> </td><td class="right">       Q_ASSERT(p);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(nbPointSources==0);</td><td> </td><td class="right">       Q_ASSERT(nbPointSources==0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Blending is really important. Otherwise faint stars in the vicini
ty of</td><td> </td><td class="right">       // Blending is really important. Otherwise faint stars in the vicini
ty of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // bright star will cause tiny black squares on the bright star, e.g
. see Procyon.</td><td> </td><td class="right">       // bright star will cause tiny black squares on the bright star, e.g
. see Procyon.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_BLEND);</span></td><td> </td><td class="rblock">       <span class="insert">p-&gt;setBlending(true, GL_ONE,</span> GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glBlendFunc(GL_ONE,</span> GL_ONE);</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">p-&gt;enableTexture2d(true);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Finalize the drawing of point sources</td><td> </td><td class="right">// Finalize the drawing of point sources</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelSkyDrawer::postDrawPointSource(StelPainter* sPainter)</td><td> </td><td class="right">void StelSkyDrawer::postDrawPointSource(StelPainter* sPainter)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(sPainter);</td><td> </td><td class="right">       Q_ASSERT(sPainter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (nbPointSources==0)</td><td> </td><td class="right">       if (nbPointSources==0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texHalo-&gt;bind();</td><td> </td><td class="right">       texHalo-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">sPainter-&gt;enableTexture2d(true);</span></td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;setBlending(true, GL_ONE,</span> GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glBlendFunc(GL_ONE,</span> GL_ONE);</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_BLEND);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Mat4f&amp; m = sPainter-&gt;getProjector()-&gt;getProjectionMatrix();</td><td> </td><td class="right">       const Mat4f&amp; m = sPainter-&gt;getProjector()-&gt;getProjectionMatrix();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const QMatrix4x4 qMat(m[0], m[4], m[8], m[12], m[1], m[5], m[9], m[1
3], m[2], m[6], m[10], m[14], m[3], m[7], m[11], m[15]);</td><td> </td><td class="right">       const QMatrix4x4 qMat(m[0], m[4], m[8], m[12], m[1], m[5], m[9], m[1
3], m[2], m[6], m[10], m[14], m[3], m[7], m[11], m[15]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(sizeof(StarVertex)==12);</td><td> </td><td class="right">       Q_ASSERT(sizeof(StarVertex)==12);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderProgram-&gt;bind();</td><td> </td><td class="right">       starShaderProgram-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderProgram-&gt;setAttributeArray(starShaderVars.pos, GL_FLOAT, (
GLfloat*)vertexArray, 2, 12);</td><td> </td><td class="right">       starShaderProgram-&gt;setAttributeArray(starShaderVars.pos, GL_FLOAT, (
GLfloat*)vertexArray, 2, 12);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderProgram-&gt;enableAttributeArray(starShaderVars.pos);</td><td> </td><td class="right">       starShaderProgram-&gt;enableAttributeArray(starShaderVars.pos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starShaderProgram-&gt;setAttributeArray(starShaderVars.color, GL_UNSIGN
ED_BYTE, (GLubyte*)&amp;(vertexArray[0].color), 3, 12);</td><td> </td><td class="right">       starShaderProgram-&gt;setAttributeArray(starShaderVars.color, GL_UNSIGN
ED_BYTE, (GLubyte*)&amp;(vertexArray[0].color), 3, 12);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 445</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 450</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // If the rmag is big, draw a big halo</td><td> </td><td class="right">       // If the rmag is big, draw a big halo</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (radius&gt;MAX_LINEAR_RADIUS+5.f)</td><td> </td><td class="right">       if (radius&gt;MAX_LINEAR_RADIUS+5.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float cmag = qMin(rcMag.luminance,(float)(radius-(MAX_LINEAR
_RADIUS+5.f))/30.f);</td><td> </td><td class="right">               float cmag = qMin(rcMag.luminance,(float)(radius-(MAX_LINEAR
_RADIUS+5.f))/30.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float rmag = 150.f;</td><td> </td><td class="right">               float rmag = 150.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (cmag&gt;1.f)</td><td> </td><td class="right">               if (cmag&gt;1.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       cmag = 1.f;</td><td> </td><td class="right">                       cmag = 1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               texBigHalo-&gt;bind();</td><td> </td><td class="right">               texBigHalo-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">sPainter-&gt;enableTexture2d(true);</span></td><td> </td><td class="rblock">               <span class="insert">sPainter-&gt;setBlending(true, GL_ONE,</span> GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glBlendFunc(GL_ONE,</span> GL_ONE);</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">glEnable(GL_BLEND);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sPainter-&gt;setColor(color[0]*cmag, color[1]*cmag, color[2]*cm
ag);</td><td> </td><td class="right">               sPainter-&gt;setColor(color[0]*cmag, color[1]*cmag, color[2]*cm
ag);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sPainter-&gt;drawSprite2dModeNoDeviceScale(win[0], win[1], rmag
);</td><td> </td><td class="right">               sPainter-&gt;drawSprite2dModeNoDeviceScale(win[0], win[1], rmag
);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       unsigned char starColor[3] = {0, 0, 0};</td><td> </td><td class="right">       unsigned char starColor[3] = {0, 0, 0};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starColor[0] = (unsigned char)std::min((int)(color[0]*tw*255+0.5f), 
255);</td><td> </td><td class="right">       starColor[0] = (unsigned char)std::min((int)(color[0]*tw*255+0.5f), 
255);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starColor[1] = (unsigned char)std::min((int)(color[1]*tw*255+0.5f), 
255);</td><td> </td><td class="right">       starColor[1] = (unsigned char)std::min((int)(color[1]*tw*255+0.5f), 
255);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starColor[2] = (unsigned char)std::min((int)(color[2]*tw*255+0.5f), 
255);</td><td> </td><td class="right">       starColor[2] = (unsigned char)std::min((int)(color[2]*tw*255+0.5f), 
255);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Store the drawing instructions in the vertex arrays</td><td> </td><td class="right">       // Store the drawing instructions in the vertex arrays</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 479</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 482</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Flush the buffer (draw all buffered stars)</td><td> </td><td class="right">               // Flush the buffer (draw all buffered stars)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               postDrawPointSource(sPainter);</td><td> </td><td class="right">               postDrawPointSource(sPainter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Draw's the Sun's corona during a solar eclipse on Earth.</td><td> </td><td class="right">// Draw's the Sun's corona during a solar eclipse on Earth.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelSkyDrawer::drawSunCorona(StelPainter* painter, const Vec3f&amp; v, flo
at radius, const Vec3f&amp; color, const float alpha)</td><td> </td><td class="right">void StelSkyDrawer::drawSunCorona(StelPainter* painter, const Vec3f&amp; v, flo
at radius, const Vec3f&amp; color, const float alpha)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texSunCorona-&gt;bind();</td><td> </td><td class="right">       texSunCorona-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_BLEND);</span></td><td> </td><td class="rblock">       <span class="insert">painter-&gt;setBlending(true, GL_ONE,</span> GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glBlendFunc(GL_ONE,</span> GL_ONE);</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">painter-&gt;enableTexture2d(true);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f win;</td><td> </td><td class="right">       Vec3f win;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       painter-&gt;getProjector()-&gt;project(v, win);</td><td> </td><td class="right">       painter-&gt;getProjector()-&gt;project(v, win);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // For some reason we must mix color with the given alpha as well, e
lse mixing does not work.</td><td> </td><td class="right">       // For some reason we must mix color with the given alpha as well, e
lse mixing does not work.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       painter-&gt;setColor(color[0]*alpha, color[1]*alpha, color[2]*alpha, al
pha);</td><td> </td><td class="right">       painter-&gt;setColor(color[0]*alpha, color[1]*alpha, color[2]*alpha, al
pha);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       painter-&gt;drawSprite2dMode(win[0], win[1], radius);</td><td> </td><td class="right">       painter-&gt;drawSprite2dMode(win[0], win[1], radius);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       postDrawPointSource(painter);</td><td> </td><td class="right">       postDrawPointSource(painter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 506</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 507</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Assume a disk shape</td><td> </td><td class="right">       // Assume a disk shape</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float pixRadius = std::sqrt(illuminatedArea/(60.*60.)*M_PI/180.*M_PI
/180.*(pixPerRad*pixPerRad))/M_PI;</td><td> </td><td class="right">       float pixRadius = std::sqrt(illuminatedArea/(60.*60.)*M_PI/180.*M_PI
/180.*(pixPerRad*pixPerRad))/M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool noStarHalo = false;</td><td> </td><td class="right">       bool noStarHalo = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (mag&lt;-15.f)</td><td> </td><td class="right">       if (mag&lt;-15.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Sun, halo size varies in function of the magnitude becaus
e sun as seen from pluto should look dimmer</td><td> </td><td class="right">               // Sun, halo size varies in function of the magnitude becaus
e sun as seen from pluto should look dimmer</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // as the sun as seen from earth</td><td> </td><td class="right">               // as the sun as seen from earth</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               texSunHalo-&gt;bind();</td><td> </td><td class="right">               texSunHalo-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">glEnable(GL_BLEND);</span></td><td> </td><td class="rblock">               <span class="insert">painter-&gt;setBlending(true, GL_ONE,</span> GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glBlendFunc(GL_ONE,</span> GL_ONE);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">painter-&gt;enableTexture2d(true);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float rmag = big3dModelHaloRadius*(mag+15.f)/-11.f;</td><td> </td><td class="right">               float rmag = big3dModelHaloRadius*(mag+15.f)/-11.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float cmag = 1.f;</td><td> </td><td class="right">               float cmag = 1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rmag&lt;pixRadius*3.f+100.)</td><td> </td><td class="right">               if (rmag&lt;pixRadius*3.f+100.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       cmag = qMax(0.f, 1.f-(pixRadius*3.f+100-rmag)/100);</td><td> </td><td class="right">                       cmag = qMax(0.f, 1.f-(pixRadius*3.f+100-rmag)/100);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3f win;</td><td> </td><td class="right">               Vec3f win;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               painter-&gt;getProjector()-&gt;project(v, win);</td><td> </td><td class="right">               painter-&gt;getProjector()-&gt;project(v, win);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               painter-&gt;setColor(color[0]*cmag, color[1]*cmag, color[2]*cma
g);</td><td> </td><td class="right">               painter-&gt;setColor(color[0]*cmag, color[1]*cmag, color[2]*cma
g);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               painter-&gt;drawSprite2dModeNoDeviceScale(win[0], win[1], rmag)
;</td><td> </td><td class="right">               painter-&gt;drawSprite2dModeNoDeviceScale(win[0], win[1], rmag)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               noStarHalo = true;</td><td> </td><td class="right">               noStarHalo = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 561</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 561</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rcm.luminance=(tStop-pixRadius)/(tStop-tStart);</td><td> </td><td class="right">               rcm.luminance=(tStop-pixRadius)/(tStop-tStart);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (truncated &amp;&amp; flagLuminanceAdaptation)</td><td> </td><td class="right">       if (truncated &amp;&amp; flagLuminanceAdaptation)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float wl = findWorldLumForMag(mag, rcm.radius);</td><td> </td><td class="right">               float wl = findWorldLumForMag(mag, rcm.radius);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (wl&gt;0)</td><td> </td><td class="right">               if (wl&gt;0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const float f = core-&gt;getMovementMgr()-&gt;getCurrentFo
v();</td><td> </td><td class="right">                       const float f = core-&gt;getMovementMgr()-&gt;getCurrentFo
v();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       reportLuminanceInFov(qMin(700.f, qMin(wl/50, (60.f*6</td><td> </td><td class="rblock">                       <span class="insert">// Report to the SkyDrawer that a very bright object</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">0.f)/(f*f)*6.f)));</span></td><td> </td><td class="rblock"><span class="insert"> (most notably Sun, Moon, bright planet)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // is in view. LP:1138533 correctly wants no such ef</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">fect if object is hidden by landscape horizon.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       LandscapeMgr* lmgr=GETSTELMODULE(LandscapeMgr);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       Q_ASSERT(lmgr);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       Landscape *landscape=lmgr-&gt;getCurrentLandscape();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       Q_ASSERT(landscape);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // Preliminary: create new Vec3d here. Later: consid</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">er replacing to vec3d in the arguments!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       Vec3d vec(v[0], v[1], v[2]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       float opacity=(landscape-&gt;getFlagShow() ? landscape-</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">&gt;getOpacity(core-&gt;j2000ToAltAz(vec, StelCore::RefractionAuto)) : 0.0f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       reportLuminanceInFov(qMin(700.f, qMin(wl/50, (60.f*6</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">0.f)/(f*f)*6.f))*(1.0f-opacity));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!noStarHalo)</td><td> </td><td class="right">       if (!noStarHalo)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               preDrawPointSource(painter);</td><td> </td><td class="right">               preDrawPointSource(painter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawPointSource(painter, v, rcm, color);</td><td> </td><td class="right">               drawPointSource(painter, v, rcm, color);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               postDrawPointSource(painter);</td><td> </td><td class="right">               postDrawPointSource(painter);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagStarTwinkle=save;</td><td> </td><td class="right">       flagStarTwinkle=save;</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 14 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>26 lines changed or deleted</i></th><th><i> </i></th><th><i>39 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
