<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.home 4.4.0-67-generic #88-Ubuntu SMP Wed Mar 8 16:34:45 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.1.3, API: 1.1 (GNU MPFR 3.1.4, GNU MP 6.1.0) --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: StelScriptMgr.cpp - StelScriptMgr.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;StelScriptMgr.cpp&nbsp;</th><th> </th><th>&nbsp;StelScriptMgr.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 49</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 49</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDateTime&gt;</td><td> </td><td class="right">#include &lt;QDateTime&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDir&gt;</td><td> </td><td class="right">#include &lt;QDir&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QFile&gt;</td><td> </td><td class="right">#include &lt;QFile&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QFileInfo&gt;</td><td> </td><td class="right">#include &lt;QFileInfo&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QRegExp&gt;</td><td> </td><td class="right">#include &lt;QRegExp&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QSet&gt;</td><td> </td><td class="right">#include &lt;QSet&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QStringList&gt;</td><td> </td><td class="right">#include &lt;QStringList&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QTemporaryFile&gt;</td><td> </td><td class="right">#include &lt;QTemporaryFile&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QVariant&gt;</td><td> </td><td class="right">#include &lt;QVariant&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include &lt;QtScript&gt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;cmath&gt;</td><td> </td><td class="right">#include &lt;cmath&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QScriptValue vec3fToScriptValue(QScriptEngine *engine, const Vec3f&amp; c)</td><td> </td><td class="right">QScriptValue vec3fToScriptValue(QScriptEngine *engine, const Vec3f&amp; c)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QScriptValue obj = engine-&gt;newObject();</td><td> </td><td class="right">       QScriptValue obj = engine-&gt;newObject();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       obj.setProperty("r", QScriptValue(engine, c[0]));</td><td> </td><td class="right">       obj.setProperty("r", QScriptValue(engine, c[0]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       obj.setProperty("g", QScriptValue(engine, c[1]));</td><td> </td><td class="right">       obj.setProperty("g", QScriptValue(engine, c[1]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       obj.setProperty("b", QScriptValue(engine, c[2]));</td><td> </td><td class="right">       obj.setProperty("b", QScriptValue(engine, c[2]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return obj;</td><td> </td><td class="right">       return obj;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 77</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 78</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QScriptValue createVec3f(QScriptContext* context, QScriptEngine *engine)</td><td> </td><td class="right">QScriptValue createVec3f(QScriptContext* context, QScriptEngine *engine)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f c;</td><td> </td><td class="right">       Vec3f c;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       c[0] = context-&gt;argument(0).toNumber();</td><td> </td><td class="right">       c[0] = context-&gt;argument(0).toNumber();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       c[1] = context-&gt;argument(1).toNumber();</td><td> </td><td class="right">       c[1] = context-&gt;argument(1).toNumber();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       c[2] = context-&gt;argument(2).toNumber();</td><td> </td><td class="right">       c[2] = context-&gt;argument(2).toNumber();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return vec3fToScriptValue(engine, c);</td><td> </td><td class="right">       return vec3fToScriptValue(engine, c);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">class StelScriptEngineAgent : public QScriptEngineAgent</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">{</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">public:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       explicit StelScriptEngineAgent(QScriptEngine *engine);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       virtual ~StelScriptEngineAgent() {}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       void setPauseScript(bool pause) { isPaused=pause; }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       bool getPauseScript() { return isPaused; }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       void positionChange(qint64 scriptId, int lineNumber, int columnNumbe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">r);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">private:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       bool isPaused;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">};</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelScriptMgr::StelScriptMgr(QObject *parent): QObject(parent)</td><td> </td><td class="right">StelScriptMgr::StelScriptMgr(QObject *parent): QObject(parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       engine = new QScriptEngine(this);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       connect(&amp;StelApp::getInstance(), SIGNAL(aboutToQuit()), this, SLOT(s
topScript()), Qt::DirectConnection);</td><td> </td><td class="right">       connect(&amp;StelApp::getInstance(), SIGNAL(aboutToQuit()), this, SLOT(s
topScript()), Qt::DirectConnection);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Scripting images</td><td> </td><td class="right">       // Scripting images</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ScreenImageMgr* scriptImages = new ScreenImageMgr();</td><td> </td><td class="right">       ScreenImageMgr* scriptImages = new ScreenImageMgr();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       scriptImages-&gt;init();</td><td> </td><td class="right">       scriptImages-&gt;init();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelApp::getInstance().getModuleMgr().registerModule(scriptImages);</td><td> </td><td class="right">       StelApp::getInstance().getModuleMgr().registerModule(scriptImages);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Allow Vec3f managment in scripts</td><td> </td><td class="right">       // Allow Vec3f managment in scripts</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       qScriptRegisterMetaType(<span class="delete">&amp;engine, vec3fToScriptValue, vec3fFromScript
V</span>alue);</td><td> </td><td class="rblock">       qScriptRegisterMetaType(<span class="insert">engine, vec3fToScriptValue, vec3fFromScriptV
</span>alue);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Constructor</td><td> </td><td class="right">       // Constructor</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       QScriptValue ctor = <span class="delete">engine.newFunction(createVec3f);</span></td><td> </td><td class="rblock">       QScriptValue ctor = <span class="insert">engine-&gt;newFunction(createVec3f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       engine.globalObject().setProperty("Vec3f",</span> ctor);</td><td> </td><td class="rblock"><span class="insert">       engine-&gt;globalObject().setProperty("Vec3f",</span> ctor);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Add the core object to access methods related to core</td><td> </td><td class="right">       // Add the core object to access methods related to core</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mainAPI = new StelMainScriptAPI(this);</td><td> </td><td class="right">       mainAPI = new StelMainScriptAPI(this);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       QScriptValue objectValue = <span class="delete">engine.newQObject(mainAPI);</span></td><td> </td><td class="rblock">       QScriptValue objectValue = <span class="insert">engine-&gt;newQObject(mainAPI);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       engine.globalObject().setProperty("core",</span> objectValue);</td><td> </td><td class="rblock"><span class="insert">       engine-&gt;globalObject().setProperty("core",</span> objectValue);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Add other classes which we want to be directly accessible from sc
ripts</td><td> </td><td class="right">       // Add other classes which we want to be directly accessible from sc
ripts</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if(StelSkyLayerMgr* smgr = GETSTELMODULE(StelSkyLayerMgr))</td><td> </td><td class="right">       if(StelSkyLayerMgr* smgr = GETSTELMODULE(StelSkyLayerMgr))</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               objectValue = engine<span class="delete">.</span>newQObject(smgr);</td><td> </td><td class="rblock">               objectValue = engine<span class="insert">-&gt;</span>newQObject(smgr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // For accessing star scale, twinkle etc.</td><td> </td><td class="right">       // For accessing star scale, twinkle etc.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       objectValue = <span class="delete">engine.newQObject(StelApp::getInstance().getCore()-&gt;ge</span></td><td> </td><td class="rblock">       objectValue = <span class="insert">engine-&gt;newQObject(StelApp::getInstance().getCore()-&gt;g</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">tSkyDrawer());</span></td><td> </td><td class="rblock"><span class="insert">etSkyDrawer());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       engine.globalObject().setProperty("StelSkyDrawer",</span> objectValue);</td><td> </td><td class="rblock"><span class="insert">       engine-&gt;globalObject().setProperty("StelSkyDrawer",</span> objectValue);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setScriptRate(1.0);</td><td> </td><td class="right">       setScriptRate(1.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       engine<span class="delete">.</span>setProcessEventsInterval(10);</td><td> </td><td class="rblock">       engine<span class="insert">-&gt;</span>setProcessEventsInterval(10);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       agent = new <span class="delete">StelScriptEngineAgent(&amp;engine);</span></td><td> </td><td class="rblock">       agent = new <span class="insert">StelScriptEngineAgent(engine);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       engine.setAgent(agent);</span></td><td> </td><td class="rblock"><span class="insert">       engine-&gt;setAgent(agent);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       initActions();</td><td> </td><td class="right">       initActions();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::initActions()</td><td> </td><td class="right">void StelScriptMgr::initActions()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelActionMgr* actionMgr = StelApp::getInstance().getStelActionManag
er();</td><td> </td><td class="right">       StelActionMgr* actionMgr = StelApp::getInstance().getStelActionManag
er();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QSignalMapper* mapper = new QSignalMapper(this);</td><td> </td><td class="right">       QSignalMapper* mapper = new QSignalMapper(this);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       foreach(const QString script, getScriptList())</td><td> </td><td class="right">       foreach(const QString script, getScriptList())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               QString shortcut = getShortcut(script);</td><td> </td><td class="right">               QString shortcut = getShortcut(script);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               QString actionId = "actionScript/" + script;</td><td> </td><td class="right">               QString actionId = "actionScript/" + script;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               StelAction* action = actionMgr-&gt;addAction(</td><td> </td><td class="right">               StelAction* action = actionMgr-&gt;addAction(</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   <span class="delete">actionId, N_("Scripts"), q_(getName(script).trimmed()), 
</span>mapper, "map()", shortcut);</td><td> </td><td class="rblock">                   <span class="insert">                    actionId, N_("Scripts"), q_(getName(
script).trimmed()), </span>mapper, "map()", shortcut);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               mapper-&gt;setMapping(action, script);</td><td> </td><td class="right">               mapper-&gt;setMapping(action, script);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       connect(mapper, SIGNAL(mapped(QString)), this, SLOT(runScript(QStrin
g)));</td><td> </td><td class="right">       connect(mapper, SIGNAL(mapped(QString)), this, SLOT(runScript(QStrin
g)));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelScriptMgr::~StelScriptMgr()</td><td> </td><td class="right">StelScriptMgr::~StelScriptMgr()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::addModules()</td><td> </td><td class="right">void StelScriptMgr::addModules()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Add all the StelModules into the script engine</td><td> </td><td class="right">       // Add all the StelModules into the script engine</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelModuleMgr* mmgr = &amp;StelApp::getInstance().getModuleMgr();</td><td> </td><td class="right">       StelModuleMgr* mmgr = &amp;StelApp::getInstance().getModuleMgr();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       foreach (StelModule* m, mmgr-&gt;getAllModules())</td><td> </td><td class="right">       foreach (StelModule* m, mmgr-&gt;getAllModules())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               QScriptValue objectValue = <span class="delete">engine.newQObject(m);</span></td><td> </td><td class="rblock">               QScriptValue objectValue = <span class="insert">engine-&gt;newQObject(m);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               engine.globalObject().setProperty(m-&gt;objectName(), objectVal</span></td><td> </td><td class="rblock"><span class="insert">               engine-&gt;globalObject().setProperty(m-&gt;objectName(), objectVa</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ue);</span></td><td> </td><td class="rblock"><span class="insert">lue);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QStringList StelScriptMgr::getScriptList()</td><td> </td><td class="right">QStringList StelScriptMgr::getScriptList()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QStringList scriptFiles;</td><td> </td><td class="right">       QStringList scriptFiles;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QSet&lt;QString&gt; files = StelFileMgr::listContents("scripts", StelFileM
gr::File, true);</td><td> </td><td class="right">       QSet&lt;QString&gt; files = StelFileMgr::listContents("scripts", StelFileM
gr::File, true);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QRegExp fileRE("^.*\\.ssc$");</td><td> </td><td class="right">       QRegExp fileRE("^.*\\.ssc$");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       foreach(const QString&amp; f, files)</td><td> </td><td class="right">       foreach(const QString&amp; f, files)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (fileRE.exactMatch(f))</td><td> </td><td class="right">               if (fileRE.exactMatch(f))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       scriptFiles &lt;&lt; f;</td><td> </td><td class="right">                       scriptFiles &lt;&lt; f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return scriptFiles;</td><td> </td><td class="right">       return scriptFiles;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool StelScriptMgr::scriptIsRunning()</td><td> </td><td class="right">bool StelScriptMgr::scriptIsRunning()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return engine<span class="delete">.</span>isEvaluating();</td><td> </td><td class="rblock">       return engine<span class="insert">-&gt;</span>isEvaluating();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString StelScriptMgr::runningScriptId()</td><td> </td><td class="right">QString StelScriptMgr::runningScriptId()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return scriptFileName;</td><td> </td><td class="right">       return scriptFileName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString StelScriptMgr::getHeaderSingleLineCommentText(const QString&amp; s, con
st QString&amp; id, const QString&amp; notFoundText) const</td><td> </td><td class="right">QString StelScriptMgr::getHeaderSingleLineCommentText(const QString&amp; s, con
st QString&amp; id, const QString&amp; notFoundText) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QFile file(StelFileMgr::findFile("scripts/" + s, StelFileMgr::File))
;</td><td> </td><td class="right">       QFile file(StelFileMgr::findFile("scripts/" + s, StelFileMgr::File))
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 306</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 324</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       desc += d;</td><td> </td><td class="right">                       desc += d;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       file.close();</td><td> </td><td class="right">       file.close();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return desc.trimmed();</td><td> </td><td class="right">       return desc.trimmed();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool StelScriptMgr::runPreprocessedScript(const QString &amp;preprocessedScript
, const QString&amp; scriptId)</td><td> </td><td class="right">bool StelScriptMgr::runPreprocessedScript(const QString &amp;preprocessedScript
, const QString&amp; scriptId)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (engine<span class="delete">.</span>isEvaluating())</td><td> </td><td class="rblock">       if (engine<span class="insert">-&gt;</span>isEvaluating())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               QString msg = QString("ERROR: there is already a script runn
ing, please wait until it's over.");</td><td> </td><td class="right">               QString msg = QString("ERROR: there is already a script runn
ing, please wait until it's over.");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               emit(scriptDebug(msg));</td><td> </td><td class="right">               emit(scriptDebug(msg));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; msg;</td><td> </td><td class="right">               qWarning() &lt;&lt; msg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return false;</td><td> </td><td class="right">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Make sure that the gui objects have been completely initialized (
there used to be problems with startup scripts).</td><td> </td><td class="right">       // Make sure that the gui objects have been completely initialized (
there used to be problems with startup scripts).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(StelApp::getInstance().getGui());</td><td> </td><td class="right">       Q_ASSERT(StelApp::getInstance().getGui());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       engine<span class="delete">.</span>globalObject().setProperty("scriptRateReadOnly", 1.0);</td><td> </td><td class="rblock">       engine<span class="insert">-&gt;</span>globalObject().setProperty("scriptRateReadOnly", 1.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       scriptFileName = scriptId;</td><td> </td><td class="right">       scriptFileName = scriptId;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Notify that the script starts here</td><td> </td><td class="right">       // Notify that the script starts here</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       emit(scriptRunning());</td><td> </td><td class="right">       emit(scriptRunning());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       emit runningScriptIdChanged(scriptId);</td><td> </td><td class="right">       emit runningScriptIdChanged(scriptId);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // run that script</td><td> </td><td class="right">       // run that script</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       engine<span class="delete">.</span>evaluate(preprocessedScript);</td><td> </td><td class="rblock">       engine<span class="insert">-&gt;</span>evaluate(preprocessedScript);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       scriptEnded();</td><td> </td><td class="right">       scriptEnded();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Run the script located at the given location</td><td> </td><td class="right">// Run the script located at the given location</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool StelScriptMgr::runScript(const QString&amp; fileName, const QString&amp; inclu
dePath)</td><td> </td><td class="right">bool StelScriptMgr::runScript(const QString&amp; fileName, const QString&amp; inclu
dePath)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString preprocessedScript;</td><td> </td><td class="right">       QString preprocessedScript;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       prepareScript(preprocessedScript,fileName,includePath);</td><td> </td><td class="right">       prepareScript(preprocessedScript,fileName,includePath);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return runPreprocessedScript(preprocessedScript,fileName);</td><td> </td><td class="right">       return runPreprocessedScript(preprocessedScript,fileName);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 401</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 419</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!ok)</td><td> </td><td class="right">       if (!ok)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return false;</td><td> </td><td class="right">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::stopScript()</td><td> </td><td class="right">void StelScriptMgr::stopScript()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (engine<span class="delete">.</span>isEvaluating())</td><td> </td><td class="rblock">       if (engine<span class="insert">-&gt;</span>isEvaluating())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               GETSTELMODULE(LabelMgr)-&gt;deleteAllLabels();</td><td> </td><td class="right">               GETSTELMODULE(LabelMgr)-&gt;deleteAllLabels();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               GETSTELMODULE(ScreenImageMgr)-&gt;deleteAllImages();</td><td> </td><td class="right">               GETSTELMODULE(ScreenImageMgr)-&gt;deleteAllImages();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (agent-&gt;getPauseScript()) {</td><td> </td><td class="right">               if (agent-&gt;getPauseScript()) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       agent-&gt;setPauseScript(false);</td><td> </td><td class="right">                       agent-&gt;setPauseScript(false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               QString msg = QString("INFO: asking running script to exit")
;</td><td> </td><td class="right">               QString msg = QString("INFO: asking running script to exit")
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               emit(scriptDebug(msg));</td><td> </td><td class="right">               emit(scriptDebug(msg));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               //qDebug() &lt;&lt; msg;</td><td> </td><td class="right">               //qDebug() &lt;&lt; msg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               engine<span class="delete">.</span>abortEvaluation();</td><td> </td><td class="rblock">               engine<span class="insert">-&gt;</span>abortEvaluation();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       scriptEnded();</td><td> </td><td class="right">       scriptEnded();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::setScriptRate(float r)</td><td> </td><td class="right">void StelScriptMgr::setScriptRate(float r)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //qDebug() &lt;&lt; "StelScriptMgr::setScriptRate(" &lt;&lt; r &lt;&lt; ")";</td><td> </td><td class="right">       //qDebug() &lt;&lt; "StelScriptMgr::setScriptRate(" &lt;&lt; r &lt;&lt; ")";</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (!engine<span class="delete">.</span>isEvaluating())</td><td> </td><td class="rblock">       if (!engine<span class="insert">-&gt;</span>isEvaluating())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               engine<span class="delete">.</span>globalObject().setProperty("scriptRateReadOnly", r);</td><td> </td><td class="rblock">               engine<span class="insert">-&gt;</span>globalObject().setProperty("scriptRateReadOnly", r);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       float currentScriptRate = engine<span class="delete">.globalObject().property("scriptRate
</span>ReadOnly").toNumber();</td><td> </td><td class="rblock">       float currentScriptRate = engine<span class="insert">-&gt;globalObject().property("scriptRat
e</span>ReadOnly").toNumber();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // pre-calculate the new time rate in an effort to prevent there bei
ng much latency</td><td> </td><td class="right">       // pre-calculate the new time rate in an effort to prevent there bei
ng much latency</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // between setting the script rate and the time rate.</td><td> </td><td class="right">       // between setting the script rate and the time rate.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float factor = r / currentScriptRate;</td><td> </td><td class="right">       float factor = r / currentScriptRate;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelCore* core = StelApp::getInstance().getCore();</td><td> </td><td class="right">       StelCore* core = StelApp::getInstance().getCore();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       core-&gt;setTimeRate(core-&gt;getTimeRate() * factor);</td><td> </td><td class="right">       core-&gt;setTimeRate(core-&gt;getTimeRate() * factor);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GETSTELMODULE(StelMovementMgr)-&gt;setMovementSpeedFactor(core-&gt;getTime
Rate());</td><td> </td><td class="right">       GETSTELMODULE(StelMovementMgr)-&gt;setMovementSpeedFactor(core-&gt;getTime
Rate());</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       engine<span class="delete">.</span>globalObject().setProperty("scriptRateReadOnly", r);</td><td> </td><td class="rblock">       engine<span class="insert">-&gt;</span>globalObject().setProperty("scriptRateReadOnly", r);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::pauseScript() {</td><td> </td><td class="right">void StelScriptMgr::pauseScript() {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       agent-&gt;setPauseScript(true);</td><td> </td><td class="right">       agent-&gt;setPauseScript(true);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::resumeScript() {</td><td> </td><td class="right">void StelScriptMgr::resumeScript() {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       agent-&gt;setPauseScript(false);</td><td> </td><td class="right">       agent-&gt;setPauseScript(false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double StelScriptMgr::getScriptRate()</td><td> </td><td class="right">double StelScriptMgr::getScriptRate()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return engine<span class="delete">.globalObject().property("scriptRateReadOnly").toNumber
</span>();</td><td> </td><td class="rblock">       return engine<span class="insert">-&gt;globalObject().property("scriptRateReadOnly").toNumbe
r</span>();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::debug(const QString&amp; msg)</td><td> </td><td class="right">void StelScriptMgr::debug(const QString&amp; msg)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       emit(scriptDebug(msg));</td><td> </td><td class="right">       emit(scriptDebug(msg));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::output(const QString &amp;msg)</td><td> </td><td class="right">void StelScriptMgr::output(const QString &amp;msg)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelScriptOutput::writeLog(msg);</td><td> </td><td class="right">       StelScriptOutput::writeLog(msg);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 476</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 494</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       emit(scriptOutput(""));</td><td> </td><td class="right">       emit(scriptOutput(""));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::saveOutputAs(const QString &amp;filename)</td><td> </td><td class="right">void StelScriptMgr::saveOutputAs(const QString &amp;filename)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelScriptOutput::saveOutputAs(filename);</td><td> </td><td class="right">       StelScriptOutput::saveOutputAs(filename);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelScriptMgr::scriptEnded()</td><td> </td><td class="right">void StelScriptMgr::scriptEnded()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (engine<span class="delete">.</span>hasUncaughtException())</td><td> </td><td class="rblock">       if (engine<span class="insert">-&gt;</span>hasUncaughtException())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               QString msg = QString("script error: \"%1\" @ line %2").arg(
engine<span class="delete">.uncaughtException().toString()).arg(engine.uncaughtExceptionLineNumb
</span>er());</td><td> </td><td class="rblock">               QString msg = QString("script error: \"%1\" @ line %2").arg(
engine<span class="insert">-&gt;uncaughtException().toString()).arg(engine-&gt;uncaughtExceptionLineNu
mb</span>er());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               emit(scriptDebug(msg));</td><td> </td><td class="right">               emit(scriptDebug(msg));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; msg;</td><td> </td><td class="right">               qWarning() &lt;&lt; msg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GETSTELMODULE(StelMovementMgr)-&gt;setMovementSpeedFactor(1.0);</td><td> </td><td class="right">       GETSTELMODULE(StelMovementMgr)-&gt;setMovementSpeedFactor(1.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       scriptFileName = QString();</td><td> </td><td class="right">       scriptFileName = QString();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       emit runningScriptIdChanged(scriptFileName);</td><td> </td><td class="right">       emit runningScriptIdChanged(scriptFileName);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       emit(scriptStopped());</td><td> </td><td class="right">       emit(scriptStopped());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 25 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>29 lines changed or deleted</i></th><th><i> </i></th><th><i>48 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
