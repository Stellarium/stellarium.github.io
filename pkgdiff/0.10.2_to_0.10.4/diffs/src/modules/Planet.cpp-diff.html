<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Planet.cpp - Planet.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Planet.cpp&nbsp;</th><th> </th><th>&nbsp;Planet.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 25</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 25</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with this program; if not, write to the Free Software</td><td> </td><td class="right"> * along with this program; if not, write to the Free Software</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, U
SA.</td><td> </td><td class="right"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, U
SA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;iomanip&gt;</td><td> </td><td class="right">#include &lt;iomanip&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QTextStream&gt;</td><td> </td><td class="right">#include &lt;QTextStream&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QString&gt;</td><td> </td><td class="right">#include &lt;QString&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include &lt;QVarLengthArray&gt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelSkyDrawer.hpp"</td><td> </td><td class="right">#include "StelSkyDrawer.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "SolarSystem.hpp"</td><td> </td><td class="right">#include "SolarSystem.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTexture.hpp"</td><td> </td><td class="right">#include "StelTexture.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "Planet.hpp"</td><td> </td><td class="right">#include "Planet.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelNavigator.hpp"</td><td> </td><td class="right">#include "StelNavigator.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelProjector.hpp"</td><td> </td><td class="right">#include "StelProjector.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelFont.hpp"</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "sideral_time.h"</td><td> </td><td class="right">#include "sideral_time.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTextureMgr.hpp"</td><td> </td><td class="right">#include "StelTextureMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelModuleMgr.hpp"</td><td> </td><td class="right">#include "StelModuleMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StarMgr.hpp"</td><td> </td><td class="right">#include "StarMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelMovementMgr.hpp"</td><td> </td><td class="right">#include "StelMovementMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelPainter.hpp"</td><td> </td><td class="right">#include "StelPainter.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelTranslator.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">StelFont* Planet::planetNameFont = NULL;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::labelColor = Vec3f(0.4,0.4,0.8);</td><td> </td><td class="right">Vec3f Planet::labelColor = Vec3f(0.4,0.4,0.8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::orbitColor = Vec3f(1,0.6,1);</td><td> </td><td class="right">Vec3f Planet::orbitColor = Vec3f(1,0.6,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::trailColor = Vec3f(1,0.7,0.7);</td><td> </td><td class="right">Vec3f Planet::trailColor = Vec3f(1,0.7,0.7);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelTextureSP Planet::hintCircleTex;</td><td> </td><td class="right">StelTextureSP Planet::hintCircleTex;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelTextureSP Planet::texEarthShadow;</td><td> </td><td class="right">StelTextureSP Planet::texEarthShadow;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Planet::Planet(const QString&amp; englishName,</td><td> </td><td class="right">Planet::Planet(const QString&amp; englishName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               int flagLighting,</td><td> </td><td class="rblock">                          int flagLighting,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               double radius,</td><td> </td><td class="rblock">                          double radius,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               double oblateness,</td><td> </td><td class="rblock">                          double oblateness,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               Vec3f color,</td><td> </td><td class="rblock">                          Vec3f color,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               float albedo,</td><td> </td><td class="rblock">                          float albedo,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               const QString&amp; atexMapName,</td><td> </td><td class="rblock">                          const QString&amp; atexMapName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               const QString&amp; texHaloName,</td><td> </td><td class="rblock">                          const QString&amp; texHaloName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               posFuncType coordFunc,</td><td> </td><td class="rblock">                          posFuncType coordFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               OsulatingFunctType *osculatingFunc,</td><td> </td><td class="rblock">                          <span class="insert">void* auserDataPtr,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               bool acloseOrbit,</td><td> </td><td class="rblock">                          OsulatingFunctType *osculatingFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               bool hidden,</td><td> </td><td class="rblock">                          bool acloseOrbit,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                  bool hasAtmosphere)</td><td> </td><td class="rblock">                          bool hidden,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                          bool hasAtmosphere)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       : englishName(englishName),</td><td> </td><td class="right">       : englishName(englishName),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         flagLighting(flagLighting),</td><td> </td><td class="right">         flagLighting(flagLighting),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         radius(radius), oneMinusOblateness(1.0-oblateness),</td><td> </td><td class="right">         radius(radius), oneMinusOblateness(1.0-oblateness),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         color(color), albedo(albedo), axisRotation(0.), rings(NULL),</td><td> </td><td class="right">         color(color), albedo(albedo), axisRotation(0.), rings(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         sphereScale(1.f),</td><td> </td><td class="right">         sphereScale(1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         lastJD(J2000),</td><td> </td><td class="right">         lastJD(J2000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         coordFunc(coordFunc),</td><td> </td><td class="right">         coordFunc(coordFunc),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         userDataPtr(auserDataPtr),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         osculatingFunc(osculatingFunc),</td><td> </td><td class="right">         osculatingFunc(osculatingFunc),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         parent(NULL),</td><td> </td><td class="right">         parent(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         hidden(hidden),</td><td> </td><td class="right">         hidden(hidden),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         atmosphere(hasAtmosphere)</td><td> </td><td class="right">         atmosphere(hasAtmosphere)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texMapName = atexMapName;</td><td> </td><td class="right">       texMapName = atexMapName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       lastOrbitJD =0;</td><td> </td><td class="right">       lastOrbitJD =0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       deltaJD = JD_SECOND;</td><td> </td><td class="right">       deltaJD = JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       orbitCached = 0;</td><td> </td><td class="right">       orbitCached = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       closeOrbit = acloseOrbit;</td><td> </td><td class="right">       closeOrbit = acloseOrbit;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eclipticPos=Vec3d(0.,0.,0.);</td><td> </td><td class="right">       eclipticPos=Vec3d(0.,0.,0.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rotLocalToParent = Mat4d::identity();</td><td> </td><td class="right">       rotLocalToParent = Mat4d::identity();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">StelApp::getInstance().getTextureManager().setDefaultParams();</span></td><td> </td><td class="rblock">       texMap = StelApp::getInstance().getTextureManager().createTexture(te</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       StelApp::getInstance().getTextureManager().setWrapMode(GL_REPEAT);</span></td><td> </td><td class="rblock"><span class="insert">xMapName, StelTexture::StelTextureParams(true, GL_LINEAR, GL_REPEAT));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       texMap = StelApp::getInstance().getTextureManager().createTexture(te</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">xMapName);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // 60 day trails</td><td> </td><td class="right">       // 60 day trails</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       DeltaTrail = 1;</td><td> </td><td class="right">       DeltaTrail = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // small increment like 0.125 would allow observation of latitude re
lated wobble of moon</td><td> </td><td class="right">       // small increment like 0.125 would allow observation of latitude re
lated wobble of moon</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // if decide to show moon trail</td><td> </td><td class="right">       // if decide to show moon trail</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       MaxTrail = 60;</td><td> </td><td class="right">       MaxTrail = 60;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       lastTrailJD = 0; // for now</td><td> </td><td class="right">       lastTrailJD = 0; // for now</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       trailOn = 0;</td><td> </td><td class="right">       trailOn = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       firstPoint = 1;</td><td> </td><td class="right">       firstPoint = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 109</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 109</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagLabels = true;</td><td> </td><td class="right">       flagLabels = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Planet::~Planet()</td><td> </td><td class="right">Planet::~Planet()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rings)</td><td> </td><td class="right">       if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete rings;</td><td> </td><td class="right">               delete rings;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">Planet::setParent(Planet* newParent)</span></td><td> </td><td class="rblock">void <span class="insert">Planet::translateName(StelTranslator&amp; trans) {nameI18</span> = <span class="insert">trans.qtransla</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">{</span></td><td> </td><td class="rblock"><span class="insert">te(englishName);}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Q_ASSERT(newParent);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       newParent-&gt;satellites.push_back(this);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       parent</span> = <span class="delete">newParent;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Return the information string "ready to print" :)</td><td> </td><td class="right">// Return the information string "ready to print" :)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Planet::getInfoString(const StelCore* core, const InfoStringGroup&amp; 
flags) const</td><td> </td><td class="right">QString Planet::getInfoString(const StelCore* core, const InfoStringGroup&amp; 
flags) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelNavigator* nav = core-&gt;getNavigator();</td><td> </td><td class="right">       const StelNavigator* nav = core-&gt;getNavigator();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString str;</td><td> </td><td class="right">       QString str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QTextStream oss(&amp;str);</td><td> </td><td class="right">       QTextStream oss(&amp;str);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Name)</td><td> </td><td class="right">       if (flags&amp;Name)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 235</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 230</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return StelNavigator::matVsop87ToJ2000.multiplyWithoutTranslation(ge
tHeliocentricEclipticPos() - nav-&gt;getObserverHeliocentricEclipticPos());</td><td> </td><td class="right">       return StelNavigator::matVsop87ToJ2000.multiplyWithoutTranslation(ge
tHeliocentricEclipticPos() - nav-&gt;getObserverHeliocentricEclipticPos());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the position in the parent Planet coordinate system</td><td> </td><td class="right">// Compute the position in the parent Planet coordinate system</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Actually call the provided function to compute the ecliptical position</td><td> </td><td class="right">// Actually call the provided function to compute the ecliptical position</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::computePositionWithoutOrbits(const double date)</td><td> </td><td class="right">void Planet::computePositionWithoutOrbits(const double date)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (fabs(lastJD-date)&gt;deltaJD)</td><td> </td><td class="right">       if (fabs(lastJD-date)&gt;deltaJD)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               coordFunc(date, eclipticPos);</td><td> </td><td class="rblock">               coordFunc(date, eclipticPos<span class="insert">, userDataPtr</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastJD = date;</td><td> </td><td class="right">               lastJD = date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::computePosition(const double date)</td><td> </td><td class="right">void Planet::computePosition(const double date)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (<span class="delete">deltaOrbitJD &gt; 0 &amp;&amp; (fabs(lastOrbitJD-date)&gt;deltaOrbitJD || !orb
</span>itCached))</td><td> </td><td class="rblock">       if (<span class="insert">orbitFader.getInterstate()&gt;0.000001 &amp;&amp; deltaOrbitJD &gt; 0 &amp;&amp; (fabs
(lastOrbitJD-date)&gt;deltaOrbitJD || !orb</span>itCached))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // calculate orbit first (for line drawing)</td><td> </td><td class="right">               // calculate orbit first (for line drawing)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double date_increment = re.siderealPeriod/ORBIT_SEGMENTS;</td><td> </td><td class="right">               double date_increment = re.siderealPeriod/ORBIT_SEGMENTS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double calc_date;</td><td> </td><td class="right">               double calc_date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // int delta_points = (int)(0.5 + (date - lastOrbitJD)/date_
increment);</td><td> </td><td class="right">               // int delta_points = (int)(0.5 + (date - lastOrbitJD)/date_
increment);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               int delta_points;</td><td> </td><td class="right">               int delta_points;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if( date &gt; lastOrbitJD )</td><td> </td><td class="right">               if( date &gt; lastOrbitJD )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 282</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 277</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*date_increment;</td><td> </td><td class="right">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*date_increment;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // date increments between points wi
ll not be completely constant though</td><td> </td><td class="right">                                       // date increments between points wi
ll not be completely constant though</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       computeTransMatrix(calc_date);</td><td> </td><td class="right">                                       computeTransMatrix(calc_date);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       if (osculatingFunc)</td><td> </td><td class="right">                                       if (osculatingFunc)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               (*osculatingFunc)(date,calc_
date,eclipticPos);</td><td> </td><td class="right">                                               (*osculatingFunc)(date,calc_
date,eclipticPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       else</td><td> </td><td class="right">                                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               coordFunc(calc_date, eclipti
cPos);</td><td> </td><td class="rblock">                                               coordFunc(calc_date, eclipti
cPos<span class="insert">, userDataPtr</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td> </td><td class="right">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = orbit[d+delta_points];</td><td> </td><td class="right">                                       orbit[d] = orbit[d+delta_points];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       lastOrbitJD = new_date;</td><td> </td><td class="right">                       lastOrbitJD = new_date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 310</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 305</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // calculate new points</td><td> </td><td class="right">                                       // calculate new points</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*date_increment;</td><td> </td><td class="right">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*date_increment;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       computeTransMatrix(calc_date);</td><td> </td><td class="right">                                       computeTransMatrix(calc_date);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       if (osculatingFunc) {</td><td> </td><td class="right">                                       if (osculatingFunc) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               (*osculatingFunc)(date,calc_
date,eclipticPos);</td><td> </td><td class="right">                                               (*osculatingFunc)(date,calc_
date,eclipticPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       else</td><td> </td><td class="right">                                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               coordFunc(calc_date, eclipti
cPos);</td><td> </td><td class="rblock">                                               coordFunc(calc_date, eclipti
cPos<span class="insert">, userDataPtr</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td> </td><td class="right">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = orbit[d+delta_points];</td><td> </td><td class="right">                                       orbit[d] = orbit[d+delta_points];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       lastOrbitJD = new_date;</td><td> </td><td class="right">                       lastOrbitJD = new_date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 337</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 332</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td> </td><td class="right">                       for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               calc_date = date + (d-ORBIT_SEGMENTS/2)*date
_increment;</td><td> </td><td class="right">                               calc_date = date + (d-ORBIT_SEGMENTS/2)*date
_increment;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               computeTransMatrix(calc_date);</td><td> </td><td class="right">                               computeTransMatrix(calc_date);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (osculatingFunc)</td><td> </td><td class="right">                               if (osculatingFunc)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       (*osculatingFunc)(date,calc_date,ecl
ipticPos);</td><td> </td><td class="right">                                       (*osculatingFunc)(date,calc_date,ecl
ipticPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       coordFunc(calc_date, eclipticPos);</td><td> </td><td class="rblock">                                       coordFunc(calc_date, eclipticPos<span class="insert">, us
erDataPtr</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               orbit[d] = getHeliocentricEclipticPos();</td><td> </td><td class="right">                               orbit[d] = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       lastOrbitJD = date;</td><td> </td><td class="right">                       lastOrbitJD = date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (!osculatingFunc) orbitCached = 1;</td><td> </td><td class="right">                       if (!osculatingFunc) orbitCached = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // calculate actual Planet position</td><td> </td><td class="right">               // calculate actual Planet position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               coordFunc(date, eclipticPos);</td><td> </td><td class="rblock">               coordFunc(date, eclipticPos<span class="insert">, userDataPtr</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastJD = date;</td><td> </td><td class="right">               lastJD = date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (fabs(lastJD-date)&gt;deltaJD)</td><td> </td><td class="right">       else if (fabs(lastJD-date)&gt;deltaJD)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // calculate actual Planet position</td><td> </td><td class="right">               // calculate actual Planet position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               coordFunc(date, eclipticPos);</td><td> </td><td class="rblock">               coordFunc(date, eclipticPos<span class="insert">, userDataPtr</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastJD = date;</td><td> </td><td class="right">               lastJD = date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the transformation matrix from the local Planet coordinate to th
e parent Planet coordinate</td><td> </td><td class="right">// Compute the transformation matrix from the local Planet coordinate to th
e parent Planet coordinate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::computeTransMatrix(double jd)</td><td> </td><td class="right">void Planet::computeTransMatrix(double jd)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       axisRotation = getSiderealTime(jd);</td><td> </td><td class="right">       axisRotation = getSiderealTime(jd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 379</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 374</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rotLocalToParent = Mat4d::zrotation(re.ascendingNode - re.pr
ecessionRate*(jd-re.epoch)) * Mat4d::xrotation(re.obliquity);</td><td> </td><td class="right">               rotLocalToParent = Mat4d::zrotation(re.ascendingNode - re.pr
ecessionRate*(jd-re.epoch)) * Mat4d::xrotation(re.obliquity);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Mat4d Planet::getRotEquatorialToVsop87(void) const</td><td> </td><td class="right">Mat4d Planet::getRotEquatorialToVsop87(void) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d rval = rotLocalToParent;</td><td> </td><td class="right">       Mat4d rval = rotLocalToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent)</td><td> </td><td class="right">       if (parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               for (<span class="delete">const Planet *</span>p=parent;p-&gt;parent;p=p-&gt;parent)</td><td> </td><td class="rblock">               for (<span class="insert">PlanetP </span>p=parent;p-&gt;parent;p=p-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rval = p-&gt;rotLocalToParent * rval;</td><td> </td><td class="right">                       rval = p-&gt;rotLocalToParent * rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return rval;</td><td> </td><td class="right">       return rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::setRotEquatorialToVsop87(const Mat4d &amp;m)</td><td> </td><td class="right">void Planet::setRotEquatorialToVsop87(const Mat4d &amp;m)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d a = Mat4d::identity();</td><td> </td><td class="right">       Mat4d a = Mat4d::identity();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent)</td><td> </td><td class="right">       if (parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               for (<span class="delete">const Planet *</span>p=parent;p-&gt;parent;p=p-&gt;parent)</td><td> </td><td class="rblock">               for (<span class="insert">PlanetP </span>p=parent;p-&gt;parent;p=p-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       a = p-&gt;rotLocalToParent * a;</td><td> </td><td class="right">                       a = p-&gt;rotLocalToParent * a;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rotLocalToParent = a.transpose() * m;</td><td> </td><td class="right">       rotLocalToParent = a.transpose() * m;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the z rotation to use from equatorial to geographic coordinates</td><td> </td><td class="right">// Compute the z rotation to use from equatorial to geographic coordinates</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getSiderealTime(double jd) const</td><td> </td><td class="right">double Planet::getSiderealTime(double jd) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (englishName=="Earth")</td><td> </td><td class="right">       if (englishName=="Earth")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 422</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 417</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the Planet position in the parent Planet ecliptic coordinate in AU</td><td> </td><td class="right">// Get the Planet position in the parent Planet ecliptic coordinate in AU</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3d Planet::getEclipticPos() const</td><td> </td><td class="right">Vec3d Planet::getEclipticPos() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return eclipticPos;</td><td> </td><td class="right">       return eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Return the heliocentric ecliptical position (Vsop87)</td><td> </td><td class="right">// Return the heliocentric ecliptical position (Vsop87)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3d Planet::getHeliocentricEclipticPos() const</td><td> </td><td class="right">Vec3d Planet::getHeliocentricEclipticPos() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d pos = eclipticPos;</td><td> </td><td class="right">       Vec3d pos = eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const Planet *</span>pp = parent;</td><td> </td><td class="rblock">       <span class="insert">PlanetP </span>pp = parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (pp)</td><td> </td><td class="right">       if (pp)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               while (pp-&gt;parent)</td><td> </td><td class="right">               while (pp-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       pos += pp-&gt;eclipticPos;</td><td> </td><td class="right">                       pos += pp-&gt;eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       pp = pp-&gt;parent;</td><td> </td><td class="right">                       pp = pp-&gt;parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return pos;</td><td> </td><td class="right">       return pos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::setHeliocentricEclipticPos(const Vec3d &amp;pos)</td><td> </td><td class="right">void Planet::setHeliocentricEclipticPos(const Vec3d &amp;pos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eclipticPos = pos;</td><td> </td><td class="right">       eclipticPos = pos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const Planet *p</span> = parent;</td><td> </td><td class="rblock">       <span class="insert">PlanetP p</span> = parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (p) <span class="delete">while (p-&gt;parent)</span></td><td> </td><td class="rblock">       if (p)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               eclipticPos -= p-&gt;eclipticPos;</td><td> </td><td class="rblock">               <span class="insert">while (p-&gt;parent)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               p = p-&gt;parent;</td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       eclipticPos -= p-&gt;eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       p = p-&gt;parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the distance to the given position in heliocentric coordinate (i
n AU)</td><td> </td><td class="right">// Compute the distance to the given position in heliocentric coordinate (i
n AU)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::computeDistance(const Vec3d&amp; obsHelioPos)</td><td> </td><td class="right">double Planet::computeDistance(const Vec3d&amp; obsHelioPos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       distance = (obsHelioPos-getHeliocentricEclipticPos()).length();</td><td> </td><td class="right">       distance = (obsHelioPos-getHeliocentricEclipticPos()).length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return distance;</td><td> </td><td class="right">       return distance;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the phase angle for an observer at pos obsPos in the heliocentric co
ordinate (dist in AU)</td><td> </td><td class="right">// Get the phase angle for an observer at pos obsPos in the heliocentric co
ordinate (dist in AU)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Planet::getPhase(<span class="delete">Vec3d</span> obsPos) const</td><td> </td><td class="rblock">double Planet::getPhase(<span class="insert">const Vec3d&amp;</span> obsPos) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const double <span class="delete">sq</span> = obsPos.lengthSquared();</td><td> </td><td class="rblock">       const double <span class="insert">observerRq</span> = obsPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const <span class="delete">Vec3d heliopos</span> = getHeliocentricEclipticPos();</td><td> </td><td class="rblock">       const <span class="insert">Vec3d&amp; planetHelioPos</span> = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const double <span class="delete">Rq</span> = <span class="delete">heliopos.lengthSquared();</span></td><td> </td><td class="rblock">       const double <span class="insert">planetRq</span> = <span class="insert">planetHelioPos.lengthSquared();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const double <span class="delete">pq</span> = (obsPos - <span class="delete">heliopos).lengthSquared();</span></td><td> </td><td class="rblock">       const double <span class="insert">observerPlanetRq</span> = (obsPos - <span class="insert">planetHelioPos).lengthSqua</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const double cos_chi = (pq + Rq - sq)/(2.0*sqrt(pq*Rq));</span></td><td> </td><td class="rblock"><span class="insert">red();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return <span class="delete">(1.0 - acos(cos_chi)/M_PI) * cos_chi</span> + <span class="delete">sqrt(1.0</span> - <span class="delete">cos_chi*cos</span></td><td> </td><td class="rblock">       return <span class="insert">std::acos(observerPlanetRq</span> + <span class="insert">planetRq</span> - <span class="insert">observerRq)/(2.0*sqrt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">_chi) / M_PI;</span></td><td> </td><td class="rblock"><span class="insert">(observerPlanetRq*planetRq));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// Computation of the visual magnitude (V band) of the planet.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">float Planet::getVMagnitude(const StelNavigator * nav) const</td><td> </td><td class="right">float Planet::getVMagnitude(const StelNavigator * nav) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d obsPos = nav-&gt;getObserverHeliocentricEclipticPos();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const double sq = obsPos.lengthSquared();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent == 0)</td><td> </td><td class="right">       if (parent == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // sun, compute the apparent magnitude for the absolute mag 
(4.83) and observer's distance</td><td> </td><td class="right">               // sun, compute the apparent magnitude for the absolute mag 
(4.83) and observer's distance</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">double distParsec = std::sqrt(sq</span>)*AU/PARSEC;</td><td> </td><td class="rblock">               <span class="insert">const double distParsec = std::sqrt(nav-&gt;getObserverHeliocen
tricEclipticPos().lengthSquared()</span>)*AU/PARSEC;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return 4.83 + 5.*(std::log10(distParsec)-1.);</td><td> </td><td class="right">               return 4.83 + 5.*(std::log10(distParsec)-1.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const Vec3d heliopos = getHeliocentricEclipticPos();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const double Rq = heliopos.lengthSquared();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const double pq = (obsPos - heliopos).lengthSquared();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const double cos_chi = (pq + Rq - sq)/(2.0*sqrt(pq*Rq));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const double phase = (1.0 - std::acos(cos_chi)/M_PI) * cos_chi + std</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">::sqrt(1.0 - cos_chi*cos_chi) / M_PI;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       double F = 2.0 * albedo * radius * radius * phase / (3.0*pq*Rq);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">// Compute the angular phase</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const Vec3d&amp; observerHelioPos = nav-&gt;getObserverHeliocentricEcliptic</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Pos();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double observerRq = observerHelioPos.lengthSquared();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double planetRq = planetHelioPos.lengthSquared();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double observerPlanetRq = (observerHelioPos - planetHelioPos).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">lengthSquared();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double cos_chi = (observerPlanetRq + planetRq - observerRq)/(2</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">.0*sqrt(observerPlanetRq*planetRq));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       double phase = std::acos(cos_chi);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       double shadowFactor = 1.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Check if the satellite is inside the inner shadow of the parent p
lanet:</td><td> </td><td class="right">       // Check if the satellite is inside the inner shadow of the parent p
lanet:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (parent-&gt;parent != 0) {</td><td> </td><td class="rblock">       if (parent-&gt;parent != 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               const <span class="delete">Vec3d parent_heliopos</span> = parent-&gt;getHeliocentricEclipti</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">cPos();</td><td> </td><td class="rblock">               const <span class="insert">Vec3d&amp; parentHeliopos</span> = parent-&gt;getHeliocentricEclipti</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               const double parent_Rq = <span class="delete">parent_heliopos.lengthSquared();</span></td><td> </td><td class="rblock">cPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               const double pos_times_parent_pos = <span class="delete">heliopos</span> * <span class="delete">parent_heliop</span></td><td> </td><td class="rblock">               const double parent_Rq = <span class="insert">parentHeliopos.lengthSquared();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">os;</span></td><td> </td><td class="rblock">               const double pos_times_parent_pos = <span class="insert">planetHelioPos</span> * <span class="insert">parentH</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (pos_times_parent_pos &gt; parent_Rq) {</td><td> </td><td class="rblock"><span class="insert">eliopos;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               if (pos_times_parent_pos &gt; parent_Rq)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // The satellite is farther away from the sun than t
he parent planet.</td><td> </td><td class="right">                       // The satellite is farther away from the sun than t
he parent planet.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const double sun_radius = parent-&gt;parent-&gt;radius;</td><td> </td><td class="right">                       const double sun_radius = parent-&gt;parent-&gt;radius;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const double sun_minus_parent_radius = sun_radius - 
parent-&gt;radius;</td><td> </td><td class="right">                       const double sun_minus_parent_radius = sun_radius - 
parent-&gt;radius;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const double quot = pos_times_parent_pos/parent_Rq;</td><td> </td><td class="right">                       const double quot = pos_times_parent_pos/parent_Rq;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // <span class="delete">compute</span> d = distance from satellite center to bor</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">der</td><td> </td><td class="rblock">                       // <span class="insert">Compute</span> d = distance from satellite center to bor</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">//</span> of inner shadow. d&gt;0 means inside the shadow <span class="delete">cone</span></td><td> </td><td class="rblock">der of inner shadow.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">.</span></td><td> </td><td class="rblock">                       <span class="insert">//</span> d&gt;0 means inside the shadow <span class="insert">cone.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double d = sun_radius - sun_minus_parent_radius*quot</td><td> </td><td class="rblock">                       double d = sun_radius - sun_minus_parent_radius*quot</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       - <span class="delete">std::sqrt( (1.0-sun_minus_parent_radius/sqrt(paren</span></td><td> </td><td class="rblock"> - <span class="insert">std::sqrt((1.-sun_minus_parent_radius/sqrt(parent_Rq))</span> * <span class="insert">(planetRq-pos_t</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">t_Rq))</span></td><td> </td><td class="rblock"><span class="insert">imes_parent_pos*quot));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       * <span class="delete">(Rq-pos_times_parent_pos*quot) );</span></td><td> </td><td class="rblock">                       if <span class="insert">(d&gt;=radius)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if <span class="delete">(d &gt;= radius)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // The satellite is totally inside the inner
 shadow.</td><td> </td><td class="right">                               // The satellite is totally inside the inner
 shadow.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">F *</span>= 1e-9;</td><td> </td><td class="rblock">                               <span class="insert">shadowFactor </span>= 1e-9;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       else if (d<span class="delete"> &gt; </span>-radius)</td><td> </td><td class="rblock">                       else if (d<span class="insert">&gt;</span>-radius)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // The satellite is partly inside the inner 
shadow,</td><td> </td><td class="right">                               // The satellite is partly inside the inner 
shadow,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // compute a fantasy value for the magnitude
:</td><td> </td><td class="right">                               // compute a fantasy value for the magnitude
:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               d /= radius;</td><td> </td><td class="right">                               d /= radius;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">F *= (0.5 - (std::asin(d)+d*std::sqrt(1.0-d*
</span>d))/M_PI);</td><td> </td><td class="rblock">                               <span class="insert">shadowFactor = (0.5 - (std::asin(d)+d*std::s
qrt(1.0-d*</span>d))/M_PI);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const double <span class="delete">rval</span> = <span class="delete">-26.73 - 2.5</span> * <span class="delete">std::log10(F);</span></td><td> </td><td class="rblock">       <span class="insert">// Use empirical formulae for main planets when seen from earth</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       //qDebug() &lt;&lt; "Planet(" &lt;&lt; getEnglishName()</span></td><td> </td><td class="rblock"><span class="insert">       // Algorithm provided by Pere Planesas (Observatorio Astronomico Nac</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       //         <span class="delete">&lt;&lt; ")::getVMagnitude(" &lt;&lt; obsPos &lt;&lt; "): "</span></td><td> </td><td class="rblock"><span class="insert">ional)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       //         <span class="delete">&lt;&lt; "phase: " &lt;&lt; phase</span></td><td> </td><td class="rblock"><span class="insert">       if (nav-&gt;getCurrentLocation().planetName=="Earth")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       //         <span class="delete">&lt;&lt; ",F: " &lt;&lt;</span> F</td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">//         &lt;&lt; ",rval: " &lt;&lt; rval;</span></td><td> </td><td class="rblock"><span class="insert">               phase*=180./M_PI;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return <span class="delete">rval;</span></td><td> </td><td class="rblock">               const double <span class="insert">d</span> = <span class="insert">5.</span> * <span class="insert">log10(sqrt(observerPlanetRq*planetRq))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               double f1 = phase/100.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Mercury")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if ( phase &gt; 150. ) f1 = 1.5;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -0.36 + d + 3.8*f1 - 2.73*f1*f1 + 2*f1*f1*f1;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Venus")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -4.29 + d + 0.09*f1 + 2.39*f1*f1 - 0.65*f1*f1</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">*f1;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Mars")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -1.52 + d + 0.016*phase;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Jupiter")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -9.25 + d + 0.005*phase;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Saturn")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       // <span class="insert">TODO re-add rings computation</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       // <span class="insert">double rings = -2.6*sinx + 1.25*sinx*sinx;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -8.88 + d + 0.044*phase;// + rings;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Uranus")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -7.19 + d + 0.0028*phase;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Neptune")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -6.87 + d;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Pluto")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return -1.01 + d + 0.041*phase;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               phase/=180./M_PI;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       // <span class="insert">This formula seems to give wrong results</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double p = (1.0 - phase/M_PI) * cos_chi + std::sqrt(1.0 - cos_</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">chi*cos_chi) / M_PI;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       double</span> F <span class="insert">= 2.0 * albedo * radius * radius * p / (3.0*observerPlanetR</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">q*planetRq) * shadowFactor;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       return <span class="insert">-26.73 - 2.5 * std::log10(F);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getAngularSize(const StelCore* core) const</td><td> </td><td class="right">double Planet::getAngularSize(const StelCore* core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double rad = radius;</td><td> </td><td class="right">       double rad = radius;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rings)</td><td> </td><td class="right">       if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rad = rings-&gt;getSize();</td><td> </td><td class="right">               rad = rings-&gt;getSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return std::atan2(rad*sphereScale,getJ2000EquatorialPos(core-&gt;getNav
igator()).length()) * 180./M_PI;</td><td> </td><td class="right">       return std::atan2(rad*sphereScale,getJ2000EquatorialPos(core-&gt;getNav
igator()).length()) * 180./M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getSpheroidAngularSize(const StelCore* core) const</td><td> </td><td class="right">double Planet::getSpheroidAngularSize(const StelCore* core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return std::atan2(radius*sphereScale,getJ2000EquatorialPos(core-&gt;get
Navigator()).length()) * 180./M_PI;</td><td> </td><td class="right">       return std::atan2(radius*sphereScale,getJ2000EquatorialPos(core-&gt;get
Navigator()).length()) * 180./M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Draw the Planet and all the related infos : name, circle etc..</td><td> </td><td class="right">// Draw the Planet and all the related infos : name, circle etc..</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::draw(StelCore* core, float maxMagLabels)</td><td> </td><td class="rblock">void Planet::draw(StelCore* core, float maxMagLabels<span class="insert">, const QFont&amp; planetNa
meFont</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hidden)</td><td> </td><td class="right">       if (hidden)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelNavigator* nav = core-&gt;getNavigator();</td><td> </td><td class="right">       StelNavigator* nav = core-&gt;getNavigator();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d mat = Mat4d::translation(eclipticPos) * rotLocalToParent;</td><td> </td><td class="right">       Mat4d mat = Mat4d::translation(eclipticPos) * rotLocalToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const Planet *</span>p = parent;</td><td> </td><td class="rblock">       <span class="insert">PlanetP </span>p = parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       while (p &amp;&amp; p-&gt;parent)</td><td> </td><td class="right">       while (p &amp;&amp; p-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               mat = Mat4d::translation(p-&gt;eclipticPos) * mat * p-&gt;rotLocal
ToParent;</td><td> </td><td class="right">               mat = Mat4d::translation(p-&gt;eclipticPos) * mat * p-&gt;rotLocal
ToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               p = p-&gt;parent;</td><td> </td><td class="right">               p = p-&gt;parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This removed totally the Planet shaking bug!!!</td><td> </td><td class="right">       // This removed totally the Planet shaking bug!!!</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       mat = nav-&gt;getHeliocentricEclipticModelViewMat() * mat;</td><td> </td><td class="right">       mat = nav-&gt;getHeliocentricEclipticModelViewMat() * mat;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (<span class="delete">this == nav-&gt;getHomePlanet()</span>)</td><td> </td><td class="rblock">       if (<span class="insert">getEnglishName() == nav-&gt;getCurrentLocation().planetName</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // Draw the rings if we are located on a planet with rings, 
but not the planet itself.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rings)</td><td> </td><td class="right">               if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       StelPainter sPainter(core-&gt;getProjection(mat));</td><td> </td><td class="right">                       StelPainter sPainter(core-&gt;getProjection(mat));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rings-&gt;draw(&amp;sPainter,mat,1000.0);</td><td> </td><td class="right">                       rings-&gt;draw(&amp;sPainter,mat,1000.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute the 2D position and check if in the screen</td><td> </td><td class="right">       // Compute the 2D position and check if in the screen</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelProjectorP prj = core-&gt;getProjection(mat);</td><td> </td><td class="right">       const StelProjectorP prj = core-&gt;getProjection(mat);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float screenSz = getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRadA
tCenter();</td><td> </td><td class="right">       float screenSz = getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRadA
tCenter();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float viewport_left = prj-&gt;getViewportPosX();</td><td> </td><td class="right">       float viewport_left = prj-&gt;getViewportPosX();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float viewport_bottom = prj-&gt;getViewportPosY();</td><td> </td><td class="right">       float viewport_bottom = prj-&gt;getViewportPosY();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (prj-&gt;project(Vec3f(0,0,0), screenPos) &amp;&amp;</td><td> </td><td class="right">       if (prj-&gt;project(Vec3f(0,0,0), screenPos) &amp;&amp;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               screenPos[1]&gt;viewport_bottom - screenSz &amp;&amp; <span class="delete">screenPos[1]&lt;view</span></td><td> </td><td class="rblock">                       screenPos[1]&gt;viewport_bottom - screenSz &amp;&amp; <span class="insert">screenPos</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">port_bottom</span> + prj-&gt;getViewportHeight()+screenSz &amp;&amp;</td><td> </td><td class="rblock"><span class="insert">[1]&lt;viewport_bottom</span> + prj-&gt;getViewportHeight()+screenSz &amp;&amp;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               screenPos[0]&gt;viewport_left - screenSz &amp;&amp; <span class="delete">screenPos[0]&lt;viewpo</span></td><td> </td><td class="rblock">                       screenPos[0]&gt;viewport_left - screenSz &amp;&amp; <span class="insert">screenPos[0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">rt_left</span> + prj-&gt;getViewportWidth() + screenSz)</td><td> </td><td class="rblock"><span class="insert">]&lt;viewport_left</span> + prj-&gt;getViewportWidth() + screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Draw the name, and the circle if it's not too close from 
the body it's turning around</td><td> </td><td class="right">               // Draw the name, and the circle if it's not too close from 
the body it's turning around</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // this prevents name overlaping (ie for jupiter satellites)</td><td> </td><td class="right">               // this prevents name overlaping (ie for jupiter satellites)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float ang_dist = 300.f*atan(getEclipticPos().length()/getEqu
inoxEquatorialPos(nav).length())/core-&gt;getMovementMgr()-&gt;getCurrentFov();</td><td> </td><td class="right">               float ang_dist = 300.f*atan(getEclipticPos().length()/getEqu
inoxEquatorialPos(nav).length())/core-&gt;getMovementMgr()-&gt;getCurrentFov();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (ang_dist==0.f)</td><td> </td><td class="right">               if (ang_dist==0.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ang_dist = 1.f; // if ang_dist == 0, the Planet is s
un..</td><td> </td><td class="right">                       ang_dist = 1.f; // if ang_dist == 0, the Planet is s
un..</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // by putting here, only draw orbit if Planet is visible for
 clarity</td><td> </td><td class="right">               // by putting here, only draw orbit if Planet is visible for
 clarity</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawOrbit(core);  // TODO - fade in here also...</td><td> </td><td class="right">               drawOrbit(core);  // TODO - fade in here also...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawTrail(core);</td><td> </td><td class="right">               drawTrail(core);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (flagLabels &amp;&amp; ang_dist&gt;0.25 &amp;&amp; maxMagLabels&gt;getVMagnitud
e(nav))</td><td> </td><td class="right">               if (flagLabels &amp;&amp; ang_dist&gt;0.25 &amp;&amp; maxMagLabels&gt;getVMagnitud
e(nav))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       labelsFader=true;</td><td> </td><td class="right">                       labelsFader=true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       labelsFader=false;</td><td> </td><td class="right">                       labelsFader=false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               drawHints(core);</td><td> </td><td class="rblock">               drawHints(core<span class="insert">, planetNameFont</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               draw3dModel(core,mat,screenSz);</td><td> </td><td class="right">               draw3dModel(core,mat,screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return;</td><td> </td><td class="right">       return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::draw3dModel(StelCore* core, const Mat4d&amp; mat, float screenSz)</td><td> </td><td class="right">void Planet::draw3dModel(StelCore* core, const Mat4d&amp; mat, float screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This is the main method drawing a planet 3d model</td><td> </td><td class="right">       // This is the main method drawing a planet 3d model</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Some work has to be done on this method to make the rendering nic
er</td><td> </td><td class="right">       // Some work has to be done on this method to make the rendering nic
er</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelNavigator* nav = core-&gt;getNavigator();</td><td> </td><td class="right">       StelNavigator* nav = core-&gt;getNavigator();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (screenSz&gt;1.)</td><td> </td><td class="right">       if (screenSz&gt;1.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               StelPainter* sPainter = new StelPainter(core-&gt;getProjection(
mat * Mat4d::zrotation(M_PI/180*(axisRotation + 90.))));</td><td> </td><td class="right">               StelPainter* sPainter = new StelPainter(core-&gt;getProjection(
mat * Mat4d::zrotation(M_PI/180*(axisRotation + 90.))));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (flagLighting)</td><td> </td><td class="right">               if (flagLighting)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">glEnable(GL_LIGHTING</span>);</td><td> </td><td class="rblock">                       <span class="insert">sPainter-&gt;getLight().enable(</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Set the main source of light to be the sun</td><td> </td><td class="right">                       // Set the main source of light to be the sun</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       const <span class="delete">Vec3d</span> sunPos = <span class="delete">core-&gt;getNavigator()-&gt;getHelioc</span></td><td> </td><td class="rblock">                       const <span class="insert">Vec3d&amp;</span> sunPos = <span class="insert">core-&gt;getNavigator()-&gt;getHelio</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">entricEclipticModelViewMat()*Vec3d(0,0,0);</span></td><td> </td><td class="rblock"><span class="insert">centricEclipticModelViewMat()*Vec3d(0,0,0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glLightfv(GL_LIGHT0,GL_POSITION,Vec4f(sunPos[0],sunP</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getLight().setPosition(Vec4f(sunPos[0],sun</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">os[1],sunPos[2],1.f));</span></td><td> </td><td class="rblock"><span class="insert">Pos[1],sunPos[2],1.f));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       const float diffuse[4] = {2.,2.,2.,1};</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glLightfv(GL_LIGHT0,GL_DIFFUSE, diffuse);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Set the light parameters taking sun as the light 
source</td><td> </td><td class="right">                       // Set the light parameters taking sun as the light 
source</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       const <span class="delete">float zero[4]</span> = <span class="delete">{0,0,0,0};</span></td><td> </td><td class="rblock">                       <span class="insert">static</span> const <span class="insert">Vec4f diffuse</span> = <span class="insert">Vec4f(2.,2.,2.,1);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       const <span class="delete">float ambient[4]</span> = <span class="delete">{0.02,0.02,0.02,0.02};</span></td><td> </td><td class="rblock"><span class="insert">                       static</span> const <span class="insert">Vec4f zero</span> = <span class="insert">Vec4f(0,0,0,0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glLightfv(GL_LIGHT0,GL_AMBIENT, ambient);</span></td><td> </td><td class="rblock"><span class="insert">                       static const Vec4f ambient = Vec4f(0.02,0.02,0.02,0.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glLightfv(GL_LIGHT0,GL_DIFFUSE, diffuse);</span></td><td> </td><td class="rblock"><span class="insert">02);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glLightfv(GL_LIGHT0,GL_SPECULAR,zero);</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getLight().setAmbient(ambient);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glMaterialfv(GL_FRONT,GL_AMBIENT,  ambient);</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getLight().setDiffuse(diffuse);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glMaterialfv(GL_FRONT,GL_EMISSION, zero);</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getLight().setSpecular(zero);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glMaterialfv(GL_FRONT,GL_SHININESS,zero);</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glMaterialfv(GL_FRONT,GL_SPECULAR, zero);</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getMaterial().setAmbient(ambient);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getMaterial().setEmission(zero);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getMaterial().setShininess(0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getMaterial().setSpecular(zero);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">glDisable(GL_LIGHTING);</span></td><td> </td><td class="rblock">                       <span class="insert">sPainter-&gt;getLight().disable();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       glColor3fv(Vec3f(1.f,1.f,1.f));</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;setColor(1.f,1.f,1.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rings)</td><td> </td><td class="right">               if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const double dist = getEquinoxEquatorialPos(nav).len
gth();</td><td> </td><td class="right">                       const double dist = getEquinoxEquatorialPos(nav).len
gth();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double z_near = 0.9*(dist - rings-&gt;getSize());</td><td> </td><td class="right">                       double z_near = 0.9*(dist - rings-&gt;getSize());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double z_far  = 1.1*(dist + rings-&gt;getSize());</td><td> </td><td class="right">                       double z_far  = 1.1*(dist + rings-&gt;getSize());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (z_near &lt; 0.0) z_near = 0.0;</td><td> </td><td class="right">                       if (z_near &lt; 0.0) z_near = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double n,f;</td><td> </td><td class="right">                       double n,f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;getClippingPlanes(&amp;n,&amp;f); // Save clipping pla
nes</td><td> </td><td class="right">                       core-&gt;getClippingPlanes(&amp;n,&amp;f); // Save clipping pla
nes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;setClippingPlanes(z_near,z_far);</td><td> </td><td class="right">                       core-&gt;setClippingPlanes(z_near,z_far);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       glDepthMask(GL_TRUE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glClear(GL_DEPTH_BUFFER_BIT);</td><td> </td><td class="right">                       glClear(GL_DEPTH_BUFFER_BIT);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glEnable(GL_DEPTH_TEST);</td><td> </td><td class="right">                       glEnable(GL_DEPTH_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       drawSphere(sPainter, screenSz);</td><td> </td><td class="right">                       drawSphere(sPainter, screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">glDisable(GL_LIGHTING);</span></td><td> </td><td class="rblock">                       <span class="insert">glDepthMask(GL_FALSE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;getLight().disable();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rings-&gt;draw(sPainter,mat,screenSz);</td><td> </td><td class="right">                       rings-&gt;draw(sPainter,mat,screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">glEnable(GL_LIGHTING</span>);</td><td> </td><td class="rblock">                       <span class="insert">sPainter-&gt;getLight().enable(</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glDisable(GL_DEPTH_TEST);</td><td> </td><td class="right">                       glDisable(GL_DEPTH_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;setClippingPlanes(n,f);  // Restore old clippi
ng planes</td><td> </td><td class="right">                       core-&gt;setClippingPlanes(n,f);  // Restore old clippi
ng planes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td> </td><td class="right">                       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if (this==ssm-&gt;getMoon() &amp;&amp; nav-&gt;get<span class="delete">HomePlanet()==ss
m-&gt;getEarth()</span> &amp;&amp; ssm-&gt;nearLunarEclipse())</td><td> </td><td class="rblock">                       if (this==ssm-&gt;getMoon() &amp;&amp; nav-&gt;get<span class="insert">CurrentLocation(
).planetName=="Earth"</span> &amp;&amp; ssm-&gt;nearLunarEclipse())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // Draw earth shadow over moon using stencil
 buffer if appropriate</td><td> </td><td class="right">                               // Draw earth shadow over moon using stencil
 buffer if appropriate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // This effect curently only looks right fro
m earth viewpoint</td><td> </td><td class="right">                               // This effect curently only looks right fro
m earth viewpoint</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // TODO: moon magnitude label during eclipse
 isn't accurate...</td><td> </td><td class="right">                               // TODO: moon magnitude label during eclipse
 isn't accurate...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glClearStencil(0x0);</td><td> </td><td class="right">                               glClearStencil(0x0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glClear(GL_STENCIL_BUFFER_BIT);</td><td> </td><td class="right">                               glClear(GL_STENCIL_BUFFER_BIT);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glStencilFunc(GL_ALWAYS, 0x1, 0x1);</td><td> </td><td class="right">                               glStencilFunc(GL_ALWAYS, 0x1, 0x1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glStencilOp(GL_ZERO, GL_REPLACE, GL_REPLACE)
;</td><td> </td><td class="right">                               glStencilOp(GL_ZERO, GL_REPLACE, GL_REPLACE)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glEnable(GL_STENCIL_TEST);</td><td> </td><td class="right">                               glEnable(GL_STENCIL_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               drawSphere(sPainter, screenSz);</td><td> </td><td class="right">                               drawSphere(sPainter, screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glDisable(GL_STENCIL_TEST);</td><td> </td><td class="right">                               glDisable(GL_STENCIL_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">glDisable(GL_LIGHTING);</span></td><td> </td><td class="rblock">                               <span class="insert">sPainter-&gt;getLight().disable();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               delete sPainter;</span></td><td> </td><td class="rblock"><span class="insert">                               drawEarthShadow(core, sPainter);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               sPainter=NULL;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               drawEarthShadow(core);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else</td><td> </td><td class="right">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // Normal planet</td><td> </td><td class="right">                               // Normal planet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               drawSphere(sPainter, screenSz);</td><td> </td><td class="right">                               drawSphere(sPainter, screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (sPainter)</td><td> </td><td class="right">               if (sPainter)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       delete sPainter;</td><td> </td><td class="right">                       delete sPainter;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sPainter=NULL;</td><td> </td><td class="right">               sPainter=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw the halo</td><td> </td><td class="right">       // Draw the halo</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Prepare openGL lighting parameters according to luminance</td><td> </td><td class="right">       // Prepare openGL lighting parameters according to luminance</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float surfArcMin2 = getSpheroidAngularSize(core)*60;</td><td> </td><td class="right">       float surfArcMin2 = getSpheroidAngularSize(core)*60;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       surfArcMin2 = surfArcMin2*surfArcMin2*M_PI; // the total illuminated
 area in arcmin^2</td><td> </td><td class="right">       surfArcMin2 = surfArcMin2*surfArcMin2*M_PI; // the total illuminated
 area in arcmin^2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(core-&gt;getProjection(StelCore::FrameJ2000));</td><td> </td><td class="right">       StelPainter sPainter(core-&gt;getProjection(StelCore::FrameJ2000));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       core-&gt;getSkyDrawer()-&gt;postDrawSky3dModel(<span class="delete">screenPos[0],screenPos[1], 
surfArcMin2, getVMagnitude(core-&gt;getNavigator()), &amp;sPainter</span>, color);</td><td> </td><td class="rblock">       core-&gt;getSkyDrawer()-&gt;postDrawSky3dModel(<span class="insert">&amp;sPainter, getJ2000Equatori
alPos(nav), surfArcMin2, getVMagnitude(core-&gt;getNavigator())</span>, color);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::drawSphere(<span class="delete">const </span>StelPainter* painter, float screenSz)</td><td> </td><td class="rblock">void Planet::drawSphere(StelPainter* painter, float screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_TEXTURE_2D</span>);</td><td> </td><td class="rblock">       <span class="insert">painter-&gt;enableTexture2d(true</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_BLEND);</td><td> </td><td class="right">       glDisable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_CULL_FACE);</td><td> </td><td class="right">       glEnable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (texMap)</td><td> </td><td class="right">       if (texMap)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               texMap-&gt;bind();</td><td> </td><td class="right">               texMap-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw the spheroid itself</td><td> </td><td class="right">       // Draw the spheroid itself</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Adapt the number of facets according with the size of the sphere 
for optimization</td><td> </td><td class="right">       // Adapt the number of facets according with the size of the sphere 
for optimization</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int nb_facet = (int)(screenSz * 40/50); // 40 facets for 1024 pixels
 diameter on screen</td><td> </td><td class="right">       int nb_facet = (int)(screenSz * 40/50); // 40 facets for 1024 pixels
 diameter on screen</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (nb_facet&lt;10) nb_facet = 10;</td><td> </td><td class="right">       if (nb_facet&lt;10) nb_facet = 10;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (nb_facet&gt;40) nb_facet = 40;</td><td> </td><td class="right">       if (nb_facet&gt;40) nb_facet = 40;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glShadeModel(GL_SMOOTH</span>);</td><td> </td><td class="rblock">       <span class="insert">painter-&gt;setShadeModel(StelPainter::ShadeModelSmooth</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Rotate and add an extra quarter rotation so that the planet textu
re map</td><td> </td><td class="right">       // Rotate and add an extra quarter rotation so that the planet textu
re map</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // fits to the observers position. No idea why this is necessary,</td><td> </td><td class="right">       // fits to the observers position. No idea why this is necessary,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // perhaps some openGl strangeness, or confusing sin/cos.</td><td> </td><td class="right">       // perhaps some openGl strangeness, or confusing sin/cos.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       painter-&gt;sSphere(radius*sphereScale, oneMinusOblateness, nb_facet, n
b_facet);</td><td> </td><td class="right">       painter-&gt;sSphere(radius*sphereScale, oneMinusOblateness, nb_facet, n
b_facet);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glShadeModel(GL_FLAT</span>);</td><td> </td><td class="rblock">       <span class="insert">painter-&gt;setShadeModel(StelPainter::ShadeModelFlat</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_CULL_FACE);</td><td> </td><td class="right">       glDisable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// draws earth shadow overlapping the moon using stencil buffer</td><td> </td><td class="right">// draws earth shadow overlapping the moon using stencil buffer</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// umbra and penumbra are sized separately for accuracy</td><td> </td><td class="right">// umbra and penumbra are sized separately for accuracy</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::drawEarthShadow(StelCore* core)</td><td> </td><td class="rblock">void Planet::drawEarthShadow(StelCore* core<span class="insert">, StelPainter* sPainter</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td> </td><td class="right">       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d e = ssm-&gt;getEarth()-&gt;getEclipticPos();</td><td> </td><td class="right">       Vec3d e = ssm-&gt;getEarth()-&gt;getEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d m = ssm-&gt;getMoon()-&gt;getEclipticPos();  // relative to earth</td><td> </td><td class="right">       Vec3d m = ssm-&gt;getMoon()-&gt;getEclipticPos();  // relative to earth</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d mh = ssm-&gt;getMoon()-&gt;getHeliocentricEclipticPos();  // relativ
e to sun</td><td> </td><td class="right">       Vec3d mh = ssm-&gt;getMoon()-&gt;getHeliocentricEclipticPos();  // relativ
e to sun</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float mscale = ssm-&gt;getMoon()-&gt;getSphereScale();</td><td> </td><td class="right">       float mscale = ssm-&gt;getMoon()-&gt;getSphereScale();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // shadow location at earth + moon distance along earth vector from 
sun</td><td> </td><td class="right">       // shadow location at earth + moon distance along earth vector from 
sun</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d en = e;</td><td> </td><td class="right">       Vec3d en = e;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       en.normalize();</td><td> </td><td class="right">       en.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 745</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 779</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // find vector orthogonal to sun-earth vector using cross product wi
th</td><td> </td><td class="right">       // find vector orthogonal to sun-earth vector using cross product wi
th</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // a non-parallel vector</td><td> </td><td class="right">       // a non-parallel vector</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d rpt = shadow^Vec3d(0,0,1);</td><td> </td><td class="right">       Vec3d rpt = shadow^Vec3d(0,0,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rpt.normalize();</td><td> </td><td class="right">       rpt.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d upt = rpt*r_umbra*mscale*1.02;  // point on umbra edge</td><td> </td><td class="right">       Vec3d upt = rpt*r_umbra*mscale*1.02;  // point on umbra edge</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rpt *= r_penumbra*mscale;  // point on penumbra edge</td><td> </td><td class="right">       rpt *= r_penumbra*mscale;  // point on penumbra edge</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // modify shadow location for scaled moon</td><td> </td><td class="right">       // modify shadow location for scaled moon</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d mdist = shadow - mh;</td><td> </td><td class="right">       Vec3d mdist = shadow - mh;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if(mdist.length() &gt; r_penumbra + 2000./AU)</td><td> </td><td class="rblock">       if<span class="insert"> </span>(mdist.length() &gt; r_penumbra + 2000./AU)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;   // not visible so don't bother drawing</td><td> </td><td class="right">               return;   // not visible so don't bother drawing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       shadow = mh + mdist*mscale;</td><td> </td><td class="right">       shadow = mh + mdist*mscale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       r_penumbra *= mscale;</td><td> </td><td class="right">       r_penumbra *= mscale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const</span> StelProjectorP <span class="delete">prj</span> = <span class="delete">core-&gt;getProjection(StelCore::FrameHelioc</span></td><td> </td><td class="rblock">       StelProjectorP <span class="insert">saveProj</span> = <span class="insert">sPainter-&gt;getProjector();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">entricEcliptic);</span></td><td> </td><td class="rblock"><span class="insert">       sPainter-&gt;setProjector(core-&gt;getProjection(StelCore::FrameHeliocentr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       StelPainter sPainter(prj);</span></td><td> </td><td class="rblock"><span class="insert">icEcliptic));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_TEXTURE_2D</span>);</td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;enableTexture2d(true</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glColor3f</span>(1,1,1);</td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;setColor</span>(1,1,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_STENCIL_TEST);</td><td> </td><td class="right">       glEnable(GL_STENCIL_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // We draw only where the stencil buffer is at 1, i.e. where the moo
n was drawn</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glStencilFunc(GL_EQUAL, 0x1, 0x1);</td><td> </td><td class="right">       glStencilFunc(GL_EQUAL, 0x1, 0x1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0060" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // Don't change stencil buffer value</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glStencilOp(GL_KEEP, GL_KEEP, GL_KEEP);</td><td> </td><td class="right">       glStencilOp(GL_KEEP, GL_KEEP, GL_KEEP);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // shadow radial texture</td><td> </td><td class="right">       // shadow radial texture</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texEarthShadow-&gt;bind();</td><td> </td><td class="right">       texEarthShadow-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0061" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Vec3d <span class="delete">r, s;</span></td><td> </td><td class="rblock">       Vec3d <span class="insert">r;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       // umbra first</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glBegin(GL_TRIANGLE_FAN);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      // johannes: work-around for nasty ATI rendering bug:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">      // use y-texture coordinate of 0.5 instead of 0.0</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glTexCoord2f(0.f,0.5f);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       sPainter.drawVertex3v(shadow);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0062" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       for <span class="delete">(int i=0; i&lt;=100; i++)</span></td><td> </td><td class="rblock">       <span class="insert">// Draw umbra first</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       {</span></td><td> </td><td class="rblock"><span class="insert">       QVarLengthArray&lt;Vec2f, 210&gt; texCoordArray(210);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               r</span> = Mat4d::rotation(shadow, <span class="delete">2.*M_PI*i/100.) * upt;</span></td><td> </td><td class="rblock"><span class="insert">       QVarLengthArray&lt;Vec3d, 210&gt; vertexArray(210);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               s</span> = <span class="delete">shadow + r;</span></td><td> </td><td class="rblock"><span class="insert">       texCoordArray[0].set(0.f, 0.5);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">       // johannes: work-around</span> for <span class="insert">nasty ATI rendering bug: use y-texture </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glTexCoord2f(0.6f,0.5f);</span>  // position in texture of umbra <span class="delete">ed</span></td><td> </td><td class="rblock"><span class="insert">coordinate of 0.5 instead of 0.0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ge</span></td><td> </td><td class="rblock"><span class="insert">       vertexArray[0]=shadow;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               sPainter.drawVertex3v(s);</span></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const Mat4d&amp; rotMat</span> = Mat4d::rotation(shadow, <span class="insert">2.*M_PI/100.);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       r</span> = <span class="insert">upt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       for (int i=1; i&lt;=101; ++i)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               // position in texture of umbra <span class="insert">edge</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               texCoordArray[i].set(0.6, 0.5);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               r.transfo4d(rotMat);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               vertexArray[i] = shadow + r;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0063" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnd();</span></td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;setArrays(vertexArray.constData(), texCoordArray.constData</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter-&gt;drawFromArray(StelPainter::TriangleFan, 102);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // now penumbra</td><td> </td><td class="right">       // now penumbra</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0064" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Vec3d <span class="delete">u, sp;</span></td><td> </td><td class="rblock">       Vec3d <span class="insert">u;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glBegin(GL_TRIANGLE_STRIP);</span></td><td> </td><td class="rblock">       r = rpt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       for (int i=0; i&lt;=100; i++)</span></td><td> </td><td class="rblock">       u = upt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       {</span></td><td> </td><td class="rblock">       <span class="insert">for (int i=0; i&lt;=200; i+=2)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               r = <span class="delete">Mat4d::rotation(shadow, 2.*M_PI*i/100.) *</span> rpt;</td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               u = <span class="delete">Mat4d::rotation(shadow, 2.*M_PI*i/100.) *</span> upt;</td><td> </td><td class="rblock"><span class="insert">               r.transfo4d(rotMat);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">s</span> = shadow + <span class="delete">r;</span></td><td> </td><td class="rblock"><span class="insert">               u.transfo4d(rotMat);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               sp</span> = shadow + <span class="delete">u;</span></td><td> </td><td class="rblock"><span class="insert">               texCoordArray[i].set(0.6, 0.5);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">               texCoordArray[i+1].set(1., 0.5); // position in texture of u</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glTexCoord2f(0.6f,0.5f);</span></td><td> </td><td class="rblock"><span class="insert">mbra edge</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               sPainter.drawVertex3v(sp);</span></td><td> </td><td class="rblock"><span class="insert">               vertexArray[i]</span> = shadow + <span class="insert">u;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"><span class="insert">               vertexArray[i+1]</span> = shadow + <span class="insert">r;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glTexCoord2f(1.f,0.5f);  // position in texture of umbra edg</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               sPainter.drawVertex3v(s);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0065" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnd();</span></td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;setArrays(vertexArray.constData(), texCoordArray.constData</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter-&gt;drawFromArray(StelPainter::TriangleStrip, 202);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_STENCIL_TEST);</td><td> </td><td class="right">       glDisable(GL_STENCIL_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glClearStencil(0x0);</td><td> </td><td class="right">       glClearStencil(0x0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glClear(GL_STENCIL_BUFFER_BIT); // Clean again to let a clean buffer
 for later Qt display</td><td> </td><td class="right">       glClear(GL_STENCIL_BUFFER_BIT); // Clean again to let a clean buffer
 for later Qt display</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0066" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter-&gt;setProjector(saveProj);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0067" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::drawHints(const StelCore* core)</td><td> </td><td class="rblock">void Planet::drawHints(const StelCore* core<span class="insert">, const QFont&amp; planetNameFont</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (labelsFader.getInterstate()&lt;=0.f)</td><td> </td><td class="right">       if (labelsFader.getInterstate()&lt;=0.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelNavigator* nav = core-&gt;getNavigator();</td><td> </td><td class="right">       const StelNavigator* nav = core-&gt;getNavigator();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameJ2000)
;</td><td> </td><td class="right">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameJ2000)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(prj);</td><td> </td><td class="right">       StelPainter sPainter(prj);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0068" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">                                                                    </span></td><td> </td><td class="rblock">       <span class="insert">sPainter.setFont(planetNameFont);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw nameI18 + scaling if it's not == 1.</td><td> </td><td class="right">       // Draw nameI18 + scaling if it's not == 1.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float tmp = 10.f + getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRa
dAtCenter()/1.44; // Shift for nameI18 printing</td><td> </td><td class="right">       float tmp = 10.f + getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRa
dAtCenter()/1.44; // Shift for nameI18 printing</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0069" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glColor4f(labelColor[0],</span> labelColor[1], <span class="delete">labelColor[2],labelsFader.ge</span></td><td> </td><td class="rblock">       <span class="insert">sPainter.setColor(labelColor[0],</span> labelColor[1], <span class="insert">labelColor[2],labels</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">tInterstate());</span></td><td> </td><td class="rblock"><span class="insert">Fader.getInterstate());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       sPainter.drawText(planetNameFont,screenPos[0],screenPos[1], getSkyLa</span></td><td> </td><td class="rblock"><span class="insert">       sPainter.drawText(screenPos[0],screenPos[1], getSkyLabel(nav),</span> 0, <span class="insert">tm</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">bel(nav),</span> 0, <span class="delete">tmp,</span> tmp, false);</td><td> </td><td class="rblock"><span class="insert">p,</span> tmp, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // hint disapears smoothly on close view</td><td> </td><td class="right">       // hint disapears smoothly on close view</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hintFader.getInterstate()&lt;=0)</td><td> </td><td class="right">       if (hintFader.getInterstate()&lt;=0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tmp -= 10.f;</td><td> </td><td class="right">       tmp -= 10.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (tmp&lt;1) tmp=1;</td><td> </td><td class="right">       if (tmp&lt;1) tmp=1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0070" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glColor4f(labelColor[0], labelColor[1], labelColor[2],labelsFader.ge
</span>tInterstate()*hintFader.getInterstate()/tmp*0.7);</td><td> </td><td class="rblock">       <span class="insert">sPainter.setColor(labelColor[0], labelColor[1], labelColor[2],labels
Fader.ge</span>tInterstate()*hintFader.getInterstate()/tmp*0.7);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw the 2D small circle</td><td> </td><td class="right">       // Draw the 2D small circle</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0071" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_TEXTURE_2D</span>);</td><td> </td><td class="rblock">       <span class="insert">sPainter.enableTexture2d(true</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Planet::hintCircleTex-&gt;bind();</td><td> </td><td class="right">       Planet::hintCircleTex-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0072" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       sPainter.drawSprite2dMode(screenPos[0], screenPos[1], <span class="delete">22</span>);</td><td> </td><td class="rblock">       sPainter.drawSprite2dMode(screenPos[0], screenPos[1], <span class="insert">11</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Ring::Ring(double radiusMin,double radiusMax,const QString &amp;texname)</td><td> </td><td class="right">Ring::Ring(double radiusMin,double radiusMax,const QString &amp;texname)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0073" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">     :radiusMin(radiusMin),radiusMax(radiusMax)</td><td> </td><td class="rblock">     <span class="insert">   </span>:radiusMin(radiusMin),radiusMax(radiusMax)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tex = StelApp::getInstance().getTextureManager().createTexture(texna
me);</td><td> </td><td class="right">       tex = StelApp::getInstance().getTextureManager().createTexture(texna
me);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Ring::~Ring(void)</td><td> </td><td class="right">Ring::~Ring(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0074" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Ring::draw(<span class="delete">const StelPainter* painter,const Mat4d&amp; mat,double screenSz
</span>)</td><td> </td><td class="rblock">void Ring::draw(<span class="insert">StelPainter* sPainter,const Mat4d&amp; mat,double screenSz</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       screenSz -= 50;</td><td> </td><td class="right">       screenSz -= 50;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       screenSz /= 250.0;</td><td> </td><td class="right">       screenSz /= 250.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (screenSz &lt; 0.0) screenSz = 0.0;</td><td> </td><td class="right">       if (screenSz &lt; 0.0) screenSz = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (screenSz &gt; 1.0) screenSz = 1.0;</td><td> </td><td class="right">       else if (screenSz &gt; 1.0) screenSz = 1.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int slices = 128+(int)((256-128)*screenSz);</td><td> </td><td class="right">       const int slices = 128+(int)((256-128)*screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int stacks = 8+(int)((32-8)*screenSz);</td><td> </td><td class="right">       const int stacks = 8+(int)((32-8)*screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Normal transparency mode</td><td> </td><td class="right">       // Normal transparency mode</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0075" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glColor3f(1.f,</span> 1.f, 1.f);</td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;setColor(1.f,</span> 1.f, 1.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glEnable(GL_TEXTURE_2D);</span></td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;enableTexture2d(true);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_CULL_FACE);</td><td> </td><td class="right">       glEnable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (tex) tex-&gt;bind();</td><td> </td><td class="right">       if (tex) tex-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         // solve the ring wraparound by culling:</td><td> </td><td class="right">         // solve the ring wraparound by culling:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         // decide if we are above or below the ring plane</td><td> </td><td class="right">         // decide if we are above or below the ring plane</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double h = mat.r[ 8]*mat.r[12]</td><td> </td><td class="right">       const double h = mat.r[ 8]*mat.r[12]</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0076" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                      + mat.r[ 9]*mat.r[13]</td><td> </td><td class="rblock">                                  + mat.r[ 9]*mat.r[13]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                      + mat.r[10]*mat.r[14];</td><td> </td><td class="rblock">                                  + mat.r[10]*mat.r[14];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">painter-&gt;sRing(radiusMin,radiusMax,(h&lt;0.0)?slices:-slices,stacks, 0)</span></td><td> </td><td class="rblock">       <span class="insert">sPainter-&gt;sRing(radiusMin,radiusMax,(h&lt;0.0)?slices:-slices,stacks, 0</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span></td><td> </td><td class="rblock"><span class="insert">);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_CULL_FACE);</td><td> </td><td class="right">       glDisable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// draw orbital path of Planet</td><td> </td><td class="right">// draw orbital path of Planet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::drawOrbit(const StelCore* core)</td><td> </td><td class="right">void Planet::drawOrbit(const StelCore* core)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!orbitFader.getInterstate())</td><td> </td><td class="right">       if (!orbitFader.getInterstate())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!re.siderealPeriod)</td><td> </td><td class="right">       if (!re.siderealPeriod)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameHelioc
entricEcliptic);</td><td> </td><td class="right">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameHelioc
entricEcliptic);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(prj);</td><td> </td><td class="right">       StelPainter sPainter(prj);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Normal transparency mode</td><td> </td><td class="right">       // Normal transparency mode</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0077" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glColor4f(orbitColor[0],</span> orbitColor[1], orbitColor[2], <span class="delete">orbitFader.ge</span></td><td> </td><td class="rblock">       <span class="insert">sPainter.setColor(orbitColor[0],</span> orbitColor[1], orbitColor[2], <span class="insert">orbit</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">tInterstate());</span></td><td> </td><td class="rblock"><span class="insert">Fader.getInterstate());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       int on=0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       int d;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d onscreen;</td><td> </td><td class="right">       Vec3d onscreen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0078" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">for(</span> int n=0; <span class="delete">n&lt;=ORBIT_SEGMENTS; n++)</span></td><td> </td><td class="rblock">       <span class="insert">// special case - use current Planet position as center vertex so th</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">at draws</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // on it's orbit all the time (since segmented rather than smooth cu</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">rve)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Vec3d savePos = orbit[ORBIT_SEGMENTS/2];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       orbit[ORBIT_SEGMENTS/2]=getHeliocentricEclipticPos();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       orbit[ORBIT_SEGMENTS]=orbit[0];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       int <span class="insert">nbIter = closeOrbit ? ORBIT_SEGMENTS : ORBIT_SEGMENTS-1;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       QVarLengthArray&lt;float, 1024&gt; vertexArray;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter.enableClientStates(true, false, false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       for (int</span> n=0; <span class="insert">n&lt;=nbIter; ++n)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0079" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">if( n==ORBIT_SEGMENTS )</span></td><td> </td><td class="rblock">               if <span class="insert">(prj-&gt;project(orbit[n],onscreen))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       d = 0;  // connect loop</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if <span class="delete">(!closeOrbit) break;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               else</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0080" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">d = n;</span></td><td> </td><td class="rblock">                       <span class="insert">vertexArray.append(onscreen[0]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       vertexArray.append(onscreen[1]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0081" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               <span class="insert">else if (!vertexArray.isEmpty())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">// special case - use current Planet position as center vert</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ex so that draws</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               // on it's orbit all the time (since segmented rather than s</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">mooth curve)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               if( n == ORBIT_SEGMENTS/2 )</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0082" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">if(prj-&gt;project(getHeliocentricEclipticPos(), onscre</span></td><td> </td><td class="rblock">                       <span class="insert">sPainter.setVertexPointer(2, GL_FLOAT, vertexArray.c</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">en))</span></td><td> </td><td class="rblock"><span class="insert">onstData());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock"><span class="insert">                       sPainter.drawFromArray(StelPainter::LineStrip, verte</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               if(!on) glBegin(GL_LINE_STRIP);</span></td><td> </td><td class="rblock"><span class="insert">xArray.size()/2, 0, false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glVertex3d(onscreen[0], onscreen[1], 0);</span></td><td> </td><td class="rblock"><span class="insert">                       vertexArray.clear();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               on=1;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       else if( on )</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glEnd();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               on=0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               else</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       if(prj-&gt;project(orbit[d],onscreen))</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               if(!on) glBegin(GL_LINE_STRIP);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glVertex3d(onscreen[0], onscreen[1], 0);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               on=1;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       else if( on )</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glEnd();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               on=0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0083" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       <span class="insert">orbit[ORBIT_SEGMENTS/2]=savePos;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if <span class="delete">(on)</span></td><td> </td><td class="rblock">       if <span class="insert">(!vertexArray.isEmpty())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glEnd();</span></td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               sPainter.setVertexPointer(2, GL_FLOAT, vertexArray.constData</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               sPainter.drawFromArray(StelPainter::LineStrip, vertexArray.s</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ize()/2, 0, false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter.enableClientStates(false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// draw trail of Planet as seen from earth</td><td> </td><td class="right">// draw trail of Planet as seen from earth</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::drawTrail(const StelCore* core)</td><td> </td><td class="right">void Planet::drawTrail(const StelCore* core)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!trailFader.getInterstate())</td><td> </td><td class="right">       if (!trailFader.getInterstate())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelNavigator* nav = core-&gt;getNavigator();</td><td> </td><td class="right">       const StelNavigator* nav = core-&gt;getNavigator();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameJ2000)
;</td><td> </td><td class="right">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameJ2000)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d onscreen1;</td><td> </td><td class="right">       Vec3d onscreen1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d onscreen2;</td><td> </td><td class="right">       Vec3d onscreen2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(prj);</td><td> </td><td class="right">       StelPainter sPainter(prj);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0084" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">glColor3fv(trailColor*trailFader.getInterstate()</span>);</td><td> </td><td class="rblock">       <span class="insert">sPainter.setColor(trailColor[0]*trailFader.getInterstate(), trailCol
or[1]*trailFader.getInterstate(), trailColor[2]*trailFader.getInterstate(),
 1.</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       std::list&lt;TrailPoint&gt;::iterator iter;</td><td> </td><td class="right">       std::list&lt;TrailPoint&gt;::iterator iter;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       std::list&lt;TrailPoint&gt;::iterator nextiter;</td><td> </td><td class="right">       std::list&lt;TrailPoint&gt;::iterator nextiter;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       std::list&lt;TrailPoint&gt;::iterator begin = trail.begin();</td><td> </td><td class="right">       std::list&lt;TrailPoint&gt;::iterator begin = trail.begin();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //  begin++;</td><td> </td><td class="right">       //  begin++;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0085" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if(trail.begin() != trail.end())</td><td> </td><td class="rblock">       if<span class="insert"> </span>(trail.begin() != trail.end())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               nextiter = trail.end();</td><td> </td><td class="right">               nextiter = trail.end();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               nextiter--;</td><td> </td><td class="right">               nextiter--;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0086" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               for<span class="delete">( iter=nextiter; iter != begin; iter--</span>)</td><td> </td><td class="rblock">               for<span class="insert"> (iter=nextiter; iter != begin; --iter</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       nextiter--;</td><td> </td><td class="right">                       nextiter--;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0087" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">if( prj-&gt;projectLineCheck(</span> (*iter).point, onscreen1,</td><td> </td><td class="rblock">                       <span class="insert">if (prj-&gt;projectLineCheck(</span> (*iter).point, onscreen1,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> (*(nextiter)).point, <span class="delete">onscreen2) )</span></td><td> </td><td class="rblock"> (*(nextiter)).point, <span class="insert">onscreen2))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       {</span></td><td> </td><td class="rblock"><span class="insert">                               sPainter.drawLine2d(onscreen1[0], onscreen1[</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glBegin(GL_LINE_STRIP);</span></td><td> </td><td class="rblock"><span class="insert">1], onscreen2[0],</span> onscreen2[1]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glVertex2d(onscreen1[0], onscreen1[1]);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               glVertex2d(onscreen2[0],</span> onscreen2[1]);</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">glEnd();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // draw final segment to finish at current Planet position</td><td> </td><td class="right">       // draw final segment to finish at current Planet position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0088" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">if( !firstPoint</span> &amp;&amp; prj-&gt;projectLineCheck( (*trail.begin()).point, on</td><td> </td><td class="rblock">       <span class="insert">if (!firstPoint</span> &amp;&amp; prj-&gt;projectLineCheck( (*trail.begin()).point, on</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">screen1, getEquinoxEquatorialPos(nav), <span class="delete">onscreen2) )</span></td><td> </td><td class="rblock">screen1, getEquinoxEquatorialPos(nav), <span class="insert">onscreen2))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       {</span></td><td> </td><td class="rblock"><span class="insert">               sPainter.drawLine2d(onscreen1[0], onscreen1[1], onscreen2[0]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glBegin(GL_LINE_STRIP);</span></td><td> </td><td class="rblock"><span class="insert">,</span> onscreen2[1]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glVertex2d(onscreen1[0], onscreen1[1]);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glVertex2d(onscreen2[0],</span> onscreen2[1]);</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">glEnd();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// update trail points as needed</td><td> </td><td class="right">// update trail points as needed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::updateTrail(const StelNavigator* nav)</td><td> </td><td class="right">void Planet::updateTrail(const StelNavigator* nav)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!trailOn)</td><td> </td><td class="right">       if (!trailOn)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double date = nav-&gt;getJDay();</td><td> </td><td class="right">       double date = nav-&gt;getJDay();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 88 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>246 lines changed or deleted</i></th><th><i> </i></th><th><i>270 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
