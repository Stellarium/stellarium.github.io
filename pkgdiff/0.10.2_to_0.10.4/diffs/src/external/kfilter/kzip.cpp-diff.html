<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: kzip.cpp - kzip.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;kzip.cpp&nbsp;</th><th> </th><th>&nbsp;kzip.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 22</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 22</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Library General Public License for more details.</td><td> </td><td class="right">   Library General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   You should have received a copy of the GNU Library General Public Licens
e</td><td> </td><td class="right">   You should have received a copy of the GNU Library General Public Licens
e</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   along with this library; see the file COPYING.LIB.  If not, write to</td><td> </td><td class="right">   along with this library; see the file COPYING.LIB.  If not, write to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,</td><td> </td><td class="right">   the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   Boston, MA 02110-1301, USA.</td><td> </td><td class="right">   Boston, MA 02110-1301, USA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">*/</td><td> </td><td class="right">*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/*</td><td> </td><td class="right">/*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       This class implements a kioslave to access ZIP files from KDE.</td><td> </td><td class="right">       This class implements a kioslave to access ZIP files from KDE.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    you can use it in QIODevice::ReadOnly or in QIODevice::WriteOnly <span class="delete">mode,</span> </td><td> </td><td class="rblock">       you can use it in QIODevice::ReadOnly or in QIODevice::WriteOnly <span class="insert">mod</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">and it</td><td> </td><td class="rblock"><span class="insert">e,</span> and it</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    behaves just as expected (i hope ;-) ).</td><td> </td><td class="rblock">       behaves just as expected (i hope ;-) ).</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    It can also be used in QIODevice::ReadWrite mode, in this case one <span class="delete">can</span></td><td> </td><td class="rblock">       It can also be used in QIODevice::ReadWrite mode, in this case one <span class="insert">c</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    append files to an existing zip archive. when you append new files, <span class="delete">whi</span></td><td> </td><td class="rblock"><span class="insert">an</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ch</span></td><td> </td><td class="rblock">       append files to an existing zip archive. when you append new files, </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    are not yet in the zip, it works as expected, they are appended at <span class="delete">the</span> </td><td> </td><td class="rblock"><span class="insert">which</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">end.</td><td> </td><td class="rblock">       are not yet in the zip, it works as expected, they are appended at <span class="insert">t</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    when you append a file, which is already in the file, the reference to </td><td> </td><td class="rblock"><span class="insert">he</span> end.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">the</td><td> </td><td class="rblock">       when you append a file, which is already in the file, the reference </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    old file is dropped and the new one is added to the zip. but the</td><td> </td><td class="rblock">to the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    old data from the file itself is not deleted, it is still in the</td><td> </td><td class="rblock">       old file is dropped and the new one is added to the zip. but the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    zipfile. so when you want to have a small and garbagefree zipfile,</td><td> </td><td class="rblock">       old data from the file itself is not deleted, it is still in the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    just read the contents of the appended zipfile and write it to a new <span class="delete">on</span></td><td> </td><td class="rblock">       zipfile. so when you want to have a small and garbagefree zipfile,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e</span></td><td> </td><td class="rblock">       just read the contents of the appended zipfile and write it to a new</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    in QIODevice::WriteOnly mode. especially take care of this, when you <span class="delete">do</span></td><td> </td><td class="rblock"> <span class="insert">one</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">n't</span> want</td><td> </td><td class="rblock">       in QIODevice::WriteOnly mode. especially take care of this, when you</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    to leak information of how intermediate versions of files in the zip</td><td> </td><td class="rblock"> <span class="insert">don't</span> want</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    were looking.</td><td> </td><td class="rblock">       to leak information of how intermediate versions of files in the zip</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    For more information on the zip fileformat go to</td><td> </td><td class="rblock">       were looking.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    http://www.pkware.com/support/appnote.html .</td><td> </td><td class="rblock">       For more information on the zip fileformat go to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       http://www.pkware.com/support/appnote.html .</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">*/</td><td> </td><td class="right">*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "kzip.h"</td><td> </td><td class="right">#include "kzip.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "kfilterdev.h"</td><td> </td><td class="right">#include "kfilterdev.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "klimitediodevice.h"</td><td> </td><td class="right">#include "klimitediodevice.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtCore/QHash&gt;</td><td> </td><td class="right">#include &lt;QtCore/QHash&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtCore/QByteArray&gt;</td><td> </td><td class="right">#include &lt;QtCore/QByteArray&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtCore/QFile&gt;</td><td> </td><td class="right">#include &lt;QtCore/QFile&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtCore/QDir&gt;</td><td> </td><td class="right">#include &lt;QtCore/QDir&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtCore/QDate&gt;</td><td> </td><td class="right">#include &lt;QtCore/QDate&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtCore/QList&gt;</td><td> </td><td class="right">#include &lt;QtCore/QList&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;zlib.h&gt;</td><td> </td><td class="right">#include &lt;zlib.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;time.h&gt;</td><td> </td><td class="right">#include &lt;time.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;string.h&gt;</td><td> </td><td class="right">#include &lt;string.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;sys/stat.h&gt;</td><td> </td><td class="right">#include &lt;sys/stat.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#ifdef <span class="delete">WIN32</span></td><td> </td><td class="rblock">#ifdef <span class="insert">Q_OS_WIN</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "kdewin32/sys/stat.h"</td><td> </td><td class="right">#include "kdewin32/sys/stat.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">const int max_path_len = 4095; // maximum number of character a path may co
ntain</td><td> </td><td class="right">const int max_path_len = 4095; // maximum number of character a path may co
ntain</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static void transformToMsDos(const QDateTime&amp; dt, char* buffer)</td><td> </td><td class="right">static void transformToMsDos(const QDateTime&amp; dt, char* buffer)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( dt.isValid() )</td><td> </td><td class="rblock">       if ( dt.isValid() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        const quint16 time =</td><td> </td><td class="rblock">               const quint16 time =</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">             ( dt.time().hour() &lt;&lt; 11 )    // 5 bit hour</td><td> </td><td class="rblock">                        ( dt.time().hour() &lt;&lt; 11 )    // 5 bit hour</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           | ( dt.time().minute() &lt;&lt; 5 )   // 6 bit minute</td><td> </td><td class="rblock">                  | ( dt.time().minute() &lt;&lt; 5 )   // 6 bit minute</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           | ( dt.time().second() &gt;&gt; 1 );  // 5 bit double seconds</td><td> </td><td class="rblock">                  | ( dt.time().second() &gt;&gt; 1 );  // 5 bit double seconds</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[0] = char(time);</td><td> </td><td class="rblock">               buffer[0] = char(time);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[1] = char(time &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[1] = char(time &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        const quint16 date =</td><td> </td><td class="rblock">               const quint16 date =</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">             ( ( dt.date().year() - 1980 ) &lt;&lt; 9 ) // 7 bit year 1980-based</td><td> </td><td class="rblock">                        ( ( dt.date().year() - 1980 ) &lt;&lt; 9 ) // 7 bit year </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           | ( dt.date().month() &lt;&lt; 5 )           // 4 bit month</td><td> </td><td class="rblock">1980-based</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           | ( dt.date().day() );                 // 5 bit day</td><td> </td><td class="rblock">                  | ( dt.date().month() &lt;&lt; 5 )           // 4 bit month</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                  | ( dt.date().day() );                 // 5 bit day</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[2] = char(date);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[3] = char(date &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[2] = char(date);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               buffer[3] = char(date &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    else // !dt.isValid(), assume 1980-01-01 midnight</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       else // !dt.isValid(), assume 1980-01-01 midnight</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[0] = 0;</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[1] = 0;</td><td> </td><td class="rblock">               buffer[0] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[2] = 33;</td><td> </td><td class="rblock">               buffer[1] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[3] = 0;</td><td> </td><td class="rblock">               buffer[2] = 33;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               buffer[3] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static time_t transformFromMsDos(const char* buffer)</td><td> </td><td class="right">static time_t transformFromMsDos(const char* buffer)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    quint16 time = (uchar)buffer[0] | ( (uchar)buffer[1] &lt;&lt; 8 );</td><td> </td><td class="rblock">       quint16 time = (uchar)buffer[0] | ( (uchar)buffer[1] &lt;&lt; 8 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int h = time &gt;&gt; 11;</td><td> </td><td class="rblock">       int h = time &gt;&gt; 11;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int m = ( time &amp; 0x7ff ) &gt;&gt; 5;</td><td> </td><td class="rblock">       int m = ( time &amp; 0x7ff ) &gt;&gt; 5;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int s = ( time &amp; 0x1f ) * 2 ;</td><td> </td><td class="rblock">       int s = ( time &amp; 0x1f ) * 2 ;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QTime qt(h, m, s);</td><td> </td><td class="rblock">       QTime qt(h, m, s);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    quint16 date = (uchar)buffer[2] | ( (uchar)buffer[3] &lt;&lt; 8 );</td><td> </td><td class="rblock">       quint16 date = (uchar)buffer[2] | ( (uchar)buffer[3] &lt;&lt; 8 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int y = ( date &gt;&gt; 9 ) + 1980;</td><td> </td><td class="rblock">       int y = ( date &gt;&gt; 9 ) + 1980;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int o = ( date &amp; 0x1ff ) &gt;&gt; 5;</td><td> </td><td class="rblock">       int o = ( date &amp; 0x1ff ) &gt;&gt; 5;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int d = ( date &amp; 0x1f );</td><td> </td><td class="rblock">       int d = ( date &amp; 0x1f );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QDate qd(y, o, d);</td><td> </td><td class="rblock">       QDate qd(y, o, d);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QDateTime dt( qd, qt );</td><td> </td><td class="rblock">       QDateTime dt( qd, qt );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return dt.toTime_t();</td><td> </td><td class="rblock">       return dt.toTime_t();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// == parsing routines for zip headers</td><td> </td><td class="right">// == parsing routines for zip headers</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** all relevant information about parsing file information */</td><td> </td><td class="right">/** all relevant information about parsing file information */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">struct ParseFileInfo {</td><td> </td><td class="right">struct ParseFileInfo {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // file related info</td><td> </td><td class="right">  // file related info</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  mode_t perm;                 // permissions of this file</td><td> </td><td class="right">  mode_t perm;                 // permissions of this file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  time_t atime;                        // last access time (UNIX format)</td><td> </td><td class="right">  time_t atime;                        // last access time (UNIX format)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  time_t mtime;                        // modification time (UNIX format)</td><td> </td><td class="right">  time_t mtime;                        // modification time (UNIX format)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  time_t ctime;                        // creation time (UNIX format)</td><td> </td><td class="right">  time_t ctime;                        // creation time (UNIX format)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int uid;                     // user id (-1 if not specified)</td><td> </td><td class="right">  int uid;                     // user id (-1 if not specified)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int gid;                     // group id (-1 if not specified)</td><td> </td><td class="right">  int gid;                     // group id (-1 if not specified)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  QByteArray guessed_symlink;  // guessed symlink target</td><td> </td><td class="right">  QByteArray guessed_symlink;  // guessed symlink target</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int extralen;                        // length of extra field</td><td> </td><td class="right">  int extralen;                        // length of extra field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // parsing related info</td><td> </td><td class="right">  // parsing related info</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  bool exttimestamp_seen;      // true if extended timestamp extra field</td><td> </td><td class="right">  bool exttimestamp_seen;      // true if extended timestamp extra field</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               // has been parsed</td><td> </td><td class="rblock">                               // has been parsed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  bool newinfounix_seen;       // true if Info-ZIP Unix New extra field has</td><td> </td><td class="right">  bool newinfounix_seen;       // true if Info-ZIP Unix New extra field has</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               // been parsed</td><td> </td><td class="rblock">                               // been parsed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  ParseFileInfo() : perm(0100644), uid(-1), gid(-1), extralen(0),</td><td> </td><td class="right">  ParseFileInfo() : perm(0100644), uid(-1), gid(-1), extralen(0),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       exttimestamp_seen(false), newinfounix_seen(false) {</td><td> </td><td class="rblock">       exttimestamp_seen(false), newinfounix_seen(false) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    ctime = mtime = atime = time(0);</td><td> </td><td class="rblock">       ctime = mtime = atime = time(0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** updates the parse information with the given extended timestamp extra f
ield.</td><td> </td><td class="right">/** updates the parse information with the given extended timestamp extra f
ield.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param buffer start content of buffer known to contain an extended</td><td> </td><td class="right">  * @param buffer start content of buffer known to contain an extended</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  *    timestamp extra field (without magic &amp; size)</td><td> </td><td class="right">  *    timestamp extra field (without magic &amp; size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param size size of field content (must not count magic and size entrie
s)</td><td> </td><td class="right">  * @param size size of field content (must not count magic and size entrie
s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param islocal true if this is a local field, false if central</td><td> </td><td class="right">  * @param islocal true if this is a local field, false if central</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param pfi ParseFileInfo object to be updated</td><td> </td><td class="right">  * @param pfi ParseFileInfo object to be updated</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @return true if processing was successful</td><td> </td><td class="right">  * @return true if processing was successful</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  */</td><td> </td><td class="right">  */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static bool parseExtTimestamp(const char *buffer, int size, bool islocal,</td><td> </td><td class="right">static bool parseExtTimestamp(const char *buffer, int size, bool islocal,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ParseFileInfo &amp;pfi) {</td><td> </td><td class="right">                       ParseFileInfo &amp;pfi) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (size &lt; 1) {</td><td> </td><td class="right">  if (size &lt; 1) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qDebug() &lt;&lt; "premature end of extended timestamp (#1)";</td><td> </td><td class="rblock">       qDebug() &lt;&lt; "premature end of extended timestamp (#1)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return false;</td><td> </td><td class="rblock">       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  int flags = *buffer;         // read flags</td><td> </td><td class="right">  int flags = *buffer;         // read flags</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer += 1;</td><td> </td><td class="right">  buffer += 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  size -= 1;</td><td> </td><td class="right">  size -= 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (flags &amp; 1) {             // contains modification time</td><td> </td><td class="right">  if (flags &amp; 1) {             // contains modification time</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (size &lt; 4) {</td><td> </td><td class="rblock">       if (size &lt; 4) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      qDebug() &lt;&lt; "premature end of extended timestamp (#2)";</td><td> </td><td class="rblock">         qDebug() &lt;&lt; "premature end of extended timestamp (#2)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      return false;</td><td> </td><td class="rblock">         return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }/*end if*/</td><td> </td><td class="rblock">       }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.mtime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td> </td><td class="rblock">       pfi.mtime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] &lt;&lt; 24);</td><td> </td><td class="rblock">                               | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 4;</td><td> </td><td class="rblock">&lt;&lt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    size -= 4;</td><td> </td><td class="rblock">       buffer += 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       size -= 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // central extended field cannot contain more than the modification time</td><td> </td><td class="right">  // central extended field cannot contain more than the modification time</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // even if other flags are set</td><td> </td><td class="right">  // even if other flags are set</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (!islocal) {</td><td> </td><td class="right">  if (!islocal) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.exttimestamp_seen = true;</td><td> </td><td class="rblock">       pfi.exttimestamp_seen = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return true;</td><td> </td><td class="rblock">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (flags &amp; 2) {             // contains last access time</td><td> </td><td class="right">  if (flags &amp; 2) {             // contains last access time</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (size &lt; 4) {</td><td> </td><td class="rblock">       if (size &lt; 4) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      qDebug() &lt;&lt; "premature end of extended timestamp (#3)";</td><td> </td><td class="rblock">         qDebug() &lt;&lt; "premature end of extended timestamp (#3)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      return true;</td><td> </td><td class="rblock">         return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }/*end if*/</td><td> </td><td class="rblock">       }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.atime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td> </td><td class="rblock">       pfi.atime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] &lt;&lt; 24);</td><td> </td><td class="rblock">                               | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 4;</td><td> </td><td class="rblock">&lt;&lt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    size -= 4;</td><td> </td><td class="rblock">       buffer += 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       size -= 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (flags &amp; 4) {             // contains creation time</td><td> </td><td class="right">  if (flags &amp; 4) {             // contains creation time</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (size &lt; 4) {</td><td> </td><td class="rblock">       if (size &lt; 4) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      qDebug() &lt;&lt; "premature end of extended timestamp (#4)";</td><td> </td><td class="rblock">         qDebug() &lt;&lt; "premature end of extended timestamp (#4)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      return true;</td><td> </td><td class="rblock">         return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }/*end if*/</td><td> </td><td class="rblock">       }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.ctime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td> </td><td class="rblock">       pfi.ctime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] &lt;&lt; 24);</td><td> </td><td class="rblock">                               | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 4;</td><td> </td><td class="rblock">&lt;&lt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       buffer += 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  pfi.exttimestamp_seen = true;</td><td> </td><td class="right">  pfi.exttimestamp_seen = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return true;</td><td> </td><td class="right">  return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** updates the parse information with the given Info-ZIP Unix old extra fi
eld.</td><td> </td><td class="right">/** updates the parse information with the given Info-ZIP Unix old extra fi
eld.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param buffer start of content of buffer known to contain an Info-ZIP</td><td> </td><td class="right">  * @param buffer start of content of buffer known to contain an Info-ZIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  *    Unix old extra field (without magic &amp; size)</td><td> </td><td class="right">  *    Unix old extra field (without magic &amp; size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param size size of field content (must not count magic and size entrie
s)</td><td> </td><td class="right">  * @param size size of field content (must not count magic and size entrie
s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param islocal true if this is a local field, false if central</td><td> </td><td class="right">  * @param islocal true if this is a local field, false if central</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param pfi ParseFileInfo object to be updated</td><td> </td><td class="right">  * @param pfi ParseFileInfo object to be updated</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @return true if processing was successful</td><td> </td><td class="right">  * @return true if processing was successful</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  */</td><td> </td><td class="right">  */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static bool parseInfoZipUnixOld(const char *buffer, int size, bool islocal,</td><td> </td><td class="right">static bool parseInfoZipUnixOld(const char *buffer, int size, bool islocal,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ParseFileInfo &amp;pfi) {</td><td> </td><td class="right">                       ParseFileInfo &amp;pfi) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // spec mandates to omit this field if one of the newer fields are availa
ble</td><td> </td><td class="right">  // spec mandates to omit this field if one of the newer fields are availa
ble</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (pfi.exttimestamp_seen || pfi.newinfounix_seen) return true;</td><td> </td><td class="right">  if (pfi.exttimestamp_seen || pfi.newinfounix_seen) return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (size &lt; 8) {</td><td> </td><td class="right">  if (size &lt; 8) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qDebug() &lt;&lt; "premature end of Info-ZIP unix extra field old";</td><td> </td><td class="rblock">       qDebug() &lt;&lt; "premature end of Info-ZIP unix extra field old";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return false;</td><td> </td><td class="rblock">       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  pfi.atime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td> </td><td class="right">  pfi.atime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">| (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] </span>&lt;&lt; 24);</td><td> </td><td class="rblock">                       <span class="insert">        | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] 
</span>&lt;&lt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer += 4;</td><td> </td><td class="right">  buffer += 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  pfi.mtime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td> </td><td class="right">  pfi.mtime = time_t((uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">| (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] </span>&lt;&lt; 24);</td><td> </td><td class="rblock">                       <span class="insert">        | (uchar)buffer[2] &lt;&lt; 16 | (uchar)buffer[3] 
</span>&lt;&lt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer += 4;</td><td> </td><td class="right">  buffer += 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (islocal &amp;&amp; size &gt;= 12) {</td><td> </td><td class="right">  if (islocal &amp;&amp; size &gt;= 12) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.uid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td> </td><td class="rblock">       pfi.uid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 2;</td><td> </td><td class="rblock">       buffer += 2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.gid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td> </td><td class="rblock">       pfi.gid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 2;</td><td> </td><td class="rblock">       buffer += 2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return true;</td><td> </td><td class="right">  return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#if 0 // not needed yet</td><td> </td><td class="right">#if 0 // not needed yet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/** updates the parse information with the given Info-ZIP Unix new extra fi
eld.</td><td> </td><td class="right">/** updates the parse information with the given Info-ZIP Unix new extra fi
eld.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param buffer start of content of buffer known to contain an Info-ZIP</td><td> </td><td class="right">  * @param buffer start of content of buffer known to contain an Info-ZIP</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  *            Unix new extra field (without magic &amp; size)</td><td> </td><td class="right">  *            Unix new extra field (without magic &amp; size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param size size of field content (must not count magic and size entrie
s)</td><td> </td><td class="right">  * @param size size of field content (must not count magic and size entrie
s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param islocal true if this is a local field, false if central</td><td> </td><td class="right">  * @param islocal true if this is a local field, false if central</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @param pfi ParseFileInfo object to be updated</td><td> </td><td class="right">  * @param pfi ParseFileInfo object to be updated</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  * @return true if processing was successful</td><td> </td><td class="right">  * @return true if processing was successful</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  */</td><td> </td><td class="right">  */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static bool parseInfoZipUnixNew(const char *buffer, int size, bool islocal,</td><td> </td><td class="right">static bool parseInfoZipUnixNew(const char *buffer, int size, bool islocal,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ParseFileInfo &amp;pfi) {</td><td> </td><td class="right">                       ParseFileInfo &amp;pfi) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (!islocal) {      // contains nothing in central field</td><td> </td><td class="right">  if (!islocal) {      // contains nothing in central field</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    pfi.newinfounix = true;</td><td> </td><td class="rblock">       pfi.newinfounix = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return true;</td><td> </td><td class="rblock">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (size &lt; 4) {</td><td> </td><td class="right">  if (size &lt; 4) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qDebug() &lt;&lt; "premature end of Info-ZIP unix extra field new";</td><td> </td><td class="rblock">       qDebug() &lt;&lt; "premature end of Info-ZIP unix extra field new";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return false;</td><td> </td><td class="rblock">       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*end if*/</td><td> </td><td class="right">  }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  pfi.uid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td> </td><td class="right">  pfi.uid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer += 2;</td><td> </td><td class="right">  buffer += 2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  pfi.gid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td> </td><td class="right">  pfi.gid = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  buffer += 2;</td><td> </td><td class="right">  buffer += 2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  pfi.newinfounix = true;</td><td> </td><td class="right">  pfi.newinfounix = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return true;</td><td> </td><td class="right">  return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 275</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 275</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @param pfi ParseFileInfo object which to write the results into</td><td> </td><td class="right"> * @param pfi ParseFileInfo object which to write the results into</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * @return true if parsing was successful</td><td> </td><td class="right"> * @return true if parsing was successful</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static bool parseExtraField(const char *buffer, int size, bool islocal,</td><td> </td><td class="right">static bool parseExtraField(const char *buffer, int size, bool islocal,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ParseFileInfo &amp;pfi) {</td><td> </td><td class="right">                       ParseFileInfo &amp;pfi) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // extra field in central directory doesn't contain useful data, so we</td><td> </td><td class="right">  // extra field in central directory doesn't contain useful data, so we</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // don't bother parsing it</td><td> </td><td class="right">  // don't bother parsing it</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (!islocal) return true;</td><td> </td><td class="right">  if (!islocal) return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  while (size &gt;= 4) {  // as long as a potential extra field can be read</td><td> </td><td class="right">  while (size &gt;= 4) {  // as long as a potential extra field can be read</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int magic = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td> </td><td class="rblock">       int magic = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 2;</td><td> </td><td class="rblock">       buffer += 2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int fieldsize = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td> </td><td class="rblock">       int fieldsize = (uchar)buffer[0] | (uchar)buffer[1] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += 2;</td><td> </td><td class="rblock">       buffer += 2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    size -= 4;</td><td> </td><td class="rblock">       size -= 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (fieldsize &gt; size) {</td><td> </td><td class="rblock">       if (fieldsize &gt; size) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      //qDebug() &lt;&lt; "fieldsize: " &lt;&lt; fieldsize &lt;&lt; " size: " &lt;&lt; size;</td><td> </td><td class="rblock">         //qDebug() &lt;&lt; "fieldsize: " &lt;&lt; fieldsize &lt;&lt; " size: " &lt;&lt; size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      qDebug() &lt;&lt; "premature end of extra fields reached";</td><td> </td><td class="rblock">         qDebug() &lt;&lt; "premature end of extra fields reached";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      break;</td><td> </td><td class="rblock">         break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }/*end if*/</td><td> </td><td class="rblock">       }/*end if*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    switch (magic) {</td><td> </td><td class="rblock">       switch (magic) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      case 0x5455:             // extended timestamp</td><td> </td><td class="rblock">         case 0x5455:          // extended timestamp</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (!parseExtTimestamp(buffer, fieldsize, islocal, pfi)) <span class="delete">return fal</span></td><td> </td><td class="rblock">               if (!parseExtTimestamp(buffer, fieldsize, islocal, pfi)) <span class="insert">ret</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">se;</span></td><td> </td><td class="rblock"><span class="insert">urn false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       break;</td><td> </td><td class="right">       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      case 0x5855:             // old Info-ZIP unix extra field</td><td> </td><td class="rblock">         case 0x5855:          // old Info-ZIP unix extra field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (!parseInfoZipUnixOld(buffer, fieldsize, islocal, pfi)) <span class="delete">return f</span></td><td> </td><td class="rblock">               if (!parseInfoZipUnixOld(buffer, fieldsize, islocal, pfi)) <span class="insert">r</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">alse;</span></td><td> </td><td class="rblock"><span class="insert">eturn false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       break;</td><td> </td><td class="right">       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#if 0  // not needed yet</td><td> </td><td class="right">#if 0  // not needed yet</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      case 0x7855:             // new Info-ZIP unix extra field</td><td> </td><td class="rblock">         case 0x7855:          // new Info-ZIP unix extra field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (!parseInfoZipUnixNew(buffer, fieldsize, islocal, pfi)) <span class="delete">return f</span></td><td> </td><td class="rblock">               if (!parseInfoZipUnixNew(buffer, fieldsize, islocal, pfi)) <span class="insert">r</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">alse;</span></td><td> </td><td class="rblock"><span class="insert">eturn false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       break;</td><td> </td><td class="right">       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      default:</td><td> </td><td class="rblock">         default:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        /* ignore everything else */;</td><td> </td><td class="rblock">               /* ignore everything else */;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }/*end switch*/</td><td> </td><td class="rblock">       }/*end switch*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer += fieldsize;</td><td> </td><td class="rblock">       buffer += fieldsize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    size -= fieldsize;</td><td> </td><td class="rblock">       size -= fieldsize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }/*wend*/</td><td> </td><td class="right">  }/*wend*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return true;</td><td> </td><td class="right">  return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////////////////////////////////////////////////////////</td><td> </td><td class="right">////////////////////////////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/////////////////////////// KZip ///////////////////////////////////////</td><td> </td><td class="right">/////////////////////////// KZip ///////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////////////////////////////////////////////////////////</td><td> </td><td class="right">////////////////////////////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">class KZip::KZipPrivate</td><td> </td><td class="right">class KZip::KZipPrivate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">public:</td><td> </td><td class="right">public:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KZipPrivate()</td><td> </td><td class="rblock">       KZipPrivate()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        : m_crc( 0 ),</td><td> </td><td class="rblock">               : m_crc( 0 ),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          m_currentFile( 0 ),</td><td> </td><td class="rblock">                 m_currentFile( 0 ),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          m_currentDev( 0 ),</td><td> </td><td class="rblock">                 m_currentDev( 0 ),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          m_compression( 8 ),</td><td> </td><td class="rblock">                 m_compression( 8 ),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">          m_extraField( KZip::NoExtraField ),</td><td> </td><td class="rblock">                 m_extraField( KZip::NoExtraField ),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         m_offset( 0 )</td><td> </td><td class="right">         m_offset( 0 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {}</td><td> </td><td class="rblock">    <span class="insert">   </span>{}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    unsigned long           m_crc;         // checksum</td><td> </td><td class="rblock">       unsigned long           m_crc;         // checksum</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KZipFileEntry*          m_currentFile; // file currently being <span class="delete">written</span></td><td> </td><td class="rblock">       KZipFileEntry*          m_currentFile; // file currently being <span class="insert">writt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QIODevice*              m_currentDev;  // filterdev used to write to <span class="delete">th</span></td><td> </td><td class="rblock"><span class="insert">en</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e</span> above file</td><td> </td><td class="rblock">       QIODevice*              m_currentDev;  // filterdev used to write to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QList&lt;KZipFileEntry*&gt; m_fileList;    // flat list of all files, for the</td><td> </td><td class="rblock"> <span class="insert">the</span> above file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> index (saves a recursive method ;)</td><td> </td><td class="rblock">       QList&lt;KZipFileEntry*&gt; m_fileList;    // flat list of all files, for </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int                     m_compression;</td><td> </td><td class="rblock">the index (saves a recursive method ;)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KZip::ExtraField        m_extraField;</td><td> </td><td class="rblock">       int                     m_compression;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // m_offset holds the offset of the place in the zip,</td><td> </td><td class="rblock">       KZip::ExtraField        m_extraField;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // where new data can be appended. after openarchive it points to 0, <span class="delete">wh</span></td><td> </td><td class="rblock">       // m_offset holds the offset of the place in the zip,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">en</span> in</td><td> </td><td class="rblock">       // where new data can be appended. after openarchive it points to 0,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // writeonly mode, or it points to the beginning of the central <span class="delete">directo</span></td><td> </td><td class="rblock"> <span class="insert">when</span> in</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ry.</span></td><td> </td><td class="rblock">       // writeonly mode, or it points to the beginning of the central <span class="insert">dire</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // each call to writefile updates this value.</td><td> </td><td class="rblock"><span class="insert">ctory.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    unsigned int            m_offset;</td><td> </td><td class="rblock">       // each call to writefile updates this value.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       unsigned int            m_offset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZip::KZip( const QString&amp; fileName )</td><td> </td><td class="right">KZip::KZip( const QString&amp; fileName )</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    : KArchive( fileName ),d(new KZipPrivate)</td><td> </td><td class="rblock">    <span class="insert">   </span>: KArchive( fileName ),d(new KZipPrivate)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZip::KZip( QIODevice * dev )</td><td> </td><td class="right">KZip::KZip( QIODevice * dev )</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    : KArchive( dev ),d(new KZipPrivate)</td><td> </td><td class="rblock">    <span class="insert">   </span>: KArchive( dev ),d(new KZipPrivate)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZip::~KZip()</td><td> </td><td class="right">KZip::~KZip()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; this;</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; this;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if( isOpen() )</td><td> </td><td class="rblock">       if( isOpen() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        close();</td><td> </td><td class="rblock">               close();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    delete d;</td><td> </td><td class="rblock">       delete d;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::openArchive( QIODevice::OpenMode mode )</td><td> </td><td class="right">bool KZip::openArchive( QIODevice::OpenMode mode )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug();</td><td> </td><td class="rblock">       //qDebug();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_fileList.clear();</td><td> </td><td class="rblock">       d-&gt;m_fileList.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( mode == QIODevice::WriteOnly )</td><td> </td><td class="rblock">       if ( mode == QIODevice::WriteOnly )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return true;</td><td> </td><td class="rblock">               return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    char buffer[47];</td><td> </td><td class="rblock">    <span class="insert">   </span>char buffer[47];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // Check that it's a valid ZIP file</td><td> </td><td class="rblock">       // Check that it's a valid ZIP file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // KArchive::open() opened the underlying device already.</td><td> </td><td class="rblock">       // KArchive::open() opened the underlying device already.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    uint offset = 0; // holds offset, where we read</td><td> </td><td class="rblock">       uint offset = 0; // holds offset, where we read</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int n;</td><td> </td><td class="rblock">       int n;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // contains information gathered from the local file headers</td><td> </td><td class="rblock">       // contains information gathered from the local file headers</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QHash&lt;QByteArray, ParseFileInfo&gt; pfi_map;</td><td> </td><td class="rblock">       QHash&lt;QByteArray, ParseFileInfo&gt; pfi_map;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QIODevice* dev = device();</td><td> </td><td class="rblock">    <span class="insert">   </span>QIODevice* dev = device();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // We set a bool for knowing if we are allowed to skip the start of the</td><td> </td><td class="rblock">       // We set a bool for knowing if we are allowed to skip the start of </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> file</td><td> </td><td class="rblock">the file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    bool startOfFile = true;</td><td> </td><td class="rblock">       bool startOfFile = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    for (;;) // repeat until 'end of entries' signature is reached</td><td> </td><td class="rblock">       for (;;) // repeat until 'end of entries' signature is reached</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //qDebug() &lt;&lt; "loop starts";</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "loop starts";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //qDebug() &lt;&lt; "dev-&gt;pos() now : " &lt;&lt; dev-&gt;pos();</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "dev-&gt;pos() now : " &lt;&lt; dev-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        n = dev-&gt;read( buffer, 4 );</td><td> </td><td class="rblock">               n = dev-&gt;read( buffer, 4 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if (n &lt; 4)</td><td> </td><td class="rblock">               if (n &lt; 4)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            qWarning() &lt;&lt; "Invalid ZIP file. Unexpected end of <span class="delete">file.</span> (#1)";</td><td> </td><td class="rblock">                       qWarning() &lt;&lt; "Invalid ZIP file. Unexpected end of <span class="insert">f</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ile.</span> (#1)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            return false;</td><td> </td><td class="rblock">                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if ( !memcmp( buffer, "PK\5\6", 4 ) ) // 'end of entries'</td><td> </td><td class="rblock">               if ( !memcmp( buffer, "PK\5\6", 4 ) ) // 'end of entries'</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           //qDebug() &lt;&lt; "PK56 found end of archive";</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "PK56 found end of archive";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            startOfFile = false;</td><td> </td><td class="rblock">                       startOfFile = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           break;</td><td> </td><td class="rblock">               break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if ( !memcmp( buffer, "PK\3\4", 4 ) ) // local file header</td><td> </td><td class="right">       if ( !memcmp( buffer, "PK\3\4", 4 ) ) // local file header</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           //qDebug() &lt;&lt; "PK34 found local file header";</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "PK34 found local file header";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            startOfFile = false;</td><td> </td><td class="rblock">                       startOfFile = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // can this fail ???</td><td> </td><td class="rblock">                       // can this fail ???</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           dev-&gt;seek( dev-&gt;pos() + 2 ); // skip 'version needed to <span class="delete">extract'</span></td><td> </td><td class="rblock">               dev-&gt;seek( dev-&gt;pos() + 2 ); // skip 'version needed to <span class="insert">extr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">act'</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           // read static header stuff</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            n = dev-&gt;read( buffer, 24 );</td><td> </td><td class="rblock">               // read static header stuff</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           if (n &lt; 24) {</td><td> </td><td class="rblock">                       n = dev-&gt;read( buffer, 24 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                qWarning() &lt;&lt; "Invalid ZIP file. Unexpected end of file. <span class="delete">(#</span></td><td> </td><td class="rblock">               if (n &lt; 24) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">4)";</span></td><td> </td><td class="rblock">                               qWarning() &lt;&lt; "Invalid ZIP file. Unexpected </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                return false;</td><td> </td><td class="rblock">end of file. <span class="insert">(#4)";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           }</td><td> </td><td class="rblock">                               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           int gpf = (uchar)buffer[0]; // "general purpose flag" <span class="delete">not "gener</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">al</span> protection fault" ;-)</td><td> </td><td class="rblock">               int gpf = (uchar)buffer[0];     // "general purpose flag" <span class="insert">no</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           int compression_mode = (uchar)buffer[2] | (uchar)buffer[3] <span class="delete">&lt;&lt;</span> 8;</td><td> </td><td class="rblock"><span class="insert">t "general</span> protection fault" ;-)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           time_t mtime = transformFromMsDos( buffer+4 );</td><td> </td><td class="rblock">               int compression_mode = (uchar)buffer[2] | (uchar)buffer[3] <span class="insert">&lt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">&lt;</span> 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qint64 compr_size = (uchar)buffer[12] | (uchar)buffer[13] &lt;&lt; 8</td><td> </td><td class="rblock">               time_t mtime = transformFromMsDos( buffer+4 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               | (uchar)buffer[14] &lt;&lt; 16 | <span class="delete">(uchar)buffer[15</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">]</span> &lt;&lt; 24;</td><td> </td><td class="rblock">               qint64 compr_size = (uchar)buffer[12] | (uchar)buffer[13] &lt;&lt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qint64 uncomp_size = (uchar)buffer[16] | (uchar)buffer[17] <span class="delete">&lt;&lt;</span> 8</td><td> </td><td class="rblock"> 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               | (uchar)buffer[18] &lt;&lt; 16 | <span class="delete">(uchar)buffer[19</span></td><td> </td><td class="rblock">                                       | (uchar)buffer[14] &lt;&lt; 16 | <span class="insert">(uchar)b</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">]</span> &lt;&lt; 24;</td><td> </td><td class="rblock"><span class="insert">uffer[15]</span> &lt;&lt; 24;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           int namelen = (uchar)buffer[20] | (uchar)buffer[21] &lt;&lt; 8;</td><td> </td><td class="rblock">               qint64 uncomp_size = (uchar)buffer[16] | (uchar)buffer[17] <span class="insert">&lt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           int extralen = (uchar)buffer[22] | (uchar)buffer[23] &lt;&lt; 8;</td><td> </td><td class="rblock"><span class="insert">&lt;</span> 8</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                       | (uchar)buffer[18] &lt;&lt; 16 | <span class="insert">(uchar)b</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            /*</td><td> </td><td class="rblock"><span class="insert">uffer[19]</span> &lt;&lt; 24;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qDebug() &lt;&lt; "general purpose bit flag: " &lt;&lt; gpf;</td><td> </td><td class="rblock">               int namelen = (uchar)buffer[20] | (uchar)buffer[21] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qDebug() &lt;&lt; "compressed size: " &lt;&lt; compr_size;</td><td> </td><td class="rblock">               int extralen = (uchar)buffer[22] | (uchar)buffer[23] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qDebug() &lt;&lt; "uncompressed size: " &lt;&lt; uncomp_size;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qDebug() &lt;&lt; "namelen: " &lt;&lt; namelen;</td><td> </td><td class="rblock">                       /*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qDebug() &lt;&lt; "extralen: " &lt;&lt; extralen;</td><td> </td><td class="rblock">               qDebug() &lt;&lt; "general purpose bit flag: " &lt;&lt; gpf;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           qDebug() &lt;&lt; "archive size: " &lt;&lt; dev-&gt;size();</td><td> </td><td class="rblock">               qDebug() &lt;&lt; "compressed size: " &lt;&lt; compr_size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           */</td><td> </td><td class="rblock">               qDebug() &lt;&lt; "uncompressed size: " &lt;&lt; uncomp_size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               qDebug() &lt;&lt; "namelen: " &lt;&lt; namelen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           // read fileName</td><td> </td><td class="rblock">               qDebug() &lt;&lt; "extralen: " &lt;&lt; extralen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            Q_ASSERT( namelen &gt; 0 );</td><td> </td><td class="rblock">               qDebug() &lt;&lt; "archive size: " &lt;&lt; dev-&gt;size();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           QByteArray fileName = dev-&gt;read(namelen);</td><td> </td><td class="rblock">               */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( fileName.size() &lt; namelen ) {</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                qWarning() &lt;&lt; "Invalid ZIP file. Name not <span class="delete">completely</span> read <span class="delete">(</span></td><td> </td><td class="rblock">               // read fileName</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#2)";</span></td><td> </td><td class="rblock">                       Q_ASSERT( namelen &gt; 0 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               QByteArray fileName = dev-&gt;read(namelen);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       if ( fileName.size() &lt; namelen ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               qWarning() &lt;&lt; "Invalid ZIP file. Name not <span class="insert">co</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">mpletely</span> read <span class="insert">(#2)";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return false;</td><td> </td><td class="right">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           }</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">ParseFileInfo pfi;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               pfi.mtime = mtime;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           <span class="delete">ParseFileInfo pfi;</span></td><td> </td><td class="rblock">                       <span class="insert">// read and parse the beginning of the extra field,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           pfi.mtime</span> = <span class="delete">mtime;</span></td><td> </td><td class="rblock"><span class="insert">                       // skip rest of extra field in case it is too long</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       unsigned int extraFieldEnd</span> = <span class="insert">dev-&gt;pos() + extralen;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               pfi.extralen = extralen;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               int handledextralen = qMin(extralen, (int)sizeof buffer);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       //if ( handledextralen )</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       //    qDebug() &lt;&lt; "handledextralen: " &lt;&lt; handledextr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">alen;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               n = dev-&gt;read(buffer, handledextralen);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // no error msg necessary as we deliberately truncate the ex</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">tra field</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (!parseExtraField(buffer, handledextralen, true, pfi))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       qWarning() &lt;&lt; "Invalid ZIP File. Broken ExtraField."</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // jump to end of extra field</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       dev-&gt;seek( extraFieldEnd );</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // <span class="delete">read and parse the beginning of the extra field,</span></td><td> </td><td class="rblock">               // we have to take care of the 'general purpose bit flag'.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            // skip rest of extra field in case it is too long</span></td><td> </td><td class="rblock">                       // if bit 3 is set, the header doesn't contain the <span class="insert">l</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            unsigned int extraFieldEnd = dev-&gt;pos() + extralen;</span></td><td> </td><td class="rblock"><span class="insert">ength</span> of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           pfi.extralen = extralen;</span></td><td> </td><td class="rblock">                       // the file and we look for the signature 'PK\7\8'.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           int handledextralen = qMin(extralen, (int)sizeof buffer);</span></td><td> </td><td class="rblock">                       if ( gpf &amp; 8 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            //if ( handledextralen )</span></td><td> </td><td class="rblock">                       // here we have to read through the compressed data </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            //    qDebug() &lt;&lt; "handledextralen: " &lt;&lt; handledextralen;</span></td><td> </td><td class="rblock">to find</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           n = dev-&gt;read(buffer, handledextralen);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           // no error msg necessary as we deliberately truncate the extra </span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">field</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           if (!parseExtraField(buffer, handledextralen, true, pfi))</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               qWarning() &lt;&lt; "Invalid ZIP File. Broken ExtraField.";</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               return false;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            // jump to end of extra field</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            dev-&gt;seek( extraFieldEnd );</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           //</span> we have to take care of the 'general purpose bit flag'.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // if bit 3 is set, the header doesn't contain the <span class="delete">length</span> of</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // the file and we look for the signature 'PK\7\8'.</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( gpf &amp; 8 )</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               // here we have to read through the compressed data to find</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // the next PKxx</td><td> </td><td class="right">               // the next PKxx</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               qDebug() &lt;&lt; "trying to seek for next PK78";</td><td> </td><td class="rblock">                       qDebug() &lt;&lt; "trying to seek for next PK78";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                bool foundSignature = false;</td><td> </td><td class="rblock">                               bool foundSignature = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                while (!foundSignature)</td><td> </td><td class="rblock">                               while (!foundSignature)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    n = dev-&gt;read( buffer, 1 );</td><td> </td><td class="rblock">                                       n = dev-&gt;read( buffer, 1 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    if (n &lt; 1)</td><td> </td><td class="rblock">                                       if (n &lt; 1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    {</td><td> </td><td class="rblock">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        qWarning() &lt;&lt; "Invalid ZIP <span class="delete">file.</span> Unexpected end of </td><td> </td><td class="rblock">                                               qWarning() &lt;&lt; "Invalid ZIP <span class="insert">f</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">file. (#2)";</td><td> </td><td class="rblock"><span class="insert">ile.</span> Unexpected end of file. (#2)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        return false;</td><td> </td><td class="rblock">                                               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    }</td><td> </td><td class="rblock">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    if ( buffer[0] != 'P' )</td><td> </td><td class="rblock">                                       if ( buffer[0] != 'P' )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        continue;</td><td> </td><td class="rblock">                                               continue;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    n = dev-&gt;read( buffer, 3 );</td><td> </td><td class="rblock">                                       n = dev-&gt;read( buffer, 3 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    if (n &lt; 3)</td><td> </td><td class="rblock">                                       if (n &lt; 3)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    {</td><td> </td><td class="rblock">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        qWarning() &lt;&lt; "Invalid ZIP <span class="delete">file.</span> Unexpected end of </td><td> </td><td class="rblock">                                               qWarning() &lt;&lt; "Invalid ZIP <span class="insert">f</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">file. (#3)";</td><td> </td><td class="rblock"><span class="insert">ile.</span> Unexpected end of file. (#3)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        return false;</td><td> </td><td class="rblock">                                               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    }</td><td> </td><td class="rblock">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    // we have to detect three magic <span class="delete">tokens</span> here:</td><td> </td><td class="rblock">                                       // we have to detect three magic <span class="insert">tok</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   // PK34 for the next local header in case there is <span class="delete">no da</span></td><td> </td><td class="rblock"><span class="insert">ens</span> here:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ta</span> descriptor</td><td> </td><td class="rblock">                       // PK34 for the next local header in case there is <span class="insert">n</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   // PK12 for the central header in case there is no <span class="delete">data</span> </td><td> </td><td class="rblock"><span class="insert">o data</span> descriptor</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">descriptor</td><td> </td><td class="rblock">                       // PK12 for the central header in case there is no <span class="insert">d</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   // PK78 for the data descriptor in case it is <span class="delete">following</span> </td><td> </td><td class="rblock"><span class="insert">ata</span> descriptor</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">the compressed data</td><td> </td><td class="rblock">                       // PK78 for the data descriptor in case it is <span class="insert">follow</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">ing</span> the compressed data</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   if ( buffer[0] == 'K' &amp;&amp; buffer[1] == 7 &amp;&amp; buffer[2] == </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">8 )</td><td> </td><td class="rblock">                       if ( buffer[0] == 'K' &amp;&amp; buffer[1] == 7 &amp;&amp; buffer[2]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    {</td><td> </td><td class="rblock"> == 8 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        foundSignature = true;</td><td> </td><td class="rblock">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        dev-&gt;seek( dev-&gt;pos() + 12 <span class="delete">);</span> // skip the <span class="delete">'data_des</span></td><td> </td><td class="rblock">                                               foundSignature = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">criptor'</span></td><td> </td><td class="rblock">                                               dev-&gt;seek( dev-&gt;pos() + 12 <span class="insert">)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    }</td><td> </td><td class="rblock"><span class="insert">;</span> // skip the <span class="insert">'data_descriptor'</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   else if ( ( buffer[0] == 'K' &amp;&amp; buffer[1] == 1 &amp;&amp; <span class="delete">buffer</span></td><td> </td><td class="rblock">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">[2]</span> == 2 )</td><td> </td><td class="rblock">                       else if ( ( buffer[0] == 'K' &amp;&amp; buffer[1] == 1 &amp;&amp; <span class="insert">bu</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        || ( buffer[0] == 'K' &amp;&amp; buffer[1] == 3 &amp;&amp; <span class="delete">buffer[2</span></td><td> </td><td class="rblock"><span class="insert">ffer[2]</span> == 2 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">]</span> == 4 ) )</td><td> </td><td class="rblock">                                || ( buffer[0] == 'K' &amp;&amp; buffer[1] == 3 &amp;&amp; </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    {</td><td> </td><td class="rblock"><span class="insert">buffer[2]</span> == 4 ) )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        foundSignature = true;</td><td> </td><td class="rblock">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        dev-&gt;seek( dev-&gt;pos() - 4 ); // go back 4 bytes, so</td><td> </td><td class="rblock">                                               foundSignature = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> that the magic bytes can be found...</td><td> </td><td class="rblock">                                               dev-&gt;seek( dev-&gt;pos() - 4 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    }</td><td> </td><td class="rblock"> // go back 4 bytes, so that the magic bytes can be found...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    else if ( buffer[0] == 'P' || <span class="delete">buffer[1]</span> == 'P' || <span class="delete">buffe</span></td><td> </td><td class="rblock">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">r[2]</span> == 'P' )</td><td> </td><td class="rblock">                                       else if ( buffer[0] == 'P' || <span class="insert">buffer</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    {</td><td> </td><td class="rblock"><span class="insert">[1]</span> == 'P' || <span class="insert">buffer[2]</span> == 'P' )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        // We have another P <span class="delete">character</span> so we must go back a</td><td> </td><td class="rblock">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> little to check if it is a magic</td><td> </td><td class="rblock">                                               // We have another P <span class="insert">charact</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        dev-&gt;seek( dev-&gt;pos() - 3 );</td><td> </td><td class="rblock"><span class="insert">er</span> so we must go back a little to check if it is a magic</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    }</td><td> </td><td class="rblock">                                               dev-&gt;seek( dev-&gt;pos() - 3 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            else</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               // here we skip the compressed data and jump to the next <span class="delete">hea</span></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">der</span></td><td> </td><td class="rblock">                       // here we skip the compressed data and jump to the </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               //qDebug() &lt;&lt; "general purpose bit flag indicates, <span class="delete">that loca</span></td><td> </td><td class="rblock">next <span class="insert">header</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">l</span> file header contains valid size";</td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "general purpose bit flag indicates, <span class="insert">t</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">hat local</span> file header contains valid size";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // check if this could be a symbolic link</td><td> </td><td class="right">               // check if this could be a symbolic link</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (compression_mode == NoCompression</td><td> </td><td class="right">               if (compression_mode == NoCompression</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       &amp;&amp; uncomp_size &lt;= max_path_len</td><td> </td><td class="rblock">                       <span class="insert">        </span>&amp;&amp; uncomp_size &lt;= max_path_len</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       &amp;&amp; uncomp_size &gt; 0) {</td><td> </td><td class="right">                       &amp;&amp; uncomp_size &gt; 0) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   // read content and store it</td><td> </td><td class="rblock">                       // read content and store it</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    // If it's not a symlink, then we'll just discard the <span class="delete">d</span></td><td> </td><td class="rblock">                                       // If it's not a symlink, then we'll</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ata</span> for now.</td><td> </td><td class="rblock"> just discard the <span class="insert">data</span> for now.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   pfi.guessed_symlink = dev-&gt;read(uncomp_size);</td><td> </td><td class="rblock">                       pfi.guessed_symlink = dev-&gt;read(uncomp_size);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   if (pfi.guessed_symlink.size() &lt; uncomp_size) {</td><td> </td><td class="rblock">                       if (pfi.guessed_symlink.size() &lt; uncomp_size) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       qWarning() &lt;&lt; "Invalid ZIP file. Unexpected end of f
ile. (#5)";</td><td> </td><td class="right">                       qWarning() &lt;&lt; "Invalid ZIP file. Unexpected end of f
ile. (#5)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       return false;</td><td> </td><td class="right">                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   }</td><td> </td><td class="rblock">                   <span class="insert">    </span>}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               } else {</td><td> </td><td class="right">               } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   if ( compr_size &gt; dev-&gt;size() )</td><td> </td><td class="rblock">                               if ( compr_size &gt; dev-&gt;size() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   {</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       // here we cannot trust the compressed size, so scan</td><td> </td><td class="rblock">                               // here we cannot trust the compressed size,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> through the compressed</td><td> </td><td class="rblock"> so scan through the compressed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // data to find the next header</td><td> </td><td class="right">                       // data to find the next header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       bool foundSignature = false;</td><td> </td><td class="right">                       bool foundSignature = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       while (!foundSignature)</td><td> </td><td class="right">                       while (!foundSignature)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               n = dev-&gt;read( buffer, 1 );</td><td> </td><td class="right">                               n = dev-&gt;read( buffer, 1 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (n &lt; 1)</td><td> </td><td class="right">                               if (n &lt; 1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       qWarning() &lt;&lt; "Invalid ZIP file. Une
xpected end of file. (#2)";</td><td> </td><td class="right">                                       qWarning() &lt;&lt; "Invalid ZIP file. Une
xpected end of file. (#2)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return false;</td><td> </td><td class="right">                                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 580</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 580</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if ( ( buffer[0] == 'K' &amp;&amp; buffer[1] == 1 &amp;&amp;
 buffer[2] == 2 )</td><td> </td><td class="right">                               if ( ( buffer[0] == 'K' &amp;&amp; buffer[1] == 1 &amp;&amp;
 buffer[2] == 2 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       || ( buffer[0] == 'K' &amp;&amp; buffer[1] =
= 3 &amp;&amp; buffer[2] == 4 ) )</td><td> </td><td class="right">                                       || ( buffer[0] == 'K' &amp;&amp; buffer[1] =
= 3 &amp;&amp; buffer[2] == 4 ) )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       foundSignature = true;</td><td> </td><td class="right">                                       foundSignature = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       dev-&gt;seek( dev-&gt;pos() - 4 );</td><td> </td><td class="right">                                       dev-&gt;seek( dev-&gt;pos() - 4 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // go back 4 bytes, so that the magi
c bytes can be found</td><td> </td><td class="right">                                       // go back 4 bytes, so that the magi
c bytes can be found</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // in the next cycle...</td><td> </td><td class="right">                                       // in the next cycle...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   }</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   else</td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   {</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//                     qDebug() &lt;&lt; "before interesting dev-&gt;pos(): " &lt;&lt; dev
-&gt;pos();</td><td> </td><td class="right">//                     qDebug() &lt;&lt; "before interesting dev-&gt;pos(): " &lt;&lt; dev
-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       bool success = dev-&gt;seek( dev-&gt;pos() + compr_size );
 // can this fail ???</td><td> </td><td class="right">                       bool success = dev-&gt;seek( dev-&gt;pos() + compr_size );
 // can this fail ???</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       success = success; // annoying unused variable warni
ng</td><td> </td><td class="right">                       success = success; // annoying unused variable warni
ng</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        <span class="delete">Q_ASSERT( success ); // let'</span>s see...</td><td> </td><td class="rblock">                        <span class="insert">                       Q_ASSERT( success ); // let'
</span>s see...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/*                     qDebug() &lt;&lt; "after interesting dev-&gt;pos(): " &lt;&lt; dev-
&gt;pos();</td><td> </td><td class="right">/*                     qDebug() &lt;&lt; "after interesting dev-&gt;pos(): " &lt;&lt; dev-
&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if ( success )</td><td> </td><td class="right">                       if ( success )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               qDebug() &lt;&lt; "dev-&gt;at was successful... ";</td><td> </td><td class="right">                               qDebug() &lt;&lt; "dev-&gt;at was successful... ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else</td><td> </td><td class="right">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               qDebug() &lt;&lt; "dev-&gt;at failed... ";*/</td><td> </td><td class="right">                               qDebug() &lt;&lt; "dev-&gt;at failed... ";*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   }</td><td> </td><td class="rblock">                   <span class="insert">    </span>}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// not needed any more</td><td> </td><td class="right">// not needed any more</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/*                // here we calculate the length of the file in the zip</td><td> </td><td class="right">/*                // here we calculate the length of the file in the zip</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                // with headers and jump to the next header.</td><td> </td><td class="rblock">                               // with headers and jump to the next header.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                uint skip = compr_size + namelen + extralen;</td><td> </td><td class="rblock">                               uint skip = compr_size + namelen + extralen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                offset += 30 + skip;*/</td><td> </td><td class="rblock">                               offset += 30 + skip;*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            pfi_map.insert(fileName, pfi);</td><td> </td><td class="rblock">                       pfi_map.insert(fileName, pfi);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        else if ( !memcmp( buffer, "PK\1\2", 4 ) ) // central block</td><td> </td><td class="rblock">               else if ( !memcmp( buffer, "PK\1\2", 4 ) ) // central block</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           //qDebug() &lt;&lt; "PK12 found central block";</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "PK12 found central block";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            startOfFile = false;</td><td> </td><td class="rblock">                       startOfFile = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // so we reached the central header at the end of <span class="delete">the</span> zip file</td><td> </td><td class="rblock">                       // so we reached the central header at the end of <span class="insert">th</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // here we get all interesting data out of the <span class="delete">central</span> header</td><td> </td><td class="rblock"><span class="insert">e</span> zip file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // of a file</td><td> </td><td class="rblock">                       // here we get all interesting data out of the <span class="insert">centr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            offset = dev-&gt;pos() - 4;</td><td> </td><td class="rblock"><span class="insert">al</span> header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       // of a file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //set offset for appending new files</td><td> </td><td class="rblock">                       offset = dev-&gt;pos() - 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( d-&gt;m_offset == 0L ) d-&gt;m_offset = offset;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       //set offset for appending new files</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            n = dev-&gt;read( buffer + 4, 42 );</td><td> </td><td class="rblock">                       if ( d-&gt;m_offset == 0L ) d-&gt;m_offset = offset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if (n &lt; 42) {</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                qWarning() &lt;&lt; "Invalid ZIP file, central <span class="delete">entry</span> too short"; </td><td> </td><td class="rblock">                       n = dev-&gt;read( buffer + 4, 42 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">// not long enough for valid entry</td><td> </td><td class="rblock">                       if (n &lt; 42) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                return false;</td><td> </td><td class="rblock">                               qWarning() &lt;&lt; "Invalid ZIP file, central <span class="insert">ent</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock"><span class="insert">ry</span> too short"; // not long enough for valid entry</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //int gpf = (uchar)buffer[9] &lt;&lt; 8 | <span class="delete">(uchar)buffer[10];</span></td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //kDebug() &lt;&lt; "general purpose flag=" &lt;&lt; gpf;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // length of the fileName (well, pathname indeed)</td><td> </td><td class="rblock">                       //int gpf = (uchar)buffer[9] &lt;&lt; 8 | <span class="insert">(uchar)buffer[10</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int namelen = (uchar)buffer[29] &lt;&lt; 8 | <span class="delete">(uchar)buffer[28];</span></td><td> </td><td class="rblock"><span class="insert">];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            Q_ASSERT( namelen &gt; 0 );</td><td> </td><td class="rblock">                       //kDebug() &lt;&lt; "general purpose flag=" &lt;&lt; gpf;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            QByteArray bufferName = dev-&gt;read( namelen );</td><td> </td><td class="rblock">                       // length of the fileName (well, pathname indeed)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( bufferName.size() &lt; namelen )</td><td> </td><td class="rblock">                       int namelen = (uchar)buffer[29] &lt;&lt; 8 | <span class="insert">(uchar)buffer</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                qWarning() &lt;&lt; "Invalid ZIP file. Name not <span class="delete">completely</span> read";</td><td> </td><td class="rblock"><span class="insert">[28];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       Q_ASSERT( namelen &gt; 0 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            ParseFileInfo pfi = pfi_map.value( bufferName, <span class="delete">ParseFileInfo()</span> </td><td> </td><td class="rblock">                       QByteArray bufferName = dev-&gt;read( namelen );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">);</td><td> </td><td class="rblock">                       if ( bufferName.size() &lt; namelen )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                               qWarning() &lt;&lt; "Invalid ZIP file. Name not <span class="insert">co</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            QString name( QFile::decodeName(bufferName) );</td><td> </td><td class="rblock"><span class="insert">mpletely</span> read";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "name: " &lt;&lt; name;</td><td> </td><td class="rblock">                       ParseFileInfo pfi = pfi_map.value( bufferName, <span class="insert">Parse</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // only in central header ! see below.</td><td> </td><td class="rblock"><span class="insert">FileInfo()</span> );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // length of extra attributes</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int extralen = (uchar)buffer[31] &lt;&lt; 8 | <span class="delete">(uchar)buffer[30];</span></td><td> </td><td class="rblock">                       QString name( QFile::decodeName(bufferName) );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // length of comment for this file</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int commlen =  (uchar)buffer[33] &lt;&lt; 8 | <span class="delete">(uchar)buffer[32];</span></td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "name: " &lt;&lt; name;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // compression method of this file</td><td> </td><td class="rblock">                       // only in central header ! see below.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int cmethod =  (uchar)buffer[11] &lt;&lt; 8 | <span class="delete">(uchar)buffer[10];</span></td><td> </td><td class="rblock">                       // length of extra attributes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       int extralen = (uchar)buffer[31] &lt;&lt; 8 | <span class="insert">(uchar)buffe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "cmethod: " &lt;&lt; cmethod;</td><td> </td><td class="rblock"><span class="insert">r[30];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "extralen: " &lt;&lt; extralen;</td><td> </td><td class="rblock">                       // length of comment for this file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       int commlen =  (uchar)buffer[33] &lt;&lt; 8 | <span class="insert">(uchar)buffe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // crc32 of the file</td><td> </td><td class="rblock"><span class="insert">r[32];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            uint crc32 = (uchar)buffer[19] &lt;&lt; 24 | <span class="delete">(uchar)buffer[18]</span> &lt;&lt; 16 </td><td> </td><td class="rblock">                       // compression method of this file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">|</td><td> </td><td class="rblock">                       int cmethod =  (uchar)buffer[11] &lt;&lt; 8 | <span class="insert">(uchar)buffe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       (uchar)buffer[17] &lt;&lt; 8 | <span class="delete">(uchar)buffer[16];</span></td><td> </td><td class="rblock"><span class="insert">r[10];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // uncompressed file size</td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "cmethod: " &lt;&lt; cmethod;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            uint ucsize = (uchar)buffer[27] &lt;&lt; 24 | <span class="delete">(uchar)buffer[26]</span> &lt;&lt; 16</td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "extralen: " &lt;&lt; extralen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> |</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       (uchar)buffer[25] &lt;&lt; 8 | (uchar)buffer[24];</td><td> </td><td class="rblock">                       // crc32 of the file</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // compressed file size</td><td> </td><td class="rblock">                       uint crc32 = (uchar)buffer[19] &lt;&lt; 24 | <span class="insert">(uchar)buffer</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            uint csize = (uchar)buffer[23] &lt;&lt; 24 | <span class="delete">(uchar)buffer[22]</span> &lt;&lt; 16 </td><td> </td><td class="rblock"><span class="insert">[18]</span> &lt;&lt; 16 |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">|</td><td> </td><td class="rblock">                                          (uchar)buffer[17] &lt;&lt; 8 | <span class="insert">(uchar)b</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       (uchar)buffer[21] &lt;&lt; 8 | (uchar)buffer[20];</td><td> </td><td class="rblock"><span class="insert">uffer[16];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       // uncompressed file size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       uint ucsize = (uchar)buffer[27] &lt;&lt; 24 | <span class="insert">(uchar)buffe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">r[26]</span> &lt;&lt; 16 |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               (uchar)buffer[25] &lt;&lt; 8 | (uchar)buffer[24];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       // compressed file size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       uint csize = (uchar)buffer[23] &lt;&lt; 24 | <span class="insert">(uchar)buffer</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">[22]</span> &lt;&lt; 16 |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               (uchar)buffer[21] &lt;&lt; 8 | (uchar)buffer[20];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // offset of local header</td><td> </td><td class="rblock">                       // offset of local header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            uint localheaderoffset = (uchar)buffer[45] &lt;&lt; 24 | <span class="delete">(uchar)buffe</span></td><td> </td><td class="rblock">                       uint localheaderoffset = (uchar)buffer[45] &lt;&lt; 24 | <span class="insert">(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">r[44]</span> &lt;&lt; 16 |</td><td> </td><td class="rblock"><span class="insert">uchar)buffer[44]</span> &lt;&lt; 16 |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               (uchar)buffer[43] &lt;&lt; 8 | (uchar)buffer[42];</td><td> </td><td class="right">                               (uchar)buffer[43] &lt;&lt; 8 | (uchar)buffer[42];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // some clever people use different extra field <span class="delete">lengths</span></td><td> </td><td class="rblock">                       // some clever people use different extra field <span class="insert">leng</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // in the central header and in the local header... funny.</td><td> </td><td class="rblock"><span class="insert">ths</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // so we need to get the localextralen to calculate the offset</td><td> </td><td class="rblock">                       // in the central header and in the local header... </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // from localheaderstart to dataoffset</td><td> </td><td class="rblock">funny.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int localextralen = pfi.extralen; // FIXME: this <span class="delete">will</span> not work </td><td> </td><td class="rblock">                       // so we need to get the localextralen to calculate </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">if</td><td> </td><td class="rblock">the offset</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               // no local header <span class="delete">exists</span></td><td> </td><td class="rblock">                       // from localheaderstart to dataoffset</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       int localextralen = pfi.extralen; // FIXME: this <span class="insert">wil</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "localextralen: " &lt;&lt; localextralen;</td><td> </td><td class="rblock"><span class="insert">l</span> not work if</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                       // no local header <span class="insert">e</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // offset, where the real data for uncompression <span class="delete">starts</span></td><td> </td><td class="rblock"><span class="insert">xists</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            uint dataoffset = localheaderoffset + 30 + <span class="delete">localextralen</span> + <span class="delete">name</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">len;</span> //comment only in central header</td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "localextralen: " &lt;&lt; localextralen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "esize: " &lt;&lt; esize;</td><td> </td><td class="rblock">                       // offset, where the real data for uncompression <span class="insert">sta</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "eoffset: " &lt;&lt; eoffset;</td><td> </td><td class="rblock"><span class="insert">rts</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //qDebug() &lt;&lt; "csize: " &lt;&lt; csize;</td><td> </td><td class="rblock">                       uint dataoffset = localheaderoffset + 30 + <span class="insert">localextr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">alen</span> + <span class="insert">namelen;</span> //comment only in central header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           int os_madeby = (uchar)buffer[5];</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            bool isdir = false;</td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "esize: " &lt;&lt; esize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int access = 0100644;</td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "eoffset: " &lt;&lt; eoffset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "csize: " &lt;&lt; csize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           if (os_madeby == 3) {       // good ole unix</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               access = (uchar)buffer[40] | (uchar)buffer[41] &lt;&lt; 8;</td><td> </td><td class="rblock">               int os_madeby = (uchar)buffer[5];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           }</td><td> </td><td class="rblock">                       bool isdir = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       int access = 0100644;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            QString entryName;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               if (os_madeby == 3) {   // good ole unix</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( name.endsWith( '/' ) ) // Entries with a <span class="delete">trailing</span> slash <span class="delete">ar</span></td><td> </td><td class="rblock">                       access = (uchar)buffer[40] | (uchar)buffer[41] &lt;&lt; 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e</span> directories</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                isdir = true;</td><td> </td><td class="rblock">                       QString entryName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                name = name.left( name.length() - 1 );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if (os_madeby != 3) access = S_IFDIR | 0755;</td><td> </td><td class="rblock">                       if ( name.endsWith( '/' ) ) // Entries with a <span class="insert">traili</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ng</span> slash <span class="insert">are</span> directories</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               isdir = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               name = name.left( name.length() - 1 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               if (os_madeby != 3) access = S_IFDIR | 0755;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else Q_ASSERT(access &amp; S_IFDIR);</td><td> </td><td class="right">               else Q_ASSERT(access &amp; S_IFDIR);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock">            <span class="insert">           </span>}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0060" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int pos = name.lastIndexOf( '/' );</td><td> </td><td class="rblock">                       int pos = name.lastIndexOf( '/' );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( pos == -1 )</td><td> </td><td class="rblock">                       if ( pos == -1 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                entryName = name;</td><td> </td><td class="rblock">                               entryName = name;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            else</td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                entryName = name.mid( pos + 1 );</td><td> </td><td class="rblock">                               entryName = name.mid( pos + 1 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            Q_ASSERT( !entryName.isEmpty() );</td><td> </td><td class="rblock">                       Q_ASSERT( !entryName.isEmpty() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            KArchiveEntry* entry;</td><td> </td><td class="rblock">                       KArchiveEntry* entry;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( isdir )</td><td> </td><td class="rblock">                       if ( isdir )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                QString path = QDir::cleanPath( name );</td><td> </td><td class="rblock">                               QString path = QDir::cleanPath( name );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                const KArchiveEntry* ent = rootDir()-&gt;entry( path );</td><td> </td><td class="rblock">                               const KArchiveEntry* ent = rootDir()-&gt;entry(</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if ( ent &amp;&amp; ent-&gt;isDirectory() )</td><td> </td><td class="rblock"> path );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                               if ( ent &amp;&amp; ent-&gt;isDirectory() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    //qDebug() &lt;&lt; "Directory already <span class="delete">exists,</span> NOT going to <span class="delete">a</span></td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">dd</span> it again";</td><td> </td><td class="rblock">                                       //qDebug() &lt;&lt; "Directory already <span class="insert">exi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    entry = 0;</td><td> </td><td class="rblock"><span class="insert">sts,</span> NOT going to <span class="insert">add</span> it again";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock">                                       entry = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                else</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    entry = new KArchiveDirectory( this, entryName, access,</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> (int)pfi.mtime, rootDir()-&gt;user(), rootDir()-&gt;group(), QString() );</td><td> </td><td class="rblock">                                       entry = new KArchiveDirectory( this,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    //qDebug() &lt;&lt; "KArchiveDirectory <span class="delete">created,</span> entryName= " </td><td> </td><td class="rblock"> entryName, access, (int)pfi.mtime, rootDir()-&gt;user(), rootDir()-&gt;group(), </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">&lt;&lt; entryName &lt;&lt; ", name=" &lt;&lt; name;</td><td> </td><td class="rblock">QString() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock">                                       //qDebug() &lt;&lt; "KArchiveDirectory <span class="insert">cre</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           }</td><td> </td><td class="rblock"><span class="insert">ated,</span> entryName= " &lt;&lt; entryName &lt;&lt; ", name=" &lt;&lt; name;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            else</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               QString symlink;</td><td> </td><td class="rblock">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       QString symlink;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (S_ISLNK(access)) {</td><td> </td><td class="right">               if (S_ISLNK(access)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0061" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   symlink = QFile::decodeName(pfi.guessed_symlink);</td><td> </td><td class="rblock">                   <span class="insert">    </span>symlink = QFile::decodeName(pfi.guessed_symlink);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0062" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                <span class="delete">entry = new KZipFileEntry( this, entryName, access, pfi.mti
</span>me,</td><td> </td><td class="rblock">                <span class="insert">               entry = new KZipFileEntry( this, entryName, 
access, pfi.mti</span>me,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       rootDir()-&gt;user(), rootDir()-&gt;group(
),</td><td> </td><td class="right">                                       rootDir()-&gt;user(), rootDir()-&gt;group(
),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       symlink, name, dataoffset,</td><td> </td><td class="right">                                       symlink, name, dataoffset,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       ucsize, cmethod, csize );</td><td> </td><td class="right">                                       ucsize, cmethod, csize );</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0063" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                static_cast&lt;KZipFileEntry <span class="delete">*&gt;(entry)-&gt;setHeaderStart( localh</span></td><td> </td><td class="rblock">                               static_cast&lt;KZipFileEntry <span class="insert">*&gt;(entry)-&gt;setHead</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">eaderoffset</span> );</td><td> </td><td class="rblock"><span class="insert">erStart( localheaderoffset</span> );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                <span class="delete">static_cast&lt;KZipFileEntry*&gt;(entry)-&gt;setCRC32(crc32);</span></td><td> </td><td class="rblock">                               <span class="insert">static_cast&lt;KZipFileEntry*&gt;(entry)-&gt;setCRC32</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                //qDebug() &lt;&lt; "KZipFileEntry created, <span class="delete">entryName=</span> " &lt;&lt; <span class="delete">entry</span></td><td> </td><td class="rblock"><span class="insert">(crc32);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">Name</span> &lt;&lt; ", name=" &lt;&lt; name;</td><td> </td><td class="rblock">                               //qDebug() &lt;&lt; "KZipFileEntry created, <span class="insert">entryN</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                d-&gt;m_fileList.append( <span class="delete">static_cast&lt;KZipFileEntry</span> *&gt;( entry )</td><td> </td><td class="rblock"><span class="insert">ame=</span> " &lt;&lt; <span class="insert">entryName</span> &lt;&lt; ", name=" &lt;&lt; name;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> );</td><td> </td><td class="rblock">                               d-&gt;m_fileList.append( <span class="insert">static_cast&lt;KZipFileEn</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock"><span class="insert">try</span> *&gt;( entry ) );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( entry )</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock">                       if ( entry )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if ( pos == -1 )</td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                               if ( pos == -1 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    rootDir()-&gt;addEntry(entry);</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock">                                       rootDir()-&gt;addEntry(entry);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                else</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    // In some tar files we can find <span class="delete">dir/./file</span> =&gt; call <span class="delete">cle</span></td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">anPath</span></td><td> </td><td class="rblock">                                       // In some tar files we can find <span class="insert">dir</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    QString path = QDir::cleanPath( <span class="delete">name.left(</span> pos ) );</td><td> </td><td class="rblock"><span class="insert">/./file</span> =&gt; call <span class="insert">cleanPath</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    // Ensure container directory <span class="delete">exists,</span> create otherwise</td><td> </td><td class="rblock">                                       QString path = QDir::cleanPath( <span class="insert">name</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    KArchiveDirectory * tdir = <span class="delete">findOrCreate(</span> path );</td><td> </td><td class="rblock"><span class="insert">.left(</span> pos ) );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    tdir-&gt;addEntry(entry);</td><td> </td><td class="rblock">                                       // Ensure container directory <span class="insert">exists</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock"><span class="insert">,</span> create otherwise</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock">                                       KArchiveDirectory * tdir = <span class="insert">findOrCre</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">ate(</span> path );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            //calculate offset to next entry</td><td> </td><td class="rblock">                                       tdir-&gt;addEntry(entry);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            offset += 46 + commlen + extralen + namelen;</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            bool b = dev-&gt;seek(offset);</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            Q_ASSERT( b );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            if ( !b )</td><td> </td><td class="rblock">                       //calculate offset to next entry</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              return false;</td><td> </td><td class="rblock">                       offset += 46 + commlen + extralen + namelen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">                       bool b = dev-&gt;seek(offset);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        else if ( startOfFile )</td><td> </td><td class="rblock">                       Q_ASSERT( b );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">                       if ( !b )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // The file does not start with any ZIP header (e.g. <span class="delete">self-extra</span></td><td> </td><td class="rblock">                         return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ctable</span> ZIP files)</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            // Therefore we need to find the first PK\003\004 <span class="delete">(local header</span></td><td> </td><td class="rblock">               else if ( startOfFile )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">)</span></td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            qDebug() &lt;&lt; "Try to skip start of file";</td><td> </td><td class="rblock">                       // The file does not start with any ZIP header (e.g.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            startOfFile = false;</td><td> </td><td class="rblock"> <span class="insert">self-extractable</span> ZIP files)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            bool foundSignature = false;</td><td> </td><td class="rblock">                       // Therefore we need to find the first PK\003\004 <span class="insert">(l</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">ocal header)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            while (!foundSignature)</td><td> </td><td class="rblock">                       qDebug() &lt;&lt; "Try to skip start of file";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            {</td><td> </td><td class="rblock">                       startOfFile = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                n = dev-&gt;read( buffer, 1 );</td><td> </td><td class="rblock">                       bool foundSignature = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if (n &lt; 1)</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                       while (!foundSignature)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    qWarning() &lt;&lt; "Invalid ZIP file. <span class="delete">Unexpected</span> end of <span class="delete">file</span></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">.</span> " ;</td><td> </td><td class="rblock">                               n = dev-&gt;read( buffer, 1 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    return false;</td><td> </td><td class="rblock">                               if (n &lt; 1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                       qWarning() &lt;&lt; "Invalid ZIP file. <span class="insert">Une</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if ( buffer[0] != 'P' )</td><td> </td><td class="rblock"><span class="insert">xpected</span> end of <span class="insert">file.</span> " ;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    continue;</td><td> </td><td class="rblock">                                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                n = dev-&gt;read( buffer, 3 );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if (n &lt; 3)</td><td> </td><td class="rblock">                               if ( buffer[0] != 'P' )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                                       continue;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    qWarning() &lt;&lt; "Invalid ZIP file. <span class="delete">Unexpected</span> end of <span class="delete">file</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">.</span> " ;</td><td> </td><td class="rblock">                               n = dev-&gt;read( buffer, 3 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    return false;</td><td> </td><td class="rblock">                               if (n &lt; 3)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                       qWarning() &lt;&lt; "Invalid ZIP file. <span class="insert">Une</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                // We have to detect the magic token for a <span class="delete">local</span> header: <span class="delete">PK</span></td><td> </td><td class="rblock"><span class="insert">xpected</span> end of <span class="insert">file.</span> " ;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">\003\004</span></td><td> </td><td class="rblock">                                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                /*</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                 * Note: we do not need to check the other <span class="delete">magics,</span> if the <span class="delete">Z</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">IP</span> file has no</td><td> </td><td class="rblock">                               // We have to detect the magic token for a <span class="insert">l</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                 * local header, then it has not any files!</td><td> </td><td class="rblock"><span class="insert">ocal</span> header: <span class="insert">PK\003\004</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                 */</td><td> </td><td class="rblock">                               /*</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                if ( buffer[0] == 'K' &amp;&amp; buffer[1] == 3 &amp;&amp; <span class="delete">buffer[2]</span> == 4 )</td><td> </td><td class="rblock">                                * Note: we do not need to check the other <span class="insert">m</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock"><span class="insert">agics,</span> if the <span class="insert">ZIP</span> file has no</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    foundSignature = true;</td><td> </td><td class="rblock">                                * local header, then it has not any files!</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    dev-&gt;seek( dev-&gt;pos() - 4 ); // go <span class="delete">back</span> 4 bytes, so <span class="delete">tha</span></td><td> </td><td class="rblock">                                */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">t</span> the magic bytes can be found...</td><td> </td><td class="rblock">                               if ( buffer[0] == 'K' &amp;&amp; buffer[1] == 3 &amp;&amp; <span class="insert">b</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock"><span class="insert">uffer[2]</span> == 4 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                else if ( buffer[0] == 'P' || buffer[1] == <span class="delete">'P'</span> || buffer[2]</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> == 'P' )</td><td> </td><td class="rblock">                                       foundSignature = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                {</td><td> </td><td class="rblock">                                       dev-&gt;seek( dev-&gt;pos() - 4 ); // go <span class="insert">b</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        // We have another P <span class="delete">character</span> so we must go back a</td><td> </td><td class="rblock"><span class="insert">ack</span> 4 bytes, so <span class="insert">that</span> the magic bytes can be found...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> little to check if it is a magic</td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                    dev-&gt;seek( dev-&gt;pos() - 3 );</td><td> </td><td class="rblock">                               else if ( buffer[0] == 'P' || buffer[1] == <span class="insert">'</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                }</td><td> </td><td class="rblock"><span class="insert">P'</span> || buffer[2] == 'P' )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            }</td><td> </td><td class="rblock">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">                                               // We have another P <span class="insert">charact</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        else</td><td> </td><td class="rblock"><span class="insert">er</span> so we must go back a little to check if it is a magic</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">                                       dev-&gt;seek( dev-&gt;pos() - 3 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            qWarning() &lt;&lt; "Invalid ZIP file. Unrecognized header at offset </td><td> </td><td class="rblock">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">" &lt;&lt; offset;</td><td> </td><td class="rblock">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            return false;</td><td> </td><td class="rblock">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">                       qWarning() &lt;&lt; "Invalid ZIP file. Unrecognized header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "*** done *** ";</td><td> </td><td class="rblock"> at offset " &lt;&lt; offset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return true;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "*** done *** ";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::closeArchive()</td><td> </td><td class="right">bool KZip::closeArchive()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0064" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( ! ( mode() &amp; QIODevice::WriteOnly ) )</td><td> </td><td class="rblock">       if ( ! ( mode() &amp; QIODevice::WriteOnly ) )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //qDebug() &lt;&lt; "readonly";</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "readonly";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return true;</td><td> </td><td class="rblock">               return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //ReadWrite or WriteOnly</td><td> </td><td class="rblock">       //ReadWrite or WriteOnly</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //write all central dir file entries</td><td> </td><td class="rblock">       //write all central dir file entries</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // to be written at the end of the file...</td><td> </td><td class="rblock">       // to be written at the end of the file...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    char buffer[ 22 ]; // first used for 12, then for 22 at the end</td><td> </td><td class="rblock">       char buffer[ 22 ]; // first used for 12, then for 22 at the end</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    uLong crc = crc32(0L, Z_NULL, 0);</td><td> </td><td class="rblock">       uLong crc = crc32(0L, Z_NULL, 0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qint64 centraldiroffset = device()-&gt;pos();</td><td> </td><td class="rblock">       qint64 centraldiroffset = device()-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "closearchive: centraldiroffset: " &lt;&lt; <span class="delete">centraldiroffset;</span></td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "closearchive: centraldiroffset: " &lt;&lt; <span class="insert">centraldiroffset</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qint64 atbackup = centraldiroffset;</td><td> </td><td class="rblock"><span class="insert">;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QMutableListIterator&lt;KZipFileEntry*&gt; it( d-&gt;m_fileList );</td><td> </td><td class="rblock">       qint64 atbackup = centraldiroffset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       QMutableListIterator&lt;KZipFileEntry*&gt; it( d-&gt;m_fileList );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    while(it.hasNext())</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {  //set crc and compressed size in each local file header</td><td> </td><td class="rblock">       while(it.hasNext())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           it.next();</td><td> </td><td class="rblock">       {       //set crc and compressed size in each local file header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if ( !device()-&gt;seek( it.value()-&gt;headerStart() + 14 ) )</td><td> </td><td class="rblock">               it.next();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            return false;</td><td> </td><td class="rblock">               if ( !device()-&gt;seek( it.value()-&gt;headerStart() + 14 ) )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //qDebug() &lt;&lt; "closearchive setcrcandcsize: fileName:"</td><td> </td><td class="right">       //qDebug() &lt;&lt; "closearchive setcrcandcsize: fileName:"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //    &lt;&lt; it.current()-&gt;path()</td><td> </td><td class="right">       //    &lt;&lt; it.current()-&gt;path()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //    &lt;&lt; "encoding:" &lt;&lt; it.current()-&gt;encoding();</td><td> </td><td class="right">       //    &lt;&lt; "encoding:" &lt;&lt; it.current()-&gt;encoding();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0065" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        uLong mycrc = it.value()-&gt;crc32();</td><td> </td><td class="rblock">               uLong mycrc = it.value()-&gt;crc32();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[0] = char(mycrc); // crc checksum, at headerStart+14</td><td> </td><td class="rblock">               buffer[0] = char(mycrc); // crc checksum, at headerStart+14</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[1] = char(mycrc &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[1] = char(mycrc &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[2] = char(mycrc &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[2] = char(mycrc &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[3] = char(mycrc &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[3] = char(mycrc &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        int mysize1 = it.value()-&gt;compressedSize();</td><td> </td><td class="rblock">               int mysize1 = it.value()-&gt;compressedSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[4] = char(mysize1); // compressed file size, at <span class="delete">headerStart+</span></td><td> </td><td class="rblock">               buffer[4] = char(mysize1); // compressed file size, at <span class="insert">heade</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">18</span></td><td> </td><td class="rblock"><span class="insert">rStart+18</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[5] = char(mysize1 &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[5] = char(mysize1 &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[6] = char(mysize1 &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[6] = char(mysize1 &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[7] = char(mysize1 &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[7] = char(mysize1 &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        int myusize = it.value()-&gt;size();</td><td> </td><td class="rblock">               int myusize = it.value()-&gt;size();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[8] = char(myusize); // uncompressed file size, at <span class="delete">headerStar</span></td><td> </td><td class="rblock">               buffer[8] = char(myusize); // uncompressed file size, at <span class="insert">hea</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">t+22</span></td><td> </td><td class="rblock"><span class="insert">derStart+22</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[9] = char(myusize &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[9] = char(myusize &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[10] = char(myusize &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[10] = char(myusize &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[11] = char(myusize &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[11] = char(myusize &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if ( device()-&gt;write( buffer, 12 ) != 12 )</td><td> </td><td class="rblock">               if ( device()-&gt;write( buffer, 12 ) != 12 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            return false;</td><td> </td><td class="rblock">                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    device()-&gt;seek( atbackup );</td><td> </td><td class="rblock">       device()-&gt;seek( atbackup );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    it.toFront();</td><td> </td><td class="rblock">       it.toFront();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    while (it.hasNext())</td><td> </td><td class="rblock">       while (it.hasNext())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       it.next();</td><td> </td><td class="right">       it.next();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0066" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //qDebug() &lt;&lt; "fileName:" &lt;&lt; it.current()-&gt;path()</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "fileName:" &lt;&lt; it.current()-&gt;path()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //              &lt;&lt; "encoding:" &lt;&lt; it.current()-&gt;encoding();</td><td> </td><td class="rblock">               //              &lt;&lt; "encoding:" &lt;&lt; it.current()-&gt;encoding();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0067" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        QByteArray path = QFile::encodeName(it.value()-&gt;path());</td><td> </td><td class="rblock">        <span class="insert">       </span>QByteArray path = QFile::encodeName(it.value()-&gt;path());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int extra_field_len = 9;</td><td> </td><td class="right">       const int extra_field_len = 9;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0068" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        int bufferSize = extra_field_len + path.length() + 46;</td><td> </td><td class="rblock">               int bufferSize = extra_field_len + path.length() + 46;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        char* buffer = new char[ bufferSize ];</td><td> </td><td class="rblock">               char* buffer = new char[ bufferSize ];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0069" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        <span class="delete">memset(buffer, 0, 46); // zero is a nice default for most header fi
</span>elds</td><td> </td><td class="rblock">        <span class="insert">       memset(buffer, 0, 46); // zero is a nice default for most he
ader fi</span>elds</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0070" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        const char head[] =</td><td> </td><td class="rblock">               const char head[] =</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            'P', 'K', 1, 2, // central file header signature</td><td> </td><td class="rblock">                       'P', 'K', 1, 2, // central file header signature</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            0x14, 3,        // version made by (3 == UNIX)</td><td> </td><td class="rblock">                       0x14, 3,        // version made by (3 == UNIX)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            0x14, 0         // version needed to extract</td><td> </td><td class="rblock">                       0x14, 0         // version needed to extract</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        };</td><td> </td><td class="rblock">               };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // I do not know why memcpy is not working here</td><td> </td><td class="right">       // I do not know why memcpy is not working here</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0071" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //memcpy(buffer, head, sizeof(head));</td><td> </td><td class="rblock">               //memcpy(buffer, head, sizeof(head));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        memmove(buffer, head, sizeof(head));</td><td> </td><td class="rblock">               memmove(buffer, head, sizeof(head));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0072" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 10 ] = char(it.value()-&gt;encoding()); // compression method</td><td> </td><td class="rblock">               buffer[ 10 ] = char(it.value()-&gt;encoding()); // compression </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 11 ] = char(it.value()-&gt;encoding() &gt;&gt; 8);</td><td> </td><td class="rblock">method</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               buffer[ 11 ] = char(it.value()-&gt;encoding() &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0073" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        transformToMsDos( it.value()-&gt;datetime(), &amp;buffer[ 12 ] );</td><td> </td><td class="rblock">        <span class="insert">       </span>transformToMsDos( it.value()-&gt;datetime(), &amp;buffer[ 12 ] );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0074" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        uLong mycrc = it.value()-&gt;crc32();</td><td> </td><td class="rblock">               uLong mycrc = it.value()-&gt;crc32();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 16 ] = char(mycrc); // crc checksum</td><td> </td><td class="rblock">               buffer[ 16 ] = char(mycrc); // crc checksum</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 17 ] = char(mycrc &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[ 17 ] = char(mycrc &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 18 ] = char(mycrc &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[ 18 ] = char(mycrc &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 19 ] = char(mycrc &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[ 19 ] = char(mycrc &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        int mysize1 = it.value()-&gt;compressedSize();</td><td> </td><td class="rblock">               int mysize1 = it.value()-&gt;compressedSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 20 ] = char(mysize1); // compressed file size</td><td> </td><td class="rblock">               buffer[ 20 ] = char(mysize1); // compressed file size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 21 ] = char(mysize1 &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[ 21 ] = char(mysize1 &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 22 ] = char(mysize1 &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[ 22 ] = char(mysize1 &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 23 ] = char(mysize1 &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[ 23 ] = char(mysize1 &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        int mysize = it.value()-&gt;size();</td><td> </td><td class="rblock">               int mysize = it.value()-&gt;size();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 24 ] = char(mysize); // uncompressed file size</td><td> </td><td class="rblock">               buffer[ 24 ] = char(mysize); // uncompressed file size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 25 ] = char(mysize &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[ 25 ] = char(mysize &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 26 ] = char(mysize &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[ 26 ] = char(mysize &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 27 ] = char(mysize &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[ 27 ] = char(mysize &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0075" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 28 ] = char(it.value()-&gt;path().length()); // <span class="delete">fileName lengt</span></td><td> </td><td class="rblock">               buffer[ 28 ] = char(it.value()-&gt;path().length()); // <span class="insert">fileNam</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">h</span></td><td> </td><td class="rblock"><span class="insert">e length</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 29 ] = char(it.value()-&gt;path().length() &gt;&gt; 8);</td><td> </td><td class="rblock">               buffer[ 29 ] = char(it.value()-&gt;path().length() &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       buffer[ 30 ] = char(extra_field_len);</td><td> </td><td class="right">       buffer[ 30 ] = char(extra_field_len);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       buffer[ 31 ] = char(extra_field_len &gt;&gt; 8);</td><td> </td><td class="right">       buffer[ 31 ] = char(extra_field_len &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       buffer[ 40 ] = char(it.value()-&gt;permissions());</td><td> </td><td class="right">       buffer[ 40 ] = char(it.value()-&gt;permissions());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       buffer[ 41 ] = char(it.value()-&gt;permissions() &gt;&gt; 8);</td><td> </td><td class="right">       buffer[ 41 ] = char(it.value()-&gt;permissions() &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0076" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        int myhst = it.value()-&gt;headerStart();</td><td> </td><td class="rblock">               int myhst = it.value()-&gt;headerStart();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 42 ] = char(myhst); //relative offset of local <span class="delete">header</span></td><td> </td><td class="rblock">               buffer[ 42 ] = char(myhst); //relative offset of local <span class="insert">heade</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 43 ] = char(myhst &gt;&gt; 8);</td><td> </td><td class="rblock"><span class="insert">r</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 44 ] = char(myhst &gt;&gt; 16);</td><td> </td><td class="rblock">               buffer[ 43 ] = char(myhst &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        buffer[ 45 ] = char(myhst &gt;&gt; 24);</td><td> </td><td class="rblock">               buffer[ 44 ] = char(myhst &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               buffer[ 45 ] = char(myhst &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0077" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        // file name</td><td> </td><td class="rblock">               // file name</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        strncpy( buffer + 46, path, path.length() );</td><td> </td><td class="rblock">               strncpy( buffer + 46, path, path.length() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //qDebug() &lt;&lt; "closearchive length to write: " &lt;&lt; bufferSize;</td><td> </td><td class="right">       //qDebug() &lt;&lt; "closearchive length to write: " &lt;&lt; bufferSize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // extra field</td><td> </td><td class="right">       // extra field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       char *extfield = buffer + 46 + path.length();</td><td> </td><td class="right">       char *extfield = buffer + 46 + path.length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[0] = 'U';</td><td> </td><td class="right">       extfield[0] = 'U';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[1] = 'T';</td><td> </td><td class="right">       extfield[1] = 'T';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[2] = 5;</td><td> </td><td class="right">       extfield[2] = 5;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[3] = 0;</td><td> </td><td class="right">       extfield[3] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[4] = 1 | 2 | 4;        // specify flags from local field</td><td> </td><td class="right">       extfield[4] = 1 | 2 | 4;        // specify flags from local field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // (unless I misread the spec)</td><td> </td><td class="right">                                       // (unless I misread the spec)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // provide only modification time</td><td> </td><td class="right">       // provide only modification time</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       unsigned long time = (unsigned long)it.value()-&gt;date();</td><td> </td><td class="right">       unsigned long time = (unsigned long)it.value()-&gt;date();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[5] = char(time);</td><td> </td><td class="right">       extfield[5] = char(time);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[6] = char(time &gt;&gt; 8);</td><td> </td><td class="right">       extfield[6] = char(time &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[7] = char(time &gt;&gt; 16);</td><td> </td><td class="right">       extfield[7] = char(time &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       extfield[8] = char(time &gt;&gt; 24);</td><td> </td><td class="right">       extfield[8] = char(time &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0078" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        crc = crc32(crc, (Bytef *)buffer, bufferSize );</td><td> </td><td class="rblock">               crc = crc32(crc, (Bytef *)buffer, bufferSize );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        bool ok = ( device()-&gt;write( buffer, bufferSize ) == <span class="delete">bufferSize</span> );</td><td> </td><td class="rblock">               bool ok = ( device()-&gt;write( buffer, bufferSize ) == <span class="insert">bufferS</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        delete[] buffer;</td><td> </td><td class="rblock"><span class="insert">ize</span> );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if ( !ok )</td><td> </td><td class="rblock">               delete[] buffer;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            return false;</td><td> </td><td class="rblock">               if ( !ok )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">                       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qint64 centraldirendoffset = device()-&gt;pos();</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "closearchive: centraldirendoffset: " &lt;&lt; <span class="delete">centraldirendoff</span></td><td> </td><td class="rblock">       qint64 centraldirendoffset = device()-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">set;</span></td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "closearchive: centraldirendoffset: " &lt;&lt; <span class="insert">centraldirend</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "closearchive: device()-&gt;pos(): " &lt;&lt; device()-&gt;pos();</td><td> </td><td class="rblock"><span class="insert">offset;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "closearchive: device()-&gt;pos(): " &lt;&lt; device()-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //write end of central dir record.</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 0 ] = 'P'; //end of central dir signature</td><td> </td><td class="rblock">       //write end of central dir record.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 1 ] = 'K';</td><td> </td><td class="rblock">       buffer[ 0 ] = 'P'; //end of central dir signature</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 2 ] = 5;</td><td> </td><td class="rblock">       buffer[ 1 ] = 'K';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 3 ] = 6;</td><td> </td><td class="rblock">       buffer[ 2 ] = 5;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 3 ] = 6;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 4 ] = 0; // number of this disk</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 5 ] = 0;</td><td> </td><td class="rblock">       buffer[ 4 ] = 0; // number of this disk</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 5 ] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 6 ] = 0; // number of disk with start of central dir</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 7 ] = 0;</td><td> </td><td class="rblock">       buffer[ 6 ] = 0; // number of disk with start of central dir</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 7 ] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">int count = d-&gt;m_fileList.count();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    //qDebug() &lt;&lt; "number of files (count): " &lt;&lt; count;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 8 ] = char(count); // total number of entries in central dir of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 9 ] = char(count &gt;&gt; 8); // this disk</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 10 ] = buffer[ 8 ]; // total number of entries in the central d</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ir</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 11 ] = buffer[ 9 ];</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    int cdsize = centraldirendoffset - centraldiroffset;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 12 ] = char(cdsize); // size of the central dir</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 13 ] = char(cdsize &gt;&gt; 8);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 14 ] = char(cdsize &gt;&gt; 16);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 15 ] = char(cdsize &gt;&gt; 24);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    //qDebug() &lt;&lt; "end : centraldiroffset: " &lt;&lt; centraldiroffset;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    //qDebug() &lt;&lt; "end : centraldirsize: " &lt;&lt; cdsize;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 16 ] = char(centraldiroffset); // central dir offset</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 17 ] = char(centraldiroffset &gt;&gt; 8);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 18 ] = char(centraldiroffset &gt;&gt; 16);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 19 ] = char(centraldiroffset &gt;&gt; 24);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0079" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">buffer[ 20 ]</span> = <span class="delete">0; //zipfile comment length</span></td><td> </td><td class="rblock">       <span class="insert">int count</span> = <span class="insert">d-&gt;m_fileList.count();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    buffer[ 21 ] = 0;</span></td><td> </td><td class="rblock"><span class="insert">       //qDebug() &lt;&lt; "number of files (count): " &lt;&lt; count;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0080" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    <span class="delete">if ( device()-&gt;write( buffer, 22 ) != 22 )</span></td><td> </td><td class="rblock">       <span class="insert">buffer[ 8 ] = char(count); // total number of entries in central dir</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">        return false;</span></td><td> </td><td class="rblock"><span class="insert"> of</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 9 ] = char(count &gt;&gt; 8); // this disk</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0081" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return true;</td><td> </td><td class="rblock">       <span class="insert">buffer[ 10 ] = buffer[ 8 ]; // total number of entries in the centra</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">l dir</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 11 ] = buffer[ 9 ];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       int cdsize = centraldirendoffset - centraldiroffset;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 12 ] = char(cdsize); // size of the central dir</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 13 ] = char(cdsize &gt;&gt; 8);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 14 ] = char(cdsize &gt;&gt; 16);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 15 ] = char(cdsize &gt;&gt; 24);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       //qDebug() &lt;&lt; "end : centraldiroffset: " &lt;&lt; centraldiroffset;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       //qDebug() &lt;&lt; "end : centraldirsize: " &lt;&lt; cdsize;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 16 ] = char(centraldiroffset); // central dir offset</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 17 ] = char(centraldiroffset &gt;&gt; 8);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 18 ] = char(centraldiroffset &gt;&gt; 16);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 19 ] = char(centraldiroffset &gt;&gt; 24);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 20 ] = 0; //zipfile comment length</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       buffer[ 21 ] = 0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       if ( device()-&gt;write( buffer, 22 ) != 22 )</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               return false;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::doWriteDir( const QString&amp;, const QString&amp;, const QString&amp;,</td><td> </td><td class="right">bool KZip::doWriteDir( const QString&amp;, const QString&amp;, const QString&amp;,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0082" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       mode_t, time_t, time_t, time_t ) {</td><td> </td><td class="rblock">                                          mode_t, time_t, time_t, time_t ) </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return true;</td><td> </td><td class="rblock">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::doPrepareWriting(const QString &amp;name, const QString &amp;user,</td><td> </td><td class="right">bool KZip::doPrepareWriting(const QString &amp;name, const QString &amp;user,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0083" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               const QString <span class="delete">&amp;group,</span> qint64 /*size*/, <span class="delete">mode_</span></td><td> </td><td class="rblock">                                                          const QString <span class="insert">&amp;gr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">t</span> perm,</td><td> </td><td class="rblock"><span class="insert">oup,</span> qint64 /*size*/, <span class="insert">mode_t</span> perm,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               time_t atime, <span class="delete">time_t</span> mtime, time_t ctime) {</td><td> </td><td class="rblock">                                                          time_t atime, <span class="insert">tim</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug();</td><td> </td><td class="rblock"><span class="insert">e_t</span> mtime, time_t ctime) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( !isOpen() )</td><td> </td><td class="rblock">       //qDebug();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       if ( !isOpen() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        qWarning( "KZip::writeFile: You must open the zip file <span class="delete">before writi</span></td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ng</span> to it\n");</td><td> </td><td class="rblock">               qWarning( "KZip::writeFile: You must open the zip file <span class="insert">befor</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return false;</td><td> </td><td class="rblock"><span class="insert">e writing</span> to it\n");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( ! ( mode() &amp; QIODevice::WriteOnly ) ) // accept WriteOnly and <span class="delete">Read</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">Write</span></td><td> </td><td class="rblock">       if ( ! ( mode() &amp; QIODevice::WriteOnly ) ) // accept WriteOnly and <span class="insert">R</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock"><span class="insert">eadWrite</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        qWarning( "KZip::writeFile: You must open the zip file for <span class="delete">writing\</span></td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">n");</span></td><td> </td><td class="rblock">               qWarning( "KZip::writeFile: You must open the zip file for <span class="insert">w</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return false;</td><td> </td><td class="rblock"><span class="insert">riting\n");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( device() );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       Q_ASSERT( device() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // set right offset in zip.</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( !device()-&gt;seek( d-&gt;m_offset ) ) {</td><td> </td><td class="rblock">       // set right offset in zip.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        qWarning() &lt;&lt; "doPrepareWriting: cannot seek in ZIP file. <span class="delete">Disk full</span></td><td> </td><td class="rblock">       if ( !device()-&gt;seek( d-&gt;m_offset ) ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">?";</span></td><td> </td><td class="rblock">               qWarning() &lt;&lt; "doPrepareWriting: cannot seek in ZIP file. <span class="insert">Di</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return false;</td><td> </td><td class="rblock"><span class="insert">sk full?";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // delete entries in the filelist with the same fileName as the one we </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">want</td><td> </td><td class="rblock">       // delete entries in the filelist with the same fileName as the one </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // to save, so that we don't have duplicate file entries when <span class="delete">viewing t</span></td><td> </td><td class="rblock">we want</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">he</span> zip</td><td> </td><td class="rblock">       // to save, so that we don't have duplicate file entries when <span class="insert">viewin</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // with konqi...</td><td> </td><td class="rblock"><span class="insert">g the</span> zip</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // CAUTION: the old file itself is still in the zip and won't be <span class="delete">remove</span></td><td> </td><td class="rblock">       // with konqi...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">d</span> !!!</td><td> </td><td class="rblock">       // CAUTION: the old file itself is still in the zip and won't be <span class="insert">rem</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QMutableListIterator&lt;KZipFileEntry*&gt; it( d-&gt;m_fileList );</td><td> </td><td class="rblock"><span class="insert">oved</span> !!!</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       QMutableListIterator&lt;KZipFileEntry*&gt; it( d-&gt;m_fileList );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //qDebug() &lt;&lt; "fileName to write: " &lt;&lt; name;</td><td> </td><td class="right">       //qDebug() &lt;&lt; "fileName to write: " &lt;&lt; name;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0084" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    while(it.hasNext())</td><td> </td><td class="rblock">       while(it.hasNext())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           it.next();</td><td> </td><td class="rblock">               it.next();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       //qDebug() &lt;&lt; "prepfileName: " &lt;&lt; it.current()-&gt;path();</td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "prepfileName: " &lt;&lt; it.current()-&gt;path();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (name == it.value()-&gt;path() )</td><td> </td><td class="right">               if (name == it.value()-&gt;path() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0085" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        {</td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               //qDebug() &lt;&lt; "removing following entry: " &lt;&lt; <span class="delete">it.current()-&gt;</span></td><td> </td><td class="rblock">                       //qDebug() &lt;&lt; "removing following entry: " &lt;&lt; <span class="insert">it.cur</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">path();</span></td><td> </td><td class="rblock"><span class="insert">rent()-&gt;path();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete it.value();</td><td> </td><td class="right">               delete it.value();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0086" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               it.remove();</td><td> </td><td class="rblock">                       it.remove();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        }</td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0087" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // Find or create parent dir</td><td> </td><td class="rblock">       // Find or create parent dir</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KArchiveDirectory* parentDir = rootDir();</td><td> </td><td class="rblock">       KArchiveDirectory* parentDir = rootDir();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QString fileName( name );</td><td> </td><td class="rblock">       QString fileName( name );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int i = name.lastIndexOf( '/' );</td><td> </td><td class="rblock">       int i = name.lastIndexOf( '/' );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( i != -1 )</td><td> </td><td class="rblock">       if ( i != -1 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        QString dir = name.left( i );</td><td> </td><td class="rblock">               QString dir = name.left( i );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        fileName = name.mid( i + 1 );</td><td> </td><td class="rblock">               fileName = name.mid( i + 1 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        //qDebug() &lt;&lt; "ensuring" &lt;&lt; dir &lt;&lt; "exists. fileName=" &lt;&lt; <span class="delete">fileName;</span></td><td> </td><td class="rblock">               //qDebug() &lt;&lt; "ensuring" &lt;&lt; dir &lt;&lt; "exists. fileName=" &lt;&lt; <span class="insert">fi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        parentDir = findOrCreate( dir );</td><td> </td><td class="rblock"><span class="insert">leName;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               parentDir = findOrCreate( dir );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // construct a KZipFileEntry and add it to list</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KZipFileEntry * e = new KZipFileEntry( this, fileName, perm, mtime, <span class="delete">use</span></td><td> </td><td class="rblock">       // construct a KZipFileEntry and add it to list</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">r,</span> group, QString(),</td><td> </td><td class="rblock">       KZipFileEntry * e = new KZipFileEntry( this, fileName, perm, mtime, </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                           name, device()-&gt;pos() + 30 + <span class="delete">nam</span></td><td> </td><td class="rblock"><span class="insert">user,</span> group, QString(),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e.length(),</span> // start</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                           0 /*size unknown yet*/, <span class="delete">d-&gt;m_com</span></td><td> </td><td class="rblock">       name, device()-&gt;pos() + 30 + <span class="insert">name.length(),</span> // start</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">pression,</span> 0 /*csize unknown yet*/ );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    e-&gt;setHeaderStart( device()-&gt;pos() );</td><td> </td><td class="rblock">       0 /*size unknown yet*/, <span class="insert">d-&gt;m_compression,</span> 0 /*csize unknown yet*/ );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "wrote file start: " &lt;&lt; e-&gt;position() &lt;&lt; " name: " &lt;&lt; <span class="delete">nam</span></td><td> </td><td class="rblock">       e-&gt;setHeaderStart( device()-&gt;pos() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e;</span></td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "wrote file start: " &lt;&lt; e-&gt;position() &lt;&lt; " name: " &lt;&lt; </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    parentDir-&gt;addEntry( e );</td><td> </td><td class="rblock"><span class="insert">name;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       parentDir-&gt;addEntry( e );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentFile = e;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_fileList.append( e );</td><td> </td><td class="rblock">       d-&gt;m_currentFile = e;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       d-&gt;m_fileList.append( e );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int extra_field_len = 0;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( d-&gt;m_extraField == ModificationTime )</td><td> </td><td class="rblock">       int extra_field_len = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extra_field_len = 17;  // value also used in <span class="delete">finishWriting()</span></td><td> </td><td class="rblock">       if ( d-&gt;m_extraField == ModificationTime )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               extra_field_len = 17;   // value also used in <span class="insert">finishWriting(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // write out zip header</td><td> </td><td class="rblock"><span class="insert">)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QByteArray encodedName = QFile::encodeName(name);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int bufferSize = extra_field_len + encodedName.length() + 30;</td><td> </td><td class="rblock">       // write out zip header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "bufferSize=" &lt;&lt; bufferSize;</td><td> </td><td class="rblock">       QByteArray encodedName = QFile::encodeName(name);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    char* buffer = new char[ bufferSize ];</td><td> </td><td class="rblock">       int bufferSize = extra_field_len + encodedName.length() + 30;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "bufferSize=" &lt;&lt; bufferSize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 0 ] = 'P'; //local file header signature</td><td> </td><td class="rblock">       char* buffer = new char[ bufferSize ];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 1 ] = 'K';</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 2 ] = 3;</td><td> </td><td class="rblock">       buffer[ 0 ] = 'P'; //local file header signature</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 3 ] = 4;</td><td> </td><td class="rblock">       buffer[ 1 ] = 'K';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 2 ] = 3;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 4 ] = 0x14; // version needed to extract</td><td> </td><td class="rblock">       buffer[ 3 ] = 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 5 ] = 0;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 4 ] = 0x14; // version needed to extract</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 6 ] = 0; // general purpose bit flag</td><td> </td><td class="rblock">       buffer[ 5 ] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 7 ] = 0;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 6 ] = 0; // general purpose bit flag</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 8 ] = char(e-&gt;encoding()); // compression method</td><td> </td><td class="rblock">       buffer[ 7 ] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 9 ] = char(e-&gt;encoding() &gt;&gt; 8);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 8 ] = char(e-&gt;encoding()); // compression method</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    transformToMsDos( e-&gt;datetime(), &amp;buffer[ 10 ] );</td><td> </td><td class="rblock">       buffer[ 9 ] = char(e-&gt;encoding() &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 14 ] = 'C'; //dummy crc</td><td> </td><td class="rblock">       transformToMsDos( e-&gt;datetime(), &amp;buffer[ 10 ] );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 15 ] = 'R';</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 16 ] = 'C';</td><td> </td><td class="rblock">       buffer[ 14 ] = 'C'; //dummy crc</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 17 ] = 'q';</td><td> </td><td class="rblock">       buffer[ 15 ] = 'R';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 16 ] = 'C';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 18 ] = 'C'; //compressed file size</td><td> </td><td class="rblock">       buffer[ 17 ] = 'q';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 19 ] = 'S';</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 20 ] = 'I';</td><td> </td><td class="rblock">       buffer[ 18 ] = 'C'; //compressed file size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 21 ] = 'Z';</td><td> </td><td class="rblock">       buffer[ 19 ] = 'S';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 20 ] = 'I';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 22 ] = 'U'; //uncompressed file size</td><td> </td><td class="rblock">       buffer[ 21 ] = 'Z';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 23 ] = 'S';</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 24 ] = 'I';</td><td> </td><td class="rblock">       buffer[ 22 ] = 'U'; //uncompressed file size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 25 ] = 'Z';</td><td> </td><td class="rblock">       buffer[ 23 ] = 'S';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 24 ] = 'I';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 26 ] = (uchar)(encodedName.length()); //fileName length</td><td> </td><td class="rblock">       buffer[ 25 ] = 'Z';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 27 ] = (uchar)(encodedName.length() &gt;&gt; 8);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 26 ] = (uchar)(encodedName.length()); //fileName length</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 28 ] = (uchar)(extra_field_len); // extra field length</td><td> </td><td class="rblock">       buffer[ 27 ] = (uchar)(encodedName.length() &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    buffer[ 29 ] = (uchar)(extra_field_len &gt;&gt; 8);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       buffer[ 28 ] = (uchar)(extra_field_len); // extra field length</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // file name</td><td> </td><td class="rblock">       buffer[ 29 ] = (uchar)(extra_field_len &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    strncpy( buffer + 30, encodedName, encodedName.length() );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       // file name</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // extra field</td><td> </td><td class="rblock">       strncpy( buffer + 30, encodedName, encodedName.length() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( d-&gt;m_extraField == ModificationTime )</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       // extra field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        char *extfield = buffer + 30 + encodedName.length();</td><td> </td><td class="rblock">       if ( d-&gt;m_extraField == ModificationTime )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        // "Extended timestamp" header (0x5455)</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[0] = 'U';</td><td> </td><td class="rblock">               char *extfield = buffer + 30 + encodedName.length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[1] = 'T';</td><td> </td><td class="rblock">               // "Extended timestamp" header (0x5455)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[2] = 13; // data size</td><td> </td><td class="rblock">               extfield[0] = 'U';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[3] = 0;</td><td> </td><td class="rblock">               extfield[1] = 'T';</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[4] = 1 | 2 | 4;       // contains mtime, atime, <span class="delete">ctime</span></td><td> </td><td class="rblock">               extfield[2] = 13; // data size</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               extfield[3] = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[5] = char(mtime);</td><td> </td><td class="rblock">               extfield[4] = 1 | 2 | 4;        // contains mtime, atime, <span class="insert">ct</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[6] = char(mtime &gt;&gt; 8);</td><td> </td><td class="rblock"><span class="insert">ime</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[7] = char(mtime &gt;&gt; 16);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[8] = char(mtime &gt;&gt; 24);</td><td> </td><td class="rblock">               extfield[5] = char(mtime);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               extfield[6] = char(mtime &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[9] = char(atime);</td><td> </td><td class="rblock">               extfield[7] = char(mtime &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[10] = char(atime &gt;&gt; 8);</td><td> </td><td class="rblock">               extfield[8] = char(mtime &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[11] = char(atime &gt;&gt; 16);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[12] = char(atime &gt;&gt; 24);</td><td> </td><td class="rblock">               extfield[9] = char(atime);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               extfield[10] = char(atime &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[13] = char(ctime);</td><td> </td><td class="rblock">               extfield[11] = char(atime &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[14] = char(ctime &gt;&gt; 8);</td><td> </td><td class="rblock">               extfield[12] = char(atime &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[15] = char(ctime &gt;&gt; 16);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extfield[16] = char(ctime &gt;&gt; 24);</td><td> </td><td class="rblock">               extfield[13] = char(ctime);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">               extfield[14] = char(ctime &gt;&gt; 8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               extfield[15] = char(ctime &gt;&gt; 16);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // Write header</td><td> </td><td class="rblock">               extfield[16] = char(ctime &gt;&gt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    bool b = (device()-&gt;write( buffer, bufferSize ) == bufferSize );</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_crc = 0L;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    delete[] buffer;</td><td> </td><td class="rblock">       // Write header</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       bool b = (device()-&gt;write( buffer, bufferSize ) == bufferSize );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( b );</td><td> </td><td class="rblock">       d-&gt;m_crc = 0L;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (!b) {</td><td> </td><td class="rblock">       delete[] buffer;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return false;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       Q_ASSERT( b );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       if (!b) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // Prepare device for writing the data</td><td> </td><td class="rblock">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // Either device() if no compression, or a KFilterDev to compress</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( d-&gt;m_compression == 0 ) {</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        d-&gt;m_currentDev = device();</td><td> </td><td class="rblock">       // Prepare device for writing the data</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return true;</td><td> </td><td class="rblock">       // Either device() if no compression, or a KFilterDev to compress</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       if ( d-&gt;m_compression == 0 ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               d-&gt;m_currentDev = device();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentDev = KFilterDev::device( device(), <span class="delete">"application/x-gzip", f</span></td><td> </td><td class="rblock">               return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">alse</span> );</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( d-&gt;m_currentDev );</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( !d-&gt;m_currentDev ) {</td><td> </td><td class="rblock">       d-&gt;m_currentDev = KFilterDev::device( device(), <span class="insert">"application/x-gzip"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return false; // ouch</td><td> </td><td class="rblock"><span class="insert">, false</span> );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       Q_ASSERT( d-&gt;m_currentDev );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    static_cast&lt;KFilterDev *&gt;(d-&gt;m_currentDev)-&gt;setSkipHeaders(); // <span class="delete">Just z</span></td><td> </td><td class="rblock">       if ( !d-&gt;m_currentDev ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">lib,</span> not gzip</td><td> </td><td class="rblock">               return false; // ouch</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    b = d-&gt;m_currentDev-&gt;open( QIODevice::WriteOnly );</td><td> </td><td class="rblock">       static_cast&lt;KFilterDev *&gt;(d-&gt;m_currentDev)-&gt;setSkipHeaders(); // <span class="insert">Jus</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( b );</td><td> </td><td class="rblock"><span class="insert">t zlib,</span> not gzip</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return b;</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       b = d-&gt;m_currentDev-&gt;open( QIODevice::WriteOnly );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       Q_ASSERT( b );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       return b;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::doFinishWriting( qint64 size )</td><td> </td><td class="right">bool KZip::doFinishWriting( qint64 size )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0088" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( d-&gt;m_currentFile-&gt;encoding() == 8 ) {</td><td> </td><td class="rblock">       if ( d-&gt;m_currentFile-&gt;encoding() == 8 ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        // Finish</td><td> </td><td class="rblock">               // Finish</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        (void)d-&gt;m_currentDev-&gt;write( 0, 0 );</td><td> </td><td class="rblock">               (void)d-&gt;m_currentDev-&gt;write( 0, 0 );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        delete d-&gt;m_currentDev;</td><td> </td><td class="rblock">               delete d-&gt;m_currentDev;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // If 0, d-&gt;m_currentDev was device() - don't delete ;)</td><td> </td><td class="rblock">       // If 0, d-&gt;m_currentDev was device() - don't delete ;)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentDev = 0L;</td><td> </td><td class="rblock">       d-&gt;m_currentDev = 0L;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( d-&gt;m_currentFile );</td><td> </td><td class="rblock">       Q_ASSERT( d-&gt;m_currentFile );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "fileName: " &lt;&lt; d-&gt;m_currentFile-&gt;path();</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "fileName: " &lt;&lt; d-&gt;m_currentFile-&gt;path();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "getpos (at): " &lt;&lt; device()-&gt;pos();</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "getpos (at): " &lt;&lt; device()-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentFile-&gt;setSize(size);</td><td> </td><td class="rblock">       d-&gt;m_currentFile-&gt;setSize(size);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int extra_field_len = 0;</td><td> </td><td class="rblock">       int extra_field_len = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( d-&gt;m_extraField == ModificationTime )</td><td> </td><td class="rblock">       if ( d-&gt;m_extraField == ModificationTime )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        extra_field_len = 17;  // value also used in <span class="delete">finishWriting()</span></td><td> </td><td class="rblock">               extra_field_len = 17;   // value also used in <span class="insert">finishWriting(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0089" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int csize = device()-&gt;pos() -</td><td> </td><td class="rblock">       int csize = device()-&gt;pos() -</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        d-&gt;m_currentFile-&gt;headerStart() - 30 -</td><td> </td><td class="rblock">               d-&gt;m_currentFile-&gt;headerStart() - 30 -</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               d-&gt;m_currentFile-&gt;path().length() - extra_field_len;</td><td> </td><td class="right">               d-&gt;m_currentFile-&gt;path().length() - extra_field_len;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0090" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentFile-&gt;setCompressedSize(csize);</td><td> </td><td class="rblock">       d-&gt;m_currentFile-&gt;setCompressedSize(csize);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "usize: " &lt;&lt; d-&gt;m_currentFile-&gt;size();</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "usize: " &lt;&lt; d-&gt;m_currentFile-&gt;size();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "csize: " &lt;&lt; d-&gt;m_currentFile-&gt;compressedSize();</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "csize: " &lt;&lt; d-&gt;m_currentFile-&gt;compressedSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "headerstart: " &lt;&lt; d-&gt;m_currentFile-&gt;headerStart();</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "headerstart: " &lt;&lt; d-&gt;m_currentFile-&gt;headerStart();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "crc: " &lt;&lt; d-&gt;m_crc;</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "crc: " &lt;&lt; d-&gt;m_crc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentFile-&gt;setCRC32( d-&gt;m_crc );</td><td> </td><td class="rblock">       d-&gt;m_currentFile-&gt;setCRC32( d-&gt;m_crc );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_currentFile = 0L;</td><td> </td><td class="rblock">       d-&gt;m_currentFile = 0L;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // update saved offset for appending new files</td><td> </td><td class="rblock">       // update saved offset for appending new files</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_offset = device()-&gt;pos();</td><td> </td><td class="rblock">       d-&gt;m_offset = device()-&gt;pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return true;</td><td> </td><td class="rblock">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::doWriteSymLink(const QString &amp;name, const QString &amp;target,</td><td> </td><td class="right">bool KZip::doWriteSymLink(const QString &amp;name, const QString &amp;target,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0091" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                          const QString &amp;user, const QString &amp;group,</td><td> </td><td class="rblock">                                                 const QString &amp;user, const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                          mode_t perm, time_t atime, time_t mtime, time_t <span class="delete">c</span></td><td> </td><td class="rblock"> QString &amp;group,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">time)</span> {</td><td> </td><td class="rblock">                                                 mode_t perm, time_t atime,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"> time_t mtime, time_t <span class="insert">ctime)</span> {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // reassure that symlink flag is set, otherwise strange things happen on</td><td> </td><td class="right">  // reassure that symlink flag is set, otherwise strange things happen on</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  // extraction</td><td> </td><td class="right">  // extraction</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  perm |= S_IFLNK;</td><td> </td><td class="right">  perm |= S_IFLNK;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  Compression c = compression();</td><td> </td><td class="right">  Compression c = compression();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  setCompression(NoCompression);       // link targets are never compressed</td><td> </td><td class="right">  setCompression(NoCompression);       // link targets are never compressed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (!doPrepareWriting(name, user, group, 0, perm, atime, mtime, ctime)) {</td><td> </td><td class="right">  if (!doPrepareWriting(name, user, group, 0, perm, atime, mtime, ctime)) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0092" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qWarning() &lt;&lt; "prepareWriting failed";</td><td> </td><td class="rblock">       qWarning() &lt;&lt; "prepareWriting failed";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    setCompression(c);</td><td> </td><td class="rblock">       setCompression(c);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return false;</td><td> </td><td class="rblock">       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  QByteArray symlink_target = QFile::encodeName(target);</td><td> </td><td class="right">  QByteArray symlink_target = QFile::encodeName(target);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (!writeData(symlink_target, symlink_target.length())) {</td><td> </td><td class="right">  if (!writeData(symlink_target, symlink_target.length())) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0093" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qWarning() &lt;&lt; "writeData failed";</td><td> </td><td class="rblock">       qWarning() &lt;&lt; "writeData failed";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    setCompression(c);</td><td> </td><td class="rblock">       setCompression(c);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return false;</td><td> </td><td class="rblock">       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  if (!finishWriting(symlink_target.length())) {</td><td> </td><td class="right">  if (!finishWriting(symlink_target.length())) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0094" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qWarning() &lt;&lt; "finishWriting failed";</td><td> </td><td class="rblock">       qWarning() &lt;&lt; "finishWriting failed";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    setCompression(c);</td><td> </td><td class="rblock">       setCompression(c);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return false;</td><td> </td><td class="rblock">       return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  }</td><td> </td><td class="right">  }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  setCompression(c);</td><td> </td><td class="right">  setCompression(c);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return true;</td><td> </td><td class="right">  return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void KZip::virtual_hook( int id, void* data )</td><td> </td><td class="right">void KZip::virtual_hook( int id, void* data )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0095" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KArchive::virtual_hook( id, data );</td><td> </td><td class="rblock">    <span class="insert">   </span>KArchive::virtual_hook( id, data );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool KZip::writeData(const char * data, qint64 size)</td><td> </td><td class="right">bool KZip::writeData(const char * data, qint64 size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0096" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( d-&gt;m_currentFile );</td><td> </td><td class="rblock">       Q_ASSERT( d-&gt;m_currentFile );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Q_ASSERT( d-&gt;m_currentDev );</td><td> </td><td class="rblock">       Q_ASSERT( d-&gt;m_currentDev );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if (!d-&gt;m_currentFile || !d-&gt;m_currentDev) {</td><td> </td><td class="rblock">       if (!d-&gt;m_currentFile || !d-&gt;m_currentDev) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return false;</td><td> </td><td class="rblock">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // crc to be calculated over uncompressed stuff...</td><td> </td><td class="rblock">       // crc to be calculated over uncompressed stuff...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // and they didn't mention it in their docs...</td><td> </td><td class="rblock">       // and they didn't mention it in their docs...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_crc = crc32(d-&gt;m_crc, (const Bytef *) data , size);</td><td> </td><td class="rblock">       d-&gt;m_crc = crc32(d-&gt;m_crc, (const Bytef *) data , size);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qint64 written = d-&gt;m_currentDev-&gt;write( data, size );</td><td> </td><td class="rblock">       qint64 written = d-&gt;m_currentDev-&gt;write( data, size );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "wrote" &lt;&lt; size &lt;&lt; "bytes.";</td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "wrote" &lt;&lt; size &lt;&lt; "bytes.";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return written == size;</td><td> </td><td class="rblock">       return written == size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void KZip::setCompression( Compression c )</td><td> </td><td class="right">void KZip::setCompression( Compression c )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0097" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_compression = ( c == NoCompression ) ? 0 : 8;</td><td> </td><td class="rblock">    <span class="insert">   </span>d-&gt;m_compression = ( c == NoCompression ) ? 0 : 8;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZip::Compression KZip::compression() const</td><td> </td><td class="right">KZip::Compression KZip::compression() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   return ( d-&gt;m_compression == 8 ) ? DeflateCompression : NoCompression;</td><td> </td><td class="right">   return ( d-&gt;m_compression == 8 ) ? DeflateCompression : NoCompression;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void KZip::setExtraField( ExtraField ef )</td><td> </td><td class="right">void KZip::setExtraField( ExtraField ef )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0098" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;m_extraField = ef;</td><td> </td><td class="rblock">    <span class="insert">   </span>d-&gt;m_extraField = ef;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZip::ExtraField KZip::extraField() const</td><td> </td><td class="right">KZip::ExtraField KZip::extraField() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0099" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return d-&gt;m_extraField;</td><td> </td><td class="rblock">    <span class="insert">   </span>return d-&gt;m_extraField;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////////////////////////////////////////////////////////</td><td> </td><td class="right">////////////////////////////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////// KZipFileEntry////////////////////////////////////</td><td> </td><td class="right">////////////////////// KZipFileEntry////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////////////////////////////////////////////////////////</td><td> </td><td class="right">////////////////////////////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">class KZipFileEntry::KZipFileEntryPrivate</td><td> </td><td class="right">class KZipFileEntry::KZipFileEntryPrivate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">public:</td><td> </td><td class="right">public:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0100" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KZipFileEntryPrivate()</td><td> </td><td class="rblock">       KZipFileEntryPrivate()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    : crc(0),</td><td> </td><td class="rblock">       : crc(0),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      compressedSize(0),</td><td> </td><td class="rblock">         compressedSize(0),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      headerStart(0),</td><td> </td><td class="rblock">         headerStart(0),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">      encoding(0)</td><td> </td><td class="rblock">         encoding(0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {}</td><td> </td><td class="rblock">       {}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    unsigned long crc;</td><td> </td><td class="rblock">       unsigned long crc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qint64        compressedSize;</td><td> </td><td class="rblock">       qint64        compressedSize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qint64        headerStart;</td><td> </td><td class="rblock">       qint64        headerStart;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    int           encoding;</td><td> </td><td class="rblock">       int           encoding;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QString       path;</td><td> </td><td class="rblock">       QString       path;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZipFileEntry::KZipFileEntry(KZip* zip, const QString&amp; name, int access, in
t date,</td><td> </td><td class="right">KZipFileEntry::KZipFileEntry(KZip* zip, const QString&amp; name, int access, in
t date,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0101" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                             const QString&amp; <span class="delete">user,</span> const QString&amp; group, <span class="delete">con</span></td><td> </td><td class="rblock">                                                        const QString&amp; <span class="insert">user</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">st</span> QString&amp; symlink,</td><td> </td><td class="rblock"><span class="insert">,</span> const QString&amp; group, <span class="insert">const</span> QString&amp; symlink,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                             const QString&amp; <span class="delete">path,</span> qint64 start, qint64 <span class="delete">unco</span></td><td> </td><td class="rblock">                                                        const QString&amp; <span class="insert">path</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">mpressedSize,</span></td><td> </td><td class="rblock"><span class="insert">,</span> qint64 start, qint64 <span class="insert">uncompressedSize,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                             int encoding, <span class="delete">qint64</span> compressedSize)</td><td> </td><td class="rblock">                                                        int encoding, <span class="insert">qint6</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">4</span> compressedSize)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> : KArchiveFile(zip, name, access, date, user, group, symlink, start, uncom
pressedSize ),</td><td> </td><td class="right"> : KArchiveFile(zip, name, access, date, user, group, symlink, start, uncom
pressedSize ),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">   d(new KZipFileEntryPrivate)</td><td> </td><td class="right">   d(new KZipFileEntryPrivate)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0102" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;path = path;</td><td> </td><td class="rblock">       d-&gt;path = path;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;encoding = encoding;</td><td> </td><td class="rblock">       d-&gt;encoding = encoding;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;compressedSize = compressedSize;</td><td> </td><td class="rblock">       d-&gt;compressedSize = compressedSize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">KZipFileEntry::~KZipFileEntry()</td><td> </td><td class="right">KZipFileEntry::~KZipFileEntry()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0103" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    delete d;</td><td> </td><td class="rblock">    <span class="insert">   </span>delete d;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">int KZipFileEntry::encoding() const</td><td> </td><td class="right">int KZipFileEntry::encoding() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0104" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return d-&gt;encoding;</td><td> </td><td class="rblock">    <span class="insert">   </span>return d-&gt;encoding;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">qint64 KZipFileEntry::compressedSize() const</td><td> </td><td class="right">qint64 KZipFileEntry::compressedSize() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0105" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return d-&gt;compressedSize;</td><td> </td><td class="rblock">    <span class="insert">   </span>return d-&gt;compressedSize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void KZipFileEntry::setCompressedSize(qint64 compressedSize)</td><td> </td><td class="right">void KZipFileEntry::setCompressedSize(qint64 compressedSize)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0106" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;compressedSize = compressedSize;</td><td> </td><td class="rblock">    <span class="insert">   </span>d-&gt;compressedSize = compressedSize;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void KZipFileEntry::setHeaderStart(qint64 headerstart)</td><td> </td><td class="right">void KZipFileEntry::setHeaderStart(qint64 headerstart)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0107" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;headerStart = headerstart;</td><td> </td><td class="rblock">    <span class="insert">   </span>d-&gt;headerStart = headerstart;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">qint64 KZipFileEntry::headerStart() const</td><td> </td><td class="right">qint64 KZipFileEntry::headerStart() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0108" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return d-&gt;headerStart;</td><td> </td><td class="rblock">    <span class="insert">   </span>return d-&gt;headerStart;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">unsigned long KZipFileEntry::crc32() const</td><td> </td><td class="right">unsigned long KZipFileEntry::crc32() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0109" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return d-&gt;crc;</td><td> </td><td class="rblock">    <span class="insert">   </span>return d-&gt;crc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void KZipFileEntry::setCRC32(unsigned long crc32)</td><td> </td><td class="right">void KZipFileEntry::setCRC32(unsigned long crc32)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0110" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    d-&gt;crc=crc32;</td><td> </td><td class="rblock">    <span class="insert">   </span>d-&gt;crc=crc32;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">const QString &amp;KZipFileEntry::path() const</td><td> </td><td class="right">const QString &amp;KZipFileEntry::path() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0111" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return d-&gt;path;</td><td> </td><td class="rblock">    <span class="insert">   </span>return d-&gt;path;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QByteArray KZipFileEntry::data() const</td><td> </td><td class="right">QByteArray KZipFileEntry::data() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0112" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QIODevice* dev = createDevice();</td><td> </td><td class="rblock">       QIODevice* dev = createDevice();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    QByteArray arr;</td><td> </td><td class="rblock">       QByteArray arr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( dev ) {</td><td> </td><td class="rblock">       if ( dev ) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        arr = dev-&gt;readAll();</td><td> </td><td class="rblock">               arr = dev-&gt;readAll();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        delete dev;</td><td> </td><td class="rblock">               delete dev;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return arr;</td><td> </td><td class="rblock">       return arr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QIODevice* KZipFileEntry::createDevice() const</td><td> </td><td class="right">QIODevice* KZipFileEntry::createDevice() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0113" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    //qDebug() &lt;&lt; "creating iodevice limited to pos=" &lt;&lt; position() &lt;&lt; <span class="delete">", c</span></td><td> </td><td class="rblock">       //qDebug() &lt;&lt; "creating iodevice limited to pos=" &lt;&lt; position() &lt;&lt; <span class="insert">"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">size="</span> &lt;&lt; compressedSize();</td><td> </td><td class="rblock"><span class="insert">, csize="</span> &lt;&lt; compressedSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // Limit the reading to the appropriate part of the underlying <span class="delete">device (</span></td><td> </td><td class="rblock">       // Limit the reading to the appropriate part of the underlying <span class="insert">devic</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e.g.</span> file)</td><td> </td><td class="rblock"><span class="insert">e (e.g.</span> file)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    KLimitedIODevice* limitedDev = new KLimitedIODevice( <span class="delete">archive()-&gt;device(</span></td><td> </td><td class="rblock">       KLimitedIODevice* limitedDev = new KLimitedIODevice( <span class="insert">archive()-&gt;devi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">),</span> position(), compressedSize() );</td><td> </td><td class="rblock"><span class="insert">ce(),</span> position(), compressedSize() );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( encoding() == 0 || compressedSize() == 0 ) // no compression <span class="delete">(or e</span></td><td> </td><td class="rblock">       if ( encoding() == 0 || compressedSize() == 0 ) // no compression <span class="insert">(o</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ven</span> no data)</td><td> </td><td class="rblock"><span class="insert">r even</span> no data)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return limitedDev;</td><td> </td><td class="rblock">               return limitedDev;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    if ( encoding() == 8 )</td><td> </td><td class="rblock">       if ( encoding() == 8 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        // On top of that, create a device that uncompresses the <span class="delete">zlib</span> data</td><td> </td><td class="rblock">               // On top of that, create a device that uncompresses the <span class="insert">zli</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        QIODevice* filterDev = KFilterDev::device( limitedDev, <span class="delete">"application</span></td><td> </td><td class="rblock"><span class="insert">b</span> data</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">/x-gzip"</span> );</td><td> </td><td class="rblock">               QIODevice* filterDev = KFilterDev::device( limitedDev, <span class="insert">"appl</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        if ( !filterDev )</td><td> </td><td class="rblock"><span class="insert">ication/x-gzip"</span> );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            return 0L; // ouch</td><td> </td><td class="rblock">               if ( !filterDev )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        static_cast&lt;KFilterDev *&gt;(filterDev)-&gt;setSkipHeaders(); // <span class="delete">Just zli</span></td><td> </td><td class="rblock">                       return 0L; // ouch</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">b,</span> not gzip</td><td> </td><td class="rblock">               static_cast&lt;KFilterDev *&gt;(filterDev)-&gt;setSkipHeaders(); // <span class="insert">J</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        bool b = filterDev-&gt;open( QIODevice::ReadOnly );</td><td> </td><td class="rblock"><span class="insert">ust zlib,</span> not gzip</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               bool b = filterDev-&gt;open( QIODevice::ReadOnly );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       b = b; // annoying unused variable warning</td><td> </td><td class="right">       b = b; // annoying unused variable warning</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0114" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        Q_ASSERT( b );</td><td> </td><td class="rblock">               Q_ASSERT( b );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        return filterDev;</td><td> </td><td class="rblock">               return filterDev;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    }</td><td> </td><td class="rblock">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    qWarning() &lt;&lt; "This zip file contains files compressed with method"</td><td> </td><td class="rblock">       qWarning() &lt;&lt; "This zip file contains files compressed with method"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              &lt;&lt; encoding() &lt;&lt; ", this method is currently not <span class="delete">supported</span> by</td><td> </td><td class="rblock">                         &lt;&lt; encoding() &lt;&lt; ", this method is currently not <span class="insert">s</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"> KZip,"</td><td> </td><td class="rblock"><span class="insert">upported</span> by KZip,"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              &lt;&lt; "please use a command-line tool to handle this file.";</td><td> </td><td class="rblock">                         &lt;&lt; "please use a command-line tool to handle this </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    return 0L;</td><td> </td><td class="rblock">file.";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       return 0L;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 114 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>1020 lines changed or deleted</i></th><th><i> </i></th><th><i>1072 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
