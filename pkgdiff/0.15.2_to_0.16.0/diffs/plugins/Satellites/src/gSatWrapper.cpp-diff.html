<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.home 4.4.0-80-generic #101-Ubuntu SMP Thu Jun 8 15:35:06 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.1.3, API: 1.1 (GNU MPFR 3.1.4, GNU MP 6.1.0) --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: gSatWrapper.cpp - gSatWrapper.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;gSatWrapper.cpp&nbsp;</th><th> </th><th>&nbsp;gSatWrapper.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 59</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 59</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Also, the TLE library expects no more than 130 characters length 
input.  We</td><td> </td><td class="right">       // Also, the TLE library expects no more than 130 characters length 
input.  We</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // shouldn't have sane input with a TLE longer than about 80, but ju
st in case</td><td> </td><td class="right">       // shouldn't have sane input with a TLE longer than about 80, but ju
st in case</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // we have a mal-formed input, we will truncate here to be safe</td><td> </td><td class="right">       // we have a mal-formed input, we will truncate here to be safe</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       t1.truncate(130);</td><td> </td><td class="right">       t1.truncate(130);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       t2.truncate(130);</td><td> </td><td class="right">       t2.truncate(130);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pSatellite = new gSatTEME(designation.toLatin1().data(),</td><td> </td><td class="right">       pSatellite = new gSatTEME(designation.toLatin1().data(),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                 t1.data(),</td><td> </td><td class="right">                                 t1.data(),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                 t2.data());</td><td> </td><td class="right">                                 t2.data());</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">updateEpoch(</span>);</td><td> </td><td class="rblock">       <span class="insert">setEpoch(StelApp::getInstance().getCore()-&gt;getJD()</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">gSatWrapper::~gSatWrapper()</td><td> </td><td class="right">gSatWrapper::~gSatWrapper()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (pSatellite != <span class="delete">NULL</span>)</td><td> </td><td class="rblock">       if (pSatellite != <span class="insert">Q_NULLPTR</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete pSatellite;</td><td> </td><td class="right">               delete pSatellite;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3d gSatWrapper::getTEMEPos()</td><td> </td><td class="rblock">Vec3d gSatWrapper::getTEMEPos()<span class="insert"> const</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">        gVector position;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d returnedVector;</td><td> </td><td class="right">       Vec3d returnedVector;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (pSatellite != <span class="delete">NULL</span>)</td><td> </td><td class="rblock">       if (pSatellite != <span class="insert">Q_NULLPTR</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                position = pSatellite-&gt;getPos();</td><td> </td><td class="rblock">               <span class="insert">gVector</span> position = pSatellite-&gt;getPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                returnedVector.set(position[0], position[1], position[2]);</td><td> </td><td class="right">                returnedVector.set(position[0], position[1], position[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; "gSatWrapper::getTEMEPos Method called without
 pSatellite initialized";</td><td> </td><td class="right">               qWarning() &lt;&lt; "gSatWrapper::getTEMEPos Method called without
 pSatellite initialized";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return returnedVector;</td><td> </td><td class="right">       return returnedVector;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3d gSatWrapper::getTEMEVel()</td><td> </td><td class="rblock">Vec3d gSatWrapper::getTEMEVel()<span class="insert"> const</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">        gVector velocity;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d returnedVector;</td><td> </td><td class="right">       Vec3d returnedVector;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (pSatellite != <span class="delete">NULL</span>)</td><td> </td><td class="rblock">       if (pSatellite != <span class="insert">Q_NULLPTR</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                velocity = pSatellite-&gt;getVel();</td><td> </td><td class="rblock">               <span class="insert">gVector</span> velocity = pSatellite-&gt;getVel();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                returnedVector.set(velocity[0], velocity[1], velocity[2]);</td><td> </td><td class="right">                returnedVector.set(velocity[0], velocity[1], velocity[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; "gSatWrapper::getTEMEVel Method called without
 pSatellite initialized";</td><td> </td><td class="right">               qWarning() &lt;&lt; "gSatWrapper::getTEMEVel Method called without
 pSatellite initialized";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return returnedVector;</td><td> </td><td class="right">       return returnedVector;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3d gSatWrapper::getSubPoint()</td><td> </td><td class="rblock">Vec3d gSatWrapper::getSubPoint()<span class="insert"> const</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">        gVector satelliteSubPoint;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d returnedVector;</td><td> </td><td class="right">       Vec3d returnedVector;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (pSatellite != <span class="delete">NULL</span>)</td><td> </td><td class="rblock">       if (pSatellite != <span class="insert">Q_NULLPTR</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                satelliteSubPoint = pSatellite-&gt;getSubPoint();</td><td> </td><td class="rblock">               <span class="insert">gVector</span> satelliteSubPoint = pSatellite-&gt;getSubPoint();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                returnedVector.set(satelliteSubPoint[0], satelliteSubPoint[
1], satelliteSubPoint[2]);</td><td> </td><td class="right">                returnedVector.set(satelliteSubPoint[0], satelliteSubPoint[
1], satelliteSubPoint[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; "gSatWrapper::getTEMEVel Method called without
 pSatellite initialized";</td><td> </td><td class="right">               qWarning() &lt;&lt; "gSatWrapper::getTEMEVel Method called without
 pSatellite initialized";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return returnedVector;</td><td> </td><td class="right">       return returnedVector;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">void gSatWrapper::updateEpoch()</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">{</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       double jul_utc = StelApp::getInstance().getCore()-&gt;getJD();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">        epoch = jul_utc;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       if (pSatellite)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                pSatellite-&gt;setEpoch(epoch);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void gSatWrapper::setEpoch(double ai_julianDaysEpoch)</td><td> </td><td class="right">void gSatWrapper::setEpoch(double ai_julianDaysEpoch)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    epoch = ai_julianDaysEpoch;</td><td> </td><td class="right">    epoch = ai_julianDaysEpoch;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">    if (pSatellite)</td><td> </td><td class="right">    if (pSatellite)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               pSatellite-&gt;setEpoch(<span class="delete">ai_julianDaysE</span>poch);</td><td> </td><td class="rblock">               pSatellite-&gt;setEpoch(<span class="insert">e</span>poch);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void gSatWrapper::calcObserverECIPosition(Vec3d&amp; ao_position, Vec3d&amp; ao_vel
ocity)</td><td> </td><td class="right">void gSatWrapper::calcObserverECIPosition(Vec3d&amp; ao_position, Vec3d&amp; ao_vel
ocity)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       StelLocation loc   = <span class="delete">StelApp::getInstance().getCore()-&gt;getCurrentLoc</span></td><td> </td><td class="rblock">       <span class="insert">if (epoch != lastCalcObserverECIPosition)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ation();</span></td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               StelLocation loc   = <span class="insert">StelApp::getInstance().getCore()-&gt;getCu</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">rrentLocation();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double radLatitude = loc.latitude * KDEG2RAD;</td><td> </td><td class="rblock">               double radLatitude = loc.latitude * KDEG2RAD;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        double theta       = epoch.toThetaLMST(loc.longitude * <span class="delete">KDEG2RAD);</span></td><td> </td><td class="rblock">               double theta       = epoch.toThetaLMST(loc.longitude * <span class="insert">KDEG2</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double r;</td><td> </td><td class="rblock"><span class="insert">RAD);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double c,sq;</td><td> </td><td class="rblock">               double r;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               double c,sq;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* Reference:  Explanatory supplement to the Astronomical <span class="delete">Almanac 19</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">92,</span> page 209-210. */</td><td> </td><td class="rblock">               /* Reference:  Explanatory supplement to the Astronomical <span class="insert">Al</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* Elipsoid earth model*/</td><td> </td><td class="rblock"><span class="insert">manac 1992,</span> page 209-210. */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       /* c = Nlat/a */</td><td> </td><td class="rblock">               /* Elipsoid earth model*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       c = 1/std::sqrt(1 + __f*(__f - 2)*Sqr(sin(radLatitude)));</td><td> </td><td class="rblock">               /* c = Nlat/a */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       sq = Sqr(1 - __f)*c;</td><td> </td><td class="rblock">               c = 1/std::sqrt(1 + __f*(__f - 2)*Sqr(sin(radLatitude)));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">               sq = Sqr(1 - __f)*c;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       r = (KEARTHRADIUS*c + (loc.altitude/1000))*cos(radLatitude);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       ao_position[0] = r * cos(theta);/*kilometers*/</td><td> </td><td class="rblock">               r = (KEARTHRADIUS*c + (loc.altitude/1000))*cos(radLatitude);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       ao_position[1] = r * sin(theta);</td><td> </td><td class="rblock">               ao_position[0] = r * cos(theta);/*kilometers*/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       ao_position[2] = (KEARTHRADIUS*sq + <span class="delete">(loc.altitude/1000))*sin(radLati</span></td><td> </td><td class="rblock">               ao_position[1] = r * sin(theta);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">tude);</span></td><td> </td><td class="rblock">               ao_position[2] = (KEARTHRADIUS*sq + <span class="insert">(loc.altitude/1000))*sin</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        ao_velocity[0] = <span class="delete">-KMFACTOR*ao_position[1];/*kilometers/second*/</span></td><td> </td><td class="rblock"><span class="insert">(radLatitude);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        ao_velocity[1] =  KMFACTOR*ao_position[0];</td><td> </td><td class="rblock">               ao_velocity[0] = <span class="insert">-KMFACTOR*ao_position[1];/*kilometers/secon</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        ao_velocity[2] =  0;</td><td> </td><td class="rblock"><span class="insert">d*/</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               ao_velocity[1] =  KMFACTOR*ao_position[0];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               ao_velocity[2] =  0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">lastCalcObserverECIPosition=epoch;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3d gSatWrapper::getAltAz()</td><td> </td><td class="rblock">Vec3d gSatWrapper::getAltAz()<span class="insert"> const</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                                                           </span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelLocation loc   = StelApp::getInstance().getCore()-&gt;getCurrentLoc
ation();</td><td> </td><td class="right">       StelLocation loc   = StelApp::getInstance().getCore()-&gt;getCurrentLoc
ation();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d topoSatPos;</td><td> </td><td class="right">       Vec3d topoSatPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d observerECIPos;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Vec3d observerECIVel;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double  radLatitude    = loc.latitude * KDEG2RAD;</td><td> </td><td class="rblock">       <span class="insert">const</span> double  radLatitude    = loc.latitude * KDEG2RAD;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        double  theta          = epoch.toThetaLMST(loc.longitude * <span class="delete">KDEG2RAD</span></td><td> </td><td class="rblock">       <span class="insert">const</span> double  theta          = epoch.toThetaLMST(loc.longitude * <span class="insert">KDE</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">);</span></td><td> </td><td class="rblock"><span class="insert">G2RAD);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double sinRadLatitude=sin(radLatitude);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double cosRadLatitude=cos(radLatitude);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double sinTheta=sin(theta);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double cosTheta=cos(theta);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // This now only updates if required.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       calcObserverECIPosition(observerECIPos, observerECIVel);</td><td> </td><td class="right">       calcObserverECIPosition(observerECIPos, observerECIVel);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d satECIPos  = getTEMEPos();</td><td> </td><td class="right">       Vec3d satECIPos  = getTEMEPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d slantRange = satECIPos - observerECIPos;</td><td> </td><td class="right">       Vec3d slantRange = satECIPos - observerECIPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //top_s</td><td> </td><td class="right">       //top_s</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       topoSatPos[0] = <span class="delete">(sin(radLatitude)</span> * <span class="delete">cos(theta)*slantRange[0]</span></td><td> </td><td class="rblock">       topoSatPos[0] = <span class="insert">(sinRadLatitude</span> * <span class="insert">cosTheta*slantRange[0]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        + <span class="delete">sin(radLatitude)* sin(theta)*slantRange[1]</span></td><td> </td><td class="rblock">                        + <span class="insert">sinRadLatitude* sinTheta*slantRange[1]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                         - <span class="delete">cos(radLatitude)*</span> slantRange[2]);</td><td> </td><td class="rblock">                        - <span class="insert">cosRadLatitude*</span> slantRange[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //top_e</td><td> </td><td class="right">       //top_e</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       topoSatPos[1] = ((-1.0)* <span class="delete">sin(theta)*slantRange[0]</span></td><td> </td><td class="rblock">       topoSatPos[1] = ((-1.0)* <span class="insert">sinTheta*slantRange[0]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                         + <span class="delete">cos(theta)*slantRange[1]);</span></td><td> </td><td class="rblock">                        + <span class="insert">cosTheta*slantRange[1]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //top_z</td><td> </td><td class="right">       //top_z</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       topoSatPos[2] = <span class="delete">(cos(radLatitude)</span> * <span class="delete">cos(theta)*slantRange[0]</span></td><td> </td><td class="rblock">       topoSatPos[2] = <span class="insert">(cosRadLatitude</span> * <span class="insert">cosTheta*slantRange[0]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        + <span class="delete">cos(radLatitude)</span> * <span class="delete">sin(theta)*slantRange[1]</span></td><td> </td><td class="rblock">                        + <span class="insert">cosRadLatitude</span> * <span class="insert">sinTheta*slantRange[1]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                         + <span class="delete">sin(radLatitude)</span> *slantRange[2]);</td><td> </td><td class="rblock">                        + <span class="insert">sinRadLatitude</span> *slantRange[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return topoSatPos;</td><td> </td><td class="right">       return topoSatPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void  gSatWrapper::getSlantRange(double &amp;ao_slantRange, double &amp;ao_slantRan
geRate)</td><td> </td><td class="rblock">void  gSatWrapper::getSlantRange(double &amp;ao_slantRange, double &amp;ao_slantRan
geRate)<span class="insert"> const</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       <span class="insert">//Vec3d</span> observerECIPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d</span> observerECIPos;</td><td> </td><td class="rblock">       <span class="insert">//Vec3d</span> observerECIVel;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d</span> observerECIVel;</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       calcObserverECIPosition(observerECIPos, observerECIVel);</td><td> </td><td class="right">       calcObserverECIPosition(observerECIPos, observerECIVel);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        Vec3d satECIPos            = getTEMEPos();</td><td> </td><td class="right">        Vec3d satECIPos            = getTEMEPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        Vec3d satECIVel            = getTEMEVel();</td><td> </td><td class="right">        Vec3d satECIVel            = getTEMEVel();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        Vec3d slantRange           = satECIPos - observerECIPos;</td><td> </td><td class="right">        Vec3d slantRange           = satECIPos - observerECIPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        Vec3d slantRangeVelocity   = satECIVel - observerECIVel;</td><td> </td><td class="right">        Vec3d slantRangeVelocity   = satECIVel - observerECIVel;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ao_slantRange     = slantRange.length();</td><td> </td><td class="right">       ao_slantRange     = slantRange.length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        ao_slantRangeRate = slantRange.dot(slantRangeVelocity)/ao_slantRang
e;</td><td> </td><td class="right">        ao_slantRangeRate = slantRange.dot(slantRangeVelocity)/ao_slantRang
e;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">Vec3d gSatWrapper::getSunECIPos()</span></td><td> </td><td class="rblock"><span class="insert">// Does the actual computation only if necessary (0.1s apart) and caches th</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">e result in a static variable.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">void gSatWrapper::updateSunECIPos()</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // All positions in ECI system are positions referenced in a StelCor
e::EquinoxEq system centered in the earth centre</td><td> </td><td class="right">       // All positions in ECI system are positions referenced in a StelCor
e::EquinoxEq system centered in the earth centre</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d</span> observerECIPos;</td><td> </td><td class="rblock">       <span class="insert">//Vec3d</span> observerECIPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d</span> observerECIVel;</td><td> </td><td class="rblock">       <span class="insert">//Vec3d</span> observerECIVel;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">Vec3d sunECIPos;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Vec3d sunEquinoxEqPos;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       calcObserverECIPosition(observerECIPos, observerECIVel);</td><td> </td><td class="right">       calcObserverECIPosition(observerECIPos, observerECIVel);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       SolarSystem *solsystem = <span class="delete">(SolarSystem*)StelApp::getInstance().getMod</span></td><td> </td><td class="rblock">       <span class="insert">static const</span> SolarSystem *solsystem = <span class="insert">(SolarSystem*)StelApp::getInst</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">uleMgr().getModule("SolarSystem");</span></td><td> </td><td class="rblock"><span class="insert">ance().getModuleMgr().getModule("SolarSystem");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       sunEquinoxEqPos        = <span class="delete">solsystem-&gt;getSun()-&gt;getEquinoxEquatorialPo</span></td><td> </td><td class="rblock"><span class="insert">       Vec3d</span> sunEquinoxEqPos = <span class="insert">solsystem-&gt;getSun()-&gt;getEquinoxEquatorialPos</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">s(StelApp::getInstance().getCore());</span></td><td> </td><td class="rblock"><span class="insert">(StelApp::getInstance().getCore());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       //sunEquinoxEqPos is measured in AU. we need <span class="delete">meassure</span> it in Km</td><td> </td><td class="rblock">       //sunEquinoxEqPos is measured in AU. we need <span class="insert">measure</span> it in Km</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">//Vec3d sunECIPos;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sunECIPos.set(sunEquinoxEqPos[0]*AU, sunEquinoxEqPos[1]*AU, sunEquin
oxEqPos[2]*AU);</td><td> </td><td class="right">       sunECIPos.set(sunEquinoxEqPos[0]*AU, sunEquinoxEqPos[1]*AU, sunEquin
oxEqPos[2]*AU);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sunECIPos = sunECIPos + observerECIPos; //Change ref system centre</td><td> </td><td class="right">       sunECIPos = sunECIPos + observerECIPos; //Change ref system centre</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Vec3d gSatWrapper::getSunECIPos()</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">{</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       if (epoch != lastSunECIepoch)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               updateSunECIPos();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               lastSunECIepoch=epoch;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return sunECIPos;</td><td> </td><td class="right">       return sunECIPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Operation getVisibilityPredict</td><td> </td><td class="right">// Operation getVisibilityPredict</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">// @brief This operation predicts the satellite visibility <span class="delete">contidions.</span></td><td> </td><td class="rblock">// @brief This operation predicts the satellite visibility <span class="insert">conditions.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">int</span> gSatWrapper::getVisibilityPredict()</td><td> </td><td class="rblock"><span class="insert">gSatWrapper::Visibility</span> gSatWrapper::getVisibilityPredict()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Vec3d <span class="delete">satECIPos;</span></td><td> </td><td class="rblock">       Vec3d satAltAzPos = getAltAz();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Vec3d satAltAzPos;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Vec3d sunECIPos;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Vec3d sunAltAzPos;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       double sunSatAngle, Dist;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       int   visibility;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       satAltAzPos = getAltAz();</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (satAltAzPos[2] &gt; 0)</td><td> </td><td class="right">       if (satAltAzPos[2] &gt; 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               satECIPos = getTEMEPos();</td><td> </td><td class="rblock">               <span class="insert">Vec3d</span> satECIPos = getTEMEPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               SolarSystem *solsystem = <span class="delete">(SolarSystem*)StelApp::getInstance(</span></td><td> </td><td class="rblock">               <span class="insert">static const</span> SolarSystem *solsystem = <span class="insert">(SolarSystem*)StelApp:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">).getModuleMgr().getModule("SolarSystem");</span></td><td> </td><td class="rblock"><span class="insert">:getInstance().getModuleMgr().getModule("SolarSystem");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               sunAltAzPos        = <span class="delete">solsystem-&gt;getSun()-&gt;getAltAzPosGeometr</span></td><td> </td><td class="rblock"><span class="insert">               Vec3d</span> sunAltAzPos = <span class="insert">solsystem-&gt;getSun()-&gt;getAltAzPosGeometri</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ic(StelApp::getInstance().getCore());</span></td><td> </td><td class="rblock"><span class="insert">c(StelApp::getInstance().getCore());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">               Vec3d</span> sunECIPos = getSunECIPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               sunECIPos = getSunECIPos();</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (sunAltAzPos[2] &gt; 0.0)</td><td> </td><td class="right">               if (sunAltAzPos[2] &gt; 0.0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">visibility =</span> RADAR_SUN;</td><td> </td><td class="rblock">                       <span class="insert">return</span> RADAR_SUN;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       sunSatAngle = sunECIPos.angle(satECIPos);</td><td> </td><td class="rblock">                       <span class="insert">double</span> sunSatAngle = sunECIPos.angle(satECIPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       Dist = satECIPos.length()*cos(sunSatAngle - <span class="delete">(M_PI/2)</span></td><td> </td><td class="rblock">                       <span class="insert">double</span> Dist = satECIPos.length()*cos(sunSatAngle - <span class="insert">(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">);</span></td><td> </td><td class="rblock"><span class="insert">M_PI/2));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (Dist &gt; KEARTHRADIUS)</td><td> </td><td class="right">                       if (Dist &gt; KEARTHRADIUS)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">visibility =</span> VISIBLE;</td><td> </td><td class="rblock">                               <span class="insert">return</span> VISIBLE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else</td><td> </td><td class="right">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">visibility =</span> RADAR_NIGHT;</td><td> </td><td class="rblock">                               <span class="insert">return</span> RADAR_NIGHT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">visibility = NOT_VISIBLE;</span></td><td> </td><td class="rblock">               return <span class="insert">NOT_VISIBLE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       return visibility; //TODO: put correct</span> return</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double gSatWrapper::getPhaseAngle()</td><td> </td><td class="rblock">double gSatWrapper::getPhaseAngle()<span class="insert"> const</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d sunECIPos = getSunECIPos();</td><td> </td><td class="right">       Vec3d sunECIPos = getSunECIPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return sunECIPos.angle(getTEMEPos());</td><td> </td><td class="right">       return sunECIPos.angle(getTEMEPos());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">gTime gSatWrapper::epoch;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">gTime gSatWrapper::lastSunECIepoch=0.0; // store last time of computation t</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">o avoid all-1 computations.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">gTime gSatWrapper::lastCalcObserverECIPosition;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Vec3d gSatWrapper::sunECIPos; // enough to have this once.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Vec3d gSatWrapper::observerECIPos;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Vec3d gSatWrapper::observerECIVel;</span></td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 43 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>105 lines changed or deleted</i></th><th><i> </i></th><th><i>98 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
