<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.home 4.4.0-80-generic #101-Ubuntu SMP Thu Jun 8 15:35:06 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.1.3, API: 1.1 (GNU MPFR 3.1.4, GNU MP 6.1.0) --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.2 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Comet.cpp - Comet.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Comet.cpp&nbsp;</th><th> </th><th>&nbsp;Comet.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 54</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 54</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// These are to avoid having index arrays for each comet when all are equal
.</td><td> </td><td class="right">// These are to avoid having index arrays for each comet when all are equal
.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool Comet::createTailIndices=true;</td><td> </td><td class="right">bool Comet::createTailIndices=true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool Comet::createTailTextureCoords=true;</td><td> </td><td class="right">bool Comet::createTailTextureCoords=true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelTextureSP Comet::comaTexture;</td><td> </td><td class="right">StelTextureSP Comet::comaTexture;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelTextureSP Comet::tailTexture;</td><td> </td><td class="right">StelTextureSP Comet::tailTexture;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QVector&lt;float&gt; Comet::tailTexCoordArr; // computed only once for all Comets
.</td><td> </td><td class="right">QVector&lt;float&gt; Comet::tailTexCoordArr; // computed only once for all Comets
.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QVector&lt;unsigned short&gt; Comet::tailIndices; // computed only once for all C
omets.</td><td> </td><td class="right">QVector&lt;unsigned short&gt; Comet::tailIndices; // computed only once for all C
omets.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Comet::Comet(const QString&amp; englishName,</td><td> </td><td class="right">Comet::Comet(const QString&amp; englishName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">            int flagLighting,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            double radius,</td><td> </td><td class="right">            double radius,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            double oblateness,</td><td> </td><td class="right">            double oblateness,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            Vec3f halocolor,</td><td> </td><td class="right">            Vec3f halocolor,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            float albedo,</td><td> </td><td class="right">            float albedo,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">            <span class="insert">float roughness,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">            float outgas_intensity,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">            float outgas_falloff,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            const QString&amp; atexMapName,</td><td> </td><td class="right">            const QString&amp; atexMapName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">            const QString&amp; aobjModelName,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            posFuncType coordFunc,</td><td> </td><td class="right">            posFuncType coordFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            void* <span class="delete">auserData</span>Ptr,</td><td> </td><td class="rblock">            void* <span class="insert">orbit</span>Ptr,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            OsculatingFunctType *osculatingFunc,</td><td> </td><td class="right">            OsculatingFunctType *osculatingFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            bool acloseOrbit,</td><td> </td><td class="right">            bool acloseOrbit,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            bool hidden,</td><td> </td><td class="right">            bool hidden,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            const QString&amp; pTypeStr,</td><td> </td><td class="right">            const QString&amp; pTypeStr,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            float dustTailWidthFact,</td><td> </td><td class="right">            float dustTailWidthFact,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            float dustTailLengthFact,</td><td> </td><td class="right">            float dustTailLengthFact,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">            float dustTailBrightnessFact)</td><td> </td><td class="right">            float dustTailBrightnessFact)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       : Planet (englishName,</td><td> </td><td class="right">       : Planet (englishName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                 flagLighting,</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 radius,</td><td> </td><td class="right">                 radius,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 oblateness,</td><td> </td><td class="right">                 oblateness,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 halocolor,</td><td> </td><td class="right">                 halocolor,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 albedo,</td><td> </td><td class="right">                 albedo,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                 roughness,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 atexMapName,</td><td> </td><td class="right">                 atexMapName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                 "",</td><td> </td><td class="rblock">                 "", <span class="insert">// no normalmap.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                 aobjModelName,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 coordFunc,</td><td> </td><td class="right">                 coordFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                 <span class="delete">auserData</span>Ptr,</td><td> </td><td class="rblock">                 <span class="insert">orbit</span>Ptr,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 osculatingFunc,</td><td> </td><td class="right">                 osculatingFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 acloseOrbit,</td><td> </td><td class="right">                 acloseOrbit,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 hidden,</td><td> </td><td class="right">                 hidden,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 false, //No atmosphere</td><td> </td><td class="right">                 false, //No atmosphere</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 true, //halo</td><td> </td><td class="right">                 true, //halo</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                 pTypeStr),</td><td> </td><td class="right">                 pTypeStr),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         <span class="delete">absoluteMagnitude(0.),</span></td><td> </td><td class="rblock">         <span class="insert">slopeParameter(-1.f),</span> //== uninitialized: used in getVMagnitude()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">         slopeParameter(-1.),</span> //== uninitialized: used in getVMagnitude()</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         semiMajorAxis(0.),</td><td> </td><td class="right">         semiMajorAxis(0.),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         isCometFragment(false),</td><td> </td><td class="right">         isCometFragment(false),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         nameIsProvisionalDesignation(false),</td><td> </td><td class="right">         nameIsProvisionalDesignation(false),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         tailFactors(-1., -1.), // mark "invalid"</td><td> </td><td class="right">         tailFactors(-1., -1.), // mark "invalid"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         tailActive(false),</td><td> </td><td class="right">         tailActive(false),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         tailBright(false),</td><td> </td><td class="right">         tailBright(false),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         deltaJDEtail(15.0*StelCore::JD_MINUTE), // update tail geometry ev
ery 15 minutes only</td><td> </td><td class="right">         deltaJDEtail(15.0*StelCore::JD_MINUTE), // update tail geometry ev
ery 15 minutes only</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         lastJDEtail(0.0),</td><td> </td><td class="right">         lastJDEtail(0.0),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         dustTailWidthFactor(dustTailWidthFact),</td><td> </td><td class="right">         dustTailWidthFactor(dustTailWidthFact),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         dustTailLengthFactor(dustTailLengthFact),</td><td> </td><td class="right">         dustTailLengthFactor(dustTailLengthFact),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         <span class="delete">dustTailBrightnessFactor(dustTailBrightnessFact)</span></td><td> </td><td class="rblock">         <span class="insert">dustTailBrightnessFactor(dustTailBrightnessFact),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         intensityFovScale(1.0f),</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         intensityMinFov(0.001f), // when zooming in further, Coma is no lo</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">nger visible.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">         intensityMaxFov(0.010f) // when zooming out further, MilkyComa is </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">fully visible (when enabled).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">eclipticPos=Vec3d(0.,0.,0.);</span></td><td> </td><td class="rblock">       <span class="insert">this-&gt;outgas_intensity =outgas_intensity;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       rotLocalToParent = Mat4d::identity();</span></td><td> </td><td class="rblock"><span class="insert">       this-&gt;outgas_falloff   =outgas_falloff;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       texMap = StelApp::getInstance().getTextureManager().createTextureThr</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ead(StelFileMgr::getInstallationDir()+"/textures/"+texMapName, StelTexture:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">:StelTextureParams(true, GL_LINEAR, GL_REPEAT));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       gastailVertexArr.clear();</td><td> </td><td class="right">       gastailVertexArr.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       dusttailVertexArr.clear();</td><td> </td><td class="right">       dusttailVertexArr.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       comaVertexArr.clear();</td><td> </td><td class="right">       comaVertexArr.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       gastailColorArr.clear();</td><td> </td><td class="right">       gastailColorArr.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       dusttailColorArr.clear();</td><td> </td><td class="right">       dusttailColorArr.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //TODO: Name processing?</td><td> </td><td class="right">       //TODO: Name processing?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Comet::~Comet()</td><td> </td><td class="right">Comet::~Comet()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Comet::setAbsoluteMagnitudeAndSlope(const <span class="delete">double magnitude, const doub
le</span> slope)</td><td> </td><td class="rblock">void Comet::setAbsoluteMagnitudeAndSlope(const <span class="insert">float magnitude, const float
</span> slope)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (slope &lt; 0 || slope &gt; 20.0)</td><td> </td><td class="right">       if (slope &lt; 0 || slope &gt; 20.0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qDebug() &lt;&lt; "Comet::setAbsoluteMagnitudeAndSlope(): Invalid 
slope parameter value (must be between 0 and 20)";</td><td> </td><td class="right">               qDebug() &lt;&lt; "Comet::setAbsoluteMagnitudeAndSlope(): Invalid 
slope parameter value (must be between 0 and 20)";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //TODO: More checks?</td><td> </td><td class="right">       //TODO: More checks?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //TODO: Make it set-once like the number?</td><td> </td><td class="right">       //TODO: Make it set-once like the number?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 238</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 242</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double siderealPeriod = getSiderealPeriod();</td><td> </td><td class="right">               double siderealPeriod = getSiderealPeriod();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (siderealPeriod&gt;0)</td><td> </td><td class="right">               if (siderealPeriod&gt;0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // TRANSLATORS: Sidereal (orbital) period for comets
 in Julian years (symbol: a)</td><td> </td><td class="right">                       // TRANSLATORS: Sidereal (orbital) period for comets
 in Julian years (symbol: a)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; q_("Sidereal period: %1 a").arg(QString::numb
er(siderealPeriod/365.25, 'f', 3)) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                       oss &lt;&lt; q_("Sidereal period: %1 a").arg(QString::numb
er(siderealPeriod/365.25, 'f', 3)) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // GZ: Add speed. I don't know where else to place that bit 
of information.</td><td> </td><td class="right">               // GZ: Add speed. I don't know where else to place that bit 
of information.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // xgettext:no-c-format</td><td> </td><td class="right">               // xgettext:no-c-format</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; QString(q_("Speed: %1 km/s"))</td><td> </td><td class="right">               oss &lt;&lt; QString(q_("Speed: %1 km/s"))</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                          .arg(((CometOrbit*)<span class="delete">userDataPtr)-&gt;getVelocity().le
ngt</span>h()*AU/86400.0, 0, 'f', 3);</td><td> </td><td class="rblock">                          .arg(((CometOrbit*)<span class="insert">orbitPtr)-&gt;getVelocity().lengt
</span>h()*AU/86400.0, 0, 'f', 3);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">               oss &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const Vec3d&amp; observerHelioPos = core-&gt;getObserverHeliocentri
cEclipticPos();</td><td> </td><td class="right">               const Vec3d&amp; observerHelioPos = core-&gt;getObserverHeliocentri
cEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const double elongation = getElongation(observerHelioPos);</td><td> </td><td class="right">               const double elongation = getElongation(observerHelioPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (withDecimalDegree)</td><td> </td><td class="right">               if (withDecimalDegree)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString(q_("Phase Angle: %1")).arg(StelUtils:
:radToDecDegStr(getPhaseAngle(observerHelioPos),4,false,true)) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                       oss &lt;&lt; QString(q_("Phase Angle: %1")).arg(StelUtils:
:radToDecDegStr(getPhaseAngle(observerHelioPos),4,false,true)) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString(q_("Elongation: %1")).arg(StelUtils::
radToDecDegStr(elongation,4,false,true)) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                       oss &lt;&lt; QString(q_("Elongation: %1")).arg(StelUtils::
radToDecDegStr(elongation,4,false,true)) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 276</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 280</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">               oss &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       postProcessInfoString(str, flags);</td><td> </td><td class="right">       postProcessInfoString(str, flags);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return str;</td><td> </td><td class="right">       return str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QVariantMap Comet::getInfoMap(const StelCore *core) const</td><td> </td><td class="right">QVariantMap Comet::getInfoMap(const StelCore *core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       QVariantMap map = <span class="delete">StelObjec</span>t::getInfoMap(core);</td><td> </td><td class="rblock">       QVariantMap map = <span class="insert">Plane</span>t::getInfoMap(core);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       map.insert("tail-length-km", tailFactors[1]*AU);</td><td> </td><td class="right">       map.insert("tail-length-km", tailFactors[1]*AU);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       map.insert("coma-diameter-km", tailFactors[0]*AU);</td><td> </td><td class="right">       map.insert("coma-diameter-km", tailFactors[0]*AU);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return map;</td><td> </td><td class="right">       return map;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Comet::setSemiMajorAxis(const double value)</td><td> </td><td class="right">void Comet::setSemiMajorAxis(const double value)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       semiMajorAxis = value;</td><td> </td><td class="right">       semiMajorAxis = value;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 328</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 332</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // with kappa typically 5..15. MPC provides Slope parameter. So we s
hould expect to have slopeParameter (a word only used for minor planets!) f
or our comets 2..6</td><td> </td><td class="right">       // with kappa typically 5..15. MPC provides Slope parameter. So we s
hould expect to have slopeParameter (a word only used for minor planets!) f
or our comets 2..6</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double apparentMagnitude = absoluteMagnitude + 5 * std::log10(observ
erCometDistance) + 2.5 * slopeParameter * std::log10(cometSunDistance);</td><td> </td><td class="right">       double apparentMagnitude = absoluteMagnitude + 5 * std::log10(observ
erCometDistance) + 2.5 * slopeParameter * std::log10(cometSunDistance);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return apparentMagnitude;</td><td> </td><td class="right">       return apparentMagnitude;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Comet::update(int deltaTime)</td><td> </td><td class="right">void Comet::update(int deltaTime)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Planet::update(deltaTime);</td><td> </td><td class="right">       Planet::update(deltaTime);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">//calculate FOV fade value, linear fade between intensityMaxFov and </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">intensityMinFov</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double vfov = StelApp::getInstance().getCore()-&gt;getMovementMgr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">()-&gt;getCurrentFov();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       intensityFovScale = qBound(0.25,(vfov - intensityMinFov) / (intensit</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">yMaxFov - intensityMinFov),1.0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // The rest deals with updating tail geometries and brightness</td><td> </td><td class="right">       // The rest deals with updating tail geometries and brightness</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelCore* core=StelApp::getInstance().getCore();</td><td> </td><td class="right">       StelCore* core=StelApp::getInstance().getCore();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double dateJDE=core-&gt;getJDE();</td><td> </td><td class="right">       double dateJDE=core-&gt;getJDE();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // The CometOrbit is in fact available in userDataPtr!</td><td> </td><td class="right">       // The CometOrbit is in fact available in userDataPtr!</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       CometOrbit* orbit=(CometOrbit*)<span class="delete">userData</span>Ptr;</td><td> </td><td class="rblock">       CometOrbit* orbit=(CometOrbit*)<span class="insert">orbit</span>Ptr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(orbit);</td><td> </td><td class="right">       Q_ASSERT(orbit);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!orbit-&gt;objectDateValid(dateJDE)) return; // don't do anything i
f out of useful date range. This allows having hundreds of comet elements.</td><td> </td><td class="right">       if (!orbit-&gt;objectDateValid(dateJDE)) return; // don't do anything i
f out of useful date range. This allows having hundreds of comet elements.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //GZ: I think we can make deltaJDtail adaptive, depending on distanc
e to sun! For some reason though, this leads to a crash!</td><td> </td><td class="right">       //GZ: I think we can make deltaJDtail adaptive, depending on distanc
e to sun! For some reason though, this leads to a crash!</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       //deltaJDtail=StelCore::JD_SECOND * q<span class="delete">Max(1.0, qMin(eclipticPos.lengt
h(), 20.0)</span>);</td><td> </td><td class="rblock">       //deltaJDtail=StelCore::JD_SECOND * q<span class="insert">Bound(1.0, eclipticPos.length()
, 20.0</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (fabs(lastJDEtail-dateJDE)&gt;deltaJDEtail)</td><td> </td><td class="right">       if (fabs(lastJDEtail-dateJDE)&gt;deltaJDEtail)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastJDEtail=dateJDE;</td><td> </td><td class="right">               lastJDEtail=dateJDE;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // The CometOrbit is in fact available in userDataPtr!</td><td> </td><td class="right">               // The CometOrbit is in fact available in userDataPtr!</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               CometOrbit* orbit=(CometOrbit*)<span class="delete">userData</span>Ptr;</td><td> </td><td class="rblock">               CometOrbit* orbit=(CometOrbit*)<span class="insert">orbit</span>Ptr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Q_ASSERT(orbit);</td><td> </td><td class="right">               Q_ASSERT(orbit);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (!orbit-&gt;objectDateValid(dateJDE)) return; // out of usef
ul date range. This should allow having hundreds of comet elements.</td><td> </td><td class="right">               if (!orbit-&gt;objectDateValid(dateJDE)) return; // out of usef
ul date range. This should allow having hundreds of comet elements.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (orbit-&gt;getUpdateTails()){</td><td> </td><td class="right">               if (orbit-&gt;getUpdateTails()){</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Compute lengths and orientations from orbit objec
t, but only if required.</td><td> </td><td class="right">                       // Compute lengths and orientations from orbit objec
t, but only if required.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       tailFactors=getComaDiameterAndTailLengthAU();</td><td> </td><td class="right">                       tailFactors=getComaDiameterAndTailLengthAU();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Note that we use a diameter larger than what the 
formula returns. A scale factor of 1.2 is ad-hoc/empirical (GZ), but may lo
ok better.</td><td> </td><td class="right">                       // Note that we use a diameter larger than what the 
formula returns. A scale factor of 1.2 is ad-hoc/empirical (GZ), but may lo
ok better.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       computeComa(1.0f*tailFactors[0]); // TBD: APPARENTLY
 NO SCALING? REMOVE 1.0 and note above.</td><td> </td><td class="right">                       computeComa(1.0f*tailFactors[0]); // TBD: APPARENTLY
 NO SCALING? REMOVE 1.0 and note above.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 401</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 409</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       orbit-&gt;setUpdateTails(false); // don't update until 
position has been recalculated elsewhere</td><td> </td><td class="right">                       orbit-&gt;setUpdateTails(false); // don't update until 
position has been recalculated elsewhere</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // And also update magnitude and tail brightness/extinction here.</td><td> </td><td class="right">       // And also update magnitude and tail brightness/extinction here.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const bool withAtmosphere=(core-&gt;getSkyDrawer()-&gt;getFlagHasAtmospher
e());</td><td> </td><td class="right">       const bool withAtmosphere=(core-&gt;getSkyDrawer()-&gt;getFlagHasAtmospher
e());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelToneReproducer* eye = core-&gt;getToneReproducer();</td><td> </td><td class="right">       StelToneReproducer* eye = core-&gt;getToneReproducer();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       float lum = core-&gt;getSkyDrawer()-&gt;surface<span class="delete">b</span>rightnessToLuminance(getVM
agnitude(core)+13.0f); // How to calibrate?</td><td> </td><td class="rblock">       float lum = core-&gt;getSkyDrawer()-&gt;surface<span class="insert">B</span>rightnessToLuminance(getVM
agnitude(core)+13.0f); // How to calibrate?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Get the luminance scaled between 0 and 1</td><td> </td><td class="right">       // Get the luminance scaled between 0 and 1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float aLum =eye-&gt;adaptLuminanceScaled(lum);</td><td> </td><td class="right">       float aLum =eye-&gt;adaptLuminanceScaled(lum);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // To make comet more apparent in overviews, take field of view into
 account:</td><td> </td><td class="right">       // To make comet more apparent in overviews, take field of view into
 account:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const float fov=core-&gt;getProjection(core-&gt;getAltAzModelViewTransform
())-&gt;getFov();</td><td> </td><td class="right">       const float fov=core-&gt;getProjection(core-&gt;getAltAzModelViewTransform
())-&gt;getFov();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (fov&gt;20)</td><td> </td><td class="right">       if (fov&gt;20)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               aLum*= (fov/20.0f);</td><td> </td><td class="right">               aLum*= (fov/20.0f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Now inhibit tail drawing if still too dim.</td><td> </td><td class="right">       // Now inhibit tail drawing if still too dim.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (aLum&lt;0.002f)</td><td> </td><td class="right">       if (aLum&lt;0.002f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 449</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 457</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               dusttailColorArr.clear();</td><td> </td><td class="right">               dusttailColorArr.clear();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               for (int i=0; i&lt;gastailVertexArr.size(); ++i)</td><td> </td><td class="right">               for (int i=0; i&lt;gastailVertexArr.size(); ++i)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Gastail extinction:</td><td> </td><td class="right">                       // Gastail extinction:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Vec3d vertAltAz=core-&gt;j2000ToAltAz(gastailVertexArr.
at(i), StelCore::RefractionOn);</td><td> </td><td class="right">                       Vec3d vertAltAz=core-&gt;j2000ToAltAz(gastailVertexArr.
at(i), StelCore::RefractionOn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       vertAltAz.normalize();</td><td> </td><td class="right">                       vertAltAz.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Q_ASSERT(fabs(vertAltAz.lengthSquared()-1.0) &lt; 0.001
);</td><td> </td><td class="right">                       Q_ASSERT(fabs(vertAltAz.lengthSquared()-1.0) &lt; 0.001
);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       float oneMag=0.0f;</td><td> </td><td class="right">                       float oneMag=0.0f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       extinction.forward(vertAltAz, &amp;oneMag);</td><td> </td><td class="right">                       extinction.forward(vertAltAz, &amp;oneMag);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       float extinctionFactor=std::pow(0.4f, oneMag); // dr
op of one magnitude: factor 2.5 or 40%</td><td> </td><td class="right">                       float extinctionFactor=std::pow(0.4f, oneMag); // dr
op of one magnitude: factor 2.5 or 40%</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       gastailColorArr.append(gasColor*extinctionFactor* br
ightnessPerVertexFromHead);</td><td> </td><td class="rblock">                       gastailColorArr.append(gasColor*extinctionFactor* br
ightnessPerVertexFromHead<span class="insert">*intensityFovScale</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // dusttail extinction:</td><td> </td><td class="right">                       // dusttail extinction:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       vertAltAz=core-&gt;j2000ToAltAz(dusttailVertexArr.at(i)
, StelCore::RefractionOn);</td><td> </td><td class="right">                       vertAltAz=core-&gt;j2000ToAltAz(dusttailVertexArr.at(i)
, StelCore::RefractionOn);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       vertAltAz.normalize();</td><td> </td><td class="right">                       vertAltAz.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Q_ASSERT(fabs(vertAltAz.lengthSquared()-1.0) &lt; 0.001
);</td><td> </td><td class="right">                       Q_ASSERT(fabs(vertAltAz.lengthSquared()-1.0) &lt; 0.001
);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oneMag=0.0f;</td><td> </td><td class="right">                       oneMag=0.0f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       extinction.forward(vertAltAz, &amp;oneMag);</td><td> </td><td class="right">                       extinction.forward(vertAltAz, &amp;oneMag);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       extinctionFactor=std::pow(0.4f, oneMag); // drop of 
one magnitude: factor 2.5 or 40%</td><td> </td><td class="right">                       extinctionFactor=std::pow(0.4f, oneMag); // drop of 
one magnitude: factor 2.5 or 40%</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       dusttailColorArr.append(dustColor*extinctionFactor *
 brightnessPerVertexFromHead);</td><td> </td><td class="rblock">                       dusttailColorArr.append(dustColor*extinctionFactor *
 brightnessPerVertexFromHead<span class="insert">*intensityFovScale</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       brightnessPerVertexFromHead-=brightnessDecreasePerVe
rtexFromHead;</td><td> </td><td class="right">                       brightnessPerVertexFromHead-=brightnessDecreasePerVe
rtexFromHead;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else // no atmosphere: set all vertices to same brightness.</td><td> </td><td class="right">       else // no atmosphere: set all vertices to same brightness.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">gastailColorArr.fill(gasColor,   gastailVertexArr.length());</span></td><td> </td><td class="rblock">               <span class="insert">gastailColorArr.fill(gasColor  *intensityFovScale, gastailVe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               dusttailColorArr.fill(dustColor, dusttailVertexArr.length())</span></td><td> </td><td class="rblock"><span class="insert">rtexArr.length());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span></td><td> </td><td class="rblock"><span class="insert">               dusttailColorArr.fill(dustColor*intensityFovScale, dusttailV</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ertexArr.length());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //qDebug() &lt;&lt; "Comet " &lt;&lt; getEnglishName() &lt;&lt;  "JDE: " &lt;&lt; date &lt;&lt; "g
asR" &lt;&lt; gasColor[0] &lt;&lt; " dustR" &lt;&lt; dustColor[0];</td><td> </td><td class="right">       //qDebug() &lt;&lt; "Comet " &lt;&lt; getEnglishName() &lt;&lt;  "JDE: " &lt;&lt; date &lt;&lt; "g
asR" &lt;&lt; gasColor[0] &lt;&lt; " dustR" &lt;&lt; dustColor[0];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Draw the Comet and all the related infos: name, circle etc... GZ: Taken 
from Planet.cpp 2013-11-05 and extended</td><td> </td><td class="right">// Draw the Comet and all the related infos: name, circle etc... GZ: Taken 
from Planet.cpp 2013-11-05 and extended</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Comet::draw(StelCore* core, float maxMagLabels, const QFont&amp; planetNam
eFont)</td><td> </td><td class="right">void Comet::draw(StelCore* core, float maxMagLabels, const QFont&amp; planetNam
eFont)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hidden)</td><td> </td><td class="right">       if (hidden)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 495</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 503</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This test seemed necessary for reasonable fps in case too many co
met elements are loaded.</td><td> </td><td class="right">       // This test seemed necessary for reasonable fps in case too many co
met elements are loaded.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Problematic: Early-out here of course disables the wanted hint ci
rcles for dim comets.</td><td> </td><td class="right">       // Problematic: Early-out here of course disables the wanted hint ci
rcles for dim comets.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // The line makes hints for comets 5 magnitudes below sky limiting m
agnitude visible.</td><td> </td><td class="right">       // The line makes hints for comets 5 magnitudes below sky limiting m
agnitude visible.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // If comet is too faint to be seen, don't bother rendering. (Massiv
e speedup if people have hundreds of comet elements!)</td><td> </td><td class="right">       // If comet is too faint to be seen, don't bother rendering. (Massiv
e speedup if people have hundreds of comet elements!)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if ((getVMagnitude(core)-5.0f) &gt; core-&gt;getSkyDrawer()-&gt;getLimitMagni
tude() &amp;&amp; !core-&gt;getCurrentLocation().planetName.contains("Observer", Qt::C
aseInsensitive))</td><td> </td><td class="right">       if ((getVMagnitude(core)-5.0f) &gt; core-&gt;getSkyDrawer()-&gt;getLimitMagni
tude() &amp;&amp; !core-&gt;getCurrentLocation().planetName.contains("Observer", Qt::C
aseInsensitive))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // The CometOrbit is in fact available in userDataPtr!</td><td> </td><td class="right">       // The CometOrbit is in fact available in userDataPtr!</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       CometOrbit* orbit=(CometOrbit*)<span class="delete">userData</span>Ptr;</td><td> </td><td class="rblock">       CometOrbit* orbit=(CometOrbit*)<span class="insert">orbit</span>Ptr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(orbit);</td><td> </td><td class="right">       Q_ASSERT(orbit);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!orbit-&gt;objectDateValid(core-&gt;getJDE())) return; // don't draw a
t all if out of useful date range. This allows having hundreds of comet ele
ments.</td><td> </td><td class="right">       if (!orbit-&gt;objectDateValid(core-&gt;getJDE())) return; // don't draw a
t all if out of useful date range. This allows having hundreds of comet ele
ments.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d mat = Mat4d::translation(eclipticPos) * rotLocalToParent;</td><td> </td><td class="right">       Mat4d mat = Mat4d::translation(eclipticPos) * rotLocalToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This removed totally the Planet shaking bug!!!</td><td> </td><td class="right">       // This removed totally the Planet shaking bug!!!</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelProjector::ModelViewTranformP transfo = core-&gt;getHeliocentricEcl
ipticModelViewTransform();</td><td> </td><td class="right">       StelProjector::ModelViewTranformP transfo = core-&gt;getHeliocentricEcl
ipticModelViewTransform();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       transfo-&gt;combine(mat);</td><td> </td><td class="right">       transfo-&gt;combine(mat);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute the 2D position and check if in the screen</td><td> </td><td class="right">       // Compute the 2D position and check if in the screen</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelProjectorP prj = core-&gt;getProjection(transfo);</td><td> </td><td class="right">       const StelProjectorP prj = core-&gt;getProjection(transfo);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float screenSz = getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRadA
tCenter();</td><td> </td><td class="right">       float screenSz = getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRadA
tCenter();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float viewport_left = prj-&gt;getViewportPosX();</td><td> </td><td class="right">       float viewport_left = prj-&gt;getViewportPosX();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float viewport_bottom = prj-&gt;getViewportPosY();</td><td> </td><td class="right">       float viewport_bottom = prj-&gt;getViewportPosY();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (prj-&gt;project(Vec3d(0), screenPos)</td><td> </td><td class="rblock">       if (prj-&gt;project(Vec3d(0<span class="insert">.</span>), screenPos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               &amp;&amp; screenPos[1]&gt;viewport_bottom - screenSz &amp;&amp; screenPos[1] &lt;
 viewport_bottom + prj-&gt;getViewportHeight()+screenSz</td><td> </td><td class="right">               &amp;&amp; screenPos[1]&gt;viewport_bottom - screenSz &amp;&amp; screenPos[1] &lt;
 viewport_bottom + prj-&gt;getViewportHeight()+screenSz</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               &amp;&amp; screenPos[0]&gt;viewport_left - screenSz &amp;&amp; screenPos[0] &lt; v
iewport_left + prj-&gt;getViewportWidth() + screenSz)</td><td> </td><td class="right">               &amp;&amp; screenPos[0]&gt;viewport_left - screenSz &amp;&amp; screenPos[0] &lt; v
iewport_left + prj-&gt;getViewportWidth() + screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Draw the name, and the circle if it's not too close from 
the body it's turning around</td><td> </td><td class="right">               // Draw the name, and the circle if it's not too close from 
the body it's turning around</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // this prevents name overlapping (ie for jupiter satellites
)</td><td> </td><td class="right">               // this prevents name overlapping (ie for jupiter satellites
)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float ang_dist = 300.f*atan(getEclipticPos().length()/getEqu
inoxEquatorialPos(core).length())/core-&gt;getMovementMgr()-&gt;getCurrentFov();</td><td> </td><td class="right">               float ang_dist = 300.f*atan(getEclipticPos().length()/getEqu
inoxEquatorialPos(core).length())/core-&gt;getMovementMgr()-&gt;getCurrentFov();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // if (ang_dist==0.f) ang_dist = 1.f; // if ang_dist == 0, t
he Planet is sun.. --&gt; GZ: we can remove it.</td><td> </td><td class="right">               // if (ang_dist==0.f) ang_dist = 1.f; // if ang_dist == 0, t
he Planet is sun.. --&gt; GZ: we can remove it.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // by putting here, only draw orbit if Comet is visible for 
clarity</td><td> </td><td class="right">               // by putting here, only draw orbit if Comet is visible for 
clarity</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawOrbit(core);  // TODO - fade in here also...</td><td> </td><td class="right">               drawOrbit(core);  // TODO - fade in here also...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 584</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 592</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d eclposNrm=eclipticPos - core-&gt;getObserverHeliocentricEclipticP
os()  ; eclposNrm.normalize();</td><td> </td><td class="right">       Vec3d eclposNrm=eclipticPos - core-&gt;getObserverHeliocentricEclipticP
os()  ; eclposNrm.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d comarot=Mat4d::rotation(Vec3d(0.0, 0.0, 1.0)^(eclposNrm), std:
:acos(Vec3d(0.0, 0.0, 1.0).dot(eclposNrm)) );</td><td> </td><td class="right">       Mat4d comarot=Mat4d::rotation(Vec3d(0.0, 0.0, 1.0)^(eclposNrm), std:
:acos(Vec3d(0.0, 0.0, 1.0).dot(eclposNrm)) );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelProjector::ModelViewTranformP transfo2 = transfo-&gt;clone();</td><td> </td><td class="right">       StelProjector::ModelViewTranformP transfo2 = transfo-&gt;clone();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       transfo2-&gt;combine(comarot);</td><td> </td><td class="right">       transfo2-&gt;combine(comarot);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(core-&gt;getProjection(transfo2));</td><td> </td><td class="right">       StelPainter sPainter(core-&gt;getProjection(transfo2));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setBlending(true, GL_ONE, GL_ONE);</td><td> </td><td class="right">       sPainter.setBlending(true, GL_ONE, GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setCullFace(false);</td><td> </td><td class="right">       sPainter.setCullFace(false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelToneReproducer* eye = core-&gt;getToneReproducer();</td><td> </td><td class="right">       StelToneReproducer* eye = core-&gt;getToneReproducer();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       float lum = core-&gt;getSkyDrawer()-&gt;surface<span class="delete">b</span>rightnessToLuminance(getVM
agnitudeWithExtinction(core)+11.0f); // How to calibrate?</td><td> </td><td class="rblock">       float lum = core-&gt;getSkyDrawer()-&gt;surface<span class="insert">B</span>rightnessToLuminance(getVM
agnitudeWithExtinction(core)+11.0f); // How to calibrate?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Get the luminance scaled between 0 and 1</td><td> </td><td class="right">       // Get the luminance scaled between 0 and 1</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float aLum =eye-&gt;adaptLuminanceScaled(lum);</td><td> </td><td class="right">       float aLum =eye-&gt;adaptLuminanceScaled(lum);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       float magFactor=q<span class="delete">Min(qMax(aLum, 0.25f)</span>, 2.0f);</td><td> </td><td class="rblock">       float magFactor=q<span class="insert">Bound(0.25f*intensityFovScale, aLum*intensityFovSca
le</span>, 2.0f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       comaTexture-&gt;bind();</td><td> </td><td class="right">       comaTexture-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setColor(0.3f*magFactor,0.7*magFactor,magFactor);</td><td> </td><td class="right">       sPainter.setColor(0.3f*magFactor,0.7*magFactor,magFactor);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setArrays((Vec3d*)comaVertexArr.constData(), (Vec2f*)comaTe
xCoordArr.constData());</td><td> </td><td class="right">       sPainter.setArrays((Vec3d*)comaVertexArr.constData(), (Vec2f*)comaTe
xCoordArr.constData());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.drawFromArray(StelPainter::Triangles, comaVertexArr.size()/
3);</td><td> </td><td class="right">       sPainter.drawFromArray(StelPainter::Triangles, comaVertexArr.size()/
3);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setBlending(false);</td><td> </td><td class="right">       sPainter.setBlending(false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Formula found at http://www.projectpluto.com/update7b.htm#comet_tail_for
mula</td><td> </td><td class="right">// Formula found at http://www.projectpluto.com/update7b.htm#comet_tail_for
mula</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec2f Comet::getComaDiameterAndTailLengthAU()</td><td> </td><td class="right">Vec2f Comet::getComaDiameterAndTailLengthAU()</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 26 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>30 lines changed or deleted</i></th><th><i> </i></th><th><i>42 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
