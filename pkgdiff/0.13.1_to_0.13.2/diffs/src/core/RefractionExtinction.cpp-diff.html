<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-45-generic #74-Ubuntu SMP Tue Jan 13 19:36:28 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: RefractionExtinction.cpp - RefractionExtinction.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;RefractionExtinction.cpp&nbsp;</th><th> </th><th>&nbsp;RefractionExtinction.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 109</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 109</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       invertPostTransfoMat=m.inverse();</td><td> </td><td class="right">       invertPostTransfoMat=m.inverse();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       postTransfoMatf.set(m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7], 
m[8], m[9], m[10], m[11], m[12], m[13], m[14], m[15]);</td><td> </td><td class="right">       postTransfoMatf.set(m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7], 
m[8], m[9], m[10], m[11], m[12], m[13], m[14], m[15]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       invertPostTransfoMatf.set(invertPostTransfoMat[0], invertPostTransfo
Mat[1], invertPostTransfoMat[2], invertPostTransfoMat[3],</td><td> </td><td class="right">       invertPostTransfoMatf.set(invertPostTransfoMat[0], invertPostTransfo
Mat[1], invertPostTransfoMat[2], invertPostTransfoMat[3],</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        invertPostTransfoMa
t[4], invertPostTransfoMat[5], invertPostTransfoMat[6], invertPostTransfoMa
t[7],</td><td> </td><td class="right">                                                        invertPostTransfoMa
t[4], invertPostTransfoMat[5], invertPostTransfoMat[6], invertPostTransfoMa
t[7],</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        invertPostTransfoMa
t[8], invertPostTransfoMat[9], invertPostTransfoMat[10], invertPostTransfoM
at[11],</td><td> </td><td class="right">                                                        invertPostTransfoMa
t[8], invertPostTransfoMat[9], invertPostTransfoMat[10], invertPostTransfoM
at[11],</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        invertPostTransfoMa
t[12], invertPostTransfoMat[13], invertPostTransfoMat[14], invertPostTransf
oMat[15]);</td><td> </td><td class="right">                                                        invertPostTransfoMa
t[12], invertPostTransfoMat[13], invertPostTransfoMat[14], invertPostTransf
oMat[15]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Refraction::updatePrecomputed()</td><td> </td><td class="right">void Refraction::updatePrecomputed()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">press_temp_corr_Bennett=pressure/1010.f</span> * 283.f/(273.f+temperature) </td><td> </td><td class="rblock">       <span class="insert">press_temp_corr=pressure/1010.f</span> * 283.f/(273.f+temperature) / 60.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">/ 60.f;</td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">press_temp_corr_Saemundson=1.02f*press_temp_corr_Bennett;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Refraction::innerRefractionForward(Vec3d&amp; altAzPos) const</td><td> </td><td class="right">void Refraction::innerRefractionForward(Vec3d&amp; altAzPos) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double length = altAzPos.length();</td><td> </td><td class="right">       const double length = altAzPos.length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double <span class="delete">geom_alt_deg=180./M_PI*std::asin(altAzPos[2]/length);</span></td><td> </td><td class="rblock">       <span class="insert">const</span> double <span class="insert">sinGeo = altAzPos[2]/length;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       double geom_alt_rad = std::asin(sinGeo);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       double geom_alt_deg = 180./M_PI*geom_alt_rad;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (geom_alt_deg &gt; MIN_GEO_ALTITUDE_DEG)</td><td> </td><td class="right">       if (geom_alt_deg &gt; MIN_GEO_ALTITUDE_DEG)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // refraction from Saemundsson, S&amp;T1986 p70 / in Meeus, Astr
.Alg.</td><td> </td><td class="right">               // refraction from Saemundsson, S&amp;T1986 p70 / in Meeus, Astr
.Alg.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">float r=press_temp_corr_Saemundson / std::tan((geom_alt_deg+
10.3f/(geom_alt_deg+5.11f))*M_PI/180.f) + 0.0019279f</span>;</td><td> </td><td class="rblock">               <span class="insert">double r=press_temp_corr * ( 1.02 / std::tan((geom_alt_deg+1
0.3/(geom_alt_deg+5.11))*M_PI/180.) + 0.0019279)</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               geom_alt_deg += r;</td><td> </td><td class="right">               geom_alt_deg += r;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (geom_alt_deg &gt; 90.)</td><td> </td><td class="right">               if (geom_alt_deg &gt; 90.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       geom_alt_deg=90.;</td><td> </td><td class="right">                       geom_alt_deg=90.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               altAzPos[2]=std::sin(geom_alt_deg*M_PI/180.)*length;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if(geom_alt_deg&gt;MIN_GEO_ALTITUDE_DEG-TRANSITION_WIDTH_GEO_DEG)</td><td> </td><td class="right">       else if(geom_alt_deg&gt;MIN_GEO_ALTITUDE_DEG-TRANSITION_WIDTH_GEO_DEG)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Avoids the jump below -5 by interpolating linearly betwee
n MIN_GEO_ALTITUDE_DEG and bottom of transition zone</td><td> </td><td class="right">               // Avoids the jump below -5 by interpolating linearly betwee
n MIN_GEO_ALTITUDE_DEG and bottom of transition zone</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               float r_m5=press_temp_corr<span class="delete">_Saemundson / std::tan((MIN_GEO_AL
TITUDE_DEG+10.3f/(MIN_GEO_ALTITUDE_DEG+5.11f))*M_PI/180.f) + 0.0019279f</span>;</td><td> </td><td class="rblock">               float r_m5=press_temp_corr<span class="insert"> * ( 1.02f / std::tan((MIN_GEO_ALT
ITUDE_DEG+10.3f/(MIN_GEO_ALTITUDE_DEG+5.11f))*M_PI/180.f) + 0.0019279f)</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               geom_alt_deg += r_m5*(geom_alt_deg-(MIN_GEO_ALTITUDE_DEG-TRA
NSITION_WIDTH_GEO_DEG))/TRANSITION_WIDTH_GEO_DEG;</td><td> </td><td class="right">               geom_alt_deg += r_m5*(geom_alt_deg-(MIN_GEO_ALTITUDE_DEG-TRA
NSITION_WIDTH_GEO_DEG))/TRANSITION_WIDTH_GEO_DEG;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               altAzPos[2]=std::sin(geom_alt_deg*M_PI/180.)*length;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">else return;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // At this point we have corrected geometric altitude. Note that if </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">we just change altAzPos[2], we would change vector length, so this would ch</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ange our angles.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // We have to shorten X,Y components of the vector as well by the ch</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ange in cosines of altitude, or (sqrt(1-sin(alt))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double refr_alt_rad=geom_alt_deg*M_PI/180.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double sinRef=std::sin(refr_alt_rad);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double shortenxy=std::sqrt((1.-sinRef*sinRef)/(1.-sinGeo*sinGe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">o)); // we need double's mantissa length here, sorry!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzPos[0]*=shortenxy;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzPos[1]*=shortenxy;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzPos[2]=sinRef*length;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Refraction::innerRefractionBackward(Vec3d&amp; altAzPos) const</td><td> </td><td class="right">void Refraction::innerRefractionBackward(Vec3d&amp; altAzPos) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // going from observed position/magnitude to geometrical position an
d atmosphere-free mag.</td><td> </td><td class="right">       // going from observed position/magnitude to geometrical position an
d atmosphere-free mag.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double length = altAzPos.length();</td><td> </td><td class="right">       const double length = altAzPos.length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">float obs_alt_deg=180./M_PI*std::asin(altAzPos[2]/length);</span></td><td> </td><td class="rblock">       <span class="insert">const double sinObs = altAzPos[2]/length;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (obs_alt_deg &gt; <span class="delete">0.22879)</span></td><td> </td><td class="rblock"><span class="insert">       double obs_alt_deg=180./M_PI*std::asin(sinObs);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       if (obs_alt_deg &gt; <span class="insert">0.22879f)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // refraction from Bennett, in Meeus, Astr.Alg.</td><td> </td><td class="right">               // refraction from Bennett, in Meeus, Astr.Alg.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">float r=press_temp_corr_Bennett / std::tan((obs_alt_deg+7.31
f/(obs_alt_deg+4.4f))*M_PI/180.) + 0.0013515f</span>;</td><td> </td><td class="rblock">               <span class="insert">double r=press_temp_corr * (1. / std::tan((obs_alt_deg+7.31/
(obs_alt_deg+4.4))*M_PI/180.) + 0.0013515)</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               obs_alt_deg -= r;</td><td> </td><td class="right">               obs_alt_deg -= r;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               altAzPos[2]=std::sin(obs_alt_deg*M_PI/180.f)*length;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (obs_alt_deg &gt; MIN_APP_ALTITUDE_DEG)</td><td> </td><td class="right">       else if (obs_alt_deg &gt; MIN_APP_ALTITUDE_DEG)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // backward refraction from polynomial fit against Saemundso
n[-5...-0.3]</td><td> </td><td class="right">               // backward refraction from polynomial fit against Saemundso
n[-5...-0.3]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float r=(((((0.0444f*obs_alt_deg+.7662f)*obs_alt_deg+4.9746f
)*obs_alt_deg+13.599f)*obs_alt_deg+8.052f)*obs_alt_deg-11.308f)*obs_alt_deg
+34.341f;</td><td> </td><td class="right">               float r=(((((0.0444f*obs_alt_deg+.7662f)*obs_alt_deg+4.9746f
)*obs_alt_deg+13.599f)*obs_alt_deg+8.052f)*obs_alt_deg-11.308f)*obs_alt_deg
+34.341f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               obs_alt_deg -= <span class="delete">press_temp_corr_Bennett*r;</span></td><td> </td><td class="rblock">               obs_alt_deg -= <span class="insert">press_temp_corr*r;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               altAzPos[2]=std::sin(obs_alt_deg*M_PI/180.)*length;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (obs_alt_deg &gt; MIN_APP_ALTITUDE_DEG-TRANSITION_WIDTH_APP_DEG
)</td><td> </td><td class="right">       else if (obs_alt_deg &gt; MIN_APP_ALTITUDE_DEG-TRANSITION_WIDTH_APP_DEG
)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Compute top value from polynome, apply linear interpolati
on</td><td> </td><td class="right">               // Compute top value from polynome, apply linear interpolati
on</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               static const float r_min=(((((0.0444f*MIN_APP_ALTITUDE_DEG+.
7662f)*MIN_APP_ALTITUDE_DEG</td><td> </td><td class="right">               static const float r_min=(((((0.0444f*MIN_APP_ALTITUDE_DEG+.
7662f)*MIN_APP_ALTITUDE_DEG</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               +4.9746f)*MIN_APP_ALTITUDE_DEG+13.599f)*MIN_
APP_ALTITUDE_DEG</td><td> </td><td class="right">                               +4.9746f)*MIN_APP_ALTITUDE_DEG+13.599f)*MIN_
APP_ALTITUDE_DEG</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                             +8.052f)*MIN_APP_ALTITUDE_DEG-11.308f)*MIN_APP
_ALTITUDE_DEG+34.341f;</td><td> </td><td class="right">                             +8.052f)*MIN_APP_ALTITUDE_DEG-11.308f)*MIN_APP
_ALTITUDE_DEG+34.341f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               obs_alt_deg -= <span class="delete">r_min*press_temp_corr_Bennett*(obs_alt_deg-(M</span></td><td> </td><td class="rblock">               obs_alt_deg -= <span class="insert">r_min*press_temp_corr*(obs_alt_deg-(MIN_APP_A</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">IN_APP_ALTITUDE_DEG-TRANSITION_WIDTH_APP_DEG))/TRANSITION_WIDTH_APP_DEG;</span></td><td> </td><td class="rblock"><span class="insert">LTITUDE_DEG-TRANSITION_WIDTH_APP_DEG))/TRANSITION_WIDTH_APP_DEG;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               altAzPos[2]=std::sin(obs_alt_deg*M_PI/180.)*length;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">else return;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // At this point we have corrected observed altitude. Note that if w</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">e just change altAzPos[2], we would change vector length, so this would cha</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">nge our angles.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       // We have to make X,Y components of the vector a bit longer as well</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> by the change in cosines of altitude, or (sqrt(1-sin(alt))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double geo_alt_rad=obs_alt_deg*M_PI/180.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double sinGeo=std::sin(geo_alt_rad);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       const double longerxy=std::sqrt((1.-sinGeo*sinGeo)/(1.-sinObs*sinObs</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzPos[0]*=longerxy;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzPos[1]*=longerxy;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzPos[2]=sinGeo*length;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Refraction::forward(Vec3d&amp; altAzPos) const</td><td> </td><td class="right">void Refraction::forward(Vec3d&amp; altAzPos) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       altAzPos.transfo4d(preTransfoMat);</td><td> </td><td class="right">       altAzPos.transfo4d(preTransfoMat);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       innerRefractionForward(altAzPos);</td><td> </td><td class="right">       innerRefractionForward(altAzPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       altAzPos.transfo4d(postTransfoMat);</td><td> </td><td class="right">       altAzPos.transfo4d(postTransfoMat);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//Bennett's formula is not a strict inverse of Saemundsson's. There is a no
table discrepancy (alt!=backward(forward(alt))) for</td><td> </td><td class="right">//Bennett's formula is not a strict inverse of Saemundsson's. There is a no
table discrepancy (alt!=backward(forward(alt))) for</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 13 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>17 lines changed or deleted</i></th><th><i> </i></th><th><i>43 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
