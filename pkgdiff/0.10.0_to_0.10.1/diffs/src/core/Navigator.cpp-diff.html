<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Navigator.cpp - StelNavigator.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Navigator.cpp&nbsp;</th><th> </th><th>&nbsp;StelNavigator.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 21</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 21</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td> </td><td class="right"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td> </td><td class="right"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * GNU General Public License for more details.</td><td> </td><td class="right"> * GNU General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with this program; if not, write to the Free Software</td><td> </td><td class="right"> * along with this program; if not, write to the Free Software</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, U
SA.</td><td> </td><td class="right"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, U
SA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include "Navigator.hpp"</td><td> </td><td class="rblock">#include "<span class="insert">Stel</span>Navigator.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelUtils.hpp"</td><td> </td><td class="right">#include "StelUtils.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "SolarSystem.hpp"</td><td> </td><td class="right">#include "SolarSystem.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include "Observer.hpp"</td><td> </td><td class="rblock">#include "<span class="insert">Stel</span>Observer.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "Planet.hpp"</td><td> </td><td class="right">#include "Planet.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelObjectMgr.hpp"</td><td> </td><td class="right">#include "StelObjectMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include <span class="delete">"LocationMgr.hpp"</span></td><td> </td><td class="rblock">#include <span class="insert">"StelLocationMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelModuleMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelMovementMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QSettings&gt;</td><td> </td><td class="right">#include &lt;QSettings&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QStringList&gt;</td><td> </td><td class="right">#include &lt;QStringList&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDateTime&gt;</td><td> </td><td class="right">#include &lt;QDateTime&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// Init statics transfo matrices</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// See vsop87.doc:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const Mat4d StelNavigator::matJ2000ToVsop87(Mat4d::xrotation(-23.4392803055</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">555555556*(M_PI/180)) * Mat4d::zrotation(0.0000275*(M_PI/180)));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const Mat4d StelNavigator::matVsop87ToJ2000(matJ2000ToVsop87.transpose());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">Navigator::Navigator() : timeSpeed(JD_SECOND), JDay(0.), position(N</span>ULL)</td><td> </td><td class="rblock"><span class="insert">StelNavigator::StelNavigator() : timeSpeed(JD_SECOND), JDay(0.), position(N
</span>ULL)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">localVision=Vec3d(1.,0.,0.);</span></td><td> </td><td class="rblock">       <span class="insert">altAzVisionDirection=Vec3d(1.,0.,0.);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       equVision=Vec3d(1.,0.,0.);</span></td><td> </td><td class="rblock"><span class="insert">       earthEquVisionDirection=Vec3d(1.,0.,0.);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       J2000EquVision=Vec3d(1.,0.,0.);</span>  // not correct yet...</td><td> </td><td class="rblock"><span class="insert">       J2000EquVisionDirection=Vec3d(1.,0.,0.);</span>  // not correct yet...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       viewingMode = ViewHorizon;  // default</td><td> </td><td class="right">       viewingMode = ViewHorizon;  // default</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">Navigator::~</span>Navigator()</td><td> </td><td class="rblock"><span class="insert">StelNavigator::~Stel</span>Navigator()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       delete position;</td><td> </td><td class="right">       delete position;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       position=NULL;</td><td> </td><td class="right">       position=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">const Planet *Navigator::getHomePlanet(void) const</td><td> </td><td class="rblock">const Planet *<span class="insert">Stel</span>Navigator::getHomePlanet(void) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return position-&gt;getHomePlanet();</td><td> </td><td class="right">       return position-&gt;getHomePlanet();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::init()</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::init()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QSettings* conf = StelApp::getInstance().getSettings();</td><td> </td><td class="right">       QSettings* conf = StelApp::getInstance().getSettings();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(conf);</td><td> </td><td class="right">       Q_ASSERT(conf);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       defaultLocationID = conf-&gt;value("init_location/location","Paris, Par
is, France").toString();</td><td> </td><td class="right">       defaultLocationID = conf-&gt;value("init_location/location","Paris, Par
is, France").toString();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       position = new <span class="delete">Observer(StelApp::getInstance().getLocationMgr().loca
</span>tionForSmallString(defaultLocationID));</td><td> </td><td class="rblock">       position = new <span class="insert">StelObserver(StelApp::getInstance().getLocationMgr().
loca</span>tionForSmallString(defaultLocationID));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setTimeNow();</td><td> </td><td class="right">       setTimeNow();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       set<span class="delete">LocalVis</span>ion(Vec3f(1,1e-05,0.2));</td><td> </td><td class="rblock">       set<span class="insert">AltAzVisionDirect</span>ion(Vec3f(1,1e-05,0.2));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute transform matrices between coordinates systems</td><td> </td><td class="right">       // Compute transform matrices between coordinates systems</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       updateTransformMatrices();</td><td> </td><td class="right">       updateTransformMatrices();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       updateModelViewMat();</td><td> </td><td class="right">       updateModelViewMat();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString tmpstr = conf-&gt;value("navigation/viewing_mode", "horizon").t
oString();</td><td> </td><td class="right">       QString tmpstr = conf-&gt;value("navigation/viewing_mode", "horizon").t
oString();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (tmpstr=="equator")</td><td> </td><td class="right">       if (tmpstr=="equator")</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               setViewingMode(Navigator::ViewEquator);</td><td> </td><td class="rblock">               setViewingMode(<span class="insert">Stel</span>Navigator::ViewEquator);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (tmpstr=="horizon")</td><td> </td><td class="right">               if (tmpstr=="horizon")</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       setViewingMode(Navigator::ViewHorizon);</td><td> </td><td class="rblock">                       setViewingMode(<span class="insert">Stel</span>Navigator::ViewHorizon);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       qDebug() &lt;&lt; "ERROR : Unknown viewing mode type : " &lt;
&lt; tmpstr;</td><td> </td><td class="right">                       qDebug() &lt;&lt; "ERROR : Unknown viewing mode type : " &lt;
&lt; tmpstr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">assert</span>(0);</td><td> </td><td class="rblock">                       <span class="insert">Q_ASSERT</span>(0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       initViewPos = StelUtils::strToVec3f(conf-&gt;value("navigation/init_vie
w_pos").toString());</td><td> </td><td class="right">       initViewPos = StelUtils::strToVec3f(conf-&gt;value("navigation/init_vie
w_pos").toString());</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       set<span class="delete">LocalVis</span>ion(initViewPos);</td><td> </td><td class="rblock">       set<span class="insert">AltAzVisionDirect</span>ion(initViewPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // we want to be able to handle the old style preset time, recorded 
as a double</td><td> </td><td class="right">       // we want to be able to handle the old style preset time, recorded 
as a double</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // jday, or as a more human readable string...</td><td> </td><td class="right">       // jday, or as a more human readable string...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool ok;</td><td> </td><td class="right">       bool ok;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString presetTimeStr = conf-&gt;value("navigation/preset_sky_time",245
1545.).toString();</td><td> </td><td class="right">       QString presetTimeStr = conf-&gt;value("navigation/preset_sky_time",245
1545.).toString();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       presetSkyTime = presetTimeStr.toDouble(&amp;ok);</td><td> </td><td class="right">       presetSkyTime = presetTimeStr.toDouble(&amp;ok);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (ok)</td><td> </td><td class="right">       if (ok)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qDebug() &lt;&lt; "navigation/preset_sky_time is a double - treati
ng as jday:" &lt;&lt; presetSkyTime;</td><td> </td><td class="right">               qDebug() &lt;&lt; "navigation/preset_sky_time is a double - treati
ng as jday:" &lt;&lt; presetSkyTime;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 112</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 119</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (startupTimeMode=="preset")</td><td> </td><td class="right">       if (startupTimeMode=="preset")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setJDay(presetSkyTime - StelUtils::getGMTShiftFromQT(presetS
kyTime) * JD_HOUR);</td><td> </td><td class="right">               setJDay(presetSkyTime - StelUtils::getGMTShiftFromQT(presetS
kyTime) * JD_HOUR);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (startupTimeMode=="today")</td><td> </td><td class="right">       else if (startupTimeMode=="today")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setTodayTime(getInitTodayTime());</td><td> </td><td class="right">               setTodayTime(getInitTodayTime());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // we previously set the time to "now" already, so we don't need to</td><td> </td><td class="right">       // we previously set the time to "now" already, so we don't need to</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // explicitly do it if the startupTimeMode=="now".</td><td> </td><td class="right">       // explicitly do it if the startupTimeMode=="now".</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set the location to use by default at startup</td><td> </td><td class="right">// Set the location to use by default at startup</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setDefaultLocationID(const QString&amp; id)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setDefaultLocationID(const QString&amp; id)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       defaultLocationID = id;</td><td> </td><td class="right">       defaultLocationID = id;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelApp::getInstance().getLocationMgr().locationForSmallString(id);</td><td> </td><td class="right">       StelApp::getInstance().getLocationMgr().locationForSmallString(id);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QSettings* conf = StelApp::getInstance().getSettings();</td><td> </td><td class="right">       QSettings* conf = StelApp::getInstance().getSettings();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(conf);</td><td> </td><td class="right">       Q_ASSERT(conf);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       conf-&gt;setValue("init_location/location", id);</td><td> </td><td class="right">       conf-&gt;setValue("init_location/location", id);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//! Set stellarium time to current real world time</td><td> </td><td class="right">//! Set stellarium time to current real world time</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setTimeNow()</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setTimeNow()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setJDay(StelUtils::getJDFromSystem());</td><td> </td><td class="right">       setJDay(StelUtils::getJDFromSystem());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setTodayTime(const QTime&amp; target)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setTodayTime(const QTime&amp; target)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QDateTime dt = QDateTime::currentDateTime();</td><td> </td><td class="right">       QDateTime dt = QDateTime::currentDateTime();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (target.isValid())</td><td> </td><td class="right">       if (target.isValid())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               dt.setTime(target);</td><td> </td><td class="right">               dt.setTime(target);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // don't forget to adjust for timezone / daylight savings.</td><td> </td><td class="right">               // don't forget to adjust for timezone / daylight savings.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setJDay(StelUtils::qDateTimeToJd(dt)-(StelUtils::getGMTShift
FromQT(StelUtils::getJDFromSystem()) * JD_HOUR));</td><td> </td><td class="right">               setJDay(StelUtils::qDateTimeToJd(dt)-(StelUtils::getGMTShift
FromQT(StelUtils::getJDFromSystem()) * JD_HOUR));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               qWarning() &lt;&lt; "WARNING - time passed to <span class="delete">Navigator::setTodayT
</span>ime is not valid. The system time will be used." &lt;&lt; target;</td><td> </td><td class="rblock">               qWarning() &lt;&lt; "WARNING - time passed to <span class="insert">StelNavigator::setTo
dayT</span>ime is not valid. The system time will be used." &lt;&lt; target;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setTimeNow();</td><td> </td><td class="right">               setTimeNow();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//! Get whether the current stellarium time is the real world time</td><td> </td><td class="right">//! Get whether the current stellarium time is the real world time</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">bool Navigator::getIsTimeNow(void) const</td><td> </td><td class="rblock">bool <span class="insert">Stel</span>Navigator::getIsTimeNow(void) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // cache last time to prevent to much slow system call</td><td> </td><td class="right">       // cache last time to prevent to much slow system call</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static double lastJD = getJDay();</td><td> </td><td class="right">       static double lastJD = getJDay();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static bool previousResult = (fabs(getJDay()-StelUtils::getJDFromSys
tem())&lt;JD_SECOND);</td><td> </td><td class="right">       static bool previousResult = (fabs(getJDay()-StelUtils::getJDFromSys
tem())&lt;JD_SECOND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (fabs(lastJD-getJDay())&gt;JD_SECOND/4)</td><td> </td><td class="right">       if (fabs(lastJD-getJDay())&gt;JD_SECOND/4)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastJD = getJDay();</td><td> </td><td class="right">               lastJD = getJDay();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               previousResult = (fabs(getJDay()-StelUtils::getJDFromSystem(
))&lt;JD_SECOND);</td><td> </td><td class="right">               previousResult = (fabs(getJDay()-StelUtils::getJDFromSystem(
))&lt;JD_SECOND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return previousResult;</td><td> </td><td class="right">       return previousResult;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::addSolarDays(double d)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::addSolarDays(double d)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setJDay(getJDay() + d);</td><td> </td><td class="right">       setJDay(getJDay() + d);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::addSiderealDays(double d)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::addSiderealDays(double d)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Planet* home = position-&gt;getHomePlanet();</td><td> </td><td class="right">       const Planet* home = position-&gt;getHomePlanet();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (home-&gt;getEnglishName() != "Solar System Observer")</td><td> </td><td class="rblock">       if (home-&gt;getEnglishName() != "Solar System <span class="insert">Stel</span>Observer")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               d *= home-&gt;getSiderealDay();</td><td> </td><td class="right">               d *= home-&gt;getSiderealDay();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setJDay(getJDay() + d);</td><td> </td><td class="right">       setJDay(getJDay() + d);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::moveObserverToSelected(void)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::moveObserverToSelected(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (StelApp::getInstance().getStelObjectMgr().getWasSelected())</td><td> </td><td class="right">       if (StelApp::getInstance().getStelObjectMgr().getWasSelected())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Planet* pl = dynamic_cast&lt;Planet*&gt;(StelApp::getInstance().ge
tStelObjectMgr().getSelectedObject()[0].get());</td><td> </td><td class="right">               Planet* pl = dynamic_cast&lt;Planet*&gt;(StelApp::getInstance().ge
tStelObjectMgr().getSelectedObject()[0].get());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (pl)</td><td> </td><td class="right">               if (pl)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // We need to move to the selected planet. Try to ge
nerate a location from the current one</td><td> </td><td class="right">                       // We need to move to the selected planet. Try to ge
nerate a location from the current one</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       Location loc = getCurrentLocation();</td><td> </td><td class="rblock">                       <span class="insert">Stel</span>Location loc = getCurrentLocation();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       loc.planetName = pl-&gt;getEnglishName();</td><td> </td><td class="right">                       loc.planetName = pl-&gt;getEnglishName();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       loc.name = "-";</td><td> </td><td class="right">                       loc.name = "-";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       loc.state = "";</td><td> </td><td class="right">                       loc.state = "";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       moveObserverTo(loc);</td><td> </td><td class="right">                       moveObserverTo(loc);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">StelMovementMgr* mmgr = (StelMovementMgr*)GETSTELMODULE("StelMovemen</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">tMgr");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Q_ASSERT(mmgr);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       mmgr-&gt;setFlagTracking(false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the informations on the current location</td><td> </td><td class="right">// Get the informations on the current location</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">const <span class="delete">Location&amp; </span>Navigator::getCurrentLocation() const</td><td> </td><td class="rblock">const <span class="insert">StelLocation&amp; Stel</span>Navigator::getCurrentLocation() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return position-&gt;getCurrentLocation();</td><td> </td><td class="right">       return position-&gt;getCurrentLocation();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Smoothly move the observer to the given location</td><td> </td><td class="right">// Smoothly move the observer to the given location</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">Navigator::moveObserverTo(const Location&amp; target, double duration, dou
</span>ble durationIfPlanetChange)</td><td> </td><td class="rblock">void <span class="insert">StelNavigator::moveObserverTo(const StelLocation&amp; target, double durat
ion, dou</span>ble durationIfPlanetChange)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double d = (getCurrentLocation().planetName==target.planetName) ? du
ration : durationIfPlanetChange;</td><td> </td><td class="right">       double d = (getCurrentLocation().planetName==target.planetName) ? du
ration : durationIfPlanetChange;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (d&gt;0.)</td><td> </td><td class="right">       if (d&gt;0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               SpaceShipObserver* newObs = new SpaceShipObserver(getCurrent
Location(), target, d);</td><td> </td><td class="right">               SpaceShipObserver* newObs = new SpaceShipObserver(getCurrent
Location(), target, d);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete position;</td><td> </td><td class="right">               delete position;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               position = newObs;</td><td> </td><td class="right">               position = newObs;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete position;</td><td> </td><td class="right">               delete position;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               position = new Observer(target);</td><td> </td><td class="rblock">               position = new <span class="insert">Stel</span>Observer(target);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the sideral time shifted by the observer longitude</td><td> </td><td class="right">// Get the sideral time shifted by the observer longitude</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Navigator::getLocalSideralTime() const</td><td> </td><td class="rblock">double <span class="insert">Stel</span>Navigator::getLocalSideralTime() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return (position-&gt;getHomePlanet()-&gt;getSiderealTime(JDay)+position-&gt;g
etCurrentLocation().longitude)*M_PI/180.;</td><td> </td><td class="right">       return (position-&gt;getHomePlanet()-&gt;getSiderealTime(JDay)+position-&gt;g
etCurrentLocation().longitude)*M_PI/180.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setInitViewDirectionToCurrent(void)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setInitViewDirectionToCurrent(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       initViewPos = <span class="delete">localVision;</span></td><td> </td><td class="rblock">       initViewPos = <span class="insert">altAzVisionDirection;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       QString dirStr = <span class="delete">QString("%1,%2,%3").arg(localVision[0]).arg(localVi</span></td><td> </td><td class="rblock">       QString dirStr = <span class="insert">QString("%1,%2,%3").arg(altAzVisionDirection[0]).ar</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">sion[1]).arg(localVision[2]);</span></td><td> </td><td class="rblock"><span class="insert">g(altAzVisionDirection[1]).arg(altAzVisionDirection[2]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelApp::getInstance().getSettings()-&gt;setValue("navigation/init_view
_pos", dirStr);</td><td> </td><td class="right">       StelApp::getInstance().getSettings()-&gt;setValue("navigation/init_view
_pos", dirStr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//! Increase the time speed</td><td> </td><td class="right">//! Increase the time speed</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::increaseTimeSpeed()</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::increaseTimeSpeed()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double s = getTime<span class="delete">Speed</span>();</td><td> </td><td class="rblock">       double s = getTime<span class="insert">Rate</span>();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (s&gt;=JD_SECOND) s*=10.;</td><td> </td><td class="right">       if (s&gt;=JD_SECOND) s*=10.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (s&lt;-JD_SECOND) s/=10.;</td><td> </td><td class="right">       else if (s&lt;-JD_SECOND) s/=10.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (s&gt;=0. &amp;&amp; s&lt;JD_SECOND) s=JD_SECOND;</td><td> </td><td class="right">       else if (s&gt;=0. &amp;&amp; s&lt;JD_SECOND) s=JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (s&gt;=-JD_SECOND &amp;&amp; s&lt;0.) s=0.;</td><td> </td><td class="right">       else if (s&gt;=-JD_SECOND &amp;&amp; s&lt;0.) s=0.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       setTime<span class="delete">Speed</span>(s);</td><td> </td><td class="rblock">       setTime<span class="insert">Rate</span>(s);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//! Decrease the time speed</td><td> </td><td class="right">//! Decrease the time speed</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::decreaseTimeSpeed()</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::decreaseTimeSpeed()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double s = getTime<span class="delete">Speed</span>();</td><td> </td><td class="rblock">       double s = getTime<span class="insert">Rate</span>();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (s&gt;JD_SECOND) s/=10.;</td><td> </td><td class="right">       if (s&gt;JD_SECOND) s/=10.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (s&lt;=-JD_SECOND) s*=10.;</td><td> </td><td class="right">       else if (s&lt;=-JD_SECOND) s*=10.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (s&gt;-JD_SECOND &amp;&amp; s&lt;=0.) s=-JD_SECOND;</td><td> </td><td class="right">       else if (s&gt;-JD_SECOND &amp;&amp; s&lt;=0.) s=-JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (s&gt;0. &amp;&amp; s&lt;=JD_SECOND) s=0.;</td><td> </td><td class="right">       else if (s&gt;0. &amp;&amp; s&lt;=JD_SECOND) s=0.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       setTime<span class="delete">Speed</span>(s);</td><td> </td><td class="rblock">       setTime<span class="insert">Rate</span>(s);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">Navigator::setLocalVis</span>ion(const Vec3d&amp; _pos)</td><td> </td><td class="rblock">void <span class="insert">StelNavigator::setAltAzVisionDirect</span>ion(const Vec3d&amp; _pos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">localVision</span> = _pos;</td><td> </td><td class="rblock">       <span class="insert">altAzVisionDirection</span> = _pos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">equVision=localToEarthEqu(localVision);</span></td><td> </td><td class="rblock">       <span class="insert">earthEquVisionDirection=altAzToEquinoxEqu(altAzVisionDirection);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       J2000EquVision</span> = <span class="delete">matEarthEquToJ2000*equVision;</span></td><td> </td><td class="rblock"><span class="insert">       J2000EquVisionDirection</span> = <span class="insert">matEquinoxEquToJ2000*earthEquVisionDirecti</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">on;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       updateModelViewMat();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">Navigator::setEquVis</span>ion(const Vec3d&amp; _pos)</td><td> </td><td class="rblock">void <span class="insert">StelNavigator::setEquinoxEquVisionDirect</span>ion(const Vec3d&amp; _pos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">equVision</span> = _pos;</td><td> </td><td class="rblock">       <span class="insert">earthEquVisionDirection</span> = _pos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">J2000EquVision</span> = <span class="delete">matEarthEquToJ2000*equVision;</span></td><td> </td><td class="rblock">       <span class="insert">J2000EquVisionDirection</span> = <span class="insert">matEquinoxEquToJ2000*earthEquVisionDirecti</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       localVision</span> = <span class="delete">earthEquToLocal(equVision);</span></td><td> </td><td class="rblock"><span class="insert">on;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzVisionDirection</span> = <span class="insert">equinoxEquToAltAz(earthEquVisionDirection);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       updateModelViewMat();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">Navigator::setJ2000EquVis</span>ion(const Vec3d&amp; _pos)</td><td> </td><td class="rblock">void <span class="insert">StelNavigator::setJ2000EquVisionDirect</span>ion(const Vec3d&amp; _pos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">J2000EquVision</span> = _pos;</td><td> </td><td class="rblock">       <span class="insert">J2000EquVisionDirection</span> = _pos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">equVision</span> = <span class="delete">matJ2000ToEarthEqu*J2000EquVision;</span></td><td> </td><td class="rblock">       <span class="insert">earthEquVisionDirection</span> = <span class="insert">matJ2000ToEquinoxEqu*J2000EquVisionDirecti</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       localVision</span> = <span class="delete">earthEquToLocal(equVision);</span></td><td> </td><td class="rblock"><span class="insert">on;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       altAzVisionDirection</span> = <span class="insert">equinoxEquToAltAz(earthEquVisionDirection);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       updateModelViewMat();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Increment time</td><td> </td><td class="right">// Increment time</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::updateTime(double deltaTime)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::updateTime(double deltaTime)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       JDay+=timeSpeed*deltaTime;</td><td> </td><td class="right">       JDay+=timeSpeed*deltaTime;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Fix time limits to -100000 to +100000 to prevent bugs</td><td> </td><td class="right">       // Fix time limits to -100000 to +100000 to prevent bugs</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (JDay&gt;38245309.499988) JDay = 38245309.499988;</td><td> </td><td class="right">       if (JDay&gt;38245309.499988) JDay = 38245309.499988;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (JDay&lt;-34803211.500012) JDay = -34803211.500012;</td><td> </td><td class="right">       if (JDay&lt;-34803211.500012) JDay = -34803211.500012;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (position-&gt;isObserverLifeOver())</td><td> </td><td class="right">       if (position-&gt;isObserverLifeOver())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Unselect if the new home planet is the previously selecte
d object</td><td> </td><td class="right">               // Unselect if the new home planet is the previously selecte
d object</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               StelObjectMgr &amp;objmgr(StelApp::getInstance().getStelObjectMg
r());</td><td> </td><td class="right">               StelObjectMgr &amp;objmgr(StelApp::getInstance().getStelObjectMg
r());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (objmgr.getWasSelected() &amp;&amp; objmgr.getSelectedObject()[0]
.get()==position-&gt;getHomePlanet())</td><td> </td><td class="right">               if (objmgr.getWasSelected() &amp;&amp; objmgr.getSelectedObject()[0]
.get()==position-&gt;getHomePlanet())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       objmgr.unSelect();</td><td> </td><td class="right">                       objmgr.unSelect();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               Observer* newObs = position-&gt;getNextObserver();</td><td> </td><td class="rblock">               <span class="insert">Stel</span>Observer* newObs = position-&gt;getNextObserver();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete position;</td><td> </td><td class="right">               delete position;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               position = newObs;</td><td> </td><td class="right">               position = newObs;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       position-&gt;update(deltaTime);</td><td> </td><td class="right">       position-&gt;update(deltaTime);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// The non optimized (more clear version is available on the CVS : before d
ate 25/07/2003)</td><td> </td><td class="right">// The non optimized (more clear version is available on the CVS : before d
ate 25/07/2003)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">// see vsop87.doc:</span></td><td> </td><td class="rblock">void <span class="insert">StelNavigator::updateTransformMatrices(void)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">const Mat4d matJ2000ToVsop87(Mat4d::xrotation(-23.4392803055555555556*(M_PI</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">/180)) * Mat4d::zrotation(0.0000275*(M_PI/180)));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">const Mat4d matVsop87ToJ2000(matJ2000ToVsop87.transpose());</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">Navigator::updateTransformMatrices(void)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">matLocalToEarthEqu</span> = <span class="delete">position-&gt;getRotLocalToEquatorial(JDay);</span></td><td> </td><td class="rblock">       <span class="insert">matAltAzToEquinoxEqu</span> = <span class="insert">position-&gt;getRotAltAzToEquatorial(JDay);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       matEarthEquToLocal</span> = <span class="delete">matLocalToEarthEqu.transpose();</span></td><td> </td><td class="rblock"><span class="insert">       matEquinoxEquToAltAz</span> = <span class="insert">matAltAzToEquinoxEqu.transpose();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">matEarthEquToJ2000</span> = matVsop87ToJ2000 * <span class="delete">position-&gt;getRotEquatorialTo</span></td><td> </td><td class="rblock">       <span class="insert">matEquinoxEquToJ2000</span> = matVsop87ToJ2000 * <span class="insert">position-&gt;getRotEquatorial</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">Vsop87();</span></td><td> </td><td class="rblock"><span class="insert">ToVsop87();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       matJ2000ToEarthEqu</span> = <span class="delete">matEarthEquToJ2000.transpose();</span></td><td> </td><td class="rblock"><span class="insert">       matJ2000ToEquinoxEqu</span> = <span class="insert">matEquinoxEquToJ2000.transpose();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       matJ2000ToLocal</span> = <span class="delete">matEarthEquToLocal*matJ2000ToEarthEqu;</span></td><td> </td><td class="rblock"><span class="insert">       matJ2000ToAltAz</span> = <span class="insert">matEquinoxEquToAltAz*matJ2000ToEquinoxEqu;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       matHelio<span class="delete">ToEarthEqu = matJ2000ToEarthEqu * matVsop87ToJ2000 * Mat4d::
</span>translation(-position-&gt;getCenterVsop87Pos());</td><td> </td><td class="rblock">       matHelio<span class="insert">centricEclipticToEquinoxEqu = matJ2000ToEquinoxEqu * matVsop
87ToJ2000 * Mat4d::</span>translation(-position-&gt;getCenterVsop87Pos());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // These two next have to take into account the position of the obse
rver on the earth</td><td> </td><td class="right">       // These two next have to take into account the position of the obse
rver on the earth</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Mat4d tmp = matJ2000ToVsop87 * matE<span class="delete">arthEquToJ2000 * matLocalToEarthE
</span>qu;</td><td> </td><td class="rblock">       Mat4d tmp = matJ2000ToVsop87 * matE<span class="insert">quinoxEquToJ2000 * matAltAzToEqui
noxE</span>qu;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       mat<span class="delete">LocalToHelio =  Mat4d::translation(position-&gt;getCenterVsop87Pos()
</span>) * tmp *</td><td> </td><td class="rblock">       mat<span class="insert">AltAzToHeliocentricEcliptic =  Mat4d::translation(position-&gt;getCe
nterVsop87Pos()</span>) * tmp *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                             Mat4d::translation(Vec3d(0.,0., position-&gt;getD
istanceFromCenter()));</td><td> </td><td class="right">                             Mat4d::translation(Vec3d(0.,0., position-&gt;getD
istanceFromCenter()));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       matHelio<span class="delete">ToLocal =  Mat4d::translation(Vec3d(0.,0.,-position-&gt;getDist
</span>anceFromCenter())) * tmp.transpose() *</td><td> </td><td class="rblock">       matHelio<span class="insert">centricEclipticToAltAz =  Mat4d::translation(Vec3d(0.,0.,-po
sition-&gt;getDist</span>anceFromCenter())) * tmp.transpose() *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                             Mat4d::translation(-position-&gt;getCenterVsop87P
os());</td><td> </td><td class="right">                             Mat4d::translation(-position-&gt;getCenterVsop87P
os());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setStartupTimeMode(const QString&amp; s)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setStartupTimeMode(const QString&amp; s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       startupTimeMode = s;</td><td> </td><td class="right">       startupTimeMode = s;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Update the modelview matrices</td><td> </td><td class="right">// Update the modelview matrices</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::updateModelViewMat(void)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::updateModelViewMat(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d f;</td><td> </td><td class="right">       Vec3d f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if( viewingMode == ViewEquator)</td><td> </td><td class="right">       if( viewingMode == ViewEquator)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // view will use equatorial coordinates, so that north is al
ways up</td><td> </td><td class="right">               // view will use equatorial coordinates, so that north is al
ways up</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               f = e<span class="delete">quVis</span>ion;</td><td> </td><td class="rblock">               f = e<span class="insert">arthEquVisionDirect</span>ion;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // view will correct for horizon (always down)</td><td> </td><td class="right">               // view will correct for horizon (always down)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               f = <span class="delete">localVis</span>ion;</td><td> </td><td class="rblock">               f = <span class="insert">altAzVisionDirect</span>ion;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       f.normalize();</td><td> </td><td class="right">       f.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d s(f[1],-f[0],0.);</td><td> </td><td class="right">       Vec3d s(f[1],-f[0],0.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if( viewingMode == ViewEquator)</td><td> </td><td class="right">       if( viewingMode == ViewEquator)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // convert everything back to local coord</td><td> </td><td class="right">               // convert everything back to local coord</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               f = <span class="delete">localVis</span>ion;</td><td> </td><td class="rblock">               f = <span class="insert">altAzVisionDirect</span>ion;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               f.normalize();</td><td> </td><td class="right">               f.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               s = e<span class="delete">arthEquToLocal</span>( s );</td><td> </td><td class="rblock">               s = e<span class="insert">quinoxEquToAltAz</span>( s );</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d u(s^f);</td><td> </td><td class="right">       Vec3d u(s^f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       s.normalize();</td><td> </td><td class="right">       s.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       u.normalize();</td><td> </td><td class="right">       u.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0060" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       mat<span class="delete">LocalToEye</span>.set(s[0],u[0],-f[0],0.,</td><td> </td><td class="rblock">       mat<span class="insert">AltAzModelView</span>.set(s[0],u[0],-f[0],0.,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                            s[1],u[1],-f[1],0.,</td><td> </td><td class="right">                            s[1],u[1],-f[1],0.,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                            s[2],u[2],-f[2],0.,</td><td> </td><td class="right">                            s[2],u[2],-f[2],0.,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                            0.,0.,0.,1.);</td><td> </td><td class="right">                            0.,0.,0.,1.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0061" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">matEarthEquToEye = matLocalToEye*matEarthEquToLocal;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       matHelioToEye = matLocalToEye*matHelioToLocal;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       matJ2000ToEye = matEarthEquToEye*matJ2000ToEarthEqu;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Return the observer heliocentric position</td><td> </td><td class="right">// Return the observer heliocentric position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0062" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3d <span class="delete">Navigator::getObserverHelio</span>Pos(void) const</td><td> </td><td class="rblock">Vec3d <span class="insert">StelNavigator::getObserverHeliocentricEcliptic</span>Pos(void) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0063" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       static const Vec3d <span class="delete">v(0.,0.,0.);</span></td><td> </td><td class="rblock">       static const Vec3d <span class="insert">v(0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return <span class="delete">matLocalToHelio*v;</span></td><td> </td><td class="rblock">       return <span class="insert">matAltAzToHeliocentricEcliptic*v;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0064" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setPresetSkyTime(QDateTime dt)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setPresetSkyTime(QDateTime dt)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setPresetSkyTime(StelUtils::qDateTimeToJd(dt));</td><td> </td><td class="right">       setPresetSkyTime(StelUtils::qDateTimeToJd(dt));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////////////////////////////
/////</td><td> </td><td class="right">///////////////////////////////////////////////////////////////////////////
/////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set type of viewing mode (align with horizon or equatorial coordinates)</td><td> </td><td class="right">// Set type of viewing mode (align with horizon or equatorial coordinates)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0065" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Navigator::setViewingMode(ViewingModeType viewMode)</td><td> </td><td class="rblock">void <span class="insert">Stel</span>Navigator::setViewingMode(ViewingModeType viewMode)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       viewingMode = viewMode;</td><td> </td><td class="right">       viewingMode = viewMode;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // TODO: include some nice smoothing function trigger here to rotate
 between</td><td> </td><td class="right">       // TODO: include some nice smoothing function trigger here to rotate
 between</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // the two modes</td><td> </td><td class="right">       // the two modes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 65 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>87 lines changed or deleted</i></th><th><i> </i></th><th><i>95 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
