<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: SkyDrawer.cpp - StelSkyDrawer.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;SkyDrawer.cpp&nbsp;</th><th> </th><th>&nbsp;StelSkyDrawer.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 20</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 20</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * This program is distributed in the hope that it will be useful,</td><td> </td><td class="right"> * This program is distributed in the hope that it will be useful,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td> </td><td class="right"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td> </td><td class="right"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * GNU General Public License for more details.</td><td> </td><td class="right"> * GNU General Public License for more details.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> *</td><td> </td><td class="right"> *</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * You should have received a copy of the GNU General Public License</td><td> </td><td class="right"> * You should have received a copy of the GNU General Public License</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * along with this program; if not, write to the Free Software</td><td> </td><td class="right"> * along with this program; if not, write to the Free Software</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, U
SA.</td><td> </td><td class="right"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, U
SA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include <span class="delete">"SkyDrawer.hpp"</span></td><td> </td><td class="rblock">#include <span class="insert">"StelSkyDrawer.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include <span class="delete">"Projector.hpp"</span></td><td> </td><td class="rblock">#include <span class="insert">"StelProjector.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include <span class="delete">"Navigator.hpp"</span></td><td> </td><td class="rblock">#include <span class="insert">"StelNavigator.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">#include <span class="delete">"ToneReproducer.hpp"</span></td><td> </td><td class="rblock">#include <span class="insert">"StelToneReproducer.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTextureMgr.hpp"</td><td> </td><td class="right">#include "StelTextureMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelUtils.hpp"</td><td> </td><td class="right">#include "StelUtils.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelMovementMgr.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelPainter.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QStringList&gt;</td><td> </td><td class="right">#include &lt;QStringList&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QSettings&gt;</td><td> </td><td class="right">#include &lt;QSettings&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QtGlobal&gt;</td><td> </td><td class="right">#include &lt;QtGlobal&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// The 0.025 corresponds to the maximum eye resolution in degree</td><td> </td><td class="right">// The 0.025 corresponds to the maximum eye resolution in degree</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define EYE_RESOLUTION (0.25)</td><td> </td><td class="right">#define EYE_RESOLUTION (0.25)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define MAX_LINEAR_RADIUS 8.f</td><td> </td><td class="right">#define MAX_LINEAR_RADIUS 8.f</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">S<span class="delete">kyDrawer::</span>SkyDrawer(StelCore* acore) : core(acore)</td><td> </td><td class="rblock">S<span class="insert">telSkyDrawer::Stel</span>SkyDrawer(StelCore* acore) : core(acore)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       prj = core-&gt;getProjection();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eye = core-&gt;getToneReproducer();</td><td> </td><td class="right">       eye = core-&gt;getToneReproducer();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">sPainter = NULL;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       inScale = 1.;</td><td> </td><td class="right">       inScale = 1.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bortleScaleIndex = 3;</td><td> </td><td class="right">       bortleScaleIndex = 3;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       limitMagnitude = -100.f;</td><td> </td><td class="right">       limitMagnitude = -100.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       limitLuminance = 0;</td><td> </td><td class="right">       limitLuminance = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oldLum=-1.f;</td><td> </td><td class="right">       oldLum=-1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       maxLum = 0.f;</td><td> </td><td class="right">       maxLum = 0.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">setMaxFov(180.f);</span></td><td> </td><td class="rblock">       <span class="insert">setMaxAdaptFov(180.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       setMinFov(0.1f);</span></td><td> </td><td class="rblock"><span class="insert">       setMinAdaptFov(0.1f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starAbsoluteScaleF = 1.f;</td><td> </td><td class="right">       starAbsoluteScaleF = 1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starRelativeScale = 1.f;</td><td> </td><td class="right">       starRelativeScale = 1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starLinearScale = 19.569f;</td><td> </td><td class="right">       starLinearScale = 19.569f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">update(0);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QSettings* conf = StelApp::getInstance().getSettings();</td><td> </td><td class="right">       QSettings* conf = StelApp::getInstance().getSettings();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       initColorTableFromConfigFile(conf);</td><td> </td><td class="right">       initColorTableFromConfigFile(conf);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setTwinkleAmount(conf-&gt;value("stars/star_twinkle_amount",0.3).toDoub
le());</td><td> </td><td class="right">       setTwinkleAmount(conf-&gt;value("stars/star_twinkle_amount",0.3).toDoub
le());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setFlagTwinkle(conf-&gt;value("stars/flag_star_twinkle",true).toBool())
;</td><td> </td><td class="right">       setFlagTwinkle(conf-&gt;value("stars/flag_star_twinkle",true).toBool())
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setFlagPointStar(conf-&gt;value("stars/flag_point_star",false).toBool()
);</td><td> </td><td class="right">       setFlagPointStar(conf-&gt;value("stars/flag_point_star",false).toBool()
);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">setMaxFov(conf-&gt;value("stars/mag_converter_max_fov",70.0).toDouble()</span></td><td> </td><td class="rblock">       <span class="insert">setMaxAdaptFov(conf-&gt;value("stars/mag_converter_max_fov",70.0).toDou</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">);</span></td><td> </td><td class="rblock"><span class="insert">ble());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       setMinFov(conf-&gt;value("stars/mag_converter_min_fov",0.1).toDouble())</span></td><td> </td><td class="rblock"><span class="insert">       setMinAdaptFov(conf-&gt;value("stars/mag_converter_min_fov",0.1).toDoub</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span></td><td> </td><td class="rblock"><span class="insert">le());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setFlagLuminanceAdaptation(conf-&gt;value("viewing/use_luminance_adapta
tion",true).toBool());</td><td> </td><td class="right">       setFlagLuminanceAdaptation(conf-&gt;value("viewing/use_luminance_adapta
tion",true).toBool());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool ok=true;</td><td> </td><td class="right">       bool ok=true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setBortleScale(conf-&gt;value("stars/init_bortle_scale",3).toInt(&amp;ok));</td><td> </td><td class="right">       setBortleScale(conf-&gt;value("stars/init_bortle_scale",3).toInt(&amp;ok));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!ok)</td><td> </td><td class="right">       if (!ok)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               conf-&gt;setValue("stars/init_bortle_scale",3);</td><td> </td><td class="right">               conf-&gt;setValue("stars/init_bortle_scale",3);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setBortleScale(3);</td><td> </td><td class="right">               setBortleScale(3);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               ok = true;</td><td> </td><td class="right">               ok = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 109</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 110</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       textureGrid = new Vec2f[maxPointSources*4];</td><td> </td><td class="right">       textureGrid = new Vec2f[maxPointSources*4];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (unsigned int i=0;i&lt;maxPointSources; ++i)</td><td> </td><td class="right">       for (unsigned int i=0;i&lt;maxPointSources; ++i)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               textureGrid[i*4].set(0,0);</td><td> </td><td class="right">               textureGrid[i*4].set(0,0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               textureGrid[i*4+1].set(1,0);</td><td> </td><td class="right">               textureGrid[i*4+1].set(1,0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               textureGrid[i*4+2].set(1,1);</td><td> </td><td class="right">               textureGrid[i*4+2].set(1,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               textureGrid[i*4+3].set(0,1);</td><td> </td><td class="right">               textureGrid[i*4+3].set(0,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">S<span class="delete">kyDrawer::~</span>SkyDrawer()</td><td> </td><td class="rblock">S<span class="insert">telSkyDrawer::~Stel</span>SkyDrawer()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (verticesGrid)</td><td> </td><td class="right">       if (verticesGrid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete[] verticesGrid;</td><td> </td><td class="right">               delete[] verticesGrid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       verticesGrid = NULL;</td><td> </td><td class="right">       verticesGrid = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (colorGrid)</td><td> </td><td class="right">       if (colorGrid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete[] colorGrid;</td><td> </td><td class="right">               delete[] colorGrid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       colorGrid = NULL;</td><td> </td><td class="right">       colorGrid = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (textureGrid)</td><td> </td><td class="right">       if (textureGrid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete[] textureGrid;</td><td> </td><td class="right">               delete[] textureGrid;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       textureGrid = NULL;</td><td> </td><td class="right">       textureGrid = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Init parameters from config file</td><td> </td><td class="right">// Init parameters from config file</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::init()</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::init()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelApp::getInstance().getTextureManager().setDefaultParams();</td><td> </td><td class="right">       StelApp::getInstance().getTextureManager().setDefaultParams();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Load star texture no mipmap:</td><td> </td><td class="right">       // Load star texture no mipmap:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texHalo = StelApp::getInstance().getTextureManager().createTexture("
star16x16.png");</td><td> </td><td class="right">       texHalo = StelApp::getInstance().getTextureManager().createTexture("
star16x16.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texBigHalo = StelApp::getInstance().getTextureManager().createTextur
e("haloLune.png");</td><td> </td><td class="right">       texBigHalo = StelApp::getInstance().getTextureManager().createTextur
e("haloLune.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texSunHalo = StelApp::getInstance().getTextureManager().createTextur
e("halo.png");</td><td> </td><td class="right">       texSunHalo = StelApp::getInstance().getTextureManager().createTextur
e("halo.png");</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       update(0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::update(double deltaTime)</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::update(double deltaTime)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       float fov = <span class="delete">prj-&gt;getFov();</span></td><td> </td><td class="rblock">       float fov = <span class="insert">core-&gt;getMovementMgr()-&gt;getCurrentFov();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (fov &gt; <span class="delete">maxFov)</span></td><td> </td><td class="rblock">       if (fov &gt; <span class="insert">maxAdaptFov)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               fov = maxFov;</td><td> </td><td class="rblock">               fov = max<span class="insert">Adapt</span>Fov;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (fov &lt; <span class="delete">minFov)</span></td><td> </td><td class="rblock">               if (fov &lt; <span class="insert">minAdaptFov)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       fov = <span class="delete">minFov;</span></td><td> </td><td class="rblock">                       fov = <span class="insert">minAdaptFov;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This factor is fully arbitrary. It corresponds to the collecting 
area x exposure time of the instrument</td><td> </td><td class="right">       // This factor is fully arbitrary. It corresponds to the collecting 
area x exposure time of the instrument</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // It is based on a power law, so that it varies progressively with 
the FOV to smoothly switch from human</td><td> </td><td class="right">       // It is based on a power law, so that it varies progressively with 
the FOV to smoothly switch from human</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // vision to binocculares/telescope. Use a max of 0.7 because after 
that the atmosphere starts to glow too much!</td><td> </td><td class="right">       // vision to binocculares/telescope. Use a max of 0.7 because after 
that the atmosphere starts to glow too much!</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float powFactor = std::pow(60./qMax(0.7f,fov), 0.8);</td><td> </td><td class="right">       float powFactor = std::pow(60./qMax(0.7f,fov), 0.8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eye-&gt;setInputScale(inScale*powFactor);</td><td> </td><td class="right">       eye-&gt;setInputScale(inScale*powFactor);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Set the fov factor for point source luminance computation</td><td> </td><td class="right">       // Set the fov factor for point source luminance computation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // the division by powFactor should in principle not be here, but it
 doesn't look nice if removed</td><td> </td><td class="right">       // the division by powFactor should in principle not be here, but it
 doesn't look nice if removed</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 166</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 168</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       starLinearScale = std::pow(35.f*2.0f*starAbsoluteScaleF, 1.40f/2.f*s
tarRelativeScale);</td><td> </td><td class="right">       starLinearScale = std::pow(35.f*2.0f*starAbsoluteScaleF, 1.40f/2.f*s
tarRelativeScale);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // update limit mag</td><td> </td><td class="right">       // update limit mag</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       limitMagnitude = computeLimitMagnitude();</td><td> </td><td class="right">       limitMagnitude = computeLimitMagnitude();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // update limit luminance</td><td> </td><td class="right">       // update limit luminance</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       limitLuminance = computeLimitLuminance();</td><td> </td><td class="right">       limitLuminance = computeLimitLuminance();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the current limit magnitude by dichotomy</td><td> </td><td class="right">// Compute the current limit magnitude by dichotomy</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float SkyDrawer::computeLimitMagnitude() const</td><td> </td><td class="rblock">float S<span class="insert">telS</span>kyDrawer::computeLimitMagnitude() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float a=-26.f;</td><td> </td><td class="right">       float a=-26.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float b=30.f;</td><td> </td><td class="right">       float b=30.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float rcmag[2];</td><td> </td><td class="right">       float rcmag[2];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float lim = 0.f;</td><td> </td><td class="right">       float lim = 0.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int safety=0;</td><td> </td><td class="right">       int safety=0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       while (std::fabs(lim-a)&gt;0.05)</td><td> </td><td class="right">       while (std::fabs(lim-a)&gt;0.05)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               computeRCMag(lim, rcmag);</td><td> </td><td class="right">               computeRCMag(lim, rcmag);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rcmag[0]&lt;=0.f)</td><td> </td><td class="right">               if (rcmag[0]&lt;=0.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 199</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 201</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (safety&gt;20)</td><td> </td><td class="right">               if (safety&gt;20)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       lim=-99;</td><td> </td><td class="right">                       lim=-99;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       break;</td><td> </td><td class="right">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return lim;</td><td> </td><td class="right">       return lim;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the current limit luminance by dichotomy</td><td> </td><td class="right">// Compute the current limit luminance by dichotomy</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float SkyDrawer::computeLimitLuminance() const</td><td> </td><td class="rblock">float S<span class="insert">telS</span>kyDrawer::computeLimitLuminance() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float a=0.f;</td><td> </td><td class="right">       float a=0.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float b=500000.f;</td><td> </td><td class="right">       float b=500000.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float lim=40.f;</td><td> </td><td class="right">       float lim=40.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int safety=0;</td><td> </td><td class="right">       int safety=0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float adaptL;</td><td> </td><td class="right">       float adaptL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       while (std::fabs(lim-a)&gt;0.05)</td><td> </td><td class="right">       while (std::fabs(lim-a)&gt;0.05)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               adaptL = eye-&gt;adaptLuminanceScaled(lim);</td><td> </td><td class="right">               adaptL = eye-&gt;adaptLuminanceScaled(lim);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (adaptL&lt;=0.05f) // Object considered not visible if its a
dapted scaled luminance&lt;0.05</td><td> </td><td class="right">               if (adaptL&lt;=0.05f) // Object considered not visible if its a
dapted scaled luminance&lt;0.05</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 232</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 234</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (safety&gt;30)</td><td> </td><td class="right">               if (safety&gt;30)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       lim=500000;</td><td> </td><td class="right">                       lim=500000;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       break;</td><td> </td><td class="right">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return lim;</td><td> </td><td class="right">       return lim;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the ln of the luminance for a point source with the given mag fo
r the current FOV</td><td> </td><td class="right">// Compute the ln of the luminance for a point source with the given mag fo
r the current FOV</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float SkyDrawer::pointSourceMagToLnLuminance(float mag) const</td><td> </td><td class="rblock">float S<span class="insert">telS</span>kyDrawer::pointSourceMagToLnLuminance(float mag) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return -0.92103f*(mag + 12.12331f) + lnfovFactor;</td><td> </td><td class="right">       return -0.92103f*(mag + 12.12331f) + lnfovFactor;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float SkyDrawer::pointSourceLuminanceToMag(float lum)</td><td> </td><td class="rblock">float S<span class="insert">telS</span>kyDrawer::pointSourceLuminanceToMag(float lum)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return (std::log(lum) - lnfovFactor)/-0.92103f - 12.12331f;</td><td> </td><td class="right">       return (std::log(lum) - lnfovFactor)/-0.92103f - 12.12331f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the luminance for an extended source with the given surface brig
htness in Vmag/arcmin^2</td><td> </td><td class="right">// Compute the luminance for an extended source with the given surface brig
htness in Vmag/arcmin^2</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float SkyDrawer::surfacebrightnessToLuminance(float sb)</td><td> </td><td class="rblock">float S<span class="insert">telS</span>kyDrawer::surfacebrightnessToLuminance(float sb)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return 2.*2025000.f*std::exp(-0.92103f*(sb + 12.12331f))/(1./60.*1./
60.);</td><td> </td><td class="right">       return 2.*2025000.f*std::exp(-0.92103f*(sb + 12.12331f))/(1./60.*1./
60.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// Compute the surface brightness from the luminance of an extended source</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">float StelSkyDrawer::luminanceToSurfacebrightness(float lum)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">{</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       return std::log(lum*(1./60.*1./60.)/(2.*2025000.f))/-0.92103f - 12.1</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">2331f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute RMag and CMag from magnitude for a point source.</td><td> </td><td class="right">// Compute RMag and CMag from magnitude for a point source.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">bool SkyDrawer::computeRCMag(float mag, float rcMag[2]) const</td><td> </td><td class="rblock">bool S<span class="insert">telS</span>kyDrawer::computeRCMag(float mag, float rcMag[2]) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rcMag[0] = eye-&gt;adaptLuminanceScaledLn(pointSourceMagToLnLuminance(m
ag), starRelativeScale*1.40f/2.f);</td><td> </td><td class="right">       rcMag[0] = eye-&gt;adaptLuminanceScaledLn(pointSourceMagToLnLuminance(m
ag), starRelativeScale*1.40f/2.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rcMag[0]*=starLinearScale;</td><td> </td><td class="right">       rcMag[0]*=starLinearScale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Use now statically min_rmag = 0.5, because higher and too small v
alues look bad</td><td> </td><td class="right">       // Use now statically min_rmag = 0.5, because higher and too small v
alues look bad</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rcMag[0] &lt; 0.5f)</td><td> </td><td class="right">       if (rcMag[0] &lt; 0.5f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rcMag[0] = rcMag[1] = 0.f;</td><td> </td><td class="right">               rcMag[0] = rcMag[1] = 0.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return false;</td><td> </td><td class="right">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 285</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 293</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // cmag:</td><td> </td><td class="right">               // cmag:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rcMag[1] = 1.0f;</td><td> </td><td class="right">               rcMag[1] = 1.0f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rcMag[0]&gt;MAX_LINEAR_RADIUS)</td><td> </td><td class="right">               if (rcMag[0]&gt;MAX_LINEAR_RADIUS)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rcMag[0]=MAX_LINEAR_RADIUS+std::sqrt(1.f+rcMag[0]-MA
X_LINEAR_RADIUS)-1.f;</td><td> </td><td class="right">                       rcMag[0]=MAX_LINEAR_RADIUS+std::sqrt(1.f+rcMag[0]-MA
X_LINEAR_RADIUS)-1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void S<span class="delete">kyDrawer::preDrawPointSource(</span>)</td><td> </td><td class="rblock">void S<span class="insert">telSkyDrawer::preDrawPointSource(const StelPainter* p</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">assert(nbPointSources==0);</span></td><td> </td><td class="rblock">       <span class="insert">Q_ASSERT(p);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Q_ASSERT(sPainter==NULL);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter=p;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Q_ASSERT(nbPointSources==0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_LIGHTING);</td><td> </td><td class="right">       glDisable(GL_LIGHTING);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Blending is really important. Otherwise faint stars in the vicini
ty of</td><td> </td><td class="right">       // Blending is really important. Otherwise faint stars in the vicini
ty of</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // bright star will cause tiny black squares on the bright star, e.g
. see Procyon.</td><td> </td><td class="right">       // bright star will cause tiny black squares on the bright star, e.g
. see Procyon.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_ONE, GL_ONE);</td><td> </td><td class="right">       glBlendFunc(GL_ONE, GL_ONE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (getFlagPointStar())</td><td> </td><td class="right">       if (getFlagPointStar())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glDisable(GL_TEXTURE_2D);</td><td> </td><td class="right">               glDisable(GL_TEXTURE_2D);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glPointSize(0.1);</td><td> </td><td class="right">               glPointSize(0.1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glEnable(GL_TEXTURE_2D);</td><td> </td><td class="right">               glEnable(GL_TEXTURE_2D);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Finalize the drawing of point sources</td><td> </td><td class="right">// Finalize the drawing of point sources</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::postDrawPointSource()</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::postDrawPointSource()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">Q_ASSERT(sPainter);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       sPainter = NULL;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (nbPointSources==0)</td><td> </td><td class="right">       if (nbPointSources==0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texHalo-&gt;bind();</td><td> </td><td class="right">       texHalo-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnableClientState(GL_VERTEX_ARRAY);</td><td> </td><td class="right">       glEnableClientState(GL_VERTEX_ARRAY);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnableClientState(GL_COLOR_ARRAY);</td><td> </td><td class="right">       glEnableClientState(GL_COLOR_ARRAY);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnableClientState(GL_TEXTURE_COORD_ARRAY);</td><td> </td><td class="right">       glEnableClientState(GL_TEXTURE_COORD_ARRAY);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Load the color components</td><td> </td><td class="right">       // Load the color components</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 335</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 350</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDrawArrays(GL_QUADS, 0, nbPointSources*4);</td><td> </td><td class="right">       glDrawArrays(GL_QUADS, 0, nbPointSources*4);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisableClientState(GL_VERTEX_ARRAY);</td><td> </td><td class="right">       glDisableClientState(GL_VERTEX_ARRAY);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisableClientState(GL_COLOR_ARRAY);</td><td> </td><td class="right">       glDisableClientState(GL_COLOR_ARRAY);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisableClientState(GL_TEXTURE_COORD_ARRAY);</td><td> </td><td class="right">       glDisableClientState(GL_TEXTURE_COORD_ARRAY);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nbPointSources = 0;</td><td> </td><td class="right">       nbPointSources = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Draw a point source halo.</td><td> </td><td class="right">// Draw a point source halo.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">bool S<span class="delete">kyDrawer::drawPointSource(double x, double y, const float rcMag[2], c
</span>onst Vec3f&amp; color)</td><td> </td><td class="rblock">bool S<span class="insert">telSkyDrawer::drawPointSource(double x, double y, const float rcMag[2
], c</span>onst Vec3f&amp; color)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">Q_ASSERT(sPainter);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rcMag[0]&lt;=0.f)</td><td> </td><td class="right">       if (rcMag[0]&lt;=0.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return false;</td><td> </td><td class="right">               return false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Random coef for star twinkling</td><td> </td><td class="right">       // Random coef for star twinkling</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const float tw = flagStarTwinkle ? (1.f-twinkleAmount*rand()/RAND_MA
X) : 1.f;</td><td> </td><td class="right">       const float tw = flagStarTwinkle ? (1.f-twinkleAmount*rand()/RAND_MA
X) : 1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flagPointStar)</td><td> </td><td class="right">       if (flagPointStar)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Draw the star rendered as GLpoint. This may be faster but
 it is not so nice</td><td> </td><td class="right">               // Draw the star rendered as GLpoint. This may be faster but
 it is not so nice</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glColor3fv(color*(rcMag[1]*tw));</td><td> </td><td class="right">               glColor3fv(color*(rcMag[1]*tw));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">prj</span>-&gt;drawPoint2d(x, y);</td><td> </td><td class="rblock">               <span class="insert">sPainter</span>-&gt;drawPoint2d(x, y);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Store the drawing instructions in the vertex arrays</td><td> </td><td class="right">               // Store the drawing instructions in the vertex arrays</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               colorGrid[nbPointSources*4+3] = color*(rcMag[1]*tw);</td><td> </td><td class="right">               colorGrid[nbPointSources*4+3] = color*(rcMag[1]*tw);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const double radius = rcMag[0];</td><td> </td><td class="right">               const double radius = rcMag[0];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec2f* v = &amp;(verticesGrid[nbPointSources*4]);</td><td> </td><td class="right">               Vec2f* v = &amp;(verticesGrid[nbPointSources*4]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               v-&gt;set(x-radius,y-radius); ++v;</td><td> </td><td class="right">               v-&gt;set(x-radius,y-radius); ++v;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               v-&gt;set(x+radius,y-radius); ++v;</td><td> </td><td class="right">               v-&gt;set(x+radius,y-radius); ++v;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               v-&gt;set(x+radius,y+radius); ++v;</td><td> </td><td class="right">               v-&gt;set(x+radius,y+radius); ++v;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 384</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 401</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexCoord2i(1,0); glVertex2f(x+rmag,y-rmag)
;</td><td> </td><td class="right">                               glTexCoord2i(1,0); glVertex2f(x+rmag,y-rmag)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexCoord2i(1,1); glVertex2f(x+rmag,y+rmag)
;</td><td> </td><td class="right">                               glTexCoord2i(1,1); glVertex2f(x+rmag,y+rmag)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glTexCoord2i(0,1); glVertex2f(x-rmag,y+rmag)
;</td><td> </td><td class="right">                               glTexCoord2i(0,1); glVertex2f(x-rmag,y+rmag)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glEnd();</td><td> </td><td class="right">                       glEnd();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               ++nbPointSources;</td><td> </td><td class="right">               ++nbPointSources;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (nbPointSources&gt;=maxPointSources)</td><td> </td><td class="right">               if (nbPointSources&gt;=maxPointSources)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Flush the buffer (draw all buffered stars)</td><td> </td><td class="right">                       // Flush the buffer (draw all buffered stars)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       const StelPainter* savePainter = sPainter;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       postDrawPointSource();</td><td> </td><td class="right">                       postDrawPointSource();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter = savePainter;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return true;</td><td> </td><td class="right">       return true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">void SkyDrawer::preDrawSky3dModel(double illuminatedArea, float mag, bool l</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ighting)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">{</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       // Set the main source of light to be the sun</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const Vec3d sunPos = core-&gt;getNavigation()-&gt;getHelioToEyeMat()*Vec3d</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">(0,0,0);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       glLightfv(GL_LIGHT0,GL_POSITION,Vec4f(sunPos[0],sunPos[1],sunPos[2],</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">1.f));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       if (lighting)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glEnable(GL_LIGHTING);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               const float diffuse[4] = {2.,2.,2.,1};</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glLightfv(GL_LIGHT0,GL_DIFFUSE, diffuse);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       else</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       {</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glDisable(GL_LIGHTING);</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               glColor3fv(Vec3f(1.f,1.f,1.f));</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">}</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Terminate drawing of a 3D model, draw the halo</td><td> </td><td class="right">// Terminate drawing of a 3D model, draw the halo</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void S<span class="delete">kyDrawer::postDrawSky3dModel(double x, double y, double illuminatedAr
ea, float mag</span>, const Vec3f&amp; color)</td><td> </td><td class="rblock">void S<span class="insert">telSkyDrawer::postDrawSky3dModel(double x, double y, double illuminat
edArea, float mag, const StelPainter* painter</span>, const Vec3f&amp; color)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">Q_ASSERT(painter);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Q_ASSERT(sPainter==NULL);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_LIGHTING);</td><td> </td><td class="right">       glDisable(GL_LIGHTING);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const float pixPerRad = core-&gt;getProjection(<span class="delete">)-&gt;getPixelPerRadAtCente
</span>r();</td><td> </td><td class="rblock">       const float pixPerRad = core-&gt;getProjection(<span class="insert">StelCore::FrameJ2000)-&gt;g
etPixelPerRadAtCente</span>r();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Assume a disk shape</td><td> </td><td class="right">       // Assume a disk shape</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float pixRadius = std::sqrt(illuminatedArea/(60.*60.)*M_PI/180.*M_PI
/180.*(pixPerRad*pixPerRad))/M_PI;</td><td> </td><td class="right">       float pixRadius = std::sqrt(illuminatedArea/(60.*60.)*M_PI/180.*M_PI
/180.*(pixPerRad*pixPerRad))/M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool noStarHalo = false;</td><td> </td><td class="right">       bool noStarHalo = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (mag&lt;-15.f)</td><td> </td><td class="right">       if (mag&lt;-15.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Sun, halo size varies in function of the magnitude becaus
e sun as seen from pluto should look dimmer</td><td> </td><td class="right">               // Sun, halo size varies in function of the magnitude becaus
e sun as seen from pluto should look dimmer</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // as the sun as seen from earth</td><td> </td><td class="right">               // as the sun as seen from earth</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               texSunHalo-&gt;bind();</td><td> </td><td class="right">               texSunHalo-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 480</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 482</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (pixRadius&gt;tStart &amp;&amp; pixRadius&lt;tStop)</td><td> </td><td class="right">       if (pixRadius&gt;tStart &amp;&amp; pixRadius&lt;tStop)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rcm[1]=(tStop-pixRadius)/(tStop-tStart);</td><td> </td><td class="right">               rcm[1]=(tStop-pixRadius)/(tStop-tStart);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (truncated &amp;&amp; flagLuminanceAdaptation)</td><td> </td><td class="right">       if (truncated &amp;&amp; flagLuminanceAdaptation)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float wl = findWorldLumForMag(mag, rcm[0]);</td><td> </td><td class="right">               float wl = findWorldLumForMag(mag, rcm[0]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (wl&gt;0)</td><td> </td><td class="right">               if (wl&gt;0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       reportLuminanceInFov(qMin(700., qMin((double)wl/50, </td><td> </td><td class="rblock">                       <span class="insert">const double f = core-&gt;getMovementMgr()-&gt;getCurrentF</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">(60.*60.)/(prj-&gt;getFov()*prj-&gt;getFov())*6.)));</span></td><td> </td><td class="rblock"><span class="insert">ov();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       reportLuminanceInFov(qMin(700., qMin((double)wl/50, </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">(60.*60.)/(f*f)*6.)));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!noStarHalo)</td><td> </td><td class="right">       if (!noStarHalo)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               preDrawPointSource();</td><td> </td><td class="rblock">               preDrawPointSource(<span class="insert">painter</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawPointSource(x,y,rcm,color);</td><td> </td><td class="right">               drawPointSource(x,y,rcm,color);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               postDrawPointSource();</td><td> </td><td class="right">               postDrawPointSource();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagStarTwinkle=save;</td><td> </td><td class="right">       flagStarTwinkle=save;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float SkyDrawer::findWorldLumForMag(float mag, float targetRadius)</td><td> </td><td class="rblock">float S<span class="insert">telS</span>kyDrawer::findWorldLumForMag(float mag, float targetRadius)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const float saveLum = eye-&gt;getWorldAdaptationLuminance();       // s
ave</td><td> </td><td class="right">       const float saveLum = eye-&gt;getWorldAdaptationLuminance();       // s
ave</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute the luminance by dichotomy</td><td> </td><td class="right">       // Compute the luminance by dichotomy</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float a=0.001f;</td><td> </td><td class="right">       float a=0.001f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float b=500000.f;</td><td> </td><td class="right">       float b=500000.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float rcmag[2];</td><td> </td><td class="right">       float rcmag[2];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rcmag[0]=-99;</td><td> </td><td class="right">       rcmag[0]=-99;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float curLum = 500.f;</td><td> </td><td class="right">       float curLum = 500.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int safety=0;</td><td> </td><td class="right">       int safety=0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l10" /><small>skipping to change at</small><em> line 541</em></th><th> </th><th><a name="part-r10" /><small>skipping to change at</small><em> line 544</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       break;</td><td> </td><td class="right">                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eye-&gt;setWorldAdaptationLuminance(saveLum);      // restore</td><td> </td><td class="right">       eye-&gt;setWorldAdaptationLuminance(saveLum);      // restore</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return curLum;</td><td> </td><td class="right">       return curLum;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Report that an object of luminance lum is currently displayed</td><td> </td><td class="right">// Report that an object of luminance lum is currently displayed</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::reportLuminanceInFov(double lum, bool fastAdaptation)</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::reportLuminanceInFov(double lum, bool fastAdaptation)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (lum &gt; maxLum)</td><td> </td><td class="right">       if (lum &gt; maxLum)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (oldLum&lt;0)</td><td> </td><td class="right">               if (oldLum&lt;0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oldLum=lum;</td><td> </td><td class="right">                       oldLum=lum;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Use a log law for smooth transitions</td><td> </td><td class="right">               // Use a log law for smooth transitions</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (fastAdaptation==true &amp;&amp; lum&gt;oldLum)</td><td> </td><td class="right">               if (fastAdaptation==true &amp;&amp; lum&gt;oldLum)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       maxLum = lum;</td><td> </td><td class="right">                       maxLum = lum;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       float transitionSpeed = 0.2f;</td><td> </td><td class="right">                       float transitionSpeed = 0.2f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       maxLum = std::exp(std::log(oldLum)+(std::log(lum)-st
d::log(oldLum))* qMin(1.f, 1.f/StelApp::getInstance().getFps()/transitionSp
eed));</td><td> </td><td class="right">                       maxLum = std::exp(std::log(oldLum)+(std::log(lum)-st
d::log(oldLum))* qMin(1.f, 1.f/StelApp::getInstance().getFps()/transitionSp
eed));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::preDraw()</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::preDraw()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eye-&gt;setWorldAdaptationLuminance(maxLum);</td><td> </td><td class="right">       eye-&gt;setWorldAdaptationLuminance(maxLum);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Re-initialize for next stage</td><td> </td><td class="right">       // Re-initialize for next stage</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oldLum = maxLum;</td><td> </td><td class="right">       oldLum = maxLum;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       maxLum = 0;</td><td> </td><td class="right">       maxLum = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set the parameters so that the stars disapear at about the limit given b
y the bortle scale</td><td> </td><td class="right">// Set the parameters so that the stars disapear at about the limit given b
y the bortle scale</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// See http://en.wikipedia.org/wiki/Bortle_Dark-Sky_Scale</td><td> </td><td class="right">// See http://en.wikipedia.org/wiki/Bortle_Dark-Sky_Scale</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::setBortleScale(int bIndex)</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::setBortleScale(int bIndex)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Associate the Bortle index (1 to 9) to inScale value</td><td> </td><td class="right">       // Associate the Bortle index (1 to 9) to inScale value</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (bIndex&lt;1)</td><td> </td><td class="right">       if (bIndex&lt;1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; "WARING: Bortle scale index range is [1;9], gi
ven" &lt;&lt; bIndex;</td><td> </td><td class="right">               qWarning() &lt;&lt; "WARING: Bortle scale index range is [1;9], gi
ven" &lt;&lt; bIndex;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               bIndex = 1;</td><td> </td><td class="right">               bIndex = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (bIndex&gt;9)</td><td> </td><td class="right">       if (bIndex&gt;9)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               qWarning() &lt;&lt; "WARING: Bortle scale index range is [1;9], gi
ven" &lt;&lt; bIndex;</td><td> </td><td class="right">               qWarning() &lt;&lt; "WARING: Bortle scale index range is [1;9], gi
ven" &lt;&lt; bIndex;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l11" /><small>skipping to change at</small><em> line 593</em></th><th> </th><th><a name="part-r11" /><small>skipping to change at</small><em> line 596</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bortleScaleIndex = bIndex;</td><td> </td><td class="right">       bortleScaleIndex = bIndex;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // These value have been calibrated by hand, looking at the faintest
 star in stellarium at around 40 deg FOV</td><td> </td><td class="right">       // These value have been calibrated by hand, looking at the faintest
 star in stellarium at around 40 deg FOV</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // They should roughly match the scale described at http://en.wikipe
dia.org/wiki/Bortle_Dark-Sky_Scale</td><td> </td><td class="right">       // They should roughly match the scale described at http://en.wikipe
dia.org/wiki/Bortle_Dark-Sky_Scale</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static const float bortleToInScale[9] = {2.45, 1.55, 1.0, 0.63, 0.40
, 0.24, 0.23, 0.145, 0.09};</td><td> </td><td class="right">       static const float bortleToInScale[9] = {2.45, 1.55, 1.0, 0.63, 0.40
, 0.24, 0.23, 0.145, 0.09};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setInputScale(bortleToInScale[bIndex-1]);</td><td> </td><td class="right">       setInputScale(bortleToInScale[bIndex-1]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Old colors</td><td> </td><td class="right">// Old colors</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">// Vec3f SkyDrawer::colorTable[128] = {</td><td> </td><td class="rblock">// Vec3f S<span class="insert">telS</span>kyDrawer::colorTable[128] = {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.587877,0.755546,1.000000),</td><td> </td><td class="right">//     Vec3f(0.587877,0.755546,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.609856,0.750638,1.000000),</td><td> </td><td class="right">//     Vec3f(0.609856,0.750638,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.624467,0.760192,1.000000),</td><td> </td><td class="right">//     Vec3f(0.624467,0.760192,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.639299,0.769855,1.000000),</td><td> </td><td class="right">//     Vec3f(0.639299,0.769855,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.654376,0.779633,1.000000),</td><td> </td><td class="right">//     Vec3f(0.654376,0.779633,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.669710,0.789527,1.000000),</td><td> </td><td class="right">//     Vec3f(0.669710,0.789527,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.685325,0.799546,1.000000),</td><td> </td><td class="right">//     Vec3f(0.685325,0.799546,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.701229,0.809688,1.000000),</td><td> </td><td class="right">//     Vec3f(0.701229,0.809688,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.717450,0.819968,1.000000),</td><td> </td><td class="right">//     Vec3f(0.717450,0.819968,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(0.733991,0.830383,1.000000),</td><td> </td><td class="right">//     Vec3f(0.733991,0.830383,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l12" /><small>skipping to change at</small><em> line 725</em></th><th> </th><th><a name="part-r12" /><small>skipping to change at</small><em> line 728</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.384653,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.384653,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.380818,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.380818,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.376979,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.376979,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.373166,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.373166,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.369322,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.369322,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.365506,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.365506,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     Vec3f(1.000000,0.361692,0.000000),</td><td> </td><td class="right">//     Vec3f(1.000000,0.361692,0.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// };</td><td> </td><td class="right">// };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// New colors</td><td> </td><td class="right">// New colors</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3f SkyDrawer::colorTable[128] = {</td><td> </td><td class="rblock">Vec3f S<span class="insert">telS</span>kyDrawer::colorTable[128] = {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.602745,0.713725,1.000000),</td><td> </td><td class="right">       Vec3f(0.602745,0.713725,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.604902,0.715294,1.000000),</td><td> </td><td class="right">       Vec3f(0.604902,0.715294,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.607059,0.716863,1.000000),</td><td> </td><td class="right">       Vec3f(0.607059,0.716863,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.609215,0.718431,1.000000),</td><td> </td><td class="right">       Vec3f(0.609215,0.718431,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.611372,0.720000,1.000000),</td><td> </td><td class="right">       Vec3f(0.611372,0.720000,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.613529,0.721569,1.000000),</td><td> </td><td class="right">       Vec3f(0.613529,0.721569,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.635490,0.737255,1.000000),</td><td> </td><td class="right">       Vec3f(0.635490,0.737255,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.651059,0.749673,1.000000),</td><td> </td><td class="right">       Vec3f(0.651059,0.749673,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.666627,0.762092,1.000000),</td><td> </td><td class="right">       Vec3f(0.666627,0.762092,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f(0.682196,0.774510,1.000000),</td><td> </td><td class="right">       Vec3f(0.682196,0.774510,1.000000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l13" /><small>skipping to change at</small><em> line 867</em></th><th> </th><th><a name="part-r13" /><small>skipping to change at</small><em> line 870</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return ((x&lt;=0.0) ? 0.0 : exp(gamma*log(x)));</td><td> </td><td class="right">       return ((x&lt;=0.0) ? 0.0 : exp(gamma*log(x)));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static Vec3f Gamma(double gamma,const Vec3f &amp;x)</td><td> </td><td class="right">static Vec3f Gamma(double gamma,const Vec3f &amp;x)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return Vec3f(Gamma(gamma,x[0]),Gamma(gamma,x[1]),Gamma(gamma,x[2]));</td><td> </td><td class="right">       return Vec3f(Gamma(gamma,x[0]),Gamma(gamma,x[1]),Gamma(gamma,x[2]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Load B-V conversion parameters from config file</td><td> </td><td class="right">// Load B-V conversion parameters from config file</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void SkyDrawer::initColorTableFromConfigFile(QSettings* conf)</td><td> </td><td class="rblock">void S<span class="insert">telS</span>kyDrawer::initColorTableFromConfigFile(QSettings* conf)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       std::map&lt;float,Vec3f&gt; color_map;</td><td> </td><td class="right">       std::map&lt;float,Vec3f&gt; color_map;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (float bV=-0.5f;bV&lt;=4.0f;bV+=0.01)</td><td> </td><td class="right">       for (float bV=-0.5f;bV&lt;=4.0f;bV+=0.01)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               char entry[256];</td><td> </td><td class="right">               char entry[256];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sprintf(entry,"bv_color_%+5.2f",bV);</td><td> </td><td class="right">               sprintf(entry,"bv_color_%+5.2f",bV);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const QStringList s(conf-&gt;value(QString("stars/") + entry).t
oStringList());</td><td> </td><td class="right">               const QStringList s(conf-&gt;value(QString("stars/") + entry).t
oStringList());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (!s.isEmpty())</td><td> </td><td class="right">               if (!s.isEmpty())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Vec3f c;</td><td> </td><td class="right">                       Vec3f c;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l14" /><small>skipping to change at</small><em> line 890</em></th><th> </th><th><a name="part-r14" /><small>skipping to change at</small><em> line 893</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else</td><td> </td><td class="right">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               c =StelUtils::strToVec3f(s);</td><td> </td><td class="right">                               c =StelUtils::strToVec3f(s);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       color_map[bV] = Gamma(eye-&gt;getDisplayGamma(),c);</td><td> </td><td class="right">                       color_map[bV] = Gamma(eye-&gt;getDisplayGamma(),c);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (color_map.size() &gt; 1)</td><td> </td><td class="right">       if (color_map.size() &gt; 1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               for (int i=0;i&lt;128;i++)</td><td> </td><td class="right">               for (int i=0;i&lt;128;i++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       const float bV = SkyDrawer::indexToBV(i);</td><td> </td><td class="rblock">                       const float bV = S<span class="insert">telS</span>kyDrawer::indexToBV(i);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       std::map&lt;float,Vec3f&gt;::const_iterator greater(color_
map.upper_bound(bV));</td><td> </td><td class="right">                       std::map&lt;float,Vec3f&gt;::const_iterator greater(color_
map.upper_bound(bV));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (greater == color_map.begin())</td><td> </td><td class="right">                       if (greater == color_map.begin())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               colorTable[i] = greater-&gt;second;</td><td> </td><td class="right">                               colorTable[i] = greater-&gt;second;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else</td><td> </td><td class="right">                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               std::map&lt;float,Vec3f&gt;::const_iterator less(g
reater);--less;</td><td> </td><td class="right">                               std::map&lt;float,Vec3f&gt;::const_iterator less(g
reater);--less;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (greater == color_map.end())</td><td> </td><td class="right">                               if (greater == color_map.end())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 45 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>68 lines changed or deleted</i></th><th><i> </i></th><th><i>70 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
