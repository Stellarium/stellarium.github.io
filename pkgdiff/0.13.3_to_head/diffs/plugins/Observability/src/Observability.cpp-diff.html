<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-62-generic #101-Ubuntu SMP Thu Jul 30 09:01:36 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Observability.cpp - Observability.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Observability.cpp&nbsp;</th><th> </th><th>&nbsp;Observability.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 74</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 74</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPluginInfo info;</td><td> </td><td class="right">       StelPluginInfo info;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       info.id = "Observability";</td><td> </td><td class="right">       info.id = "Observability";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       info.displayedName = N_("Observability Analysis");</td><td> </td><td class="right">       info.displayedName = N_("Observability Analysis");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       info.authors = "Ivan Marti-Vidal (Onsala Space Observatory)"; // non
-translatable field</td><td> </td><td class="right">       info.authors = "Ivan Marti-Vidal (Onsala Space Observatory)"; // non
-translatable field</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       info.contact = "i.martividal@gmail.com";</td><td> </td><td class="right">       info.contact = "i.martividal@gmail.com";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       info.description = N_("Displays an analysis of a selected object's o
bservability (rise, set, and transit times) for the current date, as well a
s when it is observable through the year. An object is assumed to be observ
able if it is above the horizon during a fraction of the night. Also includ
ed are the dates of the largest separation from the Sun and acronychal and 
cosmical rising and setting. (Explanations are provided in the 'About' tab 
of the plugin's configuration window.)");</td><td> </td><td class="right">       info.description = N_("Displays an analysis of a selected object's o
bservability (rise, set, and transit times) for the current date, as well a
s when it is observable through the year. An object is assumed to be observ
able if it is above the horizon during a fraction of the night. Also includ
ed are the dates of the largest separation from the Sun and acronychal and 
cosmical rising and setting. (Explanations are provided in the 'About' tab 
of the plugin's configuration window.)");</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       info.version = OBSERVABILITY_PLUGIN_VERSION;</td><td> </td><td class="right">       info.version = OBSERVABILITY_PLUGIN_VERSION;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return info;</td><td> </td><td class="right">       return info;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// TODO: Migrate to static const? --BM ==&gt; GZ during JDfix for 0.14: SURE!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// Some useful constants:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::Rad2Deg = 180./M_PI;         // Convert degrees</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> into radians</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::Rad2Hr = 12./M_PI;           // Convert hours i</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">nto radians</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::UA =  AU;                    // 1.4958e+8;     </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">    // Astronomical Unit in Km. ==&gt; HAS BEEN DEFINED IN StelUtils.hpp!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::TFrac = 0.9972677595628414;  // Convert siderea</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">l time into Solar time</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::JDsec = 1./86400.;           // A second in day</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">s. ==&gt; TODO USE StelCore::JD_SECOND instead</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::halfpi = M_PI * 0.5;         //  1.57079632675;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> // pi/2</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::MoonT = 29.530588;           // Moon synodic pe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">riod (used as first estimate of Full Moon). ==&gt; FIND MORE DEC. PLACES!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::RefFullMoon = 2451564.696; // Reference Julian </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">date of a Full Moon.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">const double Observability::MoonPerilune = 0.0024236308; // Smallest Earth-</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Moon distance (in AU).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Observability::Observability()</td><td> </td><td class="right">Observability::Observability()</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       : <span class="delete">Jan1stJD(0.)</span></td><td> </td><td class="rblock">       : <span class="insert">configDialog(new ObservabilityDialog())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       , nextFullMoon(0.)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       , prevFullMoon(0.)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , GMTShift(0.)</td><td> </td><td class="right">       , GMTShift(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       , Jan1stJD(0.)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , twilightAltRad(0.)</td><td> </td><td class="right">       , twilightAltRad(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , twilightAltDeg(0.)</td><td> </td><td class="right">       , twilightAltDeg(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       , refractedHorizonAlt(0.)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , horizonAltitude(0.)</td><td> </td><td class="right">       , horizonAltitude(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , horizonAltDeg(0.)</td><td> </td><td class="right">       , horizonAltDeg(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , selRA(0.)</td><td> </td><td class="right">       , selRA(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , selDec(0.)</td><td> </td><td class="right">       , selDec(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , alti(0.)</td><td> </td><td class="right">       , alti(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , horizH(0.)</td><td> </td><td class="right">       , horizH(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , culmAlt(0.)</td><td> </td><td class="right">       , culmAlt(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , MoonRise(0.)</td><td> </td><td class="right">       , MoonRise(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , MoonSet(0.)</td><td> </td><td class="right">       , MoonSet(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , MoonCulm(0.)</td><td> </td><td class="right">       , MoonCulm(0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 108</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 124</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , show_AcroCos(false)</td><td> </td><td class="right">       , show_AcroCos(false)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , show_Good_Nights(false)</td><td> </td><td class="right">       , show_Good_Nights(false)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , show_Best_Night(false)</td><td> </td><td class="right">       , show_Best_Night(false)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , show_Today(false)</td><td> </td><td class="right">       , show_Today(false)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , show_FullMoon(false)</td><td> </td><td class="right">       , show_FullMoon(false)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , flagShowReport(false)</td><td> </td><td class="right">       , flagShowReport(false)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , fontSize(14)</td><td> </td><td class="right">       , fontSize(14)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       , button(NULL)</td><td> </td><td class="right">       , button(NULL)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       setObjectName("Observability");</td><td> </td><td class="right">       setObjectName("Observability");</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">configDialog = new ObservabilityDialog();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       // TODO: Migrate to static const? --BM</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       // Some useful constants:</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Rad2Deg = 180./3.1415927; // Convert degrees into radians</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       Rad2Hr = 12./3.1415927;  // Convert hours into radians</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       UA = 1.4958e+8;         // Astronomical Unit in Km.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       TFrac = 0.9972677595628414;  // Convert sidereal time into Solar tim</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       JDsec = 1./86400.;      // A second in days.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       halfpi = 1.57079632675; // pi/2</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       MoonT = 29.530588; // Moon synodic period (used as first estimate of</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"> Full Moon).</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       RefFullMoon = 2451564.696; // Reference Julian date of a Full Moon.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       MoonPerilune = 0.0024236308; // Smallest Earth-Moon distance (in AU)</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">.</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"></span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       nextFullMoon = 0.0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       prevFullMoon = 0.0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       refractedHorizonAlt = 0.0;</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       selName = "";</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Dummy initial values for parameters and data vectors:</td><td> </td><td class="right">       // Dummy initial values for parameters and data vectors:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       mylat = 1000.; mylon = 1000.;</td><td> </td><td class="rblock">       mylat = 1000.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">myJD</span> = <span class="delete">0.0;</span></td><td> </td><td class="rblock">       mylon = 1000.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">myJD.first</span> = <span class="insert">0.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       myJD.second = 0.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       curYear = 0;</td><td> </td><td class="right">       curYear = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       isStar = true;</td><td> </td><td class="right">       isStar = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       isMoon = false;</td><td> </td><td class="right">       isMoon = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       isSun = false;</td><td> </td><td class="right">       isSun = false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       isScreen = true;</td><td> </td><td class="right">       isScreen = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //Get pointer to the Earth:</td><td> </td><td class="right">       //Get pointer to the Earth:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       PlanetP Earth = GETSTELMODULE(SolarSystem)-&gt;getEarth();</td><td> </td><td class="right">       PlanetP Earth = GETSTELMODULE(SolarSystem)-&gt;getEarth();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       myEarth = Earth.data();</td><td> </td><td class="right">       myEarth = Earth.data();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Get pointer to the Moon/Sun:</td><td> </td><td class="right">       // Get pointer to the Moon/Sun:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       PlanetP Moon = GETSTELMODULE(SolarSystem)-&gt;getMoon();</td><td> </td><td class="right">       PlanetP Moon = GETSTELMODULE(SolarSystem)-&gt;getMoon();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       myMoon = Moon.data();</td><td> </td><td class="right">       myMoon = Moon.data();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // I think this can be done in a more simple way...--BM</td><td> </td><td class="right">       // I think this can be done in a more simple way...--BM</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (int i=0;i&lt;366;i++) {</td><td> </td><td class="right">       for (int i=0;i&lt;366;i++) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               sunRA[i] = 0.0; sunDec[i] = 0.0;</td><td> </td><td class="rblock"><span class="insert">//</span>             sunRA[i] = 0.0; sunDec[i] = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               objectRA[i] = 0.0; objectDec[i]=0.0;</td><td> </td><td class="rblock"><span class="insert">//</span>             objectRA[i] = 0.0; objectDec[i]=0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               sunSidT[0][i]=0.0; sunSidT[1][i]=0.0;</td><td> </td><td class="rblock"><span class="insert">//</span>             sunSidT[0][i]=0.0; sunSidT[1][i]=0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               objectSidT[0][i]=0.0; objectSidT[1][i]=0.0;</td><td> </td><td class="rblock"><span class="insert">//</span>             objectSidT[0][i]=0.0; objectSidT[1][i]=0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               objectH0[i] = 0.0;</td><td> </td><td class="rblock"><span class="insert">//</span>             objectH0[i] = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">yearJD[i] = 0.0;</span></td><td> </td><td class="rblock">               <span class="insert">yearJD[i]=QPair&lt;double, double&gt;(0.0, 0.0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">// GZ Sure:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(sunRA,      0,   366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(sunDec,     0,   366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(objectRA,   0,   366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(objectDec,  0,   366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(sunSidT,    0, 2*366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(objectSidT, 0, 2*366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       memset(objectH0,   0,   366*sizeof(double));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Observability::~Observability()</td><td> </td><td class="right">Observability::~Observability()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Shouldn't this be in the deinit()? --BM</td><td> </td><td class="right">       // Shouldn't this be in the deinit()? --BM</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (configDialog != NULL)</td><td> </td><td class="right">       if (configDialog != NULL)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete configDialog;</td><td> </td><td class="right">               delete configDialog;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 281</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 289</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set the painter:</td><td> </td><td class="right">// Set the painter:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter painter(core-&gt;getProjection2d());</td><td> </td><td class="right">       StelPainter painter(core-&gt;getProjection2d());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       painter.setColor(fontColor[0],fontColor[1],fontColor[2],1);</td><td> </td><td class="right">       painter.setColor(fontColor[0],fontColor[1],fontColor[2],1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       font.setPixelSize(fontSize);</td><td> </td><td class="right">       font.setPixelSize(fontSize);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       painter.setFont(font);</td><td> </td><td class="right">       painter.setFont(font);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get current date, location, and check if there is something selected.</td><td> </td><td class="right">// Get current date, location, and check if there is something selected.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double currlat = (core-&gt;getCurrentLocation().latitude)/Rad2Deg;</td><td> </td><td class="right">       double currlat = (core-&gt;getCurrentLocation().latitude)/Rad2Deg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double currlon = (core-&gt;getCurrentLocation().longitude)/Rad2Deg;</td><td> </td><td class="right">       double currlon = (core-&gt;getCurrentLocation().longitude)/Rad2Deg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double currheight = (6371.+(core-&gt;getCurrentLocation().altitude)/100
0.)/UA;</td><td> </td><td class="right">       double currheight = (6371.+(core-&gt;getCurrentLocation().altitude)/100
0.)/UA;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double currJD = core-&gt;getJD<span class="delete">ay</span>();</td><td> </td><td class="rblock">       double currJD = core-&gt;getJD();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double currJDint;</td><td> </td><td class="right">       double currJDint;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     GMTShift = StelUtils::getGMTShiftFromQT(currJD)/24.0;</td><td> </td><td class="right">//     GMTShift = StelUtils::getGMTShiftFromQT(currJD)/24.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GMTShift = StelApp::getInstance().getLocaleMgr().getGMTShift(currJD)
/24.0;</td><td> </td><td class="right">       GMTShift = StelApp::getInstance().getLocaleMgr().getGMTShift(currJD)
/24.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//     qDebug() &lt;&lt; QString("%1%2 ").arg(GMTShift);</td><td> </td><td class="right">//     qDebug() &lt;&lt; QString("%1%2 ").arg(GMTShift);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double currLocalT = 24.*modf(currJD + GMTShift,&amp;currJDint);</td><td> </td><td class="right">       double currLocalT = 24.*modf(currJD + GMTShift,&amp;currJDint);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int auxm, auxd, auxy;</td><td> </td><td class="right">       int auxm, auxd, auxy;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelUtils::getDateFromJulianDay(currJD, &amp;auxy, &amp;auxm, &amp;auxd);</td><td> </td><td class="right">       StelUtils::getDateFromJulianDay(currJD, &amp;auxy, &amp;auxm, &amp;auxd);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool isSource = StelApp::getInstance().getStelObjectMgr().getWasSele
cted();</td><td> </td><td class="right">       bool isSource = StelApp::getInstance().getStelObjectMgr().getWasSele
cted();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool show_Year = show_Best_Night || show_Good_Nights || show_AcroCos
;</td><td> </td><td class="right">       bool show_Year = show_Best_Night || show_Good_Nights || show_AcroCos
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// NOW WE CHECK THE CHANGED PARAMETERS W.R.T. THE PREVIOUS FRAME:</td><td> </td><td class="right">// NOW WE CHECK THE CHANGED PARAMETERS W.R.T. THE PREVIOUS FRAME:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Update JD.</td><td> </td><td class="right">// Update JD.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       myJD = currJD;</td><td> </td><td class="rblock">       myJD<span class="insert">.first</span> = currJD;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// If the year changed, we must recompute the Sun's position for each new d
ay:</td><td> </td><td class="right">// If the year changed, we must recompute the Sun's position for each new d
ay:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (auxy != curYear)</td><td> </td><td class="right">       if (auxy != curYear)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               yearChanged = true;</td><td> </td><td class="right">               yearChanged = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               curYear = auxy;</td><td> </td><td class="right">               curYear = auxy;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               updateSunData(core);</td><td> </td><td class="right">               updateSunData(core);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 484</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 492</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Today's ephemeris (rise, set, and transit times)</td><td> </td><td class="right">               // Today's ephemeris (rise, set, and transit times)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (!isStar)</td><td> </td><td class="right">               if (!isStar)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       int type = (isSun) ? 1:0;</td><td> </td><td class="right">                       int type = (isSun) ? 1:0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       type += (isMoon) ? 2:0;</td><td> </td><td class="right">                       type += (isMoon) ? 2:0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       type += (!isSun &amp;&amp; !isMoon) ? 3:0;</td><td> </td><td class="right">                       type += (!isSun &amp;&amp; !isMoon) ? 3:0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Returns false if the calculation fails...</td><td> </td><td class="right">                       // Returns false if the calculation fails...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       solvedMoon = calculateSolarSystemEvents(core, type);</td><td> </td><td class="right">                       solvedMoon = calculateSolarSystemEvents(core, type);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       currH = <span class="delete">qAbs(24.*(MoonCulm-myJD)/TFrac);</span></td><td> </td><td class="rblock">                       currH = <span class="insert">qAbs(24.*(MoonCulm-myJD.first)/TFrac);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       transit = <span class="delete">MoonCulm-myJD&lt;0.0;</span></td><td> </td><td class="rblock">                       transit = <span class="insert">MoonCulm-myJD.first&lt;0.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (solvedMoon)</td><td> </td><td class="right">                       if (solvedMoon)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {  // If failed, Set and Rise will be dummy.</td><td> </td><td class="right">                       {  // If failed, Set and Rise will be dummy.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               settingTime = <span class="delete">qAbs(24.*(MoonSet-myJD)/TFrac)</span></td><td> </td><td class="rblock">                               settingTime = <span class="insert">qAbs(24.*(MoonSet-myJD.first)/</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span></td><td> </td><td class="rblock"><span class="insert">TFrac);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               risingTime = <span class="delete">qAbs(24.*(MoonRise-myJD)/TFrac)</span></td><td> </td><td class="rblock">                               risingTime = <span class="insert">qAbs(24.*(MoonRise-myJD.first)/</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span></td><td> </td><td class="rblock"><span class="insert">TFrac);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else if (horizH&gt;0.0)</td><td> </td><td class="right">               else if (horizH&gt;0.0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               { // The source is not circumpolar and can be seen from this
 latitude.</td><td> </td><td class="right">               { // The source is not circumpolar and can be seen from this
 latitude.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if ( LocPos[1]&gt;0.0 ) // The source is at the eastern
 side...</td><td> </td><td class="right">                       if ( LocPos[1]&gt;0.0 ) // The source is at the eastern
 side...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if ( currH&gt;horizH ) // ... and below the hor
izon.</td><td> </td><td class="right">                               if ( currH&gt;horizH ) // ... and below the hor
izon.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       settingTime = 24.-currH-horizH;</td><td> </td><td class="right">                                       settingTime = 24.-currH-horizH;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 926</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 934</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double auxRA = 24.*std::modf(RA/24.,&amp;tempRA);</td><td> </td><td class="right">       double auxRA = 24.*std::modf(RA/24.,&amp;tempRA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       auxRA += (auxRA&lt;0.0)?24.0:((auxRA&gt;24.0)?-24.0:0.0);</td><td> </td><td class="right">       auxRA += (auxRA&lt;0.0)?24.0:((auxRA&gt;24.0)?-24.0:0.0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return auxRA;</td><td> </td><td class="right">       return auxRA;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////////////////////</td><td> </td><td class="right">////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Observability::formatAsDate(int dayNumber)</td><td> </td><td class="right">QString Observability::formatAsDate(int dayNumber)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int day, month, year;</td><td> </td><td class="right">       int day, month, year;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       StelUtils::getDateFromJulianDay(yearJD[dayNumber]<span class="delete">, &amp;year, &amp;month, &amp;d
</span>ay);</td><td> </td><td class="rblock">       StelUtils::getDateFromJulianDay(yearJD[dayNumber]<span class="insert">.first, &amp;year, &amp;mon
th, &amp;d</span>ay);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString formatString = (getDateFormat()) ? "%1 %2" : "%2 %1";</td><td> </td><td class="right">       QString formatString = (getDateFormat()) ? "%1 %2" : "%2 %1";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString result = formatString.arg(day).arg(monthNames[month-1]);</td><td> </td><td class="right">       QString result = formatString.arg(day).arg(monthNames[month-1]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return result;</td><td> </td><td class="right">       return result;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////</td><td> </td><td class="right">///////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Returns the day and month of year (to put it in format '25 Apr')</td><td> </td><td class="right">// Returns the day and month of year (to put it in format '25 Apr')</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Observability::formatAsDateRange(int startDay, int endDay)</td><td> </td><td class="right">QString Observability::formatAsDateRange(int startDay, int endDay)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int sDay, sMonth, sYear, eDay, eMonth, eYear;</td><td> </td><td class="right">       int sDay, sMonth, sYear, eDay, eMonth, eYear;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString range;</td><td> </td><td class="right">       QString range;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">StelUtils::getDateFromJulianDay(yearJD[startDay],</span> &amp;sYear, <span class="delete">&amp;sMonth, &amp;</span></td><td> </td><td class="rblock">       <span class="insert">StelUtils::getDateFromJulianDay(yearJD[startDay].first,</span> &amp;sYear, <span class="insert">&amp;sMo</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">sDay);</span></td><td> </td><td class="rblock"><span class="insert">nth, &amp;sDay);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       StelUtils::getDateFromJulianDay(yearJD[endDay],</span> &amp;eYear, <span class="delete">&amp;eMonth, &amp;eD</span></td><td> </td><td class="rblock"><span class="insert">       StelUtils::getDateFromJulianDay(yearJD[endDay].first,</span> &amp;eYear, <span class="insert">&amp;eMont</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ay);</span></td><td> </td><td class="rblock"><span class="insert">h, &amp;eDay);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (endDay == 0)</td><td> </td><td class="right">       if (endDay == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               eDay = 31;</td><td> </td><td class="right">               eDay = 31;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               eMonth = 12;</td><td> </td><td class="right">               eMonth = 12;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (startDay == 0)</td><td> </td><td class="right">       if (startDay == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sDay = 1;</td><td> </td><td class="right">               sDay = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sMonth = 1;</td><td> </td><td class="right">               sMonth = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 996</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 1004</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       getPlanetCoords(core, myJD, objectRA[0], objectDec[0], true);</td><td> </td><td class="right">       getPlanetCoords(core, myJD, objectRA[0], objectDec[0], true);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/////////////////////////////////////////////////</td><td> </td><td class="right">/////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Computes the Sun's RA and Dec (and the JD) for</td><td> </td><td class="right">// Computes the Sun's RA and Dec (and the JD) for</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// each day of the current year.</td><td> </td><td class="right">// each day of the current year.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Observability::updateSunData(StelCore* core)</td><td> </td><td class="right">void Observability::updateSunData(StelCore* core)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int day, month, year, sameYear;</td><td> </td><td class="right">       int day, month, year, sameYear;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get current date:</td><td> </td><td class="right">// Get current date:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       StelUtils::getDateFromJulianDay(myJD,&amp;year,&amp;month,&amp;day);</td><td> </td><td class="rblock">       StelUtils::getDateFromJulianDay(myJD<span class="insert">.first</span>,&amp;year,&amp;month,&amp;day);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get JD for the Jan 1 of current year:</td><td> </td><td class="right">// Get JD for the Jan 1 of current year:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelUtils::getJDFromDate(&amp;Jan1stJD,year,1,1,0,0,0);</td><td> </td><td class="right">       StelUtils::getJDFromDate(&amp;Jan1stJD,year,1,1,0,0,0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Check if we are on a leap year:</td><td> </td><td class="right">// Check if we are on a leap year:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelUtils::getDateFromJulianDay(Jan1stJD+365., &amp;sameYear, &amp;month, &amp;d
ay);</td><td> </td><td class="right">       StelUtils::getDateFromJulianDay(Jan1stJD+365., &amp;sameYear, &amp;month, &amp;d
ay);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nDays = (year==sameYear)?366:365;</td><td> </td><td class="right">       nDays = (year==sameYear)?366:365;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute Earth's position throughout the year:</td><td> </td><td class="right">// Compute Earth's position throughout the year:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d pos, sunPos;</td><td> </td><td class="right">       Vec3d pos, sunPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (int i=0; i&lt;nDays; i++)</td><td> </td><td class="right">       for (int i=0; i&lt;nDays; i++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">yearJD[i]</span> = Jan1stJD + (double)i;</td><td> </td><td class="rblock">               <span class="insert">yearJD[i].first</span> = Jan1stJD + (double)i;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(yearJD[i]);</span></td><td> </td><td class="rblock">               <span class="insert">yearJD[i].second = yearJD[i].first+core-&gt;computeDeltaT(yearJ</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(yearJD[i]);</span></td><td> </td><td class="rblock"><span class="insert">D[i].first)/86400.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computePosition(yearJD[i].second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(yearJD[i].first, yearJD[i].secon</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">d);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               pos = myEarth-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               pos = myEarth-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sunPos = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ2000)*(-
pos));</td><td> </td><td class="right">               sunPos = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ2000)*(-
pos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               EarthPos[i] = -pos;</td><td> </td><td class="right">               EarthPos[i] = -pos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               toRADec(sunPos,sunRA[i],sunDec[i]);</td><td> </td><td class="right">               toRADec(sunPos,sunRA[i],sunDec[i]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//Return the Earth to its current time:</td><td> </td><td class="right">//Return the Earth to its current time:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">myEarth-&gt;computePosition(myJD);</span></td><td> </td><td class="rblock">       <span class="insert">myEarth-&gt;computePosition(myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       myEarth-&gt;computeTransMatrix(myJD);</span></td><td> </td><td class="rblock"><span class="insert">       myEarth-&gt;computeTransMatrix(myJD.first, myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">///////////////////////////////////////////////////</td><td> </td><td class="right">///////////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">////////////////////////////////////////////</td><td> </td><td class="right">////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Computes Sun's Sidereal Times at twilight and culmination:</td><td> </td><td class="right">// Computes Sun's Sidereal Times at twilight and culmination:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Observability::updateSunH()</td><td> </td><td class="right">void Observability::updateSunH()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double tempH, tempH00;</td><td> </td><td class="right">       double tempH, tempH00;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (int i=0; i&lt;nDays; i++)</td><td> </td><td class="right">       for (int i=0; i&lt;nDays; i++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 1225</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 1234</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Just return the sign of a double</td><td> </td><td class="right">// Just return the sign of a double</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Observability::sign(double d)</td><td> </td><td class="right">double Observability::sign(double d)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return (d&lt;0.0)?-1.0:1.0;</td><td> </td><td class="right">       return (d&lt;0.0)?-1.0:1.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////</td><td> </td><td class="right">//////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////</td><td> </td><td class="right">//////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the coordinates of Sun or Moon for a given JD:</td><td> </td><td class="right">// Get the coordinates of Sun or Moon for a given JD:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// getBack controls whether Earth and Moon must be returned to their origin
al positions after computation.</td><td> </td><td class="right">// getBack controls whether Earth and Moon must be returned to their origin
al positions after computation.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Observability::getSunMoonCoords(StelCore *core, <span class="delete">double jd,</span></td><td> </td><td class="rblock">void Observability::getSunMoonCoords(StelCore *core, <span class="insert">QPair&lt;double, double&gt; </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                     double &amp;raSun, double &amp;decSun,</td><td> </td><td class="rblock"><span class="insert">JD,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                     double &amp;raMoon, double &amp;decMoon,</td><td> </td><td class="rblock">                                    double &amp;raSun, double &amp;decSun,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                     double &amp;eclLon, bool getBack)</td><td> </td><td class="rblock">                                    double &amp;raMoon, double &amp;decMoon,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                    double &amp;eclLon, bool getBack)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                     //, Vec3d &amp;AltAzVector)</td><td> </td><td class="right">                                     //, Vec3d &amp;AltAzVector)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (getBack) // Return the Moon and Earth to their current position:</td><td> </td><td class="right">       if (getBack) // Return the Moon and Earth to their current position:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(jd);</span></td><td> </td><td class="rblock">               <span class="insert">myEarth-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myMoon-&gt;computePosition(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myMoon-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myMoon-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myMoon-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else // Compute coordinates:</td><td> </td><td class="right">       else // Compute coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(jd);</span></td><td> </td><td class="rblock">               <span class="insert">myEarth-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d earthPos = myEarth-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Vec3d earthPos = myEarth-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double curSidT;</td><td> </td><td class="right">               double curSidT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Sun coordinates:</td><td> </td><td class="right">// Sun coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d sunPos = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ20
00)*(-earthPos));</td><td> </td><td class="right">               Vec3d sunPos = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ20
00)*(-earthPos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               toRADec(sunPos, raSun, decSun);</td><td> </td><td class="right">               toRADec(sunPos, raSun, decSun);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Moon coordinates:</td><td> </td><td class="right">// Moon coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               curSidT = myEarth-&gt;getSiderealTime(<span class="delete">jd)/Rad2</span>Deg;</td><td> </td><td class="rblock">               curSidT = myEarth-&gt;getSiderealTime(<span class="insert">JD.first, JD.second)/Rad2
</span>Deg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               RotObserver = (Mat4d::zrotation(curSidT))*ObserverLoc;</td><td> </td><td class="right">               RotObserver = (Mat4d::zrotation(curSidT))*ObserverLoc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translation(-ear
thPos));</td><td> </td><td class="right">               LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translation(-ear
thPos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myMoon-&gt;computePosition(jd);</span></td><td> </td><td class="rblock">               <span class="insert">myMoon-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myMoon-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myMoon-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d moonPos = myMoon-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Vec3d moonPos = myMoon-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sunPos = (core-&gt;j2000ToEquinoxEqu(LocTrans*moonPos))-RotObse
rver;</td><td> </td><td class="right">               sunPos = (core-&gt;j2000ToEquinoxEqu(LocTrans*moonPos))-RotObse
rver;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               eclLon = moonPos[0]*earthPos[1] - moonPos[1]*earthPos[0];</td><td> </td><td class="right">               eclLon = moonPos[0]*earthPos[1] - moonPos[1]*earthPos[0];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               toRADec(sunPos,raMoon,decMoon);</td><td> </td><td class="right">               toRADec(sunPos,raMoon,decMoon);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////</td><td> </td><td class="right">//////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the Observer-to-Moon distance JD:</td><td> </td><td class="right">// Get the Observer-to-Moon distance JD:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// getBack controls whether Earth and Moon must be returned to their origin
al positions after computation.</td><td> </td><td class="right">// getBack controls whether Earth and Moon must be returned to their origin
al positions after computation.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Observability::getMoonDistance(StelCore *core, <span class="delete">double jd, double &amp;dist
</span>ance, bool getBack)</td><td> </td><td class="rblock">void Observability::getMoonDistance(StelCore *core, <span class="insert">QPair&lt;double, double&gt; J
D, double &amp;dist</span>ance, bool getBack)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (getBack) // Return the Moon and Earth to their current position:</td><td> </td><td class="right">       if (getBack) // Return the Moon and Earth to their current position:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(jd);</span></td><td> </td><td class="rblock">               <span class="insert">myEarth-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myMoon-&gt;computePosition(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myMoon-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myMoon-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myMoon-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {       // Compute coordinates:</td><td> </td><td class="right">       {       // Compute coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(jd);</span></td><td> </td><td class="rblock">               <span class="insert">myEarth-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d earthPos = myEarth-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Vec3d earthPos = myEarth-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             double curSidT;</td><td> </td><td class="right">//             double curSidT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Sun coordinates:</td><td> </td><td class="right">// Sun coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             Pos2 = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ2000)*(-Po
s0));</td><td> </td><td class="right">//             Pos2 = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ2000)*(-Po
s0));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             toRADec(Pos2,RASun,DecSun);</td><td> </td><td class="right">//             toRADec(Pos2,RASun,DecSun);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Moon coordinates:</td><td> </td><td class="right">// Moon coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             curSidT = myEarth-&gt;getSiderealTime(JD)/Rad2Deg;</td><td> </td><td class="right">//             curSidT = myEarth-&gt;getSiderealTime(JD)/Rad2Deg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             RotObserver = (Mat4d::zrotation(curSidT))*ObserverLoc;</td><td> </td><td class="right">//             RotObserver = (Mat4d::zrotation(curSidT))*ObserverLoc;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translation(-ear
thPos));</td><td> </td><td class="right">               LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translation(-ear
thPos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myMoon-&gt;computePosition(jd);</span></td><td> </td><td class="rblock">               <span class="insert">myMoon-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myMoon-&gt;computeTransMatrix(jd);</span></td><td> </td><td class="rblock"><span class="insert">               myMoon-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Pos1 = myMoon-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Pos1 = myMoon-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Pos2 = (core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1)); //-RotObser
ver;</td><td> </td><td class="right">               Pos2 = (core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1)); //-RotObser
ver;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               distance = std::sqrt(Pos2*Pos2);</td><td> </td><td class="right">               distance = std::sqrt(Pos2*Pos2);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             toRADec(Pos2,RAMoon,DecMoon);</td><td> </td><td class="right">//             toRADec(Pos2,RAMoon,DecMoon);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the Coords of a planet:</td><td> </td><td class="right">// Get the Coords of a planet:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Observability::getPlanetCoords(StelCore *core, <span class="delete">double JD, double &amp;RA, 
</span>double &amp;Dec, bool getBack)</td><td> </td><td class="rblock">void Observability::getPlanetCoords(StelCore *core, <span class="insert">QPair&lt;double, double&gt; J
D, double &amp;RA, </span>double &amp;Dec, bool getBack)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (getBack)</td><td> </td><td class="right">       if (getBack)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Return the planet to its current time:</td><td> </td><td class="right">       // Return the planet to its current time:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myPlanet-&gt;computePosition(JD);</span></td><td> </td><td class="rblock">               <span class="insert">myPlanet-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myPlanet-&gt;computeTransMatrix(JD);</span></td><td> </td><td class="rblock"><span class="insert">               myPlanet-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computePosition(JD);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(JD);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       } else</td><td> </td><td class="right">       } else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute planet's position:</td><td> </td><td class="right">       // Compute planet's position:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myPlanet-&gt;computePosition(JD);</span></td><td> </td><td class="rblock">               <span class="insert">myPlanet-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myPlanet-&gt;computeTransMatrix(JD);</span></td><td> </td><td class="rblock"><span class="insert">               myPlanet-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Pos1 = myPlanet-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Pos1 = myPlanet-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(JD);</span></td><td> </td><td class="rblock">               <span class="insert">myEarth-&gt;computePosition(JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(JD);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(JD.first, JD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Pos2 = myEarth-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Pos2 = myEarth-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translation(-Pos
2));</td><td> </td><td class="right">               LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translation(-Pos
2));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Pos2 = core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1);</td><td> </td><td class="right">               Pos2 = core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               toRADec(Pos2,RA,Dec);</td><td> </td><td class="right">               toRADec(Pos2,RA,Dec);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       };</td><td> </td><td class="right">       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//////////////////////////////////////////////</td><td> </td><td class="right">//////////////////////////////////////////////</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Solves Moon's, Sun's, or Planet's ephemeris by bissection.</td><td> </td><td class="right">// Solves Moon's, Sun's, or Planet's ephemeris by bissection.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool Observability::calculateSolarSystemEvents(StelCore* core, int bodyType
)</td><td> </td><td class="right">bool Observability::calculateSolarSystemEvents(StelCore* core, int bodyType
)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int NUM_ITER = 100;</td><td> </td><td class="right">       const int NUM_ITER = 100;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int i;</td><td> </td><td class="right">       int i;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double hHoriz, ra, dec, raSun, decSun, tempH, tempJd, <span class="delete">tempEphH, curS</span></td><td> </td><td class="rblock">       double hHoriz, ra, dec, raSun, decSun, tempH, <span class="insert">/*</span> tempJd, <span class="insert">*/ tempEphH</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">idT,</span> eclLon;</td><td> </td><td class="rblock"><span class="insert">, curSidT,</span> eclLon;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">QPair&lt;double, double&gt; tempJd;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //Vec3d Observer;</td><td> </td><td class="right">       //Vec3d Observer;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       hHoriz = calculateHourAngle(mylat, refractedHorizonAlt, selDec);</td><td> </td><td class="right">       hHoriz = calculateHourAngle(mylat, refractedHorizonAlt, selDec);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       bool raises = hHoriz &gt; 0.0;</td><td> </td><td class="right">       bool raises = hHoriz &gt; 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Only recompute ephemeris from second to second (at least)</td><td> </td><td class="right">// Only recompute ephemeris from second to second (at least)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// or if the source has changed (i.e., Sun &lt;-&gt; Moon). This saves resources:</td><td> </td><td class="right">// or if the source has changed (i.e., Sun &lt;-&gt; Moon). This saves resources:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (qAbs(myJD<span class="delete">-lastJDMoon)&gt;JDsec || lastType!=bodyType || souCh</span>anged)</td><td> </td><td class="rblock">       if (qAbs(myJD<span class="insert">.first-lastJDMoon)&gt;JDsec || lastType!=bodyType || souCh
</span>anged)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             qDebug() &lt;&lt; q_("%1  %2   %3   %4").arg(Kind).arg(LastObject)
.arg(myJD,0,'f',5).arg(lastJDMoon,0,'f',5);</td><td> </td><td class="right">//             qDebug() &lt;&lt; q_("%1  %2   %3   %4").arg(Kind).arg(LastObject)
.arg(myJD,0,'f',5).arg(lastJDMoon,0,'f',5);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastType = bodyType;</td><td> </td><td class="right">               lastType = bodyType;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">myEarth-&gt;computePosition(myJD);</span></td><td> </td><td class="rblock">               <span class="insert">myEarth-&gt;computePosition(myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               myEarth-&gt;computeTransMatrix(myJD);</span></td><td> </td><td class="rblock"><span class="insert">               myEarth-&gt;computeTransMatrix(myJD.first, myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d earthPos = myEarth-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">               Vec3d earthPos = myEarth-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (bodyType == 1) // Sun position</td><td> </td><td class="right">               if (bodyType == 1) // Sun position</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Pos2 = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ20
00)*(-earthPos));</td><td> </td><td class="right">                       Pos2 = core-&gt;j2000ToEquinoxEqu((core-&gt;matVsop87ToJ20
00)*(-earthPos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else if (bodyType==2) // Moon position</td><td> </td><td class="right">               else if (bodyType==2) // Moon position</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       curSidT = myEarth-&gt;getSiderealTime(myJD)/Rad2Deg;</td><td> </td><td class="rblock">                       curSidT = myEarth-&gt;getSiderealTime(myJD<span class="insert">.first, myJD.
second</span>)/Rad2Deg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       RotObserver = (Mat4d::zrotation(curSidT))*ObserverLo
c;</td><td> </td><td class="right">                       RotObserver = (Mat4d::zrotation(curSidT))*ObserverLo
c;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translat
ion(-earthPos));</td><td> </td><td class="right">                       LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translat
ion(-earthPos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">myMoon-&gt;computePosition(myJD);</span></td><td> </td><td class="rblock">                       <span class="insert">myMoon-&gt;computePosition(myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       myMoon-&gt;computeTransMatrix(myJD);</span></td><td> </td><td class="rblock"><span class="insert">                       myMoon-&gt;computeTransMatrix(myJD.first, myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Pos1 = myMoon-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">                       Pos1 = myMoon-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Pos2 = (core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1))-RotO
bserver;</td><td> </td><td class="right">                       Pos2 = (core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1))-RotO
bserver;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else // Planet position</td><td> </td><td class="right">               else // Planet position</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">myPlanet-&gt;computePosition(myJD);</span></td><td> </td><td class="rblock">                       <span class="insert">myPlanet-&gt;computePosition(myJD.second);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       myPlanet-&gt;computeTransMatrix(myJD);</span></td><td> </td><td class="rblock"><span class="insert">                       myPlanet-&gt;computeTransMatrix(myJD.first, myJD.second</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Pos1 = myPlanet-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">                       Pos1 = myPlanet-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translat
ion(-earthPos));</td><td> </td><td class="right">                       LocTrans = (core-&gt;matVsop87ToJ2000)*(Mat4d::translat
ion(-earthPos));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Pos2 = core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1);</td><td> </td><td class="right">                       Pos2 = core-&gt;j2000ToEquinoxEqu(LocTrans*Pos1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               };</td><td> </td><td class="right">               };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               toRADec(Pos2,ra,dec);</td><td> </td><td class="right">               toRADec(Pos2,ra,dec);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d moonAltAz = core-&gt;equinoxEquToAltAz(Pos2, StelCore::Re
fractionOff);</td><td> </td><td class="right">               Vec3d moonAltAz = core-&gt;equinoxEquToAltAz(Pos2, StelCore::Re
fractionOff);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               hasRisen = moonAltAz[2] &gt; refractedHorizonAlt;</td><td> </td><td class="right">               hasRisen = moonAltAz[2] &gt; refractedHorizonAlt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Initial guesses of rise/set/transit times.</td><td> </td><td class="right">// Initial guesses of rise/set/transit times.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 1408</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 1418</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (raises)</td><td> </td><td class="right">               if (raises)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (!hasRisen)</td><td> </td><td class="right">                       if (!hasRisen)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               MoonRise += (MoonRise&lt;0.0)?24.0:0.0;</td><td> </td><td class="right">                               MoonRise += (MoonRise&lt;0.0)?24.0:0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               MoonSet -= (MoonSet&gt;0.0)?24.0:0.0;</td><td> </td><td class="right">                               MoonSet -= (MoonSet&gt;0.0)?24.0:0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Rise time:</td><td> </td><td class="right">// Rise time:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       tempEphH = MoonRise*TFrac;</td><td> </td><td class="right">                       tempEphH = MoonRise*TFrac;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       MoonRise = myJD + (MoonRise/24.);</td><td> </td><td class="rblock">                       MoonRise = myJD<span class="insert">.first</span> + (MoonRise/24.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for (i=0; i&lt;NUM_ITER; i++)</td><td> </td><td class="right">                       for (i=0; i&lt;NUM_ITER; i++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Get modified coordinates:</td><td> </td><td class="right">       // Get modified coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">tempJd</span> = MoonRise;</td><td> </td><td class="rblock">                               <span class="insert">tempJd.first</span> = MoonRise;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               <span class="insert">tempJd.second=tempJd.first+core-&gt;computeDelt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">aT(tempJd.first)/86400.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (bodyType&lt;3)</td><td> </td><td class="right">                               if (bodyType&lt;3)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       getSunMoonCoords(core, tempJd,</td><td> </td><td class="right">                                       getSunMoonCoords(core, tempJd,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        raSun, decSun,</td><td> </td><td class="right">                                                        raSun, decSun,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        ra, dec,</td><td> </td><td class="right">                                                        ra, dec,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        eclLon, false);</td><td> </td><td class="right">                                                        eclLon, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               } else</td><td> </td><td class="right">                               } else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       getPlanetCoords(core, tempJd, ra, de
c, false);</td><td> </td><td class="right">                                       getPlanetCoords(core, tempJd, ra, de
c, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 1441</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 1452</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // H at horizon for mod. coordinates:</td><td> </td><td class="right">       // H at horizon for mod. coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               hHoriz = calculateHourAngle(mylat,refractedH
orizonAlt,dec);</td><td> </td><td class="right">                               hHoriz = calculateHourAngle(mylat,refractedH
orizonAlt,dec);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute eph. times for mod. coordinates:</td><td> </td><td class="right">       // Compute eph. times for mod. coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               tempH = (-hHoriz-Hcurr)*TFrac;</td><td> </td><td class="right">                               tempH = (-hHoriz-Hcurr)*TFrac;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (hasRisen==false) tempH += (tempH&lt;0.0)?24
.0:0.0;</td><td> </td><td class="right">                               if (hasRisen==false) tempH += (tempH&lt;0.0)?24
.0:0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Check convergence:</td><td> </td><td class="right">                       // Check convergence:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (qAbs(tempH-tempEphH)&lt;JDsec) break;</td><td> </td><td class="right">                               if (qAbs(tempH-tempEphH)&lt;JDsec) break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Update rise-time estimate:</td><td> </td><td class="right">                       // Update rise-time estimate:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               tempEphH = tempH;</td><td> </td><td class="right">                               tempEphH = tempH;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               MoonRise = myJD + (tempEphH/24.);</td><td> </td><td class="rblock">                               MoonRise = myJD<span class="insert">.first</span> + (tempEphH/24.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       };</td><td> </td><td class="right">                       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set time:</td><td> </td><td class="right">// Set time:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       tempEphH = MoonSet;</td><td> </td><td class="right">                       tempEphH = MoonSet;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       MoonSet = myJD + (MoonSet/24.);</td><td> </td><td class="rblock">                       MoonSet = myJD<span class="insert">.first</span> + (MoonSet/24.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for (i=0; i&lt;NUM_ITER; i++)</td><td> </td><td class="right">                       for (i=0; i&lt;NUM_ITER; i++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Get modified coordinates:</td><td> </td><td class="right">       // Get modified coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">tempJd</span> = MoonSet;</td><td> </td><td class="rblock">                               <span class="insert">tempJd.first</span> = MoonSet;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               <span class="insert">tempJd.second=tempJd.first+core-&gt;computeDelt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">aT(tempJd.first)/86400.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (bodyType &lt; 3)</td><td> </td><td class="right">                               if (bodyType &lt; 3)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       getSunMoonCoords(core, tempJd,</td><td> </td><td class="right">                                       getSunMoonCoords(core, tempJd,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        raSun, decSun,</td><td> </td><td class="right">                                                        raSun, decSun,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        ra, dec,</td><td> </td><td class="right">                                                        ra, dec,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                                        eclLon, false);</td><td> </td><td class="right">                                                        eclLon, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       getPlanetCoords(core, tempJd, ra, de
c, false);</td><td> </td><td class="right">                                       getPlanetCoords(core, tempJd, ra, de
c, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (bodyType==1) {ra = raSun; dec = decSun;}
;</td><td> </td><td class="right">                               if (bodyType==1) {ra = raSun; dec = decSun;}
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l10" /><small>skipping to change at</small><em> line 1477</em></th><th> </th><th><a name="part-r10" /><small>skipping to change at</small><em> line 1489</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               hHoriz = calculateHourAngle(mylat, refracted
HorizonAlt, dec);</td><td> </td><td class="right">                               hHoriz = calculateHourAngle(mylat, refracted
HorizonAlt, dec);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute eph. times for mod. coordinates:</td><td> </td><td class="right">       // Compute eph. times for mod. coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               tempH = (hHoriz-Hcurr)*TFrac;</td><td> </td><td class="right">                               tempH = (hHoriz-Hcurr)*TFrac;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (!hasRisen)</td><td> </td><td class="right">                               if (!hasRisen)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       tempH -= (tempH&gt;0.0)?24.0:0.0;</td><td> </td><td class="right">                                       tempH -= (tempH&gt;0.0)?24.0:0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Check convergence:</td><td> </td><td class="right">               // Check convergence:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (qAbs(tempH-tempEphH)&lt;JDsec)</td><td> </td><td class="right">                               if (qAbs(tempH-tempEphH)&lt;JDsec)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       break;</td><td> </td><td class="right">                                       break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Update set-time estimate:</td><td> </td><td class="right">               // Update set-time estimate:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               tempEphH = tempH;</td><td> </td><td class="right">                               tempEphH = tempH;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               MoonSet = myJD + (tempEphH/24.);</td><td> </td><td class="rblock">                               MoonSet = myJD<span class="insert">.first</span> + (tempEphH/24.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       };</td><td> </td><td class="right">                       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else // Comes from if(raises)</td><td> </td><td class="right">               else // Comes from if(raises)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       MoonSet = -1.0;</td><td> </td><td class="right">                       MoonSet = -1.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       MoonRise = -1.0;</td><td> </td><td class="right">                       MoonRise = -1.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               };</td><td> </td><td class="right">               };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Culmination time:</td><td> </td><td class="right">// Culmination time:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               tempEphH = MoonCulm;</td><td> </td><td class="right">               tempEphH = MoonCulm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               MoonCulm = myJD + (MoonCulm/24.);</td><td> </td><td class="rblock">               MoonCulm = myJD<span class="insert">.first</span> + (MoonCulm/24.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               for (i=0; i&lt;NUM_ITER; i++)</td><td> </td><td class="right">               for (i=0; i&lt;NUM_ITER; i++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Get modified coordinates:</td><td> </td><td class="right">                       // Get modified coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">tempJd</span> = MoonCulm;</td><td> </td><td class="rblock">                       <span class="insert">tempJd.first</span> = MoonCulm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       <span class="insert">tempJd.second=tempJd.first+core-&gt;computeDeltaT(tempJ</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">d.first)/86400.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (bodyType&lt;3)</td><td> </td><td class="right">                       if (bodyType&lt;3)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               getSunMoonCoords(core,tempJd,raSun,decSun,ra
,dec,eclLon,false);</td><td> </td><td class="right">                               getSunMoonCoords(core,tempJd,raSun,decSun,ra
,dec,eclLon,false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       } else</td><td> </td><td class="right">                       } else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               getPlanetCoords(core,tempJd,ra,dec,false);</td><td> </td><td class="right">                               getPlanetCoords(core,tempJd,ra,dec,false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       };</td><td> </td><td class="right">                       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (bodyType==1) {ra = raSun; dec = decSun;};</td><td> </td><td class="right">                       if (bodyType==1) {ra = raSun; dec = decSun;};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l11" /><small>skipping to change at</small><em> line 1515</em></th><th> </th><th><a name="part-r11" /><small>skipping to change at</small><em> line 1528</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Current hour angle at mod. coordinates:</td><td> </td><td class="right">       // Current hour angle at mod. coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Hcurr = toUnsignedRA(SidT-ra);</td><td> </td><td class="right">                       Hcurr = toUnsignedRA(SidT-ra);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Hcurr += (LocPos[1]&lt;0.0)?24.0:-24.0;</td><td> </td><td class="right">                       Hcurr += (LocPos[1]&lt;0.0)?24.0:-24.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Hcurr -= (Hcurr&gt;12.)?24.0:0.0;</td><td> </td><td class="right">                       Hcurr -= (Hcurr&gt;12.)?24.0:0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute eph. times for mod. coordinates:</td><td> </td><td class="right">       // Compute eph. times for mod. coordinates:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       tempH = -Hcurr*TFrac;</td><td> </td><td class="right">                       tempH = -Hcurr*TFrac;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Check convergence:</td><td> </td><td class="right">       // Check convergence:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (qAbs(tempH-tempEphH)&lt;JDsec) break;</td><td> </td><td class="right">                       if (qAbs(tempH-tempEphH)&lt;JDsec) break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       tempEphH = tempH;</td><td> </td><td class="right">                       tempEphH = tempH;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       MoonCulm = myJD + (tempEphH/24.);</td><td> </td><td class="rblock">                       MoonCulm = myJD<span class="insert">.first</span> + (tempEphH/24.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       culmAlt = qAbs(mylat-dec); // 90 - altitude at trans
it.</td><td> </td><td class="right">                       culmAlt = qAbs(mylat-dec); // 90 - altitude at trans
it.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               };</td><td> </td><td class="right">               };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//             qDebug() &lt;&lt; q_("%1").arg(MoonCulm,0,'f',5);</td><td> </td><td class="right">//             qDebug() &lt;&lt; q_("%1").arg(MoonCulm,0,'f',5);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       lastJDMoon = myJD;</td><td> </td><td class="rblock">       lastJDMoon = myJD<span class="insert">.first</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       }; // Comes from if (qAbs(myJD<span class="delete">-lastJDMoon)&gt;JDsec || LastObject!=Kind
</span>)</td><td> </td><td class="rblock">       }; // Comes from if (qAbs(myJD<span class="insert">.first-lastJDMoon)&gt;JDsec || LastObject
!=Kind</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Find out the days of Full Moon:</td><td> </td><td class="right">// Find out the days of Full Moon:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (bodyType==2 &amp;&amp; show_FullMoon) // || show_SuperMoon))</td><td> </td><td class="right">       if (bodyType==2 &amp;&amp; show_FullMoon) // || show_SuperMoon))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Only estimate date of Full Moon if we have changed Lunar month:</td><td> </td><td class="right">       // Only estimate date of Full Moon if we have changed Lunar month:</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (myJD<span class="delete"> &gt; nextFullMoon || myJD</span> &lt; prevFullMoon)</td><td> </td><td class="rblock">               if (myJD<span class="insert">.first &gt; nextFullMoon || myJD.first</span> &lt; prevFullMoon)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Estimate the nearest (in time) Full Moon:</td><td> </td><td class="right">       // Estimate the nearest (in time) Full Moon:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double nT;</td><td> </td><td class="right">                       double nT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double dT = std::modf((myJD<span class="delete">-RefFullMoon)/MoonT</span>,&amp;nT);</td><td> </td><td class="rblock">                       double dT = std::modf((myJD<span class="insert">.first-RefFullMoon)/MoonT
</span>,&amp;nT);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (dT&gt;0.5) {nT += 1.0;};</td><td> </td><td class="right">                       if (dT&gt;0.5) {nT += 1.0;};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (dT&lt;-0.5) {nT -= 1.0;};</td><td> </td><td class="right">                       if (dT&lt;-0.5) {nT -= 1.0;};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double TempFullMoon = RefFullMoon + nT*MoonT;</td><td> </td><td class="right">                       double TempFullMoon = RefFullMoon + nT*MoonT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Improve the estimate iteratively (Secant method over Lunar-phase 
vs. time):</td><td> </td><td class="right">       // Improve the estimate iteratively (Secant method over Lunar-phase 
vs. time):</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       dT = 0.1/1440.; // 6 seconds. Our time span for the 
finite-difference derivative estimate.</td><td> </td><td class="right">                       dT = 0.1/1440.; // 6 seconds. Our time span for the 
finite-difference derivative estimate.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//                     double Deriv1, Deriv2; // Variables for temporal use
.</td><td> </td><td class="right">//                     double Deriv1, Deriv2; // Variables for temporal use
.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double <span class="delete">Sec1, Sec2,</span> Temp1, Temp2; // Variables for <span class="delete">te</span></td><td> </td><td class="rblock">                       <span class="insert">QPair&lt;double, double&gt;Sec1, Sec2; // Variables for te</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">mporal</span> use.</td><td> </td><td class="rblock"><span class="insert">mporal use. Contrary to the other cases, we have Sec[12].second=DeltaT[days</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">], not JDE. This avoids needless re-computing.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       double Temp1, Temp2; // Variables for <span class="insert">temporal</span> use.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double iniEst1, iniEst2;  // JD values that MUST inc
lude the solution within them.</td><td> </td><td class="right">                       double iniEst1, iniEst2;  // JD values that MUST inc
lude the solution within them.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double Phase1;</td><td> </td><td class="right">                       double Phase1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for (int j=0; j&lt;2; j++)</td><td> </td><td class="right">                       for (int j=0; j&lt;2; j++)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       { // Two steps: one for the previos Full Moon and th
e other for the next one.</td><td> </td><td class="right">                       { // Two steps: one for the previos Full Moon and th
e other for the next one.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               iniEst1 =  TempFullMoon - 0.25*MoonT;</td><td> </td><td class="right">                               iniEst1 =  TempFullMoon - 0.25*MoonT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               iniEst2 =  TempFullMoon + 0.25*MoonT;</td><td> </td><td class="right">                               iniEst2 =  TempFullMoon + 0.25*MoonT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">Sec1</span> = iniEst1; // TempFullMoon - <span class="delete">0.05*MoonT</span></td><td> </td><td class="rblock">                               <span class="insert">Sec1.first</span> = iniEst1; // TempFullMoon - <span class="insert">0.05</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span> // Initial estimates of Full-Moon dates</td><td> </td><td class="rblock"><span class="insert">*MoonT;</span> // Initial estimates of Full-Moon dates</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">Sec2</span> = iniEst2; // TempFullMoon + <span class="delete">0.05*MoonT</span></td><td> </td><td class="rblock">                               <span class="insert">Sec1.second= core-&gt;computeDeltaT(Sec1.first)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">;</span></td><td> </td><td class="rblock"><span class="insert">/86400.0; // enough to compute this once.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               Sec2.first</span> = iniEst2; // TempFullMoon + <span class="insert">0.05</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">*MoonT;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               Sec2.second= core-&gt;computeDeltaT(Sec2.first)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">/86400.0; // enough to compute this once.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               <span class="delete">getSunMoonCoords(core,Sec1,raSun,decSun,ra,d</span></td><td> </td><td class="rblock">                               <span class="insert">// for the computation calls, we need tempor</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ec,eclLon,false);</span></td><td> </td><td class="rblock"><span class="insert">ary QPairs here!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               getSunMoonCoords(core,QPair&lt;double, double&gt;(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Sec1.first, Sec1.first+Sec1.second),raSun,decSun,ra,dec,eclLon,false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               Temp1 = eclLon; //Lambda(RA,Dec,RAS,DecS);</td><td> </td><td class="right">                               Temp1 = eclLon; //Lambda(RA,Dec,RAS,DecS);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               getSunMoonCoords(core,<span class="delete">Sec2,raSun,decSun,ra,d
</span>ec,eclLon,false);</td><td> </td><td class="rblock">                               getSunMoonCoords(core,<span class="insert">QPair&lt;double, double&gt;(
Sec2.first, Sec2.first+Sec2.second),raSun,decSun,ra,d</span>ec,eclLon,false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               Temp2 = eclLon; //Lambda(RA,Dec,RAS,DecS);</td><td> </td><td class="right">                               Temp2 = eclLon; //Lambda(RA,Dec,RAS,DecS);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               for (int i=0; i&lt;100; i++) // A limit of 100 
iterations.</td><td> </td><td class="right">                               for (int i=0; i&lt;100; i++) // A limit of 100 
iterations.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       Phase1 = <span class="delete">(Sec2-Sec1)/(Temp1-Temp2)*T</span></td><td> </td><td class="rblock">                                       Phase1 = <span class="insert">(Sec2.first-Sec1.first)/(Te</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">emp1+Sec1;</span></td><td> </td><td class="rblock"><span class="insert">mp1-Temp2)*Temp1+Sec1.first;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                                       getSunMoonCoords(core,Phase1,raSun,d</span></td><td> </td><td class="rblock"><span class="insert">                                       // The ad-hoc pair needs a DeltaT, u</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ecSun,ra,dec,eclLon,false);</span></td><td> </td><td class="rblock"><span class="insert">se the one of Sec1</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       getSunMoonCoords(core,QPair&lt;double, </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">double&gt;(Phase1, Phase1+Sec1.second),raSun,decSun,ra,dec,eclLon,false);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       if (Temp1*eclLon &lt; 0.0)</td><td> </td><td class="right">                                       if (Temp1*eclLon &lt; 0.0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               Sec2 = Phase1;</td><td> </td><td class="rblock">                                               Sec2<span class="insert">.first</span> = Phase1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               Temp2 = eclLon;</td><td> </td><td class="right">                                               Temp2 = eclLon;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       } else {</td><td> </td><td class="right">                                       } else {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               Sec1 = Phase1;</td><td> </td><td class="rblock">                                               Sec1<span class="insert">.first</span> = Phase1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               Temp1 = eclLon;</td><td> </td><td class="right">                                               Temp1 = eclLon;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       };</td><td> </td><td class="right">                                       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               //      qDebug() &lt;&lt; QString("%1 %2 %3 %4 ").
arg(Sec1).arg(Sec2).arg(Temp1).arg(Temp2);</td><td> </td><td class="right">                               //      qDebug() &lt;&lt; QString("%1 %2 %3 %4 ").
arg(Sec1).arg(Sec2).arg(Temp1).arg(Temp2);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       if (qAbs(Sec2<span class="delete">-Sec1) &lt; 10.*dT)  // 1 
</span>minute accuracy; convergence.</td><td> </td><td class="rblock">                                       if (qAbs(Sec2<span class="insert">.first-Sec1.first) &lt; 10
.*dT)  // 1 </span>minute accuracy; convergence.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               TempFullMoon = (Sec1<span class="delete">+Sec2)/2
</span>.;</td><td> </td><td class="rblock">                                               TempFullMoon = (Sec1<span class="insert">.first+S
ec2.first)/2</span>.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               //              qDebug() &lt;&lt; QString("%1%2 ")
.arg(TempFullMoon);</td><td> </td><td class="right">                               //              qDebug() &lt;&lt; QString("%1%2 ")
.arg(TempFullMoon);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               break;</td><td> </td><td class="right">                                               break;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       };</td><td> </td><td class="right">                                       };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               };</td><td> </td><td class="right">                               };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               if (TempFullMoon &gt; myJD)</td><td> </td><td class="rblock">                               if (TempFullMoon &gt; myJD<span class="insert">.first</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       nextFullMoon = TempFullMoon;</td><td> </td><td class="right">                                       nextFullMoon = TempFullMoon;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       TempFullMoon -= MoonT;</td><td> </td><td class="right">                                       TempFullMoon -= MoonT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               } else</td><td> </td><td class="right">                               } else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       prevFullMoon = TempFullMoon;</td><td> </td><td class="right">                                       prevFullMoon = TempFullMoon;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       TempFullMoon += MoonT;</td><td> </td><td class="right">                                       TempFullMoon += MoonT;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               };</td><td> </td><td class="right">                               };</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       };</td><td> </td><td class="right">                       };</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 59 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>121 lines changed or deleted</i></th><th><i> </i></th><th><i>157 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
