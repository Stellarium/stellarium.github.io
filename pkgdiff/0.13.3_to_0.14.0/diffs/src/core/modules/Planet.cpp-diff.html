<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-62-generic #101-Ubuntu SMP Thu Jul 30 09:01:36 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Planet.cpp - Planet.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Planet.cpp&nbsp;</th><th> </th><th>&nbsp;Planet.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 27</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 27</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td> </td><td class="right"> * Foundation, Inc., 51 Franklin Street, Suite 500, Boston, MA  02110-1335,
 USA.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelFileMgr.hpp"</td><td> </td><td class="right">#include "StelFileMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTexture.hpp"</td><td> </td><td class="right">#include "StelTexture.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelSkyDrawer.hpp"</td><td> </td><td class="right">#include "StelSkyDrawer.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "SolarSystem.hpp"</td><td> </td><td class="right">#include "SolarSystem.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "Planet.hpp"</td><td> </td><td class="right">#include "Planet.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">#include "planetsephems/precession.h"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "StelObserver.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelProjector.hpp"</td><td> </td><td class="right">#include "StelProjector.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "sidereal_time.h"</td><td> </td><td class="right">#include "sidereal_time.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTextureMgr.hpp"</td><td> </td><td class="right">#include "StelTextureMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelModuleMgr.hpp"</td><td> </td><td class="right">#include "StelModuleMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StarMgr.hpp"</td><td> </td><td class="right">#include "StarMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelMovementMgr.hpp"</td><td> </td><td class="right">#include "StelMovementMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelPainter.hpp"</td><td> </td><td class="right">#include "StelPainter.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTranslator.hpp"</td><td> </td><td class="right">#include "StelTranslator.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelUtils.hpp"</td><td> </td><td class="right">#include "StelUtils.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelOpenGL.hpp"</td><td> </td><td class="right">#include "StelOpenGL.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;iomanip&gt;</td><td> </td><td class="right">#include &lt;iomanip&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include &lt;limits&gt;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QTextStream&gt;</td><td> </td><td class="right">#include &lt;QTextStream&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QString&gt;</td><td> </td><td class="right">#include &lt;QString&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QVarLengthArray&gt;</td><td> </td><td class="right">#include &lt;QVarLengthArray&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QOpenGLContext&gt;</td><td> </td><td class="right">#include &lt;QOpenGLContext&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QOpenGLShader&gt;</td><td> </td><td class="right">#include &lt;QOpenGLShader&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::labelColor = Vec3f(0.4,0.4,0.8);</td><td> </td><td class="right">Vec3f Planet::labelColor = Vec3f(0.4,0.4,0.8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::orbitColor = Vec3f(1,0.6,1);</td><td> </td><td class="right">Vec3f Planet::orbitColor = Vec3f(1,0.6,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">StelTextureSP Planet::hintCircleTex;</td><td> </td><td class="right">StelTextureSP Planet::hintCircleTex;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 66</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 68</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QOpenGLShaderProgram* Planet::moonShaderProgram=NULL;</td><td> </td><td class="right">QOpenGLShaderProgram* Planet::moonShaderProgram=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Planet::MoonShaderVars Planet::moonShaderVars;</td><td> </td><td class="right">Planet::MoonShaderVars Planet::moonShaderVars;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QMap&lt;Planet::PlanetType, QString&gt; Planet::pTypeMap;</td><td> </td><td class="right">QMap&lt;Planet::PlanetType, QString&gt; Planet::pTypeMap;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QMap&lt;Planet::ApparentMagnitudeAlgorithm, QString&gt; Planet::vMagAlgorithmMap;</td><td> </td><td class="right">QMap&lt;Planet::ApparentMagnitudeAlgorithm, QString&gt; Planet::vMagAlgorithmMap;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Planet::Planet(const QString&amp; englishName,</td><td> </td><td class="right">Planet::Planet(const QString&amp; englishName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              int flagLighting,</td><td> </td><td class="right">              int flagLighting,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              double radius,</td><td> </td><td class="right">              double radius,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              double oblateness,</td><td> </td><td class="right">              double oblateness,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">              Vec3f color,</td><td> </td><td class="rblock">              Vec3f <span class="insert">halo</span>color,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              float albedo,</td><td> </td><td class="right">              float albedo,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              const QString&amp; atexMapName,</td><td> </td><td class="right">              const QString&amp; atexMapName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              const QString&amp; anormalMapName,</td><td> </td><td class="right">              const QString&amp; anormalMapName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              posFuncType coordFunc,</td><td> </td><td class="right">              posFuncType coordFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              void* auserDataPtr,</td><td> </td><td class="right">              void* auserDataPtr,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              OsculatingFunctType *osculatingFunc,</td><td> </td><td class="right">              OsculatingFunctType *osculatingFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              bool acloseOrbit,</td><td> </td><td class="right">              bool acloseOrbit,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              bool hidden,</td><td> </td><td class="right">              bool hidden,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              bool hasAtmosphere,</td><td> </td><td class="right">              bool hasAtmosphere,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              bool hasHalo,</td><td> </td><td class="right">              bool hasHalo,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">              const QString&amp; pTypeStr)</td><td> </td><td class="right">              const QString&amp; pTypeStr)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       : englishName(englishName),</td><td> </td><td class="right">       : englishName(englishName),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         flagLighting(flagLighting),</td><td> </td><td class="right">         flagLighting(flagLighting),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         radius(radius),</td><td> </td><td class="right">         radius(radius),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         oneMinusOblateness(1.0-oblateness),</td><td> </td><td class="right">         oneMinusOblateness(1.0-oblateness),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         <span class="delete">color(</span>color),</td><td> </td><td class="rblock">         <span class="insert">haloColor(halo</span>color),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         albedo(albedo),</td><td> </td><td class="right">         albedo(albedo),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         axisRotation(0.),</td><td> </td><td class="right">         axisRotation(0.),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         rings(NULL),</td><td> </td><td class="right">         rings(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         sphereScale(1.f),</td><td> </td><td class="right">         sphereScale(1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">         lastJD(J2000),</td><td> </td><td class="rblock">         lastJD<span class="insert">E</span>(J2000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         coordFunc(coordFunc),</td><td> </td><td class="right">         coordFunc(coordFunc),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         userDataPtr(auserDataPtr),</td><td> </td><td class="right">         userDataPtr(auserDataPtr),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         osculatingFunc(osculatingFunc),</td><td> </td><td class="right">         osculatingFunc(osculatingFunc),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         parent(NULL),</td><td> </td><td class="right">         parent(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         hidden(hidden),</td><td> </td><td class="right">         hidden(hidden),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         atmosphere(hasAtmosphere),</td><td> </td><td class="right">         atmosphere(hasAtmosphere),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         halo(hasHalo)</td><td> </td><td class="right">         halo(hasHalo)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texMapName = atexMapName;</td><td> </td><td class="right">       texMapName = atexMapName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       normalMapName = anormalMapName;</td><td> </td><td class="right">       normalMapName = anormalMapName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">lastOrbitJD</span> =0;</td><td> </td><td class="rblock">       <span class="insert">lastOrbitJDE</span> =0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">deltaJD</span> = StelCore::JD_SECOND;</td><td> </td><td class="rblock">       <span class="insert">deltaJDE</span> = StelCore::JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       orbitCached = 0;</td><td> </td><td class="right">       orbitCached = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       closeOrbit = acloseOrbit;</td><td> </td><td class="right">       closeOrbit = acloseOrbit;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       deltaOrbitJD = 0;</td><td> </td><td class="rblock">       deltaOrbitJD<span class="insert">E</span> = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       distance = 0;</td><td> </td><td class="right">       distance = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Initialize pType with the key found in pTypeMap, or mark planet t
ype as undefined.</td><td> </td><td class="right">       // Initialize pType with the key found in pTypeMap, or mark planet t
ype as undefined.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // The latter condition should obviously never happen.</td><td> </td><td class="right">       // The latter condition should obviously never happen.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       pType = pTypeMap.key(pTypeStr, Planet::isUNDEFINED);</td><td> </td><td class="right">       pType = pTypeMap.key(pTypeStr, Planet::isUNDEFINED);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       vMagAlgorithm = Planet::UndefinedAlgorithm;</td><td> </td><td class="right">       vMagAlgorithm = Planet::UndefinedAlgorithm;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eclipticPos = Vec3d(0.,0.,0.);</td><td> </td><td class="right">       eclipticPos = Vec3d(0.,0.,0.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rotLocalToParent = Mat4d::identity();</td><td> </td><td class="right">       rotLocalToParent = Mat4d::identity();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texMap = StelApp::getInstance().getTextureManager().createTextureThr
ead(StelFileMgr::getInstallationDir()+"/textures/"+texMapName, StelTexture:
:StelTextureParams(true, GL_LINEAR, GL_REPEAT));</td><td> </td><td class="right">       texMap = StelApp::getInstance().getTextureManager().createTextureThr
ead(StelFileMgr::getInstallationDir()+"/textures/"+texMapName, StelTexture:
:StelTextureParams(true, GL_LINEAR, GL_REPEAT));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       normalMap = StelApp::getInstance().getTextureManager().createTexture
Thread(StelFileMgr::getInstallationDir()+"/textures/"+normalMapName, StelTe
xture::StelTextureParams(true, GL_LINEAR, GL_REPEAT));</td><td> </td><td class="right">       normalMap = StelApp::getInstance().getTextureManager().createTexture
Thread(StelFileMgr::getInstallationDir()+"/textures/"+normalMapName, StelTe
xture::StelTextureParams(true, GL_LINEAR, GL_REPEAT));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nameI18 = englishName;</td><td> </td><td class="right">       nameI18 = englishName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nativeName = "";</td><td> </td><td class="right">       nativeName = "";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (englishName!="Pluto")</td><td> </td><td class="right">       if (englishName!="Pluto")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               deltaJD = 0.001*StelCore::JD_SECOND;</td><td> </td><td class="rblock">               deltaJD<span class="insert">E</span> = 0.001*StelCore::JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagLabels = true;</td><td> </td><td class="right">       flagLabels = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagNativeName = true;</td><td> </td><td class="right">       flagNativeName = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagTranslatedName = true;</td><td> </td><td class="right">       flagTranslatedName = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// called in SolarSystem::init() before first planet is created. Loads pTyp
eMap.</td><td> </td><td class="right">// called in SolarSystem::init() before first planet is created. Loads pTyp
eMap.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::init()</td><td> </td><td class="right">void Planet::init()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (pTypeMap.count() &gt; 0 )</td><td> </td><td class="right">       if (pTypeMap.count() &gt; 0 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 198</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 200</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Planet::getNameI18n() const</td><td> </td><td class="right">QString Planet::getNameI18n() const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return nameI18;</td><td> </td><td class="right">       return nameI18;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Return the information string "ready to print" :)</td><td> </td><td class="right">// Return the information string "ready to print" :)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Planet::getInfoString(const StelCore* core, const InfoStringGroup&amp; 
flags) const</td><td> </td><td class="right">QString Planet::getInfoString(const StelCore* core, const InfoStringGroup&amp; 
flags) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString str;</td><td> </td><td class="right">       QString str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QTextStream oss(&amp;str);</td><td> </td><td class="right">       QTextStream oss(&amp;str);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">double az_app, alt_app;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       StelUtils::rectToSphe(&amp;az_app,&amp;alt_app,getAltAzPosApparent(core));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Q_UNUSED(az_app);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Name)</td><td> </td><td class="right">       if (flags&amp;Name)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;h2&gt;" &lt;&lt; getNameI18n();  // UI translation can diffe
r from sky translation</td><td> </td><td class="right">               oss &lt;&lt; "&lt;h2&gt;" &lt;&lt; getNameI18n();  // UI translation can diffe
r from sky translation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss.setRealNumberNotation(QTextStream::FixedNotation);</td><td> </td><td class="right">               oss.setRealNumberNotation(QTextStream::FixedNotation);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss.setRealNumberPrecision(1);</td><td> </td><td class="right">               oss.setRealNumberPrecision(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (sphereScale != 1.f)</td><td> </td><td class="right">               if (sphereScale != 1.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString::fromUtf8(" (\xC3\x97") &lt;&lt; sphereScal
e &lt;&lt; ")";</td><td> </td><td class="right">                       oss &lt;&lt; QString::fromUtf8(" (\xC3\x97") &lt;&lt; sphereScal
e &lt;&lt; ")";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;/h2&gt;";</td><td> </td><td class="right">               oss &lt;&lt; "&lt;/h2&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;ObjectType &amp;&amp; getPlanetType()!=isUNDEFINED)</td><td> </td><td class="right">       if (flags&amp;ObjectType &amp;&amp; getPlanetType()!=isUNDEFINED)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; q_("Type: &lt;b&gt;%1&lt;/b&gt;").arg(q_(getPlanetTypeString())) 
&lt;&lt; "&lt;br /&gt;";</td><td> </td><td class="right">               oss &lt;&lt; q_("Type: &lt;b&gt;%1&lt;/b&gt;").arg(q_(getPlanetTypeString())) 
&lt;&lt; "&lt;br /&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (flags&amp;Magnitude)</td><td> </td><td class="rblock">       if (flags&amp;Magnitude<span class="insert"> &amp;&amp; getVMagnitude(core)!=std::numeric_limits&lt;floa
t&gt;::infinity()</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if <span class="delete">(core-&gt;getSkyDrawer()-&gt;getFlagHasAtmosphere())</span></td><td> </td><td class="rblock">               if <span class="insert">(core-&gt;getSkyDrawer()-&gt;getFlagHasAtmosphere() &amp;&amp; (alt_app</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   oss &lt;&lt; q_("Magnitude: &lt;b&gt;%1&lt;/b&gt; (extincted to: <span class="delete">&lt;b&gt;%2&lt;/b&gt;</span></td><td> </td><td class="rblock"><span class="insert">&gt;-3.0*M_PI/180.0)) // Don't show extincted magnitude much below horizon whe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">)").arg(QString::number(getVMagnitude(core),</span> 'f', 2),</td><td> </td><td class="rblock"><span class="insert">re model is meaningless.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       oss &lt;&lt; q_("Magnitude: &lt;b&gt;%1&lt;/b&gt; (extincted to: <span class="insert">&lt;b&gt;%2</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">        QString::number(getVMagnitudeWithExtinction(core), 'f', 2)) &lt;&lt; <span class="delete">"&lt;br</span></td><td> </td><td class="rblock"><span class="insert">&lt;/b&gt;)").arg(QString::number(getVMagnitude(core),</span> 'f', 2),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">&gt;";</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">            QString::number(getVMagnitudeWithExtinction(core), 'f', 2)) &lt;&lt; </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">"&lt;br&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                   <span class="delete">oss &lt;&lt; q_("Magnitude: &lt;b&gt;%1&lt;/b&gt;").arg(getVMagnitude(core
</span>), 0, 'f', 2) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock">                   <span class="insert">    oss &lt;&lt; q_("Magnitude: &lt;b&gt;%1&lt;/b&gt;").arg(getVMagnitude(
core</span>), 0, 'f', 2) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (flags&amp;AbsoluteMagnitude)</td><td> </td><td class="rblock">       if (flags&amp;AbsoluteMagnitude<span class="insert"> &amp;&amp; getVMagnitude(core)!=std::numeric_lim
its&lt;float&gt;::infinity()</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; q_("Absolute Magnitude: %1").arg(getVMagnitude(core)-
5.*(std::log10(getJ2000EquatorialPos(core).length()*AU/PARSEC)-1.), 0, 'f',
 2) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">               oss &lt;&lt; q_("Absolute Magnitude: %1").arg(getVMagnitude(core)-
5.*(std::log10(getJ2000EquatorialPos(core).length()*AU/PARSEC)-1.), 0, 'f',
 2) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oss &lt;&lt; getPositionInfoString(core, flags);</td><td> </td><td class="right">       oss &lt;&lt; getPositionInfoString(core, flags);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (flags&amp;Extra)</td><td> </td><td class="rblock">       <span class="insert">// GZ This is mostly for debugging. Maybe also useful for letting pe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       {</td><td> </td><td class="rblock"><span class="insert">ople use our results to cross-check theirs, but we should not act as refere</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               static SolarSystem *ssystem=GETSTELMODULE(SolarSystem);</td><td> </td><td class="rblock"><span class="insert">nce, currently...</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               double ecl= ssystem-&gt;getEarth()-&gt;getRotObliquity(core-&gt;getJD</td><td> </td><td class="rblock"><span class="insert">       // TODO: maybe separate this out into:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">ay());</td><td> </td><td class="rblock"><span class="insert">       //if (flags&amp;EclipticCoordXYZ)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (core-&gt;getCurrentLocation().planetName=="Earth")</td><td> </td><td class="rblock"><span class="insert">       // For now: add to EclipticCoord</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       oss &lt;&lt; <span class="delete">q_("Obliquity</span> (of <span class="delete">date, for Earth): %1").arg(</span></td><td> </td><td class="rblock"><span class="insert">       //if (flags&amp;EclipticCoord)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">StelUtils::radToDmsStr(ecl,</span> true)) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock"><span class="insert">       //      oss &lt;&lt; q_("Ecliptical XYZ (VSOP87A): %1/%2/%3").arg(QString:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               //if (englishName!="Sun")</td><td> </td><td class="rblock"><span class="insert">:number(eclipticPos[0], 'f', 3), QString::number(eclipticPos[1], 'f', 3), Q</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               //      oss &lt;&lt; q_("Obliquity (of date): %1").arg(StelUtils::</td><td> </td><td class="rblock"><span class="insert">String::number(eclipticPos[2], 'f', 3)) &lt;&lt; "&lt;br&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">radToDmsStr(getRotObliquity(core-&gt;getJDay()), true)) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock"><span class="insert">//</span>     if (flags&amp;Extra)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       }</td><td> </td><td class="rblock"><span class="insert">//</span>     {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//</span>             static SolarSystem *ssystem=GETSTELMODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//</span>             double ecl= ssystem-&gt;getEarth()-&gt;getRotObliquity(core-&gt;getJD</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">ay());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//</span>             if (core-&gt;getCurrentLocation().planetName=="Earth")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//</span>                     oss &lt;&lt; <span class="insert">q_("Ecliptic obliquity</span> (of <span class="insert">date): %1").arg(St</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">elUtils::radToDmsStr(ecl,</span> true)) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//</span>             //if (englishName!="Sun")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">//             <span class="insert">//</span>      oss &lt;&lt; q_("Obliquity (of date): %1").arg(StelUtils::</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">radToDmsStr(getRotObliquity(core-&gt;getJDay()), true)) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//</span>     }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Distance)</td><td> </td><td class="right">       if (flags&amp;Distance)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double distanceAu = getJ2000EquatorialPos(core).length();</td><td> </td><td class="right">               double distanceAu = getJ2000EquatorialPos(core).length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double distanceKm = AU * distanceAu;</td><td> </td><td class="right">               double distanceKm = AU * distanceAu;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (distanceAu &lt; 0.1)</td><td> </td><td class="right">               if (distanceAu &lt; 0.1)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // xgettext:no-c-format</td><td> </td><td class="right">                       // xgettext:no-c-format</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString(q_("Distance: %1AU (%2 km)"))</td><td> </td><td class="right">                       oss &lt;&lt; QString(q_("Distance: %1AU (%2 km)"))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                  .arg(distanceAu, 0, 'f', 6)</td><td> </td><td class="right">                                  .arg(distanceAu, 0, 'f', 6)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 279</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 290</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; q_("Apparent diameter: %1").arg(StelUtils::ra
dToDmsStr(angularSize, true));</td><td> </td><td class="right">                       oss &lt;&lt; q_("Apparent diameter: %1").arg(StelUtils::ra
dToDmsStr(angularSize, true));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">               oss &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double siderealPeriod = getSiderealPeriod();</td><td> </td><td class="right">       double siderealPeriod = getSiderealPeriod();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double siderealDay = getSiderealDay();</td><td> </td><td class="right">       double siderealDay = getSiderealDay();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Extra)</td><td> </td><td class="right">       if (flags&amp;Extra)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">// This is a string you can activate for debugging. It shows</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> the distance between observer and center of the body you are standing on.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // May be helpful for debugging critical parallax correction</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">s for eclipses.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // For general use, find a better location first.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // oss &lt;&lt; q_("Planetocentric distance &amp;rho;: %1 (km)").arg(c</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ore-&gt;getCurrentObserver()-&gt;getDistanceFromCenter() * AU) &lt;&lt;"&lt;br&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (siderealPeriod&gt;0)</td><td> </td><td class="right">               if (siderealPeriod&gt;0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // TRANSLATORS: Sidereal (orbital) period for solar 
system bodies in days and in Julian years (symbol: a)</td><td> </td><td class="right">                       // TRANSLATORS: Sidereal (orbital) period for solar 
system bodies in days and in Julian years (symbol: a)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; q_("Sidereal period: %1 days (%2 a)").arg(QSt
ring::number(siderealPeriod, 'f', 2)).arg(QString::number(siderealPeriod/36
5.25, 'f', 3)) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                       oss &lt;&lt; q_("Sidereal period: %1 days (%2 a)").arg(QSt
ring::number(siderealPeriod, 'f', 2)).arg(QString::number(siderealPeriod/36
5.25, 'f', 3)) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (qAbs(siderealDay)&gt;0)</td><td> </td><td class="right">                       if (qAbs(siderealDay)&gt;0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               oss &lt;&lt; q_("Sidereal day: %1").arg(StelUtils:
:hoursToHmsStr(qAbs(siderealDay*24))) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                               oss &lt;&lt; q_("Sidereal day: %1").arg(StelUtils:
:hoursToHmsStr(qAbs(siderealDay*24))) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               oss &lt;&lt; q_("Mean solar day: %1").arg(StelUtil
s::hoursToHmsStr(qAbs(getMeanSolarDay()*24))) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                               oss &lt;&lt; q_("Mean solar day: %1").arg(StelUtil
s::hoursToHmsStr(qAbs(getMeanSolarDay()*24))) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       else if (re.period==0.)</td><td> </td><td class="right">                       else if (re.period==0.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               oss &lt;&lt; q_("The period of rotation is chaotic
") &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                               oss &lt;&lt; q_("The period of rotation is chaotic
") &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (englishName<span class="delete">.compare("Sun")!=0</span>)</td><td> </td><td class="rblock">               if (englishName<span class="insert"> != "Sun"</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const Vec3d&amp; observerHelioPos = core-&gt;getObserverHel
iocentricEclipticPos();</td><td> </td><td class="right">                       const Vec3d&amp; observerHelioPos = core-&gt;getObserverHel
iocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       <span class="insert">const double elongation = getElongation(observerHeli</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">oPos);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       QString phase = "";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       double deg;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       bool sign;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       StelUtils::radToDecDeg(elongation, sign, deg);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (deg&gt;=357.5 &amp;&amp; deg&lt;=2.5)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               phase = q_("New Moon");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (deg&gt;=87.5 &amp;&amp; deg&lt;=92.5)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               phase = q_("Last Quarter");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (deg&gt;=177.5 &amp;&amp; deg&lt;=182.5)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               phase = q_("Full Moon");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (deg&gt;=267.5 &amp;&amp; deg&lt;=272.5)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               phase = q_("First Quarter");</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString(q_("Phase Angle: %1")).arg(StelUtils:
:radToDmsStr(getPhaseAngle(observerHelioPos))) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                       oss &lt;&lt; QString(q_("Phase Angle: %1")).arg(StelUtils:
:radToDmsStr(getPhaseAngle(observerHelioPos))) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       oss &lt;&lt; QString(q_("Elongation: %1")).arg(StelUtils::</td><td> </td><td class="rblock">                       oss &lt;&lt; QString(q_("Elongation: %1")).arg(StelUtils::</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">radToDmsStr(getElongation(observerHelioPos)))</span> &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock"><span class="insert">radToDmsStr(elongation))</span> &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       oss &lt;&lt; QString(q_("Phase: <span class="delete">%1")).arg(getPhase(observe</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">rHelioPos), 0, 'f', 2)</span> &lt;&lt; <span class="delete">"&lt;br&gt;";</span></td><td> </td><td class="rblock">                       <span class="insert">if (englishName=="Moon" &amp;&amp; !phase.isEmpty())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               if (qRound(deg)==180.f || qRound(deg)==90.f </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">|| qRound(deg)==270.f || qRound(deg)==0.f)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       phase = QString("%1 (&lt;b&gt;%2&lt;/b&gt;)").ar</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">g(getPhase(observerHelioPos), 0, 'f', 2).arg(phase);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                       phase = QString("%1 (%2)").arg(getPh</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ase(observerHelioPos), 0, 'f', 2).arg(phase);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               phase = QString("%1").arg(getPhase(observerH</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">elioPos), 0, 'f', 2);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       oss &lt;&lt; QString(q_("Phase: <span class="insert">%1")).arg(phase)</span> &lt;&lt; <span class="insert">"&lt;br&gt;"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString(q_("Illuminated: %1%")).arg(getPhase(
observerHelioPos) * 100, 0, 'f', 1) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="right">                       oss &lt;&lt; QString(q_("Illuminated: %1%")).arg(getPhase(
observerHelioPos) * 100, 0, 'f', 1) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">if (englishName=="Sun")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // Only show during eclipse, show percent?</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       static SolarSystem *ssystem=GETSTELMODULE(SolarSyste</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">m);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // Debug solution:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//                     float eclipseFactor = ssystem-&gt;getEclipseFactor(core</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">//                     oss &lt;&lt; QString(q_("Eclipse Factor: %1 alpha: %2")).a</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">rg(eclipseFactor).arg(-0.1f*qMax(-10.0f, (float) std::log10(eclipseFactor))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">) &lt;&lt; "&lt;br&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // Release version:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       float eclipseFactor = 100.f*(1.f-ssystem-&gt;getEclipse</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Factor(core));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (eclipseFactor&gt;0.f)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               oss &lt;&lt; QString(q_("Eclipse Factor: %1%")).ar</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">g(eclipseFactor) &lt;&lt; "&lt;br&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       postProcessInfoString(str, flags);</td><td> </td><td class="right">       postProcessInfoString(str, flags);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return str;</td><td> </td><td class="right">       return str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//! Get sky label (sky translation)</td><td> </td><td class="right">//! Get sky label (sky translation)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Planet::getSkyLabel(const StelCore*) const</td><td> </td><td class="right">QString Planet::getSkyLabel(const StelCore*) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 373</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 426</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::setRotationElements(float _period, float _offset, double _epoc
h, float _obliquity, float _ascendingNode, float _precessionRate, double _s
iderealPeriod )</td><td> </td><td class="right">void Planet::setRotationElements(float _period, float _offset, double _epoc
h, float _obliquity, float _ascendingNode, float _precessionRate, double _s
iderealPeriod )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.period = _period;</td><td> </td><td class="right">       re.period = _period;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.offset = _offset;</td><td> </td><td class="right">       re.offset = _offset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.epoch = _epoch;</td><td> </td><td class="right">       re.epoch = _epoch;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.obliquity = _obliquity;</td><td> </td><td class="right">       re.obliquity = _obliquity;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.ascendingNode = _ascendingNode;</td><td> </td><td class="right">       re.ascendingNode = _ascendingNode;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.precessionRate = _precessionRate;</td><td> </td><td class="right">       re.precessionRate = _precessionRate;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.siderealPeriod = _siderealPeriod;  // used for drawing orbit line
s</td><td> </td><td class="right">       re.siderealPeriod = _siderealPeriod;  // used for drawing orbit line
s</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       deltaOrbitJD = re.siderealPeriod/ORBIT_SEGMENTS;</td><td> </td><td class="rblock">       deltaOrbitJD<span class="insert">E</span> = re.siderealPeriod/ORBIT_SEGMENTS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3d Planet::getJ2000EquatorialPos(const StelCore *core) const</td><td> </td><td class="right">Vec3d Planet::getJ2000EquatorialPos(const StelCore *core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return StelCore::matVsop87ToJ2000.multiplyWithoutTranslation(getHeli
ocentricEclipticPos() - core-&gt;getObserverHeliocentricEclipticPos());</td><td> </td><td class="right">       return StelCore::matVsop87ToJ2000.multiplyWithoutTranslation(getHeli
ocentricEclipticPos() - core-&gt;getObserverHeliocentricEclipticPos());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the position in the parent Planet coordinate system</td><td> </td><td class="right">// Compute the position in the parent Planet coordinate system</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Actually call the provided function to compute the ecliptical position</td><td> </td><td class="right">// Actually call the provided function to compute the ecliptical position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::computePositionWithoutOrbits(const double dateJD)</td><td> </td><td class="rblock">void Planet::computePositionWithoutOrbits(const double dateJD<span class="insert">E</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (fabs(lastJD<span class="delete">-dateJD)&gt;deltaJD</span>)</td><td> </td><td class="rblock">       if (fabs(lastJD<span class="insert">E-dateJDE)&gt;deltaJDE</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">coordFunc(dateJD,</span> eclipticPos, userDataPtr);</td><td> </td><td class="rblock">               <span class="insert">coordFunc(dateJDE,</span> eclipticPos, userDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">lastJD</span> = <span class="delete">dateJD;</span></td><td> </td><td class="rblock">               <span class="insert">lastJDE</span> = <span class="insert">dateJDE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Planet::getRotObliquity(double <span class="delete">JDay)</span> const</td><td> </td><td class="rblock"><span class="insert">// return value in radians!</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// For Earth, this is epsilon_A, the angle between earth's rotational axis </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">and mean ecliptic of date.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// Details: e.g. Hilton etal, Report on Precession and the Ecliptic, Cel.Me</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ch.Dyn.Astr.94:351-67 (2006), Fig1.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">double Planet::getRotObliquity(double <span class="insert">JDE)</span> const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // JDay=2451545.0 for J2000.0</td><td> </td><td class="right">       // JDay=2451545.0 for J2000.0</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (englishName=="Earth")</td><td> </td><td class="right">       if (englishName=="Earth")</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               return get<span class="delete">_mean_ecliptical_obliquity(JDay) *M_PI/180.0</span>;</td><td> </td><td class="rblock">               return get<span class="insert">PrecessionAngleVondrakEpsilon(JDE)</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return re.obliquity;</td><td> </td><td class="right">               return re.obliquity;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool willCastShadow(const Planet* thisPlanet, const Planet* p)</td><td> </td><td class="right">bool willCastShadow(const Planet* thisPlanet, const Planet* p)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d thisPos = thisPlanet-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">       Vec3d thisPos = thisPlanet-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d planetPos = p-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">       Vec3d planetPos = p-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // If the planet p is farther from the sun than this planet, it can'
t cast shadow on it.</td><td> </td><td class="right">       // If the planet p is farther from the sun than this planet, it can'
t cast shadow on it.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 444</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 500</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (willCastShadow(this, planet.data()))</td><td> </td><td class="right">               if (willCastShadow(this, planet.data()))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       res.append(planet.data());</td><td> </td><td class="right">                       res.append(planet.data());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (willCastShadow(this, parent.data()))</td><td> </td><td class="right">       if (willCastShadow(this, parent.data()))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               res.append(parent.data());</td><td> </td><td class="right">               res.append(parent.data());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return res;</td><td> </td><td class="right">       return res;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::computePosition(const double dateJD)</td><td> </td><td class="rblock">void Planet::computePosition(const double dateJD<span class="insert">E</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Make sure the parent position is computed for the dateJD, otherwi
se</td><td> </td><td class="right">       // Make sure the parent position is computed for the dateJD, otherwi
se</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // getHeliocentricPos() would return incorect values.</td><td> </td><td class="right">       // getHeliocentricPos() would return incorect values.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent)</td><td> </td><td class="right">       if (parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               parent-&gt;computePositionWithoutOrbits(dateJD);</td><td> </td><td class="rblock">               parent-&gt;computePositionWithoutOrbits(dateJD<span class="insert">E</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (orbitFader.getInterstate()&gt;0.000001 &amp;&amp; deltaOrbitJD<span class="delete"> &gt; 0 &amp;&amp; (fabs
(lastOrbitJD-dateJD)&gt;deltaOrbitJD</span> || !orbitCached))</td><td> </td><td class="rblock">       if (orbitFader.getInterstate()&gt;0.000001 &amp;&amp; deltaOrbitJD<span class="insert">E &gt; 0 &amp;&amp; (fab
s(lastOrbitJDE-dateJDE)&gt;deltaOrbitJDE</span> || !orbitCached))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">StelCore *core=StelApp::getInstance().getCore();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double calc_date;</td><td> </td><td class="right">               double calc_date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // int delta_points = (int)(0.5 + (date - lastOrbitJD)/date_
increment);</td><td> </td><td class="right">               // int delta_points = (int)(0.5 + (date - lastOrbitJD)/date_
increment);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               int delta_points;</td><td> </td><td class="right">               int delta_points;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if( dateJD<span class="delete"> &gt; lastOrbitJD</span> )</td><td> </td><td class="rblock">               if( dateJD<span class="insert">E &gt; lastOrbitJDE</span> )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       delta_points = (int)(0.5 + (dateJD<span class="delete"> - lastOrbitJD)/de
ltaOrbitJD</span>);</td><td> </td><td class="rblock">                       delta_points = (int)(0.5 + (dateJD<span class="insert">E - lastOrbitJDE)/
deltaOrbitJDE</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       delta_points = (int)(-0.5 + (dateJD<span class="delete"> - lastOrbitJD)/d
eltaOrbitJD</span>);</td><td> </td><td class="rblock">                       delta_points = (int)(-0.5 + (dateJD<span class="insert">E - lastOrbitJDE)
/deltaOrbitJDE</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               double new_date = lastOrbitJD<span class="delete"> + delta_points*deltaOrbitJD</span>;</td><td> </td><td class="rblock">               double new_date = lastOrbitJD<span class="insert">E + delta_points*deltaOrbitJDE</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // qDebug( "Updating orbit coordinates for %s (delta %f) (%d
 points)\n", getEnglishName().toUtf8().data(), deltaOrbitJD, delta_points);</td><td> </td><td class="right">               // qDebug( "Updating orbit coordinates for %s (delta %f) (%d
 points)\n", getEnglishName().toUtf8().data(), deltaOrbitJD, delta_points);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if( delta_points &gt; 0 &amp;&amp; delta_points &lt; ORBIT_SEGMENTS &amp;&amp; orb
itCached)</td><td> </td><td class="right">               if( delta_points &gt; 0 &amp;&amp; delta_points &lt; ORBIT_SEGMENTS &amp;&amp; orb
itCached)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td> </td><td class="right">                       for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if(d + delta_points &gt;= ORBIT_SEGMENTS )</td><td> </td><td class="right">                               if(d + delta_points &gt;= ORBIT_SEGMENTS )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // calculate new points</td><td> </td><td class="right">                                       // calculate new points</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*deltaOrbitJD;</td><td> </td><td class="rblock">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*deltaOrbitJD<span class="insert">E</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // date increments between points wi
ll not be completely constant though</td><td> </td><td class="right">                                       // date increments between points wi
ll not be completely constant though</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       computeTransMatrix(calc_date);</td><td> </td><td class="rblock">                                       computeTransMatrix(calc_date<span class="insert">-core-&gt;c
omputeDeltaT(calc_date)/86400.0, calc_date</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       if (osculatingFunc)</td><td> </td><td class="right">                                       if (osculatingFunc)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               (*osculatingFunc)(dateJD<span class="delete">,cal
</span>c_date,eclipticPos);</td><td> </td><td class="rblock">                                               (*osculatingFunc)(dateJD<span class="insert">E,ca
l</span>c_date,eclipticPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       else</td><td> </td><td class="right">                                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               coordFunc(calc_date, eclipti
cPos, userDataPtr);</td><td> </td><td class="right">                                               coordFunc(calc_date, eclipti
cPos, userDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbitP[d] = eclipticPos;</td><td> </td><td class="right">                                       orbitP[d] = eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td> </td><td class="right">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbitP[d] = orbitP[d+delta_points];</td><td> </td><td class="right">                                       orbitP[d] = orbitP[d+delta_points];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = getHeliocentricPos(orbitP
[d]);</td><td> </td><td class="right">                                       orbit[d] = getHeliocentricPos(orbitP
[d]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       lastOrbitJD = new_date;</td><td> </td><td class="rblock">                       lastOrbitJD<span class="insert">E</span> = new_date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else if( delta_points &lt; 0 &amp;&amp; abs(delta_points) &lt; ORBIT_SEGME
NTS  &amp;&amp; orbitCached)</td><td> </td><td class="right">               else if( delta_points &lt; 0 &amp;&amp; abs(delta_points) &lt; ORBIT_SEGME
NTS  &amp;&amp; orbitCached)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for( int d=ORBIT_SEGMENTS-1; d&gt;=0; d-- )</td><td> </td><td class="right">                       for( int d=ORBIT_SEGMENTS-1; d&gt;=0; d-- )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if(d + delta_points &lt; 0 )</td><td> </td><td class="right">                               if(d + delta_points &lt; 0 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // calculate new points</td><td> </td><td class="right">                                       // calculate new points</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*deltaOrbitJD;</td><td> </td><td class="rblock">                                       calc_date = new_date + (d-ORBIT_SEGM
ENTS/2)*deltaOrbitJD<span class="insert">E</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       computeTransMatrix(calc_date);</td><td> </td><td class="rblock">                                       computeTransMatrix(calc_date<span class="insert">-core-&gt;c
omputeDeltaT(calc_date)/86400.0, calc_date</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       if (osculatingFunc) {</td><td> </td><td class="right">                                       if (osculatingFunc) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                               (*osculatingFunc)(dateJD<span class="delete">,cal
</span>c_date,eclipticPos);</td><td> </td><td class="rblock">                                               (*osculatingFunc)(dateJD<span class="insert">E,ca
l</span>c_date,eclipticPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       else</td><td> </td><td class="right">                                       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       {</td><td> </td><td class="right">                                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                               coordFunc(calc_date, eclipti
cPos, userDataPtr);</td><td> </td><td class="right">                                               coordFunc(calc_date, eclipti
cPos, userDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       }</td><td> </td><td class="right">                                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbitP[d] = eclipticPos;</td><td> </td><td class="right">                                       orbitP[d] = eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td> </td><td class="right">                                       orbit[d] = getHeliocentricEclipticPo
s();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbitP[d] = orbitP[d+delta_points];</td><td> </td><td class="right">                                       orbitP[d] = orbitP[d+delta_points];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       orbit[d] = getHeliocentricPos(orbitP
[d]);</td><td> </td><td class="right">                                       orbit[d] = getHeliocentricPos(orbitP
[d]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       lastOrbitJD = new_date;</td><td> </td><td class="rblock">                       lastOrbitJD<span class="insert">E</span> = new_date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else if( delta_points || !orbitCached)</td><td> </td><td class="right">               else if( delta_points || !orbitCached)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // update all points (less efficient)</td><td> </td><td class="right">                       // update all points (less efficient)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td> </td><td class="right">                       for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               calc_date = <span class="delete">dateJD</span> + <span class="delete">(d-ORBIT_SEGMENTS/2)*de</span></td><td> </td><td class="rblock">                               calc_date = <span class="insert">dateJDE</span> + <span class="insert">(d-ORBIT_SEGMENTS/2)*d</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ltaOrbitJD;</span></td><td> </td><td class="rblock"><span class="insert">eltaOrbitJDE;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                               computeTransMatrix(calc_date);</span></td><td> </td><td class="rblock"><span class="insert">                               computeTransMatrix(calc_date-core-&gt;computeDe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ltaT(calc_date)/86400.0, calc_date);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (osculatingFunc)</td><td> </td><td class="right">                               if (osculatingFunc)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       (*osculatingFunc)(dateJD<span class="delete">,calc_date,e
</span>clipticPos);</td><td> </td><td class="rblock">                                       (*osculatingFunc)(dateJD<span class="insert">E,calc_date,
e</span>clipticPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               else</td><td> </td><td class="right">                               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       coordFunc(calc_date, eclipticPos, us
erDataPtr);</td><td> </td><td class="right">                                       coordFunc(calc_date, eclipticPos, us
erDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               orbitP[d] = eclipticPos;</td><td> </td><td class="right">                               orbitP[d] = eclipticPos;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               orbit[d] = getHeliocentricEclipticPos();</td><td> </td><td class="right">                               orbit[d] = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       lastOrbitJD<span class="delete"> = dateJD</span>;</td><td> </td><td class="rblock">                       lastOrbitJD<span class="insert">E = dateJDE</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (!osculatingFunc) orbitCached = 1;</td><td> </td><td class="right">                       if (!osculatingFunc) orbitCached = 1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // calculate actual Planet position</td><td> </td><td class="right">               // calculate actual Planet position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               coordFunc(dateJD, eclipticPos, userDataPtr);</td><td> </td><td class="rblock">               coordFunc(dateJD<span class="insert">E</span>, eclipticPos, userDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               lastJD<span class="delete"> = dateJD</span>;</td><td> </td><td class="rblock">               lastJD<span class="insert">E = dateJDE</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       else if (fabs(lastJD<span class="delete">-dateJD)&gt;deltaJD</span>)</td><td> </td><td class="rblock">       else if (fabs(lastJD<span class="insert">E-dateJDE)&gt;deltaJDE</span>)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // calculate actual Planet position</td><td> </td><td class="right">               // calculate actual Planet position</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               coordFunc(dateJD, eclipticPos, userDataPtr);</td><td> </td><td class="rblock">               coordFunc(dateJD<span class="insert">E</span>, eclipticPos, userDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // XXX: do we need to do that even when the orbit is not vis
ible?</td><td> </td><td class="right">               // XXX: do we need to do that even when the orbit is not vis
ible?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td> </td><td class="right">               for( int d=0; d&lt;ORBIT_SEGMENTS; d++ )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       orbit[d]=getHeliocentricPos(orbitP[d]);</td><td> </td><td class="right">                       orbit[d]=getHeliocentricPos(orbitP[d]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0049" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               lastJD<span class="delete"> = dateJD</span>;</td><td> </td><td class="rblock">               lastJD<span class="insert">E = dateJDE</span>;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0050" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">// Compute the transformation matrix from the local Planet coordinate to <span class="delete">th</span></td><td> </td><td class="rblock">// Compute the transformation matrix from the local Planet coordinate <span class="insert">syste</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">e</span> parent Planet coordinate</td><td> </td><td class="rblock"><span class="insert">m</span> to <span class="insert">the</span> parent Planet coordinate <span class="insert">system.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::computeTransMatrix(double <span class="delete">jd)</span></td><td> </td><td class="rblock"><span class="insert">// In case of the planets, this makes the axis point to their respective ce</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">lestial poles.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">// TODO: Verify for the other planets if their axes are relative to J2000 e</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">cliptic (VSOP87A XY plane) or relative to (precessed) ecliptic of date?</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">void Planet::computeTransMatrix(double <span class="insert">JD, double JDE)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0051" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       axisRotation = <span class="delete">getSiderealTime(jd);</span></td><td> </td><td class="rblock">       <span class="insert">// We have to call with both to correct this for earth with the new </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">model.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       axisRotation = <span class="insert">getSiderealTime(JD, JDE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0052" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // Special case - heliocentric coordinates are <span class="delete">on ecliptic</span>,</td><td> </td><td class="rblock">       // Special case - heliocentric coordinates are <span class="insert">relative to eclipticJ
2000 (VSOP87A XY plane)</span>,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // not solar equator...</td><td> </td><td class="right">       // not solar equator...</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0053" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                                           </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent)</td><td> </td><td class="right">       if (parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0054" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               rotLocalToParent = Mat4d::zrotation(re.ascendingNode - <span class="delete">re.pr</span></td><td> </td><td class="rblock">               <span class="insert">// We can inject a proper precession plus even nutation matr</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ecessionRate*(jd-re.epoch))</span> * Mat4d::xrotation(re.obliquity);</td><td> </td><td class="rblock"><span class="insert">ix in this stage, if available.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (englishName=="Earth")</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // rotLocalToParent = Mat4d::zrotation(re.ascendingN</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ode - re.precessionRate*(jd-re.epoch)) * Mat4d::xrotation(-getRotObliquity(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">jd));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // We follow Capitaine's (2003) formulation P=Rz(Chi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">_A)*Rx(-omega_A)*Rz(-psi_A)*Rx(eps_o).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // ADS: 2011A&amp;A...534A..22V = A&amp;A 534, A22 (2011): V</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ondrak, Capitane, Wallace: New Precession Expressions, valid for long time </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">intervals:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // See also Hilton et al., Report on Precession and </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">the Ecliptic. Cel.Mech.Dyn.Astr. 94:351-367 (2006), eqn (6) and (21).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       double eps_A, chi_A, omega_A, psi_A;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       getPrecessionAnglesVondrak(JDE, &amp;eps_A, &amp;chi_A, &amp;ome</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ga_A, &amp;psi_A);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // Canonical precession rotations: Nodal rotation ps</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">i_A,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // then rotation by omega_A, the angle between EclPo</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">leJ2000 and EarthPoleOfDate.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // The final rotation by chi_A rotates the equinox (</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">zero degree).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // To achieve ecliptical coords of date, you just ha</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ve now to add a rotX by epsilon_A (obliquity of date).</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       rotLocalToParent= Mat4d::zrotation(-psi_A) * Mat4d::</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">xrotation(-omega_A) * Mat4d::zrotation(chi_A);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // Plus nutation IAU-2000B:</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (StelApp::getInstance().getCore()-&gt;getUseNutation</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               double deltaEps, deltaPsi;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               getNutationAngles(JDE, &amp;deltaPsi, &amp;deltaEps)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               //qDebug() &lt;&lt; "deltaEps, arcsec" &lt;&lt; deltaEps</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">*180./M_PI*3600. &lt;&lt; "deltaPsi" &lt;&lt; deltaPsi*180./M_PI*3600.;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               Mat4d nut2000B=Mat4d::xrotation(eps_A) * Mat</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">4d::zrotation(deltaPsi)* Mat4d::xrotation(-eps_A-deltaEps);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               rotLocalToParent=rotLocalToParent*nut2000B;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       rotLocalToParent = Mat4d::zrotation(re.ascendingNode</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"> - <span class="insert">re.precessionRate*(JDE-re.epoch))</span> * Mat4d::xrotation(re.obliquity);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Mat4d Planet::getRotEquatorialToVsop87(void) const</td><td> </td><td class="right">Mat4d Planet::getRotEquatorialToVsop87(void) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d rval = rotLocalToParent;</td><td> </td><td class="right">       Mat4d rval = rotLocalToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent)</td><td> </td><td class="right">       if (parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               for (PlanetP p=parent;p-&gt;parent;p=p-&gt;parent)</td><td> </td><td class="right">               for (PlanetP p=parent;p-&gt;parent;p=p-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rval = p-&gt;rotLocalToParent * rval;</td><td> </td><td class="right">                       rval = p-&gt;rotLocalToParent * rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 609</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 697</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d a = Mat4d::identity();</td><td> </td><td class="right">       Mat4d a = Mat4d::identity();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent)</td><td> </td><td class="right">       if (parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               for (PlanetP p=parent;p-&gt;parent;p=p-&gt;parent)</td><td> </td><td class="right">               for (PlanetP p=parent;p-&gt;parent;p=p-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       a = p-&gt;rotLocalToParent * a;</td><td> </td><td class="right">                       a = p-&gt;rotLocalToParent * a;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rotLocalToParent = a.transpose() * m;</td><td> </td><td class="right">       rotLocalToParent = a.transpose() * m;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0055" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">// Compute the z rotation to use from equatorial to geographic <span class="delete">coordinates</span></td><td> </td><td class="rblock">// Compute the z rotation to use from equatorial to geographic <span class="insert">coordinates.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Planet::getSiderealTime(double <span class="delete">jd)</span> const</td><td> </td><td class="rblock"><span class="insert">// We need both JD and JDE here for Earth. (For other planets only JDE.)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">double Planet::getSiderealTime(double <span class="insert">JD, double JDE)</span> const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (englishName=="Earth")</td><td> </td><td class="right">       if (englishName=="Earth")</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0056" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       {</td><td> </td><td class="rblock">       {       <span class="insert">// Check to make sure that nutation is just those few arcsec</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               return <span class="delete">get_apparent_sidereal_time(jd);</span></td><td> </td><td class="rblock"><span class="insert">onds.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (StelApp::getInstance().getCore()-&gt;getUseNutation())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       return <span class="insert">get_apparent_sidereal_time(JD, JDE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       return get_mean_sidereal_time(JD, JDE);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0057" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       double t = <span class="delete">jd</span> - re.epoch;</td><td> </td><td class="rblock">       double t = <span class="insert">JDE</span> - re.epoch;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // oops... avoid division by zero (typical case for moons with chaot
ic period of rotation)</td><td> </td><td class="right">       // oops... avoid division by zero (typical case for moons with chaot
ic period of rotation)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double rotations = 1.f; // NOTE: Maybe 1e-3 will be better?</td><td> </td><td class="right">       double rotations = 1.f; // NOTE: Maybe 1e-3 will be better?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (re.period!=0.) // OK, it's not a moon with chaotic period of rot
ation :)</td><td> </td><td class="right">       if (re.period!=0.) // OK, it's not a moon with chaotic period of rot
ation :)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rotations = t / (double) re.period;</td><td> </td><td class="right">               rotations = t / (double) re.period;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double wholeRotations = floor(rotations);</td><td> </td><td class="right">       double wholeRotations = floor(rotations);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double remainder = rotations - wholeRotations;</td><td> </td><td class="right">       double remainder = rotations - wholeRotations;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (englishName=="Jupiter")</td><td> </td><td class="right">       if (englishName=="Jupiter")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if( re.offset &gt;= 0.0 )</td><td> </td><td class="right">               if( re.offset &gt;= 0.0 )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // use semi-empirical coefficient for GRS drift</td><td> </td><td class="right">                       // use semi-empirical coefficient for GRS drift</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // qDebug() &lt;&lt; "Jupiter: offset = " &lt;&lt; re.offset &lt;&lt; 
" --&gt; rotation = " &lt;&lt; (remainder * 360. + re.offset - 0.2483 * qAbs(jd - 24
56172));</td><td> </td><td class="right">                       // qDebug() &lt;&lt; "Jupiter: offset = " &lt;&lt; re.offset &lt;&lt; 
" --&gt; rotation = " &lt;&lt; (remainder * 360. + re.offset - 0.2483 * qAbs(jd - 24
56172));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0058" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       return remainder * 360. + re.offset - 0.2483 * qAbs(
<span class="delete">jd</span> - 2456172);</td><td> </td><td class="rblock">                       return remainder * 360. + re.offset - 0.2483 * qAbs(
<span class="insert">JDE</span> - 2456172);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // http://www.projectpluto.com/grs_form.htm</td><td> </td><td class="right">                       // http://www.projectpluto.com/grs_form.htm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // CM( System II) =  181.62 + 870.1869147 * jd + cor
rection [870d rotation every day]</td><td> </td><td class="right">                       // CM( System II) =  181.62 + 870.1869147 * jd + cor
rection [870d rotation every day]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const double rad  = M_PI/180.;</td><td> </td><td class="right">                       const double rad  = M_PI/180.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0059" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double jup_mean = (<span class="delete">jd - 2455636.938) * 360. / 4332.8
</span>9709;</td><td> </td><td class="rblock">                       double jup_mean = (<span class="insert">JDE - 2455636.938) * 360. / 4332.
8</span>9709;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double eqn_center = 5.55 * sin( rad*jup_mean);</td><td> </td><td class="right">                       double eqn_center = 5.55 * sin( rad*jup_mean);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0060" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double angle = (<span class="delete">jd - 2451870.628) * 360. / 398.884 -
</span> eqn_center;</td><td> </td><td class="rblock">                       double angle = (<span class="insert">JDE - 2451870.628) * 360. / 398.884 
-</span> eqn_center;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //double correction = 11 * sin( rad*angle) + 5 * cos
( rad*angle)- 1.25 * cos( rad*jup_mean) - eqn_center; // original correctio
n</td><td> </td><td class="right">                       //double correction = 11 * sin( rad*angle) + 5 * cos
( rad*angle)- 1.25 * cos( rad*jup_mean) - eqn_center; // original correctio
n</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double correction = 25.8 + 11 * sin( rad*angle) - 2.
5 * cos( rad*jup_mean) - eqn_center; // light speed correction not used bec
ause in stellarium the jd is manipulated for that</td><td> </td><td class="right">                       double correction = 25.8 + 11 * sin( rad*angle) - 2.
5 * cos( rad*jup_mean) - eqn_center; // light speed correction not used bec
ause in stellarium the jd is manipulated for that</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0061" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double cm2=181.62 + 870.1869147 * <span class="delete">jd + correction;</span></td><td> </td><td class="rblock">                       double cm2=181.62 + 870.1869147 * <span class="insert">JDE + correction; 
// Central Meridian II</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       cm2=cm2 - 360.0*(int)(cm2/360.);</td><td> </td><td class="right">                       cm2=cm2 - 360.0*(int)(cm2/360.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // http://www.skyandtelescope.com/observing/transit-
times-of-jupiters-great-red-spot/ writes:</td><td> </td><td class="right">                       // http://www.skyandtelescope.com/observing/transit-
times-of-jupiters-great-red-spot/ writes:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // The predictions assume the Red Spot was at Jovian
 System II longitude 216 in September 2014 and continues to drift 1.25 pe
r month, based on historical trends noted by JUPOS.</td><td> </td><td class="right">                       // The predictions assume the Red Spot was at Jovian
 System II longitude 216 in September 2014 and continues to drift 1.25 pe
r month, based on historical trends noted by JUPOS.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // GRS longitude was at 2014-09-08 216d with a drift
 of 1.25d every month</td><td> </td><td class="right">                       // GRS longitude was at 2014-09-08 216d with a drift
 of 1.25d every month</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0062" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       double longitudeGRS=216+1.25*( <span class="delete">jd</span> - 2456908)/30;</td><td> </td><td class="rblock">                       double longitudeGRS=216+1.25*( <span class="insert">JDE</span> - 2456908)/30;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // qDebug() &lt;&lt; "Jupiter: CM2 = " &lt;&lt; cm2 &lt;&lt; " longitu
deGRS = " &lt;&lt; longitudeGRS &lt;&lt; " --&gt; rotation = " &lt;&lt; (cm2 - longitudeGRS);</td><td> </td><td class="right">                       // qDebug() &lt;&lt; "Jupiter: CM2 = " &lt;&lt; cm2 &lt;&lt; " longitu
deGRS = " &lt;&lt; longitudeGRS &lt;&lt; " --&gt; rotation = " &lt;&lt; (cm2 - longitudeGRS);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       return cm2 - longitudeGRS + 25.; // + 25 = Jupiter T
exture not 0d</td><td> </td><td class="right">                       return cm2 - longitudeGRS + 25.; // + 25 = Jupiter T
exture not 0d</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // To verify:</td><td> </td><td class="right">                       // To verify:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // GRS at 2015-02-26 23:07 UT on picture at https://
maximusphotography.files.wordpress.com/2015/03/jupiter-febr-26-2015.jpg</td><td> </td><td class="right">                       // GRS at 2015-02-26 23:07 UT on picture at https://
maximusphotography.files.wordpress.com/2015/03/jupiter-febr-26-2015.jpg</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //        2014-02-25 19:03 UT    http://www.damianpe
ach.com/jup1314/2014_02_25rgb0305.jpg</td><td> </td><td class="right">                       //        2014-02-25 19:03 UT    http://www.damianpe
ach.com/jup1314/2014_02_25rgb0305.jpg</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //        2013-05-01 10:29 UT    http://astro.christ
one.net/jupiter/jupiter2012/jupiter20130501.jpg</td><td> </td><td class="right">                       //        2013-05-01 10:29 UT    http://astro.christ
one.net/jupiter/jupiter2012/jupiter20130501.jpg</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //        2012-10-26 00:12 UT at http://www.lunar-ca
ptures.com//jupiter2012_files/121026_JupiterGRS_Tar.jpg</td><td> </td><td class="right">                       //        2012-10-26 00:12 UT at http://www.lunar-ca
ptures.com//jupiter2012_files/121026_JupiterGRS_Tar.jpg</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       //        2011-08-28 02:29 UT at http://www.damianpe
ach.com/jup1112/2011_08_28rgb.jpg</td><td> </td><td class="right">                       //        2011-08-28 02:29 UT at http://www.damianpe
ach.com/jup1112/2011_08_28rgb.jpg</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // stellarium 2h too early: 2010-09-21 23:37 UT http
://www.digitalsky.org.uk/Jupiter/2010-09-21_23-37-30_R-G-B_800.jpg</td><td> </td><td class="right">                       // stellarium 2h too early: 2010-09-21 23:37 UT http
://www.digitalsky.org.uk/Jupiter/2010-09-21_23-37-30_R-G-B_800.jpg</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 751</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 843</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       p = p-&gt;parent;</td><td> </td><td class="right">                       p = p-&gt;parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the distance to the given position in heliocentric coordinate (i
n AU)</td><td> </td><td class="right">// Compute the distance to the given position in heliocentric coordinate (i
n AU)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// This is called by SolarSystem::draw()</td><td> </td><td class="right">// This is called by SolarSystem::draw()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::computeDistance(const Vec3d&amp; obsHelioPos)</td><td> </td><td class="right">double Planet::computeDistance(const Vec3d&amp; obsHelioPos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       distance = (obsHelioPos-getHeliocentricEclipticPos()).length();</td><td> </td><td class="right">       distance = (obsHelioPos-getHeliocentricEclipticPos()).length();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0063" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // improve fps by juggling updates for <span class="delete">asteroids.</span> They must be fast </td><td> </td><td class="rblock">       // improve fps by juggling updates for <span class="insert">asteroids and other minor bod</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">if close to observer, but can be slow if further <span class="delete">away.</span></td><td> </td><td class="rblock"><span class="insert">ies.</span> They must be fast if close to observer, but can be slow if further <span class="insert">awa</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (pType <span class="delete">==</span> Planet::isAsteroid)</td><td> </td><td class="rblock"><span class="insert">y.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">deltaJD=distance*StelCore::JD_SECOND;</span></td><td> </td><td class="rblock">       if (pType <span class="insert">&gt;=</span> Planet::isAsteroid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       <span class="insert">deltaJDE=distance*StelCore::JD_SECOND;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return distance;</td><td> </td><td class="right">       return distance;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Get the phase angle (radians) for an observer at pos obsPos in heliocent
ric coordinates (dist in AU)</td><td> </td><td class="right">// Get the phase angle (radians) for an observer at pos obsPos in heliocent
ric coordinates (dist in AU)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getPhaseAngle(const Vec3d&amp; obsPos) const</td><td> </td><td class="right">double Planet::getPhaseAngle(const Vec3d&amp; obsPos) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerRq = obsPos.lengthSquared();</td><td> </td><td class="right">       const double observerRq = obsPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td> </td><td class="right">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double planetRq = planetHelioPos.lengthSquared();</td><td> </td><td class="right">       const double planetRq = planetHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerPlanetRq = (obsPos - planetHelioPos).lengthSqua
red();</td><td> </td><td class="right">       const double observerPlanetRq = (obsPos - planetHelioPos).lengthSqua
red();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 793</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 885</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double planetRq = planetHelioPos.lengthSquared();</td><td> </td><td class="right">       const double planetRq = planetHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerPlanetRq = (obsPos - planetHelioPos).lengthSqua
red();</td><td> </td><td class="right">       const double observerPlanetRq = (obsPos - planetHelioPos).lengthSqua
red();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return std::acos((observerPlanetRq  + observerRq - planetRq)/(2.0*sq
rt(observerPlanetRq*observerRq)));</td><td> </td><td class="right">       return std::acos((observerPlanetRq  + observerRq - planetRq)/(2.0*sq
rt(observerPlanetRq*observerRq)));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Computation of the visual magnitude (V band) of the planet.</td><td> </td><td class="right">// Computation of the visual magnitude (V band) of the planet.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">float Planet::getVMagnitude(const StelCore* core) const</td><td> </td><td class="right">float Planet::getVMagnitude(const StelCore* core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent == 0)</td><td> </td><td class="right">       if (parent == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0064" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               // <span class="delete">sun,</span> compute the apparent magnitude for the absolute mag </td><td> </td><td class="rblock">               // <span class="insert">Sun,</span> compute the apparent magnitude for the absolute mag </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">(4.83)</span> and observer's distance</td><td> </td><td class="rblock"><span class="insert">(V: 4.83)</span> and observer's distance</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">// Hint: Absolute Magnitude of the Sun in Several Bands: htt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">p://mips.as.arizona.edu/~cnaw/sun.html</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const double distParsec = std::sqrt(core-&gt;getObserverHelioce
ntricEclipticPos().lengthSquared())*AU/PARSEC;</td><td> </td><td class="right">               const double distParsec = std::sqrt(core-&gt;getObserverHelioce
ntricEclipticPos().lengthSquared())*AU/PARSEC;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0065" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               return 4.83 + <span class="delete">5.*(std::log10(distParsec)-1.);</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">// check how much of it is visible</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               const SolarSystem* ssm = GETSTELMODULE(SolarSystem);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               double shadowFactor = ssm-&gt;getEclipseFactor(core);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // See: Hughes, D. W., Brightness during a solar eclipse // </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Journal of the British Astronomical Association, vol.110, no.4, p.203-205</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // URL: http://adsabs.harvard.edu/abs/2000JBAA..110..203H</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if(shadowFactor &lt; 0.000128)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       shadowFactor = 0.000128;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               return 4.83 + <span class="insert">5.*(std::log10(distParsec)-1.) - 2.5*(std::log</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">10(shadowFactor));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute the angular phase</td><td> </td><td class="right">       // Compute the angular phase</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec3d&amp; observerHelioPos = core-&gt;getObserverHeliocentricEclipti
cPos();</td><td> </td><td class="right">       const Vec3d&amp; observerHelioPos = core-&gt;getObserverHeliocentricEclipti
cPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerRq = observerHelioPos.lengthSquared();</td><td> </td><td class="right">       const double observerRq = observerHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td> </td><td class="right">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double planetRq = planetHelioPos.lengthSquared();</td><td> </td><td class="right">       const double planetRq = planetHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerPlanetRq = (observerHelioPos - planetHelioPos).
lengthSquared();</td><td> </td><td class="right">       const double observerPlanetRq = (observerHelioPos - planetHelioPos).
lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double cos_chi = (observerPlanetRq + planetRq - observerRq)/(2
.0*std::sqrt(observerPlanetRq*planetRq));</td><td> </td><td class="right">       const double cos_chi = (observerPlanetRq + planetRq - observerRq)/(2
.0*std::sqrt(observerPlanetRq*planetRq));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double phase = std::acos(cos_chi);</td><td> </td><td class="right">       const double phase = std::acos(cos_chi);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l10" /><small>skipping to change at</small><em> line 883</em></th><th> </th><th><a name="part-r10" /><small>skipping to change at</small><em> line 985</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Venus")</td><td> </td><td class="right">                               if (englishName=="Venus")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -4.29 + d + 0.09*f1 + 2.39*f1
*f1 - 0.65*f1*f1*f1;</td><td> </td><td class="right">                                       return -4.29 + d + 0.09*f1 + 2.39*f1
*f1 - 0.65*f1*f1*f1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Mars")</td><td> </td><td class="right">                               if (englishName=="Mars")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -1.52 + d + 0.016*phaseDeg;</td><td> </td><td class="right">                                       return -1.52 + d + 0.016*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Jupiter")</td><td> </td><td class="right">                               if (englishName=="Jupiter")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -9.25 + d + 0.005*phaseDeg;</td><td> </td><td class="right">                                       return -9.25 + d + 0.005*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Saturn")</td><td> </td><td class="right">                               if (englishName=="Saturn")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // add rings computation</td><td> </td><td class="right">                                       // add rings computation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // implemented from Meeus, Astr.Alg.
1992</td><td> </td><td class="right">                                       // implemented from Meeus, Astr.Alg.
1992</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0066" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       const double <span class="delete">jd=core-&gt;getJDay();</span></td><td> </td><td class="rblock">                                       const double <span class="insert">jde=core-&gt;getJDE();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       const double <span class="delete">T=(jd-2451545.0)/36525.</span></td><td> </td><td class="rblock">                                       const double <span class="insert">T=(jde-2451545.0)/36525</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">0;</span></td><td> </td><td class="rblock"><span class="insert">.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double i=((0.000004*T-0.012998
)*T+28.075216)*M_PI/180.0;</td><td> </td><td class="right">                                       const double i=((0.000004*T-0.012998
)*T+28.075216)*M_PI/180.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double Omega=((0.000412*T+1.39
4681)*T+169.508470)*M_PI/180.0;</td><td> </td><td class="right">                                       const double Omega=((0.000412*T+1.39
4681)*T+169.508470)*M_PI/180.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       static SolarSystem *ssystem=GETSTELM
ODULE(SolarSystem);</td><td> </td><td class="right">                                       static SolarSystem *ssystem=GETSTELM
ODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const Vec3d saturnEarth=getHeliocent
ricEclipticPos() - ssystem-&gt;getEarth()-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">                                       const Vec3d saturnEarth=getHeliocent
ricEclipticPos() - ssystem-&gt;getEarth()-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double lambda=atan2(saturnEarth[1], 
saturnEarth[0]);</td><td> </td><td class="right">                                       double lambda=atan2(saturnEarth[1], 
saturnEarth[0]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double beta=atan2(saturnEarth[2], st
d::sqrt(saturnEarth[0]*saturnEarth[0]+saturnEarth[1]*saturnEarth[1]));</td><td> </td><td class="right">                                       double beta=atan2(saturnEarth[2], st
d::sqrt(saturnEarth[0]*saturnEarth[0]+saturnEarth[1]*saturnEarth[1]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double sinx=sin(i)*cos(beta)*s
in(lambda-Omega)-cos(i)*sin(beta);</td><td> </td><td class="right">                                       const double sinx=sin(i)*cos(beta)*s
in(lambda-Omega)-cos(i)*sin(beta);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double rings = -2.6*sinx + 1.25*sinx
*sinx;</td><td> </td><td class="right">                                       double rings = -2.6*sinx + 1.25*sinx
*sinx;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -8.88 + d + 0.044*phaseDeg + 
rings;</td><td> </td><td class="right">                                       return -8.88 + d + 0.044*phaseDeg + 
rings;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l11" /><small>skipping to change at</small><em> line 922</em></th><th> </th><th><a name="part-r11" /><small>skipping to change at</small><em> line 1024</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Venus")</td><td> </td><td class="right">                               if (englishName=="Venus")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -4.0 + d + 0.01322*phaseDeg +
 0.0000004247*phaseDeg*phaseDeg*phaseDeg;</td><td> </td><td class="right">                                       return -4.0 + d + 0.01322*phaseDeg +
 0.0000004247*phaseDeg*phaseDeg*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Mars")</td><td> </td><td class="right">                               if (englishName=="Mars")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -1.3 + d + 0.01486*phaseDeg;</td><td> </td><td class="right">                                       return -1.3 + d + 0.01486*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Jupiter")</td><td> </td><td class="right">                               if (englishName=="Jupiter")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -8.93 + d;</td><td> </td><td class="right">                                       return -8.93 + d;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Saturn")</td><td> </td><td class="right">                               if (englishName=="Saturn")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // add rings computation</td><td> </td><td class="right">                                       // add rings computation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // implemented from Meeus, Astr.Alg.
1992</td><td> </td><td class="right">                                       // implemented from Meeus, Astr.Alg.
1992</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0067" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       const double <span class="delete">jd=core-&gt;getJDay();</span></td><td> </td><td class="rblock">                                       const double <span class="insert">jde=core-&gt;getJDE();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       const double <span class="delete">T=(jd-2451545.0)/36525.</span></td><td> </td><td class="rblock">                                       const double <span class="insert">T=(jde-2451545.0)/36525</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">0;</span></td><td> </td><td class="rblock"><span class="insert">.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double i=((0.000004*T-0.012998
)*T+28.075216)*M_PI/180.0;</td><td> </td><td class="right">                                       const double i=((0.000004*T-0.012998
)*T+28.075216)*M_PI/180.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double Omega=((0.000412*T+1.39
4681)*T+169.508470)*M_PI/180.0;</td><td> </td><td class="right">                                       const double Omega=((0.000412*T+1.39
4681)*T+169.508470)*M_PI/180.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       SolarSystem *ssystem=GETSTELMODULE(S
olarSystem);</td><td> </td><td class="right">                                       SolarSystem *ssystem=GETSTELMODULE(S
olarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const Vec3d saturnEarth=getHeliocent
ricEclipticPos() - ssystem-&gt;getEarth()-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">                                       const Vec3d saturnEarth=getHeliocent
ricEclipticPos() - ssystem-&gt;getEarth()-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double lambda=atan2(saturnEarth[1], 
saturnEarth[0]);</td><td> </td><td class="right">                                       double lambda=atan2(saturnEarth[1], 
saturnEarth[0]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double beta=atan2(saturnEarth[2], st
d::sqrt(saturnEarth[0]*saturnEarth[0]+saturnEarth[1]*saturnEarth[1]));</td><td> </td><td class="right">                                       double beta=atan2(saturnEarth[2], st
d::sqrt(saturnEarth[0]*saturnEarth[0]+saturnEarth[1]*saturnEarth[1]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double sinB=sin(i)*cos(beta)*s
in(lambda-Omega)-cos(i)*sin(beta);</td><td> </td><td class="right">                                       const double sinB=sin(i)*cos(beta)*s
in(lambda-Omega)-cos(i)*sin(beta);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double rings = -2.6*fabs(sinB) + 1.2
5*sinB*sinB; // sinx=sinB, saturnicentric latitude of earth. longish, see M
eeus.</td><td> </td><td class="right">                                       double rings = -2.6*fabs(sinB) + 1.2
5*sinB*sinB; // sinx=sinB, saturnicentric latitude of earth. longish, see M
eeus.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -8.68 + d + 0.044*phaseDeg + 
rings;</td><td> </td><td class="right">                                       return -8.68 + d + 0.044*phaseDeg + 
rings;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l12" /><small>skipping to change at</small><em> line 960</em></th><th> </th><th><a name="part-r12" /><small>skipping to change at</small><em> line 1062</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Venus")</td><td> </td><td class="right">                               if (englishName=="Venus")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -4.40 + d + 0.0009*phaseDeg +
 0.000239*phaseDeg*phaseDeg - 0.00000065*phaseDeg*phaseDeg*phaseDeg;</td><td> </td><td class="right">                                       return -4.40 + d + 0.0009*phaseDeg +
 0.000239*phaseDeg*phaseDeg - 0.00000065*phaseDeg*phaseDeg*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Mars")</td><td> </td><td class="right">                               if (englishName=="Mars")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -1.52 + d + 0.016*phaseDeg;</td><td> </td><td class="right">                                       return -1.52 + d + 0.016*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Jupiter")</td><td> </td><td class="right">                               if (englishName=="Jupiter")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -9.40 + d + 0.005*phaseDeg;</td><td> </td><td class="right">                                       return -9.40 + d + 0.005*phaseDeg;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               if (englishName=="Saturn")</td><td> </td><td class="right">                               if (englishName=="Saturn")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               {</td><td> </td><td class="right">                               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // add rings computation</td><td> </td><td class="right">                                       // add rings computation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       // implemented from Meeus, Astr.Alg.
1992</td><td> </td><td class="right">                                       // implemented from Meeus, Astr.Alg.
1992</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0068" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       const double <span class="delete">jd=core-&gt;getJDay();</span></td><td> </td><td class="rblock">                                       const double <span class="insert">jde=core-&gt;getJDE();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                       const double <span class="delete">T=(jd-2451545.0)/36525.</span></td><td> </td><td class="rblock">                                       const double <span class="insert">T=(jde-2451545.0)/36525</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">0;</span></td><td> </td><td class="rblock"><span class="insert">.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double i=((0.000004*T-0.012998
)*T+28.075216)*M_PI/180.0;</td><td> </td><td class="right">                                       const double i=((0.000004*T-0.012998
)*T+28.075216)*M_PI/180.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double Omega=((0.000412*T+1.39
4681)*T+169.508470)*M_PI/180.0;</td><td> </td><td class="right">                                       const double Omega=((0.000412*T+1.39
4681)*T+169.508470)*M_PI/180.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       static SolarSystem *ssystem=GETSTELM
ODULE(SolarSystem);</td><td> </td><td class="right">                                       static SolarSystem *ssystem=GETSTELM
ODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const Vec3d saturnEarth=getHeliocent
ricEclipticPos() - ssystem-&gt;getEarth()-&gt;getHeliocentricEclipticPos();</td><td> </td><td class="right">                                       const Vec3d saturnEarth=getHeliocent
ricEclipticPos() - ssystem-&gt;getEarth()-&gt;getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double lambda=atan2(saturnEarth[1], 
saturnEarth[0]);</td><td> </td><td class="right">                                       double lambda=atan2(saturnEarth[1], 
saturnEarth[0]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double beta=atan2(saturnEarth[2], st
d::sqrt(saturnEarth[0]*saturnEarth[0]+saturnEarth[1]*saturnEarth[1]));</td><td> </td><td class="right">                                       double beta=atan2(saturnEarth[2], st
d::sqrt(saturnEarth[0]*saturnEarth[0]+saturnEarth[1]*saturnEarth[1]));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       const double sinB=sin(i)*cos(beta)*s
in(lambda-Omega)-cos(i)*sin(beta);</td><td> </td><td class="right">                                       const double sinB=sin(i)*cos(beta)*s
in(lambda-Omega)-cos(i)*sin(beta);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       double rings = -2.6*fabs(sinB) + 1.2
5*sinB*sinB; // sinx=sinB, saturnicentric latitude of earth. longish, see M
eeus.</td><td> </td><td class="right">                                       double rings = -2.6*fabs(sinB) + 1.2
5*sinB*sinB; // sinx=sinB, saturnicentric latitude of earth. longish, see M
eeus.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                       return -8.88 + d + 0.044*phaseDeg + 
rings;</td><td> </td><td class="right">                                       return -8.88 + d + 0.044*phaseDeg + 
rings;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               }</td><td> </td><td class="right">                               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l13" /><small>skipping to change at</small><em> line 1013</em></th><th> </th><th><a name="part-r13" /><small>skipping to change at</small><em> line 1115</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getSpheroidAngularSize(const StelCore* core) const</td><td> </td><td class="right">double Planet::getSpheroidAngularSize(const StelCore* core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return std::atan2(radius*sphereScale,getJ2000EquatorialPos(core).len
gth()) * 180./M_PI;</td><td> </td><td class="right">       return std::atan2(radius*sphereScale,getJ2000EquatorialPos(core).len
gth()) * 180./M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Draw the Planet and all the related infos : name, circle etc..</td><td> </td><td class="right">// Draw the Planet and all the related infos : name, circle etc..</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::draw(StelCore* core, float maxMagLabels, const QFont&amp; planetNa
meFont)</td><td> </td><td class="right">void Planet::draw(StelCore* core, float maxMagLabels, const QFont&amp; planetNa
meFont)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hidden)</td><td> </td><td class="right">       if (hidden)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0069" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">// Exclude drawing if user set a hard limit magnitude.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       if (core-&gt;getSkyDrawer()-&gt;getFlagPlanetMagnitudeLimit() &amp;&amp; (getVMagn</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">itude(core) &gt; core-&gt;getSkyDrawer()-&gt;getCustomPlanetMagnitudeLimit()))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               return;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Try to improve speed for minor planets: test if visible at all.</td><td> </td><td class="right">       // Try to improve speed for minor planets: test if visible at all.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // For a full catalog of NEAs (11000 objects), with this and resetti
ng deltaJD according to distance, rendering time went 4.5fps-&gt;12fps.</td><td> </td><td class="right">       // For a full catalog of NEAs (11000 objects), with this and resetti
ng deltaJD according to distance, rendering time went 4.5fps-&gt;12fps.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // TBD: Note that taking away the asteroids at this stage breaks dim
-asteroid occultation of stars!</td><td> </td><td class="right">       // TBD: Note that taking away the asteroids at this stage breaks dim
-asteroid occultation of stars!</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       //      Maybe make another configurable flag for those interested?</td><td> </td><td class="right">       //      Maybe make another configurable flag for those interested?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Problematic: Early-out here of course disables the wanted hint ci
rcles for dim asteroids.</td><td> </td><td class="right">       // Problematic: Early-out here of course disables the wanted hint ci
rcles for dim asteroids.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // The line makes hints for asteroids 5 magnitudes below sky limitin
g magnitude visible.</td><td> </td><td class="right">       // The line makes hints for asteroids 5 magnitudes below sky limitin
g magnitude visible.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // If asteroid is too faint to be seen, don't bother rendering. (Mas
sive speedup if people have hundreds of orbital elements!)</td><td> </td><td class="right">       // If asteroid is too faint to be seen, don't bother rendering. (Mas
sive speedup if people have hundreds of orbital elements!)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (((getVMagnitude(core)-5.0f) &gt; core-&gt;getSkyDrawer()-&gt;getLimitMagn
itude()) &amp;&amp; pType&gt;=Planet::isAsteroid)</td><td> </td><td class="right">       if (((getVMagnitude(core)-5.0f) &gt; core-&gt;getSkyDrawer()-&gt;getLimitMagn
itude()) &amp;&amp; pType&gt;=Planet::isAsteroid)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l14" /><small>skipping to change at</small><em> line 1374</em></th><th> </th><th><a name="part-r14" /><small>skipping to change at</small><em> line 1481</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       delete moonShaderProgram;</td><td> </td><td class="right">       delete moonShaderProgram;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       moonShaderProgram = NULL;</td><td> </td><td class="right">       moonShaderProgram = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::draw3dModel(StelCore* core, StelProjector::ModelViewTranformP 
transfo, float screenSz, bool drawOnlyRing)</td><td> </td><td class="right">void Planet::draw3dModel(StelCore* core, StelProjector::ModelViewTranformP 
transfo, float screenSz, bool drawOnlyRing)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This is the main method drawing a planet 3d model</td><td> </td><td class="right">       // This is the main method drawing a planet 3d model</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Some work has to be done on this method to make the rendering nic
er</td><td> </td><td class="right">       // Some work has to be done on this method to make the rendering nic
er</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td> </td><td class="right">       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0070" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">// Find extinction settings to change colors. The method is rather a</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">d-hoc.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       float extinctedMag=getVMagnitudeWithExtinction(core)-getVMagnitude(c</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ore); // this is net value of extinction, in mag.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       float magFactorGreen=pow(0.85f, 0.6f*extinctedMag);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       float magFactorBlue=pow(0.6f, 0.5f*extinctedMag);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (screenSz&gt;1.)</td><td> </td><td class="right">       if (screenSz&gt;1.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               StelProjector::ModelViewTranformP transfo2 = transfo-&gt;clone(
);</td><td> </td><td class="right">               StelProjector::ModelViewTranformP transfo2 = transfo-&gt;clone(
);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               transfo2-&gt;combine(Mat4d::zrotation(M_PI/180*(axisRotation + 
90.)));</td><td> </td><td class="right">               transfo2-&gt;combine(Mat4d::zrotation(M_PI/180*(axisRotation + 
90.)));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               StelPainter* sPainter = new StelPainter(core-&gt;getProjection(
transfo2));</td><td> </td><td class="right">               StelPainter* sPainter = new StelPainter(core-&gt;getProjection(
transfo2));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (flagLighting)</td><td> </td><td class="right">               if (flagLighting)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Set the main source of light to be the sun</td><td> </td><td class="right">                       // Set the main source of light to be the sun</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       Vec3d sunPos(0);</td><td> </td><td class="right">                       Vec3d sunPos(0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;getHeliocentricEclipticModelViewTransform()-&gt;f
orward(sunPos);</td><td> </td><td class="right">                       core-&gt;getHeliocentricEclipticModelViewTransform()-&gt;f
orward(sunPos);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       light.position=Vec4f(sunPos[0],sunPos[1],sunPos[2],1
.f);</td><td> </td><td class="right">                       light.position=Vec4f(sunPos[0],sunPos[1],sunPos[2],1
.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Set the light parameters taking sun as the light 
source</td><td> </td><td class="right">                       // Set the light parameters taking sun as the light 
source</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0071" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       light.diffuse = <span class="delete">Vec4f(1.f,1.f,1.f);</span></td><td> </td><td class="rblock">                       light.diffuse = <span class="insert">Vec4f(1.f,magFactorGreen*1.f,magFact</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       light.ambient = <span class="delete">Vec4f(0.02f,0.02f,0.02f);</span></td><td> </td><td class="rblock"><span class="insert">orBlue*1.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       light.ambient = <span class="insert">Vec4f(0.02f,magFactorGreen*0.02f,mag</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">FactorBlue*0.02f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (this==ssm-&gt;getMoon())</td><td> </td><td class="right">                       if (this==ssm-&gt;getMoon())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0072" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               // Special case for the Moon (maybe better u</td><td> </td><td class="rblock">                               // Special case for the Moon (maybe better u</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">se 1.5,1.5,1.5,1.0 ?)</td><td> </td><td class="rblock">se 1.5,1.5,1.5,1.0 ?) <span class="insert">Was 1.6, but this often is too bright.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               light.diffuse = <span class="delete">Vec4f(1.6f,1.6f,1.6f,1.f);</span></td><td> </td><td class="rblock">                               light.diffuse = <span class="insert">Vec4f(1.5f,magFactorGreen*1.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">5f,magFactorBlue*1.5f,1.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0073" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       sPainter-&gt;setColor(albedo,<span class="delete">albedo,</span>albedo);</td><td> </td><td class="rblock">                       sPainter-&gt;setColor(albedo,<span class="insert">magFactorGreen*albedo,magF
actorBlue*</span>albedo);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0074" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">// possibly tint sun's color from extinction. This should de</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">liberately cause stronger reddening than for the other objects.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (this==ssm-&gt;getSun())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       sPainter-&gt;setColor(2.f, pow(0.75f, extinctedMag)*2.f</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">, pow(0.42f, 0.9f*extinctedMag)*2.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rings)</td><td> </td><td class="right">               if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // The planet has rings, we need to use depth buffer
 and adjust the clipping planes to avoid</td><td> </td><td class="right">                       // The planet has rings, we need to use depth buffer
 and adjust the clipping planes to avoid</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // reaching the maximum resolution of the depth buff
er</td><td> </td><td class="right">                       // reaching the maximum resolution of the depth buff
er</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const double dist = getEquinoxEquatorialPos(core).le
ngth();</td><td> </td><td class="right">                       const double dist = getEquinoxEquatorialPos(core).le
ngth();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double z_near = 0.9*(dist - rings-&gt;getSize());</td><td> </td><td class="right">                       double z_near = 0.9*(dist - rings-&gt;getSize());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double z_far  = 1.1*(dist + rings-&gt;getSize());</td><td> </td><td class="right">                       double z_far  = 1.1*(dist + rings-&gt;getSize());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (z_near &lt; 0.0) z_near = 0.0;</td><td> </td><td class="right">                       if (z_near &lt; 0.0) z_near = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double n,f;</td><td> </td><td class="right">                       double n,f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;getClippingPlanes(&amp;n,&amp;f); // Save clipping pla
nes</td><td> </td><td class="right">                       core-&gt;getClippingPlanes(&amp;n,&amp;f); // Save clipping pla
nes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l15" /><small>skipping to change at</small><em> line 1436</em></th><th> </th><th><a name="part-r15" /><small>skipping to change at</small><em> line 1552</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw the halo if it enabled in the ssystem.ini file (+ special ca
se for backward compatible for the Sun)</td><td> </td><td class="right">       // Draw the halo if it enabled in the ssystem.ini file (+ special ca
se for backward compatible for the Sun)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hasHalo() || this==ssm-&gt;getSun())</td><td> </td><td class="right">       if (hasHalo() || this==ssm-&gt;getSun())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Prepare openGL lighting parameters according to luminance</td><td> </td><td class="right">               // Prepare openGL lighting parameters according to luminance</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               float surfArcMin2 = getSpheroidAngularSize(core)*60;</td><td> </td><td class="right">               float surfArcMin2 = getSpheroidAngularSize(core)*60;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               surfArcMin2 = surfArcMin2*surfArcMin2*M_PI; // the total ill
uminated area in arcmin^2</td><td> </td><td class="right">               surfArcMin2 = surfArcMin2*surfArcMin2*M_PI; // the total ill
uminated area in arcmin^2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               StelPainter sPainter(core-&gt;getProjection(StelCore::FrameJ200
0));</td><td> </td><td class="right">               StelPainter sPainter(core-&gt;getProjection(StelCore::FrameJ200
0));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Vec3d tmp = getJ2000EquatorialPos(core);</td><td> </td><td class="right">               Vec3d tmp = getJ2000EquatorialPos(core);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0075" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               core-&gt;getSkyDrawer()-&gt;postDrawSky3dModel(&amp;sPainter, Vec3f(tm</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">p[0], tmp[1], tmp[2]), surfArcMin2, getVMagnitudeWithExtinction(core), <span class="delete">colo</span></td><td> </td><td class="rblock">               <span class="insert">// Find new extincted color for halo. The method is again ra</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">r);</span></td><td> </td><td class="rblock"><span class="insert">ther ad-hoc, but does not look too bad.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               // For the sun, we have again to use the stronger extinction</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> to avoid color mismatch.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               Vec3f haloColorToDraw;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (this==ssm-&gt;getSun())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       haloColorToDraw.set(haloColor[0], pow(0.75f, extinct</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">edMag) * haloColor[1], pow(0.42f, 0.9f*extinctedMag) * haloColor[2]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       haloColorToDraw.set(haloColor[0], magFactorGreen * h</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">aloColor[1], magFactorBlue * haloColor[2]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               core-&gt;getSkyDrawer()-&gt;postDrawSky3dModel(&amp;sPainter, Vec3f(tm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">p[0], tmp[1], tmp[2]), surfArcMin2, getVMagnitudeWithExtinction(core), <span class="insert">halo</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ColorToDraw);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if ((englishName=="Sun") &amp;&amp; (core-&gt;getCurrentLocation().plan</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">etName == "Earth"))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       float eclipseFactor = ssm-&gt;getEclipseFactor(core);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       // This alpha ensures 0 for complete sun, 1 for ecli</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">pse better 1e-10, with a strong increase towards full eclipse. We still nee</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">d to square it.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       float alpha=-0.1f*qMax(-10.0f, (float) std::log10(ec</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">lipseFactor));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       core-&gt;getSkyDrawer()-&gt;drawSunCorona(&amp;sPainter, Vec3f</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">(tmp[0], tmp[1], tmp[2]), 512.f/192.f*screenSz, haloColorToDraw, alpha*alph</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">a);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">struct Planet3DModel</td><td> </td><td class="right">struct Planet3DModel</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QVector&lt;float&gt; vertexArr;</td><td> </td><td class="right">       QVector&lt;float&gt; vertexArr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QVector&lt;float&gt; texCoordArr;</td><td> </td><td class="right">       QVector&lt;float&gt; texCoordArr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QVector&lt;unsigned short&gt; indiceArr;</td><td> </td><td class="right">       QVector&lt;unsigned short&gt; indiceArr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l16" /><small>skipping to change at</small><em> line 1586</em></th><th> </th><th><a name="part-r16" /><small>skipping to change at</small><em> line 1719</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QVector&lt;float&gt; projectedVertexArr;</td><td> </td><td class="right">       QVector&lt;float&gt; projectedVertexArr;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       projectedVertexArr.resize(model.vertexArr.size());</td><td> </td><td class="right">       projectedVertexArr.resize(model.vertexArr.size());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (int i=0;i&lt;model.vertexArr.size()/3;++i)</td><td> </td><td class="right">       for (int i=0;i&lt;model.vertexArr.size()/3;++i)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               painter-&gt;getProjector()-&gt;project(*((Vec3f*)(model.vertexArr.
constData()+i*3)), *((Vec3f*)(projectedVertexArr.data()+i*3)));</td><td> </td><td class="right">               painter-&gt;getProjector()-&gt;project(*((Vec3f*)(model.vertexArr.
constData()+i*3)), *((Vec3f*)(projectedVertexArr.data()+i*3)));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td> </td><td class="right">       const SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (this==ssm-&gt;getSun())</td><td> </td><td class="right">       if (this==ssm-&gt;getSun())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               texMap-&gt;bind();</td><td> </td><td class="right">               texMap-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0076" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">painter-&gt;setColor(2, 2, 2);</span></td><td> </td><td class="rblock">               <span class="insert">//painter-&gt;setColor(2, 2, 0.2); // This is now in draw3dMode
l() to apply extinction</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               painter-&gt;setArrays((Vec3f*)projectedVertexArr.constData(), (
Vec2f*)model.texCoordArr.constData());</td><td> </td><td class="right">               painter-&gt;setArrays((Vec3f*)projectedVertexArr.constData(), (
Vec2f*)model.texCoordArr.constData());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               painter-&gt;drawFromArray(StelPainter::Triangles, model.indiceA
rr.size(), 0, false, model.indiceArr.constData());</td><td> </td><td class="right">               painter-&gt;drawFromArray(StelPainter::Triangles, model.indiceA
rr.size(), 0, false, model.indiceArr.constData());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (planetShaderProgram==NULL)</td><td> </td><td class="right">       if (planetShaderProgram==NULL)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               Planet::initShader();</td><td> </td><td class="right">               Planet::initShader();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(planetShaderProgram!=NULL);</td><td> </td><td class="right">       Q_ASSERT(planetShaderProgram!=NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(ringPlanetShaderProgram!=NULL);</td><td> </td><td class="right">       Q_ASSERT(ringPlanetShaderProgram!=NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(moonShaderProgram!=NULL);</td><td> </td><td class="right">       Q_ASSERT(moonShaderProgram!=NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l17" /><small>skipping to change at</small><em> line 1795</em></th><th> </th><th><a name="part-r17" /><small>skipping to change at</small><em> line 1928</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// draw orbital path of Planet</td><td> </td><td class="right">// draw orbital path of Planet</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::drawOrbit(const StelCore* core)</td><td> </td><td class="right">void Planet::drawOrbit(const StelCore* core)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!orbitFader.getInterstate())</td><td> </td><td class="right">       if (!orbitFader.getInterstate())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (!re.siderealPeriod)</td><td> </td><td class="right">       if (!re.siderealPeriod)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0077" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameHelioc
entricEcliptic);</td><td> </td><td class="rblock">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameHelioc
entricEcliptic<span class="insert">J2000</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(prj);</td><td> </td><td class="right">       StelPainter sPainter(prj);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Normal transparency mode</td><td> </td><td class="right">       // Normal transparency mode</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setColor(orbitColor[0], orbitColor[1], orbitColor[2], orbit
Fader.getInterstate());</td><td> </td><td class="right">       sPainter.setColor(orbitColor[0], orbitColor[1], orbitColor[2], orbit
Fader.getInterstate());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d onscreen;</td><td> </td><td class="right">       Vec3d onscreen;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // special case - use current Planet position as center vertex so th
at draws</td><td> </td><td class="right">       // special case - use current Planet position as center vertex so th
at draws</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0078" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // on it<span class="delete">'s orbit all the time (since segmented rather than smooth cu
r</span>ve)</td><td> </td><td class="rblock">       // on it<span class="insert">s orbit all the time (since segmented rather than smooth cur
</span>ve)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3d savePos = orbit[ORBIT_SEGMENTS/2];</td><td> </td><td class="right">       Vec3d savePos = orbit[ORBIT_SEGMENTS/2];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       orbit[ORBIT_SEGMENTS/2]=getHeliocentricEclipticPos();</td><td> </td><td class="right">       orbit[ORBIT_SEGMENTS/2]=getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       orbit[ORBIT_SEGMENTS]=orbit[0];</td><td> </td><td class="right">       orbit[ORBIT_SEGMENTS]=orbit[0];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int nbIter = closeOrbit ? ORBIT_SEGMENTS : ORBIT_SEGMENTS-1;</td><td> </td><td class="right">       int nbIter = closeOrbit ? ORBIT_SEGMENTS : ORBIT_SEGMENTS-1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QVarLengthArray&lt;float, 1024&gt; vertexArray;</td><td> </td><td class="right">       QVarLengthArray&lt;float, 1024&gt; vertexArray;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.enableClientStates(true, false, false);</td><td> </td><td class="right">       sPainter.enableClientStates(true, false, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (int n=0; n&lt;=nbIter; ++n)</td><td> </td><td class="right">       for (int n=0; n&lt;=nbIter; ++n)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 78 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>111 lines changed or deleted</i></th><th><i> </i></th><th><i>310 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
