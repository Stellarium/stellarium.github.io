<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: ZoneArray.cpp - ZoneArray.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;ZoneArray.cpp&nbsp;</th><th> </th><th>&nbsp;ZoneArray.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 28</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 28</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> */</td><td> </td><td class="right"> */</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QFile&gt;</td><td> </td><td class="right">#include &lt;QFile&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef Q_OS_WIN</td><td> </td><td class="right">#ifdef Q_OS_WIN</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;io.h&gt;</td><td> </td><td class="right">#include &lt;io.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;windows.h&gt;</td><td> </td><td class="right">#include &lt;windows.h&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "ZoneArray.hpp"</td><td> </td><td class="right">#include "ZoneArray.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">#include "renderer/StelRenderer.hpp"</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelFileMgr.hpp"</td><td> </td><td class="right">#include "StelFileMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelGeodesicGrid.hpp"</td><td> </td><td class="right">#include "StelGeodesicGrid.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelObject.hpp"</td><td> </td><td class="right">#include "StelObject.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static unsigned int stel_bswap_32(unsigned int val) {</td><td> </td><td class="right">static unsigned int stel_bswap_32(unsigned int val) {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">  return (((val) &amp; 0xff000000) &gt;&gt; 24) | (((val) &amp; 0x00ff0000) &gt;&gt;  8) |</td><td> </td><td class="right">  return (((val) &amp; 0xff000000) &gt;&gt; 24) | (((val) &amp; 0x00ff0000) &gt;&gt;  8) |</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       (((val) &amp; 0x0000ff00) &lt;&lt;  8) | (((val) &amp; 0x000000ff) &lt;&lt; 24);</td><td> </td><td class="right">       (((val) &amp; 0x0000ff00) &lt;&lt;  8) | (((val) &amp; 0x000000ff) &lt;&lt; 24);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">namespace BigStarCatalogExtension</td><td> </td><td class="right">namespace BigStarCatalogExtension</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">static const Vec3f north(0,0,1);</td><td> </td><td class="right">static const Vec3f north(0,0,1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void ZoneArray::initTriangle(int index, const Vec3f &amp;c0, const Vec3f &amp;c1,</td><td> </td><td class="right">void ZoneArray::initTriangle(int index, const Vec3f &amp;c0, const Vec3f &amp;c1,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                             <span class="delete">                           </span>const Vec3f &amp;c2)</td><td> </td><td class="rblock">                             const Vec3f &amp;c2)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // initialize center,axis0,axis1:</td><td> </td><td class="right">       // initialize center,axis0,axis1:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ZoneData &amp;z(zones[index]);</td><td> </td><td class="right">       ZoneData &amp;z(zones[index]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.center = c0+c1+c2;</td><td> </td><td class="right">       z.center = c0+c1+c2;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.center.normalize();</td><td> </td><td class="right">       z.center.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.axis0 = north ^ z.center;</td><td> </td><td class="right">       z.axis0 = north ^ z.center;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.axis0.normalize();</td><td> </td><td class="right">       z.axis0.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       z.axis1 = z.center ^ z.axis0;</td><td> </td><td class="right">       z.axis1 = z.center ^ z.axis0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // initialize star_position_scale:</td><td> </td><td class="right">       // initialize star_position_scale:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double mu0,mu1,f,h;</td><td> </td><td class="right">       double mu0,mu1,f,h;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 247</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 248</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rval)</td><td> </td><td class="right">               if (rval)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       delete rval;</td><td> </td><td class="right">                       delete rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       rval = 0;</td><td> </td><td class="right">                       rval = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return rval;</td><td> </td><td class="right">       return rval;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">ZoneArray::ZoneArray(const QString&amp; fname, QFile* file, int level, int mag_
min,</td><td> </td><td class="right">ZoneArray::ZoneArray(const QString&amp; fname, QFile* file, int level, int mag_
min,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        int mag_range, int mag_steps)</td><td> </td><td class="rblock">                     int mag_range, int mag_steps)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       : fname(fname), level(level), mag_min(mag_min),</td><td> </td><td class="rblock">       : fname(fname), level(level), mag_min(mag_min),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                         mag_range(mag_range), mag_steps(mag_steps),</td><td> </td><td class="rblock">         mag_range(mag_range), mag_steps(mag_steps),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                         star_position_scale(0.0), zones(0), file(file)</td><td> </td><td class="rblock">         star_position_scale(0.0), zones(0), file(file)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_zones = StelGeodesicGrid::nrOfZones(level);</td><td> </td><td class="right">       nr_of_zones = StelGeodesicGrid::nrOfZones(level);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_stars = 0;</td><td> </td><td class="right">       nr_of_stars = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">bool ZoneArray::readFile(QFile&amp; file, void *data, qint64 size)</td><td> </td><td class="right">bool ZoneArray::readFile(QFile&amp; file, void *data, qint64 size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int parts = 256;</td><td> </td><td class="right">       int parts = 256;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int part_size = (size + (parts&gt;&gt;1)) / parts;</td><td> </td><td class="right">       int part_size = (size + (parts&gt;&gt;1)) / parts;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (part_size &lt; 64*1024)</td><td> </td><td class="right">       if (part_size &lt; 64*1024)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 475</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 476</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (zones)</td><td> </td><td class="right">       if (zones)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete[] getZones();</td><td> </td><td class="right">               delete[] getZones();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               zones = NULL;</td><td> </td><td class="right">               zones = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_zones = 0;</td><td> </td><td class="right">       nr_of_zones = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nr_of_stars = 0;</td><td> </td><td class="right">       nr_of_stars = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">template&lt;class Star&gt;</td><td> </td><td class="right">template&lt;class Star&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">SpecialZoneArray&lt;Star&gt;::draw(StelPainter* sPainter,</span> int index, bool <span class="delete">is</span></td><td> </td><td class="rblock">void <span class="insert">SpecialZoneArray&lt;Star&gt;::draw</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">_inside,</span> const float *rcmag_table, StelCore* core, unsigned int <span class="delete">maxMagStarN</span></td><td> </td><td class="rblock"><span class="insert">       (StelProjectorP projector, StelRenderer* renderer,</span> int index, bool <span class="insert">i</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ame,</span></td><td> </td><td class="rblock"><span class="insert">s_inside,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                 float names_brightness) const</td><td> </td><td class="rblock">        const float *rcmag_table, StelCore* core, unsigned int <span class="insert">maxMagStarNa</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">{</td><td> </td><td class="rblock"><span class="insert">me,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    StelSkyDrawer* drawer = core-&gt;getSkyDrawer();</td><td> </td><td class="rblock">        float names_brightness) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    SpecialZoneData&lt;Star&gt; *const z = getZones() + index;</td><td> </td><td class="rblock">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Vec3f vf;</td><td> </td><td class="rblock">       StelSkyDrawer* drawer = core-&gt;getSkyDrawer();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    const Star *const end = z-&gt;getStars() + z-&gt;size;</td><td> </td><td class="rblock">       SpecialZoneData&lt;Star&gt; *const z = getZones() + index;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    static const double d2000 = 2451545.0;</td><td> </td><td class="rblock">       Vec3f vf;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    const double movementFactor = (M_PI/180)*(0.0001/3600) * <span class="delete">((core-&gt;getJDa</span></td><td> </td><td class="rblock">       const Star *const end = z-&gt;getStars() + z-&gt;size;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">y()-d2000)/365.25)</span> / star_position_scale;</td><td> </td><td class="rblock">       static const double d2000 = 2451545.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    const float* tmpRcmag; // will point to precomputed rC in table</td><td> </td><td class="rblock">       const double movementFactor = (M_PI/180)*(0.0001/3600) * <span class="insert">((core-&gt;get</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // GZ, added for extinction</td><td> </td><td class="rblock"><span class="insert">JDay()-d2000)/365.25)</span> / star_position_scale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    Extinction extinction=core-&gt;getSkyDrawer()-&gt;getExtinction();</td><td> </td><td class="rblock">       const float* tmpRcmag; // will point to precomputed rC in table</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    const bool withExtinction=(drawer-&gt;getFlagHasAtmosphere() &amp;&amp; <span class="delete">extinction</span></td><td> </td><td class="rblock">       // GZ, added for extinction</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">.getExtinctionCoefficient()&gt;=0.01f);</span></td><td> </td><td class="rblock">       Extinction extinction=core-&gt;getSkyDrawer()-&gt;getExtinction();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    const float k = (0.001f*mag_range)/mag_steps; // from StarMgr.cpp <span class="delete">line</span> </td><td> </td><td class="rblock">       const bool withExtinction=(drawer-&gt;getFlagHasAtmosphere() &amp;&amp; <span class="insert">extinct</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">654</td><td> </td><td class="rblock"><span class="insert">ion.getExtinctionCoefficient()&gt;=0.01f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">       const float k = (0.001f*mag_range)/mag_steps; // from StarMgr.cpp <span class="insert">li</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    // go through all stars, which are sorted by magnitude (bright stars <span class="delete">fi</span></td><td> </td><td class="rblock"><span class="insert">ne</span> 654</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">rst)</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    for (const Star *s=z-&gt;getStars();s&lt;end;++s)</td><td> </td><td class="rblock">       // go through all stars, which are sorted by magnitude (bright stars</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">    {</td><td> </td><td class="rblock"> <span class="insert">first)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       tmpRcmag = rcmag_table+2*s-&gt;mag;</td><td> </td><td class="rblock">       for (const Star *s=z-&gt;getStars();s&lt;end;++s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (*tmpRcmag&lt;=0.f) break; // no size for this and following (even <span class="delete">d</span></td><td> </td><td class="rblock">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">immer,</span> unextincted) stars? --&gt; early exit</td><td> </td><td class="rblock">               tmpRcmag = rcmag_table+2*s-&gt;mag;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       s-&gt;getJ2000Pos(z,movementFactor, vf);</td><td> </td><td class="rblock">               if (*tmpRcmag&lt;=0.f) break; // no size for this and following</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"> (even <span class="insert">dimmer,</span> unextincted) stars? --&gt; early exit</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       // GZ new:</td><td> </td><td class="rblock">               s-&gt;getJ2000Pos(z,movementFactor, vf);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (withExtinction)</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       {</td><td> </td><td class="rblock">               <span class="insert">const Vec3d vd(vf[0], vf[1], vf[2]);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           //GZ: We must compute position first, then shift <span class="delete">magnitude.</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           Vec3d <span class="delete">altAz=core-&gt;j2000ToAltAz(Vec3d(vf[0], vf[1], vf[2]), StelC</span></td><td> </td><td class="rblock">               // GZ new:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ore::RefractionOn);</span></td><td> </td><td class="rblock">               if (withExtinction)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           float <span class="delete">extMagShift=0.0f;</span></td><td> </td><td class="rblock">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           extinction.forward(&amp;altAz, &amp;extMagShift);</td><td> </td><td class="rblock">                       //GZ: We must compute position first, then shift <span class="insert">mag</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">            int <span class="delete">extMagShiftStep=qMin((int)floor(extMagShift/k), 4096-mag_st</span></td><td> </td><td class="rblock"><span class="insert">nitude.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">eps); // this number muist be equal StarMgr.cpp line 649</span></td><td> </td><td class="rblock">                       Vec3d <span class="insert">altAz = core-&gt;j2000ToAltAz(vd, StelCore::Refra</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           tmpRcmag = <span class="delete">rcmag_table+2*(s-&gt;mag+extMagShiftStep);</span></td><td> </td><td class="rblock"><span class="insert">ctionOn);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       }</td><td> </td><td class="rblock">                       float <span class="insert">extMagShift = 0.0f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock">                       extinction.forward(&amp;altAz, &amp;extMagShift);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">if (drawer-&gt;drawPointSource(sPainter, Vec3d(vf[0], vf[1], vf[2]), tm</span></td><td> </td><td class="rblock">                       <span class="insert">const</span> int <span class="insert">extMagShiftStep =</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">pRcmag, s-&gt;bV, !is_inside) &amp;&amp; s-&gt;hasName()</span> &amp;&amp; s-&gt;mag &lt; maxMagStarName &amp;&amp; <span class="delete">s-</span></td><td> </td><td class="rblock"><span class="insert">                               qMin((int)floor(extMagShift / k), RCMAG_TABL</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">&gt;hasComponentID()&lt;=1)</span></td><td> </td><td class="rblock"><span class="insert">E_SIZE-mag_steps);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       {</td><td> </td><td class="rblock">                       tmpRcmag = <span class="insert">rcmag_table + 2 * (s-&gt;mag+extMagShiftStep</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           const float offset = *tmpRcmag*0.7f;</td><td> </td><td class="rblock"><span class="insert">);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">           const Vec3f&amp; colorr = <span class="delete">(StelApp::getInstance().getVisionModeNight</span></td><td> </td><td class="rblock">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">()</span> ? Vec3f(0.8f, 0.0f, 0.0f) : <span class="delete">StelSkyDrawer::indexToColor(s-&gt;bV))*0.75f;</span></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           sPainter-&gt;setColor(colorr[0], colorr[1], colorr[2],names_brightn</span></td><td> </td><td class="rblock">               <span class="insert">Vec3f win;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ess);</span></td><td> </td><td class="rblock"><span class="insert">               if(drawer-&gt;pointSourceVisible(&amp;(*projector), vf, tmpRcmag, !</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">           sPainter-&gt;drawText(Vec3d(vf[0], vf[1], vf[2]), s-&gt;getNameI18n(),</span></td><td> </td><td class="rblock"><span class="insert">is_inside, win))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete"> 0, offset, offset, false);</span></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       drawer-&gt;drawPointSource(win, tmpRcmag, s-&gt;bV);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if(s-&gt;hasName()</span> &amp;&amp; s-&gt;mag &lt; maxMagStarName &amp;&amp; <span class="insert">s-&gt;has</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ComponentID()&lt;=1)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               const float offset = *tmpRcmag*0.7f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                               const Vec3f&amp; colorr = <span class="insert">(StelApp::getInstance(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">).getVisionModeNight()</span> ? Vec3f(0.8f, 0.0f, 0.0f) : <span class="insert">StelSkyDrawer::indexToCo</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">lor(s-&gt;bV))*0.75f;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"></span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               renderer-&gt;setGlobalColor(colorr[0], colorr[1</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">], colorr[2], names_brightness);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               renderer-&gt;drawText(TextParams(vf, projector,</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert"> s-&gt;getNameI18n())</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                                                  .shift(offset, offset).us</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">eGravity());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">    }</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">template&lt;class Star&gt;</td><td> </td><td class="right">template&lt;class Star&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void <span class="delete">SpecialZoneArray&lt;Star&gt;::searchAround(const</span> StelCore* core, int index, </td><td> </td><td class="rblock">void <span class="insert">SpecialZoneArray&lt;Star&gt;::searchAround</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">const Vec3d &amp;v, double cosLimFov,</td><td> </td><td class="rblock"><span class="insert">       (const</span> StelCore* core, int index, const Vec3d &amp;v, double cosLimFov,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                         QList&lt;StelObjectP &gt; &amp;result)</td><td> </td><td class="rblock">        QList&lt;StelObjectP &gt; &amp;result)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static const double d2000 = 2451545.0;</td><td> </td><td class="right">       static const double d2000 = 2451545.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double movementFactor = (M_PI/180.)*(0.0001/3600.) * ((core-&gt;g
etJDay()-d2000)/365.25)/ star_position_scale;</td><td> </td><td class="right">       const double movementFactor = (M_PI/180.)*(0.0001/3600.) * ((core-&gt;g
etJDay()-d2000)/365.25)/ star_position_scale;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const SpecialZoneData&lt;Star&gt; *const z = getZones()+index;</td><td> </td><td class="right">       const SpecialZoneData&lt;Star&gt; *const z = getZones()+index;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f tmp;</td><td> </td><td class="right">       Vec3f tmp;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Vec3f vf(v[0], v[1], v[2]);</td><td> </td><td class="right">       Vec3f vf(v[0], v[1], v[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       for (const Star* s=z-&gt;getStars();s&lt;z-&gt;getStars()+z-&gt;size;++s)</td><td> </td><td class="right">       for (const Star* s=z-&gt;getStars();s&lt;z-&gt;getStars()+z-&gt;size;++s)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               s-&gt;getJ2000Pos(z,movementFactor, tmp);</td><td> </td><td class="right">               s-&gt;getJ2000Pos(z,movementFactor, tmp);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               tmp.normalize();</td><td> </td><td class="right">               tmp.normalize();</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 6 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>62 lines changed or deleted</i></th><th><i> </i></th><th><i>79 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
