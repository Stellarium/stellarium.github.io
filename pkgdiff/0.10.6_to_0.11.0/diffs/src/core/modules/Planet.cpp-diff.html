<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: Planet.cpp - Planet.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;Planet.cpp&nbsp;</th><th> </th><th>&nbsp;Planet.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 33</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 33</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QString&gt;</td><td> </td><td class="right">#include &lt;QString&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QDebug&gt;</td><td> </td><td class="right">#include &lt;QDebug&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include &lt;QVarLengthArray&gt;</td><td> </td><td class="right">#include &lt;QVarLengthArray&gt;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelApp.hpp"</td><td> </td><td class="right">#include "StelApp.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelCore.hpp"</td><td> </td><td class="right">#include "StelCore.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelSkyDrawer.hpp"</td><td> </td><td class="right">#include "StelSkyDrawer.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "SolarSystem.hpp"</td><td> </td><td class="right">#include "SolarSystem.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTexture.hpp"</td><td> </td><td class="right">#include "StelTexture.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "Planet.hpp"</td><td> </td><td class="right">#include "Planet.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">#include "StelNavigator.hpp"</span></td><td> </td><td class="rblock"><span class="insert">                                                                           </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelProjector.hpp"</td><td> </td><td class="right">#include "StelProjector.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "sideral_time.h"</td><td> </td><td class="right">#include "sideral_time.h"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTextureMgr.hpp"</td><td> </td><td class="right">#include "StelTextureMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelModuleMgr.hpp"</td><td> </td><td class="right">#include "StelModuleMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StarMgr.hpp"</td><td> </td><td class="right">#include "StarMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelMovementMgr.hpp"</td><td> </td><td class="right">#include "StelMovementMgr.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelPainter.hpp"</td><td> </td><td class="right">#include "StelPainter.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#include "StelTranslator.hpp"</td><td> </td><td class="right">#include "StelTranslator.hpp"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::labelColor = Vec3f(0.4,0.4,0.8);</td><td> </td><td class="right">Vec3f Planet::labelColor = Vec3f(0.4,0.4,0.8);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 57</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 57</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Planet::Planet(const QString&amp; englishName,</td><td> </td><td class="right">Planet::Planet(const QString&amp; englishName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          int flagLighting,</td><td> </td><td class="right">                          int flagLighting,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          double radius,</td><td> </td><td class="right">                          double radius,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          double oblateness,</td><td> </td><td class="right">                          double oblateness,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          Vec3f color,</td><td> </td><td class="right">                          Vec3f color,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          float albedo,</td><td> </td><td class="right">                          float albedo,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          const QString&amp; atexMapName,</td><td> </td><td class="right">                          const QString&amp; atexMapName,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          posFuncType coordFunc,</td><td> </td><td class="right">                          posFuncType coordFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          void* auserDataPtr,</td><td> </td><td class="right">                          void* auserDataPtr,</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                          OsulatingFunctType *osculatingFunc,</td><td> </td><td class="rblock">                          Os<span class="insert">c</span>ulatingFunctType *osculatingFunc,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          bool acloseOrbit,</td><td> </td><td class="right">                          bool acloseOrbit,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          bool hidden,</td><td> </td><td class="right">                          bool hidden,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                          bool hasAtmosphere)</td><td> </td><td class="right">                          bool hasAtmosphere)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       : englishName(englishName),</td><td> </td><td class="right">       : englishName(englishName),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         flagLighting(flagLighting),</td><td> </td><td class="right">         flagLighting(flagLighting),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         radius(radius), oneMinusOblateness(1.0-oblateness),</td><td> </td><td class="right">         radius(radius), oneMinusOblateness(1.0-oblateness),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         color(color), albedo(albedo), axisRotation(0.), rings(NULL),</td><td> </td><td class="right">         color(color), albedo(albedo), axisRotation(0.), rings(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         sphereScale(1.f),</td><td> </td><td class="right">         sphereScale(1.f),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         lastJD(J2000),</td><td> </td><td class="right">         lastJD(J2000),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         coordFunc(coordFunc),</td><td> </td><td class="right">         coordFunc(coordFunc),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         userDataPtr(auserDataPtr),</td><td> </td><td class="right">         userDataPtr(auserDataPtr),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         osculatingFunc(osculatingFunc),</td><td> </td><td class="right">         osculatingFunc(osculatingFunc),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         parent(NULL),</td><td> </td><td class="right">         parent(NULL),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         hidden(hidden),</td><td> </td><td class="right">         hidden(hidden),</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         atmosphere(hasAtmosphere)</td><td> </td><td class="right">         atmosphere(hasAtmosphere)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texMapName = atexMapName;</td><td> </td><td class="right">       texMapName = atexMapName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       lastOrbitJD =0;</td><td> </td><td class="right">       lastOrbitJD =0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       deltaJD = JD_SECOND;</td><td> </td><td class="rblock">       deltaJD = <span class="insert">StelCore::</span>JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       orbitCached = 0;</td><td> </td><td class="right">       orbitCached = 0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       closeOrbit = acloseOrbit;</td><td> </td><td class="right">       closeOrbit = acloseOrbit;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       eclipticPos=Vec3d(0.,0.,0.);</td><td> </td><td class="right">       eclipticPos=Vec3d(0.,0.,0.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       rotLocalToParent = Mat4d::identity();</td><td> </td><td class="right">       rotLocalToParent = Mat4d::identity();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texMap = StelApp::getInstance().getTextureManager().createTextureThr
ead("textures/"+texMapName, StelTexture::StelTextureParams(true, GL_LINEAR,
 GL_REPEAT));</td><td> </td><td class="right">       texMap = StelApp::getInstance().getTextureManager().createTextureThr
ead("textures/"+texMapName, StelTexture::StelTextureParams(true, GL_LINEAR,
 GL_REPEAT));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       nameI18 = englishName;</td><td> </td><td class="right">       nameI18 = englishName;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (englishName!="Pluto")</td><td> </td><td class="right">       if (englishName!="Pluto")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               deltaJD = 0.001*JD_SECOND;</td><td> </td><td class="rblock">               deltaJD = 0.001*<span class="insert">StelCore::</span>JD_SECOND;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       flagLabels = true;</td><td> </td><td class="right">       flagLabels = true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Planet::~Planet()</td><td> </td><td class="right">Planet::~Planet()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rings)</td><td> </td><td class="right">       if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               delete rings;</td><td> </td><td class="right">               delete rings;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::translateName(StelTranslator&amp; trans) <span class="delete">{nameI18</span> = <span class="delete">trans.qtransla</span></td><td> </td><td class="rblock">void Planet::translateName(StelTranslator&amp; trans)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">te(englishName);}</span></td><td> </td><td class="rblock"><span class="insert">{</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       nameI18</span> = <span class="insert">trans.qtranslate(englishName);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">}</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Return the information string "ready to print" :)</td><td> </td><td class="right">// Return the information string "ready to print" :)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QString Planet::getInfoString(const StelCore* core, const InfoStringGroup&amp; 
flags) const</td><td> </td><td class="right">QString Planet::getInfoString(const StelCore* core, const InfoStringGroup&amp; 
flags) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">const StelNavigator* nav = core-&gt;getNavigator();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString str;</td><td> </td><td class="right">       QString str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QTextStream oss(&amp;str);</td><td> </td><td class="right">       QTextStream oss(&amp;str);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Name)</td><td> </td><td class="right">       if (flags&amp;Name)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;h2&gt;" &lt;&lt; q_(englishName);  // UI translation can dif
fer from sky translation</td><td> </td><td class="right">               oss &lt;&lt; "&lt;h2&gt;" &lt;&lt; q_(englishName);  // UI translation can dif
fer from sky translation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss.setRealNumberNotation(QTextStream::FixedNotation);</td><td> </td><td class="right">               oss.setRealNumberNotation(QTextStream::FixedNotation);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss.setRealNumberPrecision(1);</td><td> </td><td class="right">               oss.setRealNumberPrecision(1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (sphereScale != 1.f)</td><td> </td><td class="right">               if (sphereScale != 1.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       oss &lt;&lt; QString::fromUtf8(" (\xC3\x97") &lt;&lt; sphereScal
e &lt;&lt; ")";</td><td> </td><td class="right">                       oss &lt;&lt; QString::fromUtf8(" (\xC3\x97") &lt;&lt; sphereScal
e &lt;&lt; ")";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; "&lt;/h2&gt;";</td><td> </td><td class="right">               oss &lt;&lt; "&lt;/h2&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Magnitude)</td><td> </td><td class="right">       if (flags&amp;Magnitude)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               oss &lt;&lt; q_("Magnitude: &lt;b&gt;%1&lt;/b&gt;").arg(getVMagnitude(<span class="delete">nav), 0,
</span> 'f', 2) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock">               oss &lt;&lt; q_("Magnitude: &lt;b&gt;%1&lt;/b&gt;").arg(getVMagnitude(<span class="insert">core), 0
,</span> 'f', 2) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;AbsoluteMagnitude)</td><td> </td><td class="right">       if (flags&amp;AbsoluteMagnitude)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               oss &lt;&lt; q_("Absolute Magnitude: %1").arg(getVMagnitude(<span class="delete">nav)-5
.*(std::log10(getJ2000EquatorialPos(nav).length()*AU/PARSEC)-1.), 0, 'f', 2
</span>) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock">               oss &lt;&lt; q_("Absolute Magnitude: %1").arg(getVMagnitude(<span class="insert">core)-
5.*(std::log10(getJ2000EquatorialPos(core).length()*AU/PARSEC)-1.), 0, 'f',
 2</span>) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oss &lt;&lt; getPositionInfoString(core, flags);</td><td> </td><td class="right">       oss &lt;&lt; getPositionInfoString(core, flags);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">if ((flags&amp;Extra2) &amp;&amp; (core-&gt;getCurrentLocation().planetName=="Earth</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">"))</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               //static SolarSystem *ssystem=GETSTELMODULE(SolarSystem);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               //double ecl= -(ssystem-&gt;getEarth()-&gt;getRotObliquity()); // </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">BUG DETECTED! Earth's obliquity is apparently reported constant.</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               double ra_equ, dec_equ, lambda, beta;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               double ecl= get_mean_ecliptical_obliquity(core-&gt;getJDay()) *</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">M_PI/180.0;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               StelUtils::rectToSphe(&amp;ra_equ,&amp;dec_equ,getEquinoxEquatorialP</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">os(core));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               StelUtils::ctRadec2Ecl(ra_equ, dec_equ, ecl, &amp;lambda, &amp;beta)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (lambda&lt;0) lambda+=2.0*M_PI;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               oss &lt;&lt; q_("Ecliptic Geocentric (of date): %1/%2").arg(StelUt</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ils::radToDmsStr(lambda, true), StelUtils::radToDmsStr(beta, true)) &lt;&lt; "&lt;br</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               oss &lt;&lt; q_("Obliquity (of date): %1").arg(StelUtils::radToDms</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Str(ecl, true)) &lt;&lt; "&lt;br&gt;";</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Distance)</td><td> </td><td class="right">       if (flags&amp;Distance)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // xgettext:no-c-format</td><td> </td><td class="right">               // xgettext:no-c-format</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               oss &lt;&lt; q_("Distance: %1AU").arg(getJ2000EquatorialPos(<span class="delete">nav).l
</span>ength(), 0, 'f', 8) &lt;&lt; "&lt;br&gt;";</td><td> </td><td class="rblock">               oss &lt;&lt; q_("Distance: %1AU").arg(getJ2000EquatorialPos(<span class="insert">core).
l</span>ength(), 0, 'f', 8) &lt;&lt; "&lt;br&gt;";</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (flags&amp;Size)</td><td> </td><td class="right">       if (flags&amp;Size)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; q_("Apparent diameter: %1").arg(StelUtils::radToDmsSt
r(2.*getAngularSize(core)*M_PI/180., true));</td><td> </td><td class="right">               oss &lt;&lt; q_("Apparent diameter: %1").arg(StelUtils::radToDmsSt
r(2.*getAngularSize(core)*M_PI/180., true));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       postProcessInfoString(str, flags);</td><td> </td><td class="right">       postProcessInfoString(str, flags);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return str;</td><td> </td><td class="right">       return str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">//! Get sky label (sky translation)</td><td> </td><td class="right">//! Get sky label (sky translation)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">QString Planet::getSkyLabel(const Stel<span class="delete">Navigator</span>*) const</td><td> </td><td class="rblock">QString Planet::getSkyLabel(const Stel<span class="insert">Core</span>*) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QString str;</td><td> </td><td class="right">       QString str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QTextStream oss(&amp;str);</td><td> </td><td class="right">       QTextStream oss(&amp;str);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oss.setRealNumberPrecision(2);</td><td> </td><td class="right">       oss.setRealNumberPrecision(2);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       oss &lt;&lt; nameI18;</td><td> </td><td class="right">       oss &lt;&lt; nameI18;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (sphereScale != 1.f)</td><td> </td><td class="right">       if (sphereScale != 1.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               oss &lt;&lt; QString::fromUtf8(" (\xC3\x97") &lt;&lt; sphereScale &lt;&lt; ")"
;</td><td> </td><td class="right">               oss &lt;&lt; QString::fromUtf8(" (\xC3\x97") &lt;&lt; sphereScale &lt;&lt; ")"
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return str;</td><td> </td><td class="right">       return str;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float Planet::getSelectPriority(const Stel<span class="delete">Navigator *nav</span>) const</td><td> </td><td class="rblock">float Planet::getSelectPriority(const Stel<span class="insert">Core* core</span>) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if( ((SolarSystem*)StelApp::getInstance().getModuleMgr().getModule("
SolarSystem"))-&gt;getFlagHints() )</td><td> </td><td class="right">       if( ((SolarSystem*)StelApp::getInstance().getModuleMgr().getModule("
SolarSystem"))-&gt;getFlagHints() )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // easy to select, especially pluto</td><td> </td><td class="right">       // easy to select, especially pluto</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               return getVMagnitude(<span class="delete">nav</span>)-15.f;</td><td> </td><td class="rblock">               return getVMagnitude(<span class="insert">core</span>)-15.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0014" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               return getVMagnitude(<span class="delete">nav</span>) - 8.f;</td><td> </td><td class="rblock">               return getVMagnitude(<span class="insert">core</span>) - 8.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Vec3f Planet::getInfoColor(void) const</td><td> </td><td class="right">Vec3f Planet::getInfoColor(void) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return StelApp::getInstance().getVisionModeNight() ? Vec3f(0.8, 0.2,
 0.4) : ((SolarSystem*)StelApp::getInstance().getModuleMgr().getModule("Sol
arSystem"))-&gt;getLabelsColor();</td><td> </td><td class="right">       return StelApp::getInstance().getVisionModeNight() ? Vec3f(0.8, 0.2,
 0.4) : ((SolarSystem*)StelApp::getInstance().getModuleMgr().getModule("Sol
arSystem"))-&gt;getLabelsColor();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0015" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Planet::getCloseViewFov(const Stel<span class="delete">Navigator* nav</span>) const</td><td> </td><td class="rblock">double Planet::getCloseViewFov(const Stel<span class="insert">Core* core</span>) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0016" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return std::atan(radius*sphereScale*2.f/getEquinoxEquatorialPos(<span class="delete">nav)
</span>.length())*180./M_PI * 4;</td><td> </td><td class="rblock">       return std::atan(radius*sphereScale*2.f/getEquinoxEquatorialPos(<span class="insert">core
)</span>.length())*180./M_PI * 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0017" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Planet::getSatellitesFov(const Stel<span class="delete">Navigator * nav</span>) const</td><td> </td><td class="rblock">double Planet::getSatellitesFov(const Stel<span class="insert">Core* core</span>) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // TODO: calculate from satellite orbits rather than hard code</td><td> </td><td class="right">       // TODO: calculate from satellite orbits rather than hard code</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0018" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (englishName=="Jupiter") return std::atan(0.005f/getEquinoxEquato</td><td> </td><td class="rblock">       if (englishName=="Jupiter") return std::atan(0.005f/getEquinoxEquato</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">rialPos(nav).length())*180./M_PI</span> * 4;</td><td> </td><td class="rblock"><span class="insert">rialPos(core).length())*180./M_PI</span> * 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (englishName=="Saturn") return std::atan(0.005f/getEquinoxEquator</td><td> </td><td class="rblock">       if (englishName=="Saturn") return std::atan(0.005f/getEquinoxEquator</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ialPos(nav).length())*180./M_PI</span> * 4;</td><td> </td><td class="rblock"><span class="insert">ialPos(core).length())*180./M_PI</span> * 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (englishName=="Mars") return std::atan(0.0001f/getEquinoxEquatori</td><td> </td><td class="rblock">       if (englishName=="Mars") return std::atan(0.0001f/getEquinoxEquatori</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">alPos(nav).length())*180./M_PI</span> * 4;</td><td> </td><td class="rblock"><span class="insert">alPos(core).length())*180./M_PI</span> * 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (englishName=="Uranus") return std::atan(0.002f/getEquinoxEquator</td><td> </td><td class="rblock">       if (englishName=="Uranus") return std::atan(0.002f/getEquinoxEquator</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ialPos(nav).length())*180./M_PI</span> * 4;</td><td> </td><td class="rblock"><span class="insert">ialPos(core).length())*180./M_PI</span> * 4;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return -1.;</td><td> </td><td class="right">       return -1.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0019" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">double Planet::getParentSatellitesFov(const Stel<span class="delete">Navigator *nav</span>) const</td><td> </td><td class="rblock">double Planet::getParentSatellitesFov(const Stel<span class="insert">Core* core</span>) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0020" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (parent &amp;&amp; parent-&gt;parent) return parent-&gt;getSatellitesFov(<span class="delete">nav</span>);</td><td> </td><td class="rblock">       if (parent &amp;&amp; parent-&gt;parent) return parent-&gt;getSatellitesFov(<span class="insert">core</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return -1.0;</td><td> </td><td class="right">       return -1.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Set the orbital elements</td><td> </td><td class="right">// Set the orbital elements</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::setRotationElements(float _period, float _offset, double _epoc
h, float _obliquity, float _ascendingNode, float _precessionRate, double _s
iderealPeriod )</td><td> </td><td class="right">void Planet::setRotationElements(float _period, float _offset, double _epoc
h, float _obliquity, float _ascendingNode, float _precessionRate, double _s
iderealPeriod )</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.period = _period;</td><td> </td><td class="right">       re.period = _period;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.offset = _offset;</td><td> </td><td class="right">       re.offset = _offset;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.epoch = _epoch;</td><td> </td><td class="right">       re.epoch = _epoch;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.obliquity = _obliquity;</td><td> </td><td class="right">       re.obliquity = _obliquity;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.ascendingNode = _ascendingNode;</td><td> </td><td class="right">       re.ascendingNode = _ascendingNode;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.precessionRate = _precessionRate;</td><td> </td><td class="right">       re.precessionRate = _precessionRate;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       re.siderealPeriod = _siderealPeriod;  // used for drawing orbit line
s</td><td> </td><td class="right">       re.siderealPeriod = _siderealPeriod;  // used for drawing orbit line
s</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       deltaOrbitJD = re.siderealPeriod/ORBIT_SEGMENTS;</td><td> </td><td class="right">       deltaOrbitJD = re.siderealPeriod/ORBIT_SEGMENTS;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0021" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">Vec3d Planet::getJ2000EquatorialPos(const Stel<span class="delete">Navigator *nav</span>) const</td><td> </td><td class="rblock">Vec3d Planet::getJ2000EquatorialPos(const Stel<span class="insert">Core *core</span>) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0022" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return Stel<span class="delete">Navigator::matVsop87ToJ2000.multiplyWithoutTranslation(ge
tHeliocentricEclipticPos() - nav</span>-&gt;getObserverHeliocentricEclipticPos());</td><td> </td><td class="rblock">       return Stel<span class="insert">Core::matVsop87ToJ2000.multiplyWithoutTranslation(getHeli
ocentricEclipticPos() - core</span>-&gt;getObserverHeliocentricEclipticPos());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Compute the position in the parent Planet coordinate system</td><td> </td><td class="right">// Compute the position in the parent Planet coordinate system</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Actually call the provided function to compute the ecliptical position</td><td> </td><td class="right">// Actually call the provided function to compute the ecliptical position</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::computePositionWithoutOrbits(const double date)</td><td> </td><td class="right">void Planet::computePositionWithoutOrbits(const double date)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (fabs(lastJD-date)&gt;deltaJD)</td><td> </td><td class="right">       if (fabs(lastJD-date)&gt;deltaJD)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               coordFunc(date, eclipticPos, userDataPtr);</td><td> </td><td class="right">               coordFunc(date, eclipticPos, userDataPtr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lastJD = date;</td><td> </td><td class="right">               lastJD = date;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 450</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 464</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getPhase(const Vec3d&amp; obsPos) const</td><td> </td><td class="right">double Planet::getPhase(const Vec3d&amp; obsPos) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerRq = obsPos.lengthSquared();</td><td> </td><td class="right">       const double observerRq = obsPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td> </td><td class="right">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double planetRq = planetHelioPos.lengthSquared();</td><td> </td><td class="right">       const double planetRq = planetHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerPlanetRq = (obsPos - planetHelioPos).lengthSqua
red();</td><td> </td><td class="right">       const double observerPlanetRq = (obsPos - planetHelioPos).lengthSqua
red();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return std::acos(observerPlanetRq + planetRq - observerRq)/(2.0*sqrt
(observerPlanetRq*planetRq));</td><td> </td><td class="right">       return std::acos(observerPlanetRq + planetRq - observerRq)/(2.0*sqrt
(observerPlanetRq*planetRq));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Computation of the visual magnitude (V band) of the planet.</td><td> </td><td class="right">// Computation of the visual magnitude (V band) of the planet.</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0023" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">float Planet::getVMagnitude(const Stel<span class="delete">Navigator * nav</span>) const</td><td> </td><td class="rblock">float Planet::getVMagnitude(const Stel<span class="insert">Core* core</span>) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent == 0)</td><td> </td><td class="right">       if (parent == 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // sun, compute the apparent magnitude for the absolute mag 
(4.83) and observer's distance</td><td> </td><td class="right">               // sun, compute the apparent magnitude for the absolute mag 
(4.83) and observer's distance</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0024" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               const double distParsec = std::sqrt(<span class="delete">nav-&gt;getObserverHeliocen
</span>tricEclipticPos().lengthSquared())*AU/PARSEC;</td><td> </td><td class="rblock">               const double distParsec = std::sqrt(<span class="insert">core-&gt;getObserverHelioce
n</span>tricEclipticPos().lengthSquared())*AU/PARSEC;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return 4.83 + 5.*(std::log10(distParsec)-1.);</td><td> </td><td class="right">               return 4.83 + 5.*(std::log10(distParsec)-1.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute the angular phase</td><td> </td><td class="right">       // Compute the angular phase</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0025" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const Vec3d&amp; observerHelioPos = <span class="delete">nav-&gt;getObserverHeliocentricEcliptic
</span>Pos();</td><td> </td><td class="rblock">       const Vec3d&amp; observerHelioPos = <span class="insert">core-&gt;getObserverHeliocentricEclipti
c</span>Pos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerRq = observerHelioPos.lengthSquared();</td><td> </td><td class="right">       const double observerRq = observerHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td> </td><td class="right">       const Vec3d&amp; planetHelioPos = getHeliocentricEclipticPos();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double planetRq = planetHelioPos.lengthSquared();</td><td> </td><td class="right">       const double planetRq = planetHelioPos.lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double observerPlanetRq = (observerHelioPos - planetHelioPos).
lengthSquared();</td><td> </td><td class="right">       const double observerPlanetRq = (observerHelioPos - planetHelioPos).
lengthSquared();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double cos_chi = (observerPlanetRq + planetRq - observerRq)/(2
.0*sqrt(observerPlanetRq*planetRq));</td><td> </td><td class="right">       const double cos_chi = (observerPlanetRq + planetRq - observerRq)/(2
.0*sqrt(observerPlanetRq*planetRq));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double phase = std::acos(cos_chi);</td><td> </td><td class="right">       double phase = std::acos(cos_chi);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double shadowFactor = 1.;</td><td> </td><td class="right">       double shadowFactor = 1.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Check if the satellite is inside the inner shadow of the parent p
lanet:</td><td> </td><td class="right">       // Check if the satellite is inside the inner shadow of the parent p
lanet:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (parent-&gt;parent != 0)</td><td> </td><td class="right">       if (parent-&gt;parent != 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 502</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 516</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // The satellite is partly inside the inner 
shadow,</td><td> </td><td class="right">                               // The satellite is partly inside the inner 
shadow,</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // compute a fantasy value for the magnitude
:</td><td> </td><td class="right">                               // compute a fantasy value for the magnitude
:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               d /= radius;</td><td> </td><td class="right">                               d /= radius;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               shadowFactor = (0.5 - (std::asin(d)+d*std::s
qrt(1.0-d*d))/M_PI);</td><td> </td><td class="right">                               shadowFactor = (0.5 - (std::asin(d)+d*std::s
qrt(1.0-d*d))/M_PI);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Use empirical formulae for main planets when seen from earth</td><td> </td><td class="right">       // Use empirical formulae for main planets when seen from earth</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Algorithm provided by Pere Planesas (Observatorio Astronomico Nac
ional)</td><td> </td><td class="right">       // Algorithm provided by Pere Planesas (Observatorio Astronomico Nac
ional)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0026" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (<span class="delete">nav</span>-&gt;getCurrentLocation().planetName=="Earth")</td><td> </td><td class="rblock">       if (<span class="insert">core</span>-&gt;getCurrentLocation().planetName=="Earth")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               phase*=180./M_PI;</td><td> </td><td class="right">               phase*=180./M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const double d = 5. * log10(sqrt(observerPlanetRq*planetRq))
;</td><td> </td><td class="right">               const double d = 5. * log10(sqrt(observerPlanetRq*planetRq))
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               double f1 = phase/100.;</td><td> </td><td class="right">               double f1 = phase/100.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (englishName=="Mercury")</td><td> </td><td class="right">               if (englishName=="Mercury")</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if ( phase &gt; 150. ) f1 = 1.5;</td><td> </td><td class="right">                       if ( phase &gt; 150. ) f1 = 1.5;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       return -0.36 + d + 3.8*f1 - 2.73*f1*f1 + 2*f1*f1*f1;</td><td> </td><td class="right">                       return -0.36 + d + 3.8*f1 - 2.73*f1*f1 + 2*f1*f1*f1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 547</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 561</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double p = (1.0 - phase/M_PI) * cos_chi + std::sqrt(1.0 - cos_
chi*cos_chi) / M_PI;</td><td> </td><td class="right">       const double p = (1.0 - phase/M_PI) * cos_chi + std::sqrt(1.0 - cos_
chi*cos_chi) / M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double F = 2.0 * albedo * radius * radius * p / (3.0*observerPlanetR
q*planetRq) * shadowFactor;</td><td> </td><td class="right">       double F = 2.0 * albedo * radius * radius * p / (3.0*observerPlanetR
q*planetRq) * shadowFactor;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return -26.73 - 2.5 * std::log10(F);</td><td> </td><td class="right">       return -26.73 - 2.5 * std::log10(F);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getAngularSize(const StelCore* core) const</td><td> </td><td class="right">double Planet::getAngularSize(const StelCore* core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       double rad = radius;</td><td> </td><td class="right">       double rad = radius;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (rings)</td><td> </td><td class="right">       if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               rad = rings-&gt;getSize();</td><td> </td><td class="right">               rad = rings-&gt;getSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0027" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return std::atan2(rad*sphereScale,getJ2000EquatorialPos(core<span class="delete">-&gt;getNav
igator()).length</span>()) * 180./M_PI;</td><td> </td><td class="rblock">       return std::atan2(rad*sphereScale,getJ2000EquatorialPos(core<span class="insert">).length
</span>()) * 180./M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">double Planet::getSpheroidAngularSize(const StelCore* core) const</td><td> </td><td class="right">double Planet::getSpheroidAngularSize(const StelCore* core) const</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0028" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       return std::atan2(radius*sphereScale,getJ2000EquatorialPos(core<span class="delete">-&gt;get
Navigator()).len</span>gth()) * 180./M_PI;</td><td> </td><td class="rblock">       return std::atan2(radius*sphereScale,getJ2000EquatorialPos(core<span class="insert">).len
</span>gth()) * 180./M_PI;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Draw the Planet and all the related infos : name, circle etc..</td><td> </td><td class="right">// Draw the Planet and all the related infos : name, circle etc..</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::draw(StelCore* core, float maxMagLabels, const QFont&amp; planetNa
meFont)</td><td> </td><td class="right">void Planet::draw(StelCore* core, float maxMagLabels, const QFont&amp; planetNa
meFont)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hidden)</td><td> </td><td class="right">       if (hidden)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0029" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">StelNavigator* nav = core-&gt;getNavigator();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Mat4d mat = Mat4d::translation(eclipticPos) * rotLocalToParent;</td><td> </td><td class="right">       Mat4d mat = Mat4d::translation(eclipticPos) * rotLocalToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       PlanetP p = parent;</td><td> </td><td class="right">       PlanetP p = parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       while (p &amp;&amp; p-&gt;parent)</td><td> </td><td class="right">       while (p &amp;&amp; p-&gt;parent)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               mat = Mat4d::translation(p-&gt;eclipticPos) * mat * p-&gt;rotLocal
ToParent;</td><td> </td><td class="right">               mat = Mat4d::translation(p-&gt;eclipticPos) * mat * p-&gt;rotLocal
ToParent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               p = p-&gt;parent;</td><td> </td><td class="right">               p = p-&gt;parent;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This removed totally the Planet shaking bug!!!</td><td> </td><td class="right">       // This removed totally the Planet shaking bug!!!</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0030" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">mat</span> = <span class="delete">nav-&gt;getHeliocentricEclipticModelViewMat() * mat;</span></td><td> </td><td class="rblock">       <span class="insert">StelProjector::ModelViewTranformP transfo</span> = <span class="insert">core-&gt;getHeliocentricEcl</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"><span class="insert">ipticModelViewTransform();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (getEnglishName() == <span class="delete">nav-&gt;getCurrentLocation().planetName)</span></td><td> </td><td class="rblock"><span class="insert">       transfo-&gt;combine(mat);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       if (getEnglishName() == <span class="insert">core-&gt;getCurrentLocation().planetName)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Draw the rings if we are located on a planet with rings, 
but not the planet itself.</td><td> </td><td class="right">               // Draw the rings if we are located on a planet with rings, 
but not the planet itself.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rings)</td><td> </td><td class="right">               if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0031" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       StelPainter <span class="delete">sPainter(core-&gt;getProjection(mat));</span></td><td> </td><td class="rblock">                       StelPainter <span class="insert">sPainter(core-&gt;getProjection(transfo));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       rings-&gt;draw(&amp;sPainter,mat,1000.0);</span></td><td> </td><td class="rblock"><span class="insert">                       rings-&gt;draw(&amp;sPainter,transfo,1000.0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Compute the 2D position and check if in the screen</td><td> </td><td class="right">       // Compute the 2D position and check if in the screen</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0032" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       const StelProjectorP prj = core-&gt;getProjection(<span class="delete">mat</span>);</td><td> </td><td class="rblock">       const StelProjectorP prj = core-&gt;getProjection(<span class="insert">transfo</span>);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float screenSz = getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRadA
tCenter();</td><td> </td><td class="right">       float screenSz = getAngularSize(core)*M_PI/180.*prj-&gt;getPixelPerRadA
tCenter();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float viewport_left = prj-&gt;getViewportPosX();</td><td> </td><td class="right">       float viewport_left = prj-&gt;getViewportPosX();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float viewport_bottom = prj-&gt;getViewportPosY();</td><td> </td><td class="right">       float viewport_bottom = prj-&gt;getViewportPosY();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0033" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       if (prj-&gt;project(Vec3d(0), screenPos) &amp;&amp;</td><td> </td><td class="rblock">       if (prj-&gt;project(Vec3d(0), screenPos)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       screenPos[1]&gt;viewport_bottom - screenSz &amp;&amp; <span class="delete">screenPos</span></td><td> </td><td class="rblock">           &amp;&amp; screenPos[1]&gt;viewport_bottom - screenSz &amp;&amp; <span class="insert">screenPos[1] &lt; vie</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">[1]&lt;viewport_bottom</span> + prj-&gt;getViewportHeight()+screenSz &amp;&amp;</td><td> </td><td class="rblock"><span class="insert">wport_bottom</span> + prj-&gt;getViewportHeight()+screenSz</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       screenPos[0]&gt;viewport_left - screenSz &amp;&amp; <span class="delete">screenPos[0</span></td><td> </td><td class="rblock">           &amp;&amp; screenPos[0]&gt;viewport_left - screenSz &amp;&amp; <span class="insert">screenPos[0] &lt; viewp</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">]&lt;viewport_left</span> + prj-&gt;getViewportWidth() + screenSz)</td><td> </td><td class="rblock"><span class="insert">ort_left</span> + prj-&gt;getViewportWidth() + screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Draw the name, and the circle if it's not too close from 
the body it's turning around</td><td> </td><td class="right">               // Draw the name, and the circle if it's not too close from 
the body it's turning around</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // this prevents name overlaping (ie for jupiter satellites)</td><td> </td><td class="right">               // this prevents name overlaping (ie for jupiter satellites)</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0034" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               float ang_dist = 300.f*atan(getEclipticPos().length()/getEqu
inoxEquatorialPos(<span class="delete">nav</span>).length())/core-&gt;getMovementMgr()-&gt;getCurrentFov();</td><td> </td><td class="rblock">               float ang_dist = 300.f*atan(getEclipticPos().length()/getEqu
inoxEquatorialPos(<span class="insert">core</span>).length())/core-&gt;getMovementMgr()-&gt;getCurrentFov();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (ang_dist==0.f)</td><td> </td><td class="right">               if (ang_dist==0.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       ang_dist = 1.f; // if ang_dist == 0, the Planet is s
un..</td><td> </td><td class="right">                       ang_dist = 1.f; // if ang_dist == 0, the Planet is s
un..</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // by putting here, only draw orbit if Planet is visible for
 clarity</td><td> </td><td class="right">               // by putting here, only draw orbit if Planet is visible for
 clarity</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawOrbit(core);  // TODO - fade in here also...</td><td> </td><td class="right">               drawOrbit(core);  // TODO - fade in here also...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0035" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               if (flagLabels &amp;&amp; ang_dist&gt;0.25 &amp;&amp; maxMagLabels&gt;getVMagnitud
e(<span class="delete">nav</span>))</td><td> </td><td class="rblock">               if (flagLabels &amp;&amp; ang_dist&gt;0.25 &amp;&amp; maxMagLabels&gt;getVMagnitud
e(<span class="insert">core</span>))</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       labelsFader=true;</td><td> </td><td class="right">                       labelsFader=true;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       labelsFader=false;</td><td> </td><td class="right">                       labelsFader=false;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawHints(core, planetNameFont);</td><td> </td><td class="right">               drawHints(core, planetNameFont);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0036" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               draw3dModel(core,<span class="delete">mat</span>,screenSz);</td><td> </td><td class="rblock">               draw3dModel(core,<span class="insert">transfo</span>,screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       return;</td><td> </td><td class="right">       return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0037" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Planet::draw3dModel(StelCore* core, <span class="delete">const Mat4d&amp; mat</span>, float screenSz)</td><td> </td><td class="rblock">void Planet::draw3dModel(StelCore* core, <span class="insert">StelProjector::ModelViewTranformP 
transfo</span>, float screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // This is the main method drawing a planet 3d model</td><td> </td><td class="right">       // This is the main method drawing a planet 3d model</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Some work has to be done on this method to make the rendering nic
er</td><td> </td><td class="right">       // Some work has to be done on this method to make the rendering nic
er</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0038" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       <span class="delete">StelNavigator* nav = core-&gt;getNavigator();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                                                                           </td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (screenSz&gt;1.)</td><td> </td><td class="right">       if (screenSz&gt;1.)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0039" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               StelPainter* sPainter = new StelPainter(core-&gt;getProjection(</td><td> </td><td class="rblock">               <span class="insert">StelProjector::ModelViewTranformP transfo2 = transfo-&gt;clone(</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">mat * Mat4d::zrotation(M_PI/180*(axisRotation + 90.))));</span></td><td> </td><td class="rblock"><span class="insert">);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               transfo2-&gt;combine(Mat4d::zrotation(M_PI/180*(axisRotation + </span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">90.)));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               StelPainter* sPainter = new StelPainter(core-&gt;getProjection(</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">transfo2));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (flagLighting)</td><td> </td><td class="right">               if (flagLighting)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().enable();</td><td> </td><td class="right">                       sPainter-&gt;getLight().enable();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Set the main source of light to be the sun</td><td> </td><td class="right">                       // Set the main source of light to be the sun</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0040" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">const Vec3d&amp; sunPos = core-&gt;getNavigator()-&gt;getHelio</span></td><td> </td><td class="rblock">                       <span class="insert">Vec3d sunPos(0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">centricEclipticModelViewMat()*Vec3d(0,0,0);</span></td><td> </td><td class="rblock"><span class="insert">                       core-&gt;getHeliocentricEclipticModelViewTransform()-&gt;f</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">orward(sunPos);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().setPosition(Vec4f(sunPos[0],sun
Pos[1],sunPos[2],1.f));</td><td> </td><td class="right">                       sPainter-&gt;getLight().setPosition(Vec4f(sunPos[0],sun
Pos[1],sunPos[2],1.f));</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Set the light parameters taking sun as the light 
source</td><td> </td><td class="right">                       // Set the light parameters taking sun as the light 
source</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       static const Vec4f diffuse = Vec4f(2.f,2.f,2.f,1.f);</td><td> </td><td class="right">                       static const Vec4f diffuse = Vec4f(2.f,2.f,2.f,1.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       static const Vec4f zero = Vec4f(0.f,0.f,0.f,0.f);</td><td> </td><td class="right">                       static const Vec4f zero = Vec4f(0.f,0.f,0.f,0.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       static const Vec4f ambient = Vec4f(0.02f,0.02f,0.02f
,0.02f);</td><td> </td><td class="right">                       static const Vec4f ambient = Vec4f(0.02f,0.02f,0.02f
,0.02f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().setAmbient(ambient);</td><td> </td><td class="right">                       sPainter-&gt;getLight().setAmbient(ambient);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().setDiffuse(diffuse);</td><td> </td><td class="right">                       sPainter-&gt;getLight().setDiffuse(diffuse);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().setSpecular(zero);</td><td> </td><td class="right">                       sPainter-&gt;getLight().setSpecular(zero);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 658</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 671</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getMaterial().setSpecular(zero);</td><td> </td><td class="right">                       sPainter-&gt;getMaterial().setSpecular(zero);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().disable();</td><td> </td><td class="right">                       sPainter-&gt;getLight().disable();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;setColor(1.f,1.f,1.f);</td><td> </td><td class="right">                       sPainter-&gt;setColor(1.f,1.f,1.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (rings)</td><td> </td><td class="right">               if (rings)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0041" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       const double dist = getEquinoxEquatorialPos(<span class="delete">nav).len
</span>gth();</td><td> </td><td class="rblock">                       const double dist = getEquinoxEquatorialPos(<span class="insert">core).le
n</span>gth();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double z_near = 0.9*(dist - rings-&gt;getSize());</td><td> </td><td class="right">                       double z_near = 0.9*(dist - rings-&gt;getSize());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double z_far  = 1.1*(dist + rings-&gt;getSize());</td><td> </td><td class="right">                       double z_far  = 1.1*(dist + rings-&gt;getSize());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       if (z_near &lt; 0.0) z_near = 0.0;</td><td> </td><td class="right">                       if (z_near &lt; 0.0) z_near = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       double n,f;</td><td> </td><td class="right">                       double n,f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;getClippingPlanes(&amp;n,&amp;f); // Save clipping pla
nes</td><td> </td><td class="right">                       core-&gt;getClippingPlanes(&amp;n,&amp;f); // Save clipping pla
nes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;setClippingPlanes(z_near,z_far);</td><td> </td><td class="right">                       core-&gt;setClippingPlanes(z_near,z_far);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glDepthMask(GL_TRUE);</td><td> </td><td class="right">                       glDepthMask(GL_TRUE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glClear(GL_DEPTH_BUFFER_BIT);</td><td> </td><td class="right">                       glClear(GL_DEPTH_BUFFER_BIT);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glEnable(GL_DEPTH_TEST);</td><td> </td><td class="right">                       glEnable(GL_DEPTH_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       drawSphere(sPainter, screenSz);</td><td> </td><td class="right">                       drawSphere(sPainter, screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glDepthMask(GL_FALSE);</td><td> </td><td class="right">                       glDepthMask(GL_FALSE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().disable();</td><td> </td><td class="right">                       sPainter-&gt;getLight().disable();</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0042" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       rings-&gt;draw(sPainter,<span class="delete">mat</span>,screenSz);</td><td> </td><td class="rblock">                       rings-&gt;draw(sPainter,<span class="insert">transfo</span>,screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       sPainter-&gt;getLight().enable();</td><td> </td><td class="right">                       sPainter-&gt;getLight().enable();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glDisable(GL_DEPTH_TEST);</td><td> </td><td class="right">                       glDisable(GL_DEPTH_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       core-&gt;setClippingPlanes(n,f);  // Restore old clippi
ng planes</td><td> </td><td class="right">                       core-&gt;setClippingPlanes(n,f);  // Restore old clippi
ng planes</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td> </td><td class="right">                       SolarSystem* ssm = GETSTELMODULE(SolarSystem);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0043" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       if (this==ssm-&gt;getMoon() &amp;&amp; <span class="delete">nav-&gt;getCurrentLocation(
</span>).planetName=="Earth" &amp;&amp; ssm-&gt;nearLunarEclipse())</td><td> </td><td class="rblock">                       if (this==ssm-&gt;getMoon() &amp;&amp; <span class="insert">core-&gt;getCurrentLocation
(</span>).planetName=="Earth" &amp;&amp; ssm-&gt;nearLunarEclipse())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // Draw earth shadow over moon using stencil
 buffer if appropriate</td><td> </td><td class="right">                               // Draw earth shadow over moon using stencil
 buffer if appropriate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // This effect curently only looks right fro
m earth viewpoint</td><td> </td><td class="right">                               // This effect curently only looks right fro
m earth viewpoint</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               // TODO: moon magnitude label during eclipse
 isn't accurate...</td><td> </td><td class="right">                               // TODO: moon magnitude label during eclipse
 isn't accurate...</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glClearStencil(0x0);</td><td> </td><td class="right">                               glClearStencil(0x0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glClear(GL_STENCIL_BUFFER_BIT);</td><td> </td><td class="right">                               glClear(GL_STENCIL_BUFFER_BIT);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glStencilFunc(GL_ALWAYS, 0x1, 0x1);</td><td> </td><td class="right">                               glStencilFunc(GL_ALWAYS, 0x1, 0x1);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glStencilOp(GL_ZERO, GL_REPLACE, GL_REPLACE)
;</td><td> </td><td class="right">                               glStencilOp(GL_ZERO, GL_REPLACE, GL_REPLACE)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               glEnable(GL_STENCIL_TEST);</td><td> </td><td class="right">                               glEnable(GL_STENCIL_TEST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                               drawSphere(sPainter, screenSz);</td><td> </td><td class="right">                               drawSphere(sPainter, screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 713</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 726</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               sPainter=NULL;</td><td> </td><td class="right">               sPainter=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw the halo</td><td> </td><td class="right">       // Draw the halo</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Prepare openGL lighting parameters according to luminance</td><td> </td><td class="right">       // Prepare openGL lighting parameters according to luminance</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float surfArcMin2 = getSpheroidAngularSize(core)*60;</td><td> </td><td class="right">       float surfArcMin2 = getSpheroidAngularSize(core)*60;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       surfArcMin2 = surfArcMin2*surfArcMin2*M_PI; // the total illuminated
 area in arcmin^2</td><td> </td><td class="right">       surfArcMin2 = surfArcMin2*surfArcMin2*M_PI; // the total illuminated
 area in arcmin^2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(core-&gt;getProjection(StelCore::FrameJ2000));</td><td> </td><td class="right">       StelPainter sPainter(core-&gt;getProjection(StelCore::FrameJ2000));</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0044" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       Vec3d tmp = <span class="delete">getJ2000EquatorialPos(nav);</span></td><td> </td><td class="rblock">       Vec3d tmp = <span class="insert">getJ2000EquatorialPos(core);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       core-&gt;getSkyDrawer()-&gt;postDrawSky3dModel(&amp;sPainter, Vec3f(tmp[0], tm</td><td> </td><td class="rblock">       core-&gt;getSkyDrawer()-&gt;postDrawSky3dModel(&amp;sPainter, Vec3f(tmp[0], tm</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">p[1], tmp[2]), surfArcMin2, <span class="delete">getVMagnitude(core-&gt;getNavigator()),</span> color);</td><td> </td><td class="rblock">p[1], tmp[2]), surfArcMin2, <span class="insert">getVMagnitude(core),</span> color);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::drawSphere(StelPainter* painter, float screenSz)</td><td> </td><td class="right">void Planet::drawSphere(StelPainter* painter, float screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (texMap)</td><td> </td><td class="right">       if (texMap)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // For lazy loading, return if texture not yet loaded</td><td> </td><td class="right">               // For lazy loading, return if texture not yet loaded</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (!texMap-&gt;bind())</td><td> </td><td class="right">               if (!texMap-&gt;bind())</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       return;</td><td> </td><td class="right">                       return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l8" /><small>skipping to change at</small><em> line 844</em></th><th> </th><th><a name="part-r8" /><small>skipping to change at</small><em> line 857</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glClearStencil(0x0);</td><td> </td><td class="right">       glClearStencil(0x0);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glClear(GL_STENCIL_BUFFER_BIT); // Clean again to let a clean buffer
 for later Qt display</td><td> </td><td class="right">       glClear(GL_STENCIL_BUFFER_BIT); // Clean again to let a clean buffer
 for later Qt display</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter-&gt;setProjector(saveProj);</td><td> </td><td class="right">       sPainter-&gt;setProjector(saveProj);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void Planet::drawHints(const StelCore* core, const QFont&amp; planetNameFont)</td><td> </td><td class="right">void Planet::drawHints(const StelCore* core, const QFont&amp; planetNameFont)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (labelsFader.getInterstate()&lt;=0.f)</td><td> </td><td class="right">       if (labelsFader.getInterstate()&lt;=0.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0045" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">       const StelNavigator* nav = core-&gt;getNavigator();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameJ2000)
;</td><td> </td><td class="right">       const StelProjectorP prj = core-&gt;getProjection(StelCore::FrameJ2000)
;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StelPainter sPainter(prj);</td><td> </td><td class="right">       StelPainter sPainter(prj);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setFont(planetNameFont);</td><td> </td><td class="right">       sPainter.setFont(planetNameFont);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw nameI18 + scaling if it's not == 1.</td><td> </td><td class="right">       // Draw nameI18 + scaling if it's not == 1.</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float tmp = (hintFader.getInterstate()&lt;=0 ? 7.f : 10.f) + getAngular
Size(core)*M_PI/180.f*prj-&gt;getPixelPerRadAtCenter()/1.44f; // Shift for nam
eI18 printing</td><td> </td><td class="right">       float tmp = (hintFader.getInterstate()&lt;=0 ? 7.f : 10.f) + getAngular
Size(core)*M_PI/180.f*prj-&gt;getPixelPerRadAtCenter()/1.44f; // Shift for nam
eI18 printing</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setColor(labelColor[0], labelColor[1], labelColor[2],labels
Fader.getInterstate());</td><td> </td><td class="right">       sPainter.setColor(labelColor[0], labelColor[1], labelColor[2],labels
Fader.getInterstate());</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0046" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">       sPainter.drawText(screenPos[0],screenPos[1], getSkyLabel(<span class="delete">nav), 0, tm
</span>p, tmp, false);</td><td> </td><td class="rblock">       sPainter.drawText(screenPos[0],screenPos[1], getSkyLabel(<span class="insert">core), 0, t
m</span>p, tmp, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // hint disapears smoothly on close view</td><td> </td><td class="right">       // hint disapears smoothly on close view</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (hintFader.getInterstate()&lt;=0)</td><td> </td><td class="right">       if (hintFader.getInterstate()&lt;=0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               return;</td><td> </td><td class="right">               return;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tmp -= 10.f;</td><td> </td><td class="right">       tmp -= 10.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (tmp&lt;1) tmp=1;</td><td> </td><td class="right">       if (tmp&lt;1) tmp=1;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter.setColor(labelColor[0], labelColor[1], labelColor[2],labels
Fader.getInterstate()*hintFader.getInterstate()/tmp*0.7f);</td><td> </td><td class="right">       sPainter.setColor(labelColor[0], labelColor[1], labelColor[2],labels
Fader.getInterstate()*hintFader.getInterstate()/tmp*0.7f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Draw the 2D small circle</td><td> </td><td class="right">       // Draw the 2D small circle</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l9" /><small>skipping to change at</small><em> line 878</em></th><th> </th><th><a name="part-r9" /><small>skipping to change at</small><em> line 890</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Ring::Ring(double radiusMin,double radiusMax,const QString &amp;texname)</td><td> </td><td class="right">Ring::Ring(double radiusMin,double radiusMax,const QString &amp;texname)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">        :radiusMin(radiusMin),radiusMax(radiusMax)</td><td> </td><td class="right">        :radiusMin(radiusMin),radiusMax(radiusMax)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       tex = StelApp::getInstance().getTextureManager().createTexture("text
ures/"+texname);</td><td> </td><td class="right">       tex = StelApp::getInstance().getTextureManager().createTexture("text
ures/"+texname);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">Ring::~Ring(void)</td><td> </td><td class="right">Ring::~Ring(void)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0047" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">void Ring::draw(StelPainter* sPainter,<span class="delete">const Mat4d&amp; mat</span>,double screenSz)</td><td> </td><td class="rblock">void Ring::draw(StelPainter* sPainter,<span class="insert">StelProjector::ModelViewTranformP tra
nsfo</span>,double screenSz)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       screenSz -= 50;</td><td> </td><td class="right">       screenSz -= 50;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       screenSz /= 250.0;</td><td> </td><td class="right">       screenSz /= 250.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (screenSz &lt; 0.0) screenSz = 0.0;</td><td> </td><td class="right">       if (screenSz &lt; 0.0) screenSz = 0.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else if (screenSz &gt; 1.0) screenSz = 1.0;</td><td> </td><td class="right">       else if (screenSz &gt; 1.0) screenSz = 1.0;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int slices = 128+(int)((256-128)*screenSz);</td><td> </td><td class="right">       const int slices = 128+(int)((256-128)*screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const int stacks = 8+(int)((32-8)*screenSz);</td><td> </td><td class="right">       const int stacks = 8+(int)((32-8)*screenSz);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Normal transparency mode</td><td> </td><td class="right">       // Normal transparency mode</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">       glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter-&gt;setColor(1.f, 1.f, 1.f);</td><td> </td><td class="right">       sPainter-&gt;setColor(1.f, 1.f, 1.f);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter-&gt;enableTexture2d(true);</td><td> </td><td class="right">       sPainter-&gt;enableTexture2d(true);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_CULL_FACE);</td><td> </td><td class="right">       glEnable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glEnable(GL_BLEND);</td><td> </td><td class="right">       glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (tex) tex-&gt;bind();</td><td> </td><td class="right">       if (tex) tex-&gt;bind();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0048" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       Mat4d mat = transfo-&gt;getApproximateLinearTransfo();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         // solve the ring wraparound by culling:</td><td> </td><td class="right">         // solve the ring wraparound by culling:</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">         // decide if we are above or below the ring plane</td><td> </td><td class="right">         // decide if we are above or below the ring plane</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const double h = mat.r[ 8]*mat.r[12]</td><td> </td><td class="right">       const double h = mat.r[ 8]*mat.r[12]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                  + mat.r[ 9]*mat.r[13]</td><td> </td><td class="right">                                  + mat.r[ 9]*mat.r[13]</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                                  + mat.r[10]*mat.r[14];</td><td> </td><td class="right">                                  + mat.r[10]*mat.r[14];</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       sPainter-&gt;sRing(radiusMin,radiusMax,(h&lt;0.0)?slices:-slices,stacks, 0
);</td><td> </td><td class="right">       sPainter-&gt;sRing(radiusMin,radiusMax,(h&lt;0.0)?slices:-slices,stacks, 0
);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glDisable(GL_CULL_FACE);</td><td> </td><td class="right">       glDisable(GL_CULL_FACE);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// draw orbital path of Planet</td><td> </td><td class="right">// draw orbital path of Planet</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 48 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>68 lines changed or deleted</i></th><th><i> </i></th><th><i>91 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
