<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<!-- Generated by rfcdiff 1.41: rfcdiff  --> 
<!-- <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional" > -->
<!-- System: Linux fomalhaut.local 3.13.0-38-generic #65-Ubuntu SMP Thu Oct 9 11:36:50 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux --> 
<!-- Using awk: /usr/bin/gawk: GNU Awk 4.0.1 --> 
<!-- Using diff: /usr/bin/diff: diff (GNU diffutils) 3.3 --> 
<!-- Using wdiff: /usr/bin/wdiff: wdiff (GNU wdiff) 1.2.1 --> 
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"> 
<head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <meta http-equiv="Content-Style-Type" content="text/css" /> 
  <title>Diff: StelPainter.cpp - StelPainter.cpp</title> 
  <style type="text/css"> 
    body    { font-size:16px; margin: 0.4ex; margin-right: auto; } 
    tr      { } 
    td      { white-space: pre; font-family: Consolas, "DejaVu Sans Mono", "Droid Sans Mono", Monaco, Monospace; vertical-align: top; font-size: 0.86em;} 
    th      { font-size: 0.86em; } 
    .small  { font-size: 0.6em; font-style: italic; font-family: Verdana, Helvetica, sans-serif; } 
    .left   { background-color: #EEE; } 
    .right  { background-color: #FFF; } 
    .diff   { background-color: #CCF; } 
    .lblock { background-color: #BFB; } 
    .rblock { background-color: #FF8; } 
    .insert { background-color: #8FF; } 
    .delete { background-color: #ACF; } 
    .void   { background-color: #FFB; } 
    .cont   { background-color: #EEE; } 
    .linebr { background-color: #AAA; } 
    .lineno { color: red; background-color: #FFF; font-size: 0.7em; text-align: right; padding: 0 2px; } 
    .elipsis{ background-color: #AAA; } 
    .left .cont { background-color: #DDD; } 
    .right .cont { background-color: #EEE; } 
    .lblock .cont { background-color: #9D9; } 
    .rblock .cont { background-color: #DD6; } 
    .insert .cont { background-color: #0DD; } 
    .delete .cont { background-color: #8AD; } 
    .stats, .stats td, .stats th { background-color: #EEE; padding: 2px 0; } 
  </style> 
</head> 
<body > 
  <table border="0" cellpadding="0" cellspacing="0"> 
  <tr bgcolor="orange"><th></th><th>&nbsp;StelPainter.cpp&nbsp;</th><th> </th><th>&nbsp;StelPainter.cpp&nbsp;</th><th></th></tr> 
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l1" /><small>skipping to change at</small><em> line 48</em></th><th> </th><th><a name="part-r1" /><small>skipping to change at</small><em> line 48</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#define GL_MULTISAMPLE  0x809D</td><td> </td><td class="right">#define GL_MULTISAMPLE  0x809D</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifndef NDEBUG</td><td> </td><td class="right">#ifndef NDEBUG</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QMutex* StelPainter::globalMutex = new QMutex();</td><td> </td><td class="right">QMutex* StelPainter::globalMutex = new QMutex();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QPainter* StelPainter::qPainter = NULL;</td><td> </td><td class="right">QPainter* StelPainter::qPainter = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">QGLContext* StelPainter::glContext = NULL;</td><td> </td><td class="right">QGLContext* StelPainter::glContext = NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0001" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">bool StelPainter::isNoPowerOfTwoAllowed;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef STELPAINTER_GL2</td><td> </td><td class="right">#ifdef STELPAINTER_GL2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> QGLShaderProgram* StelPainter::colorShaderProgram=NULL;</td><td> </td><td class="right"> QGLShaderProgram* StelPainter::colorShaderProgram=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> QGLShaderProgram* StelPainter::texturesShaderProgram=NULL;</td><td> </td><td class="right"> QGLShaderProgram* StelPainter::texturesShaderProgram=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> QGLShaderProgram* StelPainter::basicShaderProgram=NULL;</td><td> </td><td class="right"> QGLShaderProgram* StelPainter::basicShaderProgram=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> QGLShaderProgram* StelPainter::texturesColorShaderProgram=NULL;</td><td> </td><td class="right"> QGLShaderProgram* StelPainter::texturesColorShaderProgram=NULL;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> StelPainter::BasicShaderVars StelPainter::basicShaderVars;</td><td> </td><td class="right"> StelPainter::BasicShaderVars StelPainter::basicShaderVars;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> StelPainter::TexturesShaderVars StelPainter::texturesShaderVars;</td><td> </td><td class="right"> StelPainter::TexturesShaderVars StelPainter::texturesShaderVars;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> StelPainter::TexturesColorShaderVars StelPainter::texturesColorShaderVars;</td><td> </td><td class="right"> StelPainter::TexturesColorShaderVars StelPainter::texturesColorShaderVars;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l2" /><small>skipping to change at</small><em> line 454</em></th><th> </th><th><a name="part-r2" /><small>skipping to change at</small><em> line 456</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int j;</td><td> </td><td class="right">       int j;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static Vec3f lightPos3;</td><td> </td><td class="right">       static Vec3f lightPos3;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static Vec4f ambientLight;</td><td> </td><td class="right">       static Vec4f ambientLight;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static Vec4f diffuseLight;</td><td> </td><td class="right">       static Vec4f diffuseLight;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float c;</td><td> </td><td class="right">       float c;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const bool isLightOn = light.isEnabled();</td><td> </td><td class="right">       const bool isLightOn = light.isEnabled();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (isLightOn)</td><td> </td><td class="right">       if (isLightOn)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lightPos3.set(light.getPosition()[0], light.getPosition()[1]
, light.getPosition()[2]);</td><td> </td><td class="right">               lightPos3.set(light.getPosition()[0], light.getPosition()[1]
, light.getPosition()[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0002" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               <span class="delete">lightPos3 -= prj-&gt;modelViewMatrixf * Vec3f(0.f);</span> // <span class="delete">-posCent</span></td><td> </td><td class="rblock">               <span class="insert">Vec3f tmpv(0.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">erEye</span></td><td> </td><td class="rblock"><span class="insert">               prj-&gt;getModelViewTransform()-&gt;forward(tmpv);</span> // <span class="insert">-posCenterEy</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               lightPos3 = <span class="delete">prj-&gt;modelViewMatrixf.transpose().multiplyWithou</span></td><td> </td><td class="rblock"><span class="insert">e</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">tTranslation(lightPos3);</span></td><td> </td><td class="rblock">               lightPos3 <span class="insert">-= tmpv;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               //lightPos3</span> = <span class="insert">prj-&gt;modelViewMatrixf.transpose().multiplyWith</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">outTranslation(lightPos3);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               prj-&gt;getModelViewTransform()-&gt;backward(lightPos3);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lightPos3.normalize();</td><td> </td><td class="right">               lightPos3.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               ambientLight = light.getAmbient();</td><td> </td><td class="right">               ambientLight = light.getAmbient();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               diffuseLight = light.getDiffuse();</td><td> </td><td class="right">               diffuseLight = light.getDiffuse();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const float nsign = orientInside?-1.f:1.f;</td><td> </td><td class="right">       const float nsign = orientInside?-1.f:1.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const float dr = (rMax-rMin) / stacks;</td><td> </td><td class="right">       const float dr = (rMax-rMin) / stacks;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const float dtheta = 2.f * M_PI / slices;</td><td> </td><td class="right">       const float dtheta = 2.f * M_PI / slices;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (slices &lt; 0) slices = -slices;</td><td> </td><td class="right">       if (slices &lt; 0) slices = -slices;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l3" /><small>skipping to change at</small><em> line 645</em></th><th> </th><th><a name="part-r3" /><small>skipping to change at</small><em> line 650</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">/*************************************************************************</td><td> </td><td class="right">/*************************************************************************</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"> Draw the string at the given position and angle with the given font</td><td> </td><td class="right"> Draw the string at the given position and angle with the given font</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">*************************************************************************/</td><td> </td><td class="right">*************************************************************************/</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Container for one cached string texture</td><td> </td><td class="right">// Container for one cached string texture</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">struct StringTexture</td><td> </td><td class="right">struct StringTexture</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GLuint texture;</td><td> </td><td class="right">       GLuint texture;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int width;</td><td> </td><td class="right">       int width;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       int height;</td><td> </td><td class="right">       int height;</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0003" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">int subTexWidth;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       int subTexHeight;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       StringTexture() : texture(0) {;}</td><td> </td><td class="right">       StringTexture() : texture(0) {;}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       ~StringTexture()</td><td> </td><td class="right">       ~StringTexture()</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (texture != 0)</td><td> </td><td class="right">               if (texture != 0)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glDeleteTextures(1, &amp;texture);</td><td> </td><td class="right">                       glDeleteTextures(1, &amp;texture);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">};</td><td> </td><td class="right">};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelPainter::drawText(float x, float y, const QString&amp; str, float angl
eDeg, float xshift, float yshift, bool noGravity)</td><td> </td><td class="right">void StelPainter::drawText(float x, float y, const QString&amp; str, float angl
eDeg, float xshift, float yshift, bool noGravity)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l4" /><small>skipping to change at</small><em> line 671</em></th><th> </th><th><a name="part-r4" /><small>skipping to change at</small><em> line 678</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       else</td><td> </td><td class="right">       else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               static const int cacheLimitByte = 7000000;</td><td> </td><td class="right">               static const int cacheLimitByte = 7000000;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               static QCache&lt;QByteArray,StringTexture&gt; texCache(cacheLimitB
yte);</td><td> </td><td class="right">               static QCache&lt;QByteArray,StringTexture&gt; texCache(cacheLimitB
yte);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               int pixelSize = qPainter-&gt;font().pixelSize();</td><td> </td><td class="right">               int pixelSize = qPainter-&gt;font().pixelSize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               QByteArray hash = str.toUtf8() + QByteArray::number(pixelSiz
e);</td><td> </td><td class="right">               QByteArray hash = str.toUtf8() + QByteArray::number(pixelSiz
e);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               const StringTexture* cachedTex = texCache.object(hash);</td><td> </td><td class="right">               const StringTexture* cachedTex = texCache.object(hash);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (cachedTex == NULL)  // need to create texture</td><td> </td><td class="right">               if (cachedTex == NULL)  // need to create texture</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0004" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       <span class="insert">StringTexture* newTex = new StringTexture();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Create temp image and render text into it</td><td> </td><td class="right">                       // Create temp image and render text into it</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       QRect strRect = getFontMetrics().boundingRect(str);</td><td> </td><td class="right">                       QRect strRect = getFontMetrics().boundingRect(str);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0005" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                        QPixmap <span class="delete">strImage(strRect.width()+1+(int)(0.02f*strR</span></td><td> </td><td class="rblock">                       <span class="insert">newTex-&gt;subTexWidth = strRect.width()+1+(int)(0.02f*</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">ect.width()), strRect.height());</span></td><td> </td><td class="rblock"><span class="insert">strRect.width());</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       newTex-&gt;subTexHeight = strRect.height();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       QPixmap <span class="insert">strImage;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       if (isNoPowerOfTwoAllowed)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               strImage = QPixmap(newTex-&gt;subTexWidth, newT</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ex-&gt;subTexHeight);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               strImage = QPixmap(StelUtils::getBiggerPower</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">OfTwo(newTex-&gt;subTexWidth), StelUtils::getBiggerPowerOfTwo(newTex-&gt;subTexHe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">ight));</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       newTex-&gt;width = strImage.width();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       newTex-&gt;height = strImage.height();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       strImage.fill(Qt::transparent);</td><td> </td><td class="right">                       strImage.fill(Qt::transparent);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       QPainter painter(&amp;strImage);</td><td> </td><td class="right">                       QPainter painter(&amp;strImage);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       painter.setFont(qPainter-&gt;font());</td><td> </td><td class="right">                       painter.setFont(qPainter-&gt;font());</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       painter.setRenderHints(QPainter::TextAntialiasing);</td><td> </td><td class="right">                       painter.setRenderHints(QPainter::TextAntialiasing);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       painter.setPen(Qt::white);</td><td> </td><td class="right">                       painter.setPen(Qt::white);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       painter.drawText(-strRect.x(), -strRect.y(), str);</td><td> </td><td class="right">                       painter.drawText(-strRect.x(), -strRect.y(), str);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // Create and bind texture, and add it to the list o
f cached textures</td><td> </td><td class="right">                       // Create and bind texture, and add it to the list o
f cached textures</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0006" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       StringTexture* newTex = new StringTexture();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       newTex-&gt;texture = StelPainter::glContext-&gt;bindTextur
e(strImage, GL_TEXTURE_2D, GL_RGBA, QGLContext::NoBindOption);</td><td> </td><td class="right">                       newTex-&gt;texture = StelPainter::glContext-&gt;bindTextur
e(strImage, GL_TEXTURE_2D, GL_RGBA, QGLContext::NoBindOption);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0007" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                       <span class="delete">newTex-&gt;width = strImage.width();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">                       newTex-&gt;height = strImage.height();</span></td><td> </td><td class="rblock"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       texCache.insert(hash, newTex, 3*newTex-&gt;width*newTex
-&gt;height);</td><td> </td><td class="right">                       texCache.insert(hash, newTex, 3*newTex-&gt;width*newTex
-&gt;height);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       cachedTex=newTex;</td><td> </td><td class="right">                       cachedTex=newTex;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       // The texture was found in the cache</td><td> </td><td class="right">                       // The texture was found in the cache</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glBindTexture(GL_TEXTURE_2D, cachedTex-&gt;texture);</td><td> </td><td class="right">                       glBindTexture(GL_TEXTURE_2D, cachedTex-&gt;texture);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // Translate/rotate</td><td> </td><td class="right">               // Translate/rotate</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l5" /><small>skipping to change at</small><em> line 713</em></th><th> </th><th><a name="part-r5" /><small>skipping to change at</small><em> line 728</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               // compute the vertex coordinates applying the translation a
nd the rotation</td><td> </td><td class="right">               // compute the vertex coordinates applying the translation a
nd the rotation</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               static const float vertexBase[] = {0., 0., 1., 0., 0., 1., 1
., 1.};</td><td> </td><td class="right">               static const float vertexBase[] = {0., 0., 1., 0., 0., 1., 1
., 1.};</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               if (std::fabs(angleDeg)&gt;1.f*M_PI/180.f)</td><td> </td><td class="right">               if (std::fabs(angleDeg)&gt;1.f*M_PI/180.f)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER
, GL_LINEAR);</td><td> </td><td class="right">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER
, GL_LINEAR);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER
, GL_LINEAR);</td><td> </td><td class="right">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER
, GL_LINEAR);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const float cosr = std::cos(angleDeg * M_PI/180.);</td><td> </td><td class="right">                       const float cosr = std::cos(angleDeg * M_PI/180.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       const float sinr = std::sin(angleDeg * M_PI/180.);</td><td> </td><td class="right">                       const float sinr = std::sin(angleDeg * M_PI/180.);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for (int i = 0; i &lt; 8; i+=2)</td><td> </td><td class="right">                       for (int i = 0; i &lt; 8; i+=2)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0008" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               vertexData[i] = int(x + <span class="delete">(cachedTex-&gt;width*ve</span></td><td> </td><td class="rblock">                               vertexData[i] = int(x + <span class="insert">(cachedTex-&gt;subTexWi</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">rtexBase[i]+xshift)</span> * cosr - <span class="delete">(cachedTex-&gt;height*vertexBase[i+1]+yshift)</span> * <span class="delete">s</span></td><td> </td><td class="rblock"><span class="insert">dth*vertexBase[i]+xshift)</span> * cosr - <span class="insert">(cachedTex-&gt;subTexHeight*vertexBase[i+1]</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">inr);</span></td><td> </td><td class="rblock"><span class="insert">+yshift)</span> * <span class="insert">sinr);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               vertexData[i+1] = int(y  + <span class="delete">(cachedTex-&gt;width</span></td><td> </td><td class="rblock">                               vertexData[i+1] = int(y  + <span class="insert">(cachedTex-&gt;subTe</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">*vertexBase[i]+xshift)</span> * sinr + <span class="delete">(cachedTex-&gt;height*vertexBase[i+1]+yshift)</span> </td><td> </td><td class="rblock"><span class="insert">xWidth*vertexBase[i]+xshift)</span> * sinr + <span class="insert">(cachedTex-&gt;subTexHeight*vertexBase[i</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">* cosr);</td><td> </td><td class="rblock"><span class="insert">+1]+yshift)</span> * cosr);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               else</td><td> </td><td class="right">               else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               {</td><td> </td><td class="right">               {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER
, GL_NEAREST);</td><td> </td><td class="right">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER
, GL_NEAREST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER
, GL_NEAREST);</td><td> </td><td class="right">                       glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER
, GL_NEAREST);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       for (int i = 0; i &lt; 8; i+=2)</td><td> </td><td class="right">                       for (int i = 0; i &lt; 8; i+=2)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       {</td><td> </td><td class="right">                       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0009" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               vertexData[i] = int(x + <span class="delete">cachedTex-&gt;width*ver</span></td><td> </td><td class="rblock">                               vertexData[i] = int(x + <span class="insert">cachedTex-&gt;subTexWid</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">texBase[i]+xshift);</span></td><td> </td><td class="rblock"><span class="insert">th*vertexBase[i]+xshift);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">                               vertexData[i+1] = int(y  + <span class="delete">cachedTex-&gt;height</span></td><td> </td><td class="rblock">                               vertexData[i+1] = int(y  + <span class="insert">cachedTex-&gt;subTex</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">*vertexBase[i+1]+yshift);</span></td><td> </td><td class="rblock"><span class="insert">Height*vertexBase[i+1]+yshift);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">                       }</td><td> </td><td class="right">                       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               }</td><td> </td><td class="right">               }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td> </td><td class="right">               glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               glEnable(GL_BLEND);</td><td> </td><td class="right">               glEnable(GL_BLEND);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               enableClientStates(true, true);</td><td> </td><td class="right">               enableClientStates(true, true);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               setVertexPointer(2, GL_FLOAT, vertexData);</td><td> </td><td class="right">               setVertexPointer(2, GL_FLOAT, vertexData);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0010" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               setTexCoordPointer(2, GL_FLOAT, texCoordData);</td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">float* texCoords = NULL;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               if (isNoPowerOfTwoAllowed)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                       setTexCoordPointer(2, GL_FLOAT, texCoordData);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">else</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       texCoords = new float[8];</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       for (int i=0;i&lt;8;i+=2)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       {</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               texCoords[i] = texCoordData[i]*(float)cached</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Tex-&gt;subTexWidth/cachedTex-&gt;width;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                               texCoords[i+1] = texCoordData[i+1]*(float)ca</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">chedTex-&gt;subTexHeight/cachedTex-&gt;height;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       setTexCoordPointer(2, GL_FLOAT, texCoords);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               }</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               drawFromArray(TriangleStrip, 4, 0, false);</td><td> </td><td class="right">               drawFromArray(TriangleStrip, 4, 0, false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               enableClientStates(false);</td><td> </td><td class="right">               enableClientStates(false);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0011" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               <span class="insert">if (!isNoPowerOfTwoAllowed)</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">                       delete[] texCoords;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">// Recursive method cutting a small circle in small segments</td><td> </td><td class="right">// Recursive method cutting a small circle in small segments</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">inline void fIter(const StelProjectorP&amp; prj, const Vec3d&amp; p1, const Vec3d&amp; 
p2, Vec3d&amp; win1, Vec3d&amp; win2, QLinkedList&lt;Vec3d&gt;&amp; vertexList, const QLinked
List&lt;Vec3d&gt;::iterator&amp; iter, double radius, const Vec3d&amp; center, int nbI=0,
 bool checkCrossDiscontinuity=true)</td><td> </td><td class="right">inline void fIter(const StelProjectorP&amp; prj, const Vec3d&amp; p1, const Vec3d&amp; 
p2, Vec3d&amp; win1, Vec3d&amp; win2, QLinkedList&lt;Vec3d&gt;&amp; vertexList, const QLinked
List&lt;Vec3d&gt;::iterator&amp; iter, double radius, const Vec3d&amp; center, int nbI=0,
 bool checkCrossDiscontinuity=true)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const bool crossDiscontinuity = checkCrossDiscontinuity &amp;&amp; prj-&gt;inte
rsectViewportDiscontinuity(p1+center, p2+center);</td><td> </td><td class="right">       const bool crossDiscontinuity = checkCrossDiscontinuity &amp;&amp; prj-&gt;inte
rsectViewportDiscontinuity(p1+center, p2+center);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (crossDiscontinuity &amp;&amp; nbI&gt;=10)</td><td> </td><td class="right">       if (crossDiscontinuity &amp;&amp; nbI&gt;=10)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               win1[2]=-2.;</td><td> </td><td class="right">               win1[2]=-2.;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l6" /><small>skipping to change at</small><em> line 1546</em></th><th> </th><th><a name="part-r6" /><small>skipping to change at</small><em> line 1578</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // static rather than on the stack. But why?</td><td> </td><td class="right">       // static rather than on the stack. But why?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Is the constructor/destructor so expensive?</td><td> </td><td class="right">       // Is the constructor/destructor so expensive?</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static Vec3f lightPos3;</td><td> </td><td class="right">       static Vec3f lightPos3;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static Vec4f ambientLight;</td><td> </td><td class="right">       static Vec4f ambientLight;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       static Vec4f diffuseLight;</td><td> </td><td class="right">       static Vec4f diffuseLight;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       float c;</td><td> </td><td class="right">       float c;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const bool isLightOn = light.isEnabled();</td><td> </td><td class="right">       const bool isLightOn = light.isEnabled();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       if (isLightOn)</td><td> </td><td class="right">       if (isLightOn)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       {</td><td> </td><td class="right">       {</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lightPos3.set(light.getPosition()[0], light.getPosition()[1]
, light.getPosition()[2]);</td><td> </td><td class="right">               lightPos3.set(light.getPosition()[0], light.getPosition()[1]
, light.getPosition()[2]);</td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0012" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock">               lightPos3 -= <span class="delete">prj-&gt;modelViewMatrixf * Vec3f(0.f);</span></td><td> </td><td class="rblock">               <span class="insert">Vec3f tmpv(0.f);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">               lightPos3</span> = <span class="delete">prj-&gt;modelViewMatrixf.transpose().multiplyWithou</span></td><td> </td><td class="rblock"><span class="insert">               prj-&gt;getModelViewTransform()-&gt;forward(tmpv); // -posCenterEy</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"><span class="delete">tTranslation(lightPos3);</span></td><td> </td><td class="rblock"><span class="insert">e</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">               lightPos3 -= <span class="insert">tmpv;</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               //lightPos3</span> = <span class="insert">prj-&gt;modelViewMatrixf.transpose().multiplyWith</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">outTranslation(lightPos3);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">               prj-&gt;getModelViewTransform()-&gt;backward(lightPos3);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               lightPos3.normalize();</td><td> </td><td class="right">               lightPos3.normalize();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               ambientLight = light.getAmbient();</td><td> </td><td class="right">               ambientLight = light.getAmbient();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               diffuseLight = light.getDiffuse();</td><td> </td><td class="right">               diffuseLight = light.getDiffuse();</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       }</td><td> </td><td class="right">       }</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GLfloat x, y, z;</td><td> </td><td class="right">       GLfloat x, y, z;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GLfloat s=0.f, t=0.f;</td><td> </td><td class="right">       GLfloat s=0.f, t=0.f;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GLint i, j;</td><td> </td><td class="right">       GLint i, j;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       GLfloat nsign;</td><td> </td><td class="right">       GLfloat nsign;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno"></td></tr>
      <tr bgcolor="gray" ><td></td><th><a name="part-l7" /><small>skipping to change at</small><em> line 1773</em></th><th> </th><th><a name="part-r7" /><small>skipping to change at</small><em> line 1808</em></th><td></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#else</td><td> </td><td class="right">#else</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       texture2dEnabled = b;</td><td> </td><td class="right">       texture2dEnabled = b;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#endif</td><td> </td><td class="right">#endif</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">}</td><td> </td><td class="right">}</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">void StelPainter::initSystemGLInfo(QGLContext* ctx)</td><td> </td><td class="right">void StelPainter::initSystemGLInfo(QGLContext* ctx)</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">{</td><td> </td><td class="right">{</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       Q_ASSERT(glContext==NULL);</td><td> </td><td class="right">       Q_ASSERT(glContext==NULL);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       glContext = ctx;</td><td> </td><td class="right">       glContext = ctx;</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left"></td><td> </td><td class="right"></td><td class="lineno" valign="top"></td></tr>
      <tr><td><a name="diff0013" /></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">       <span class="insert">makeMainGLContextCurrent();</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">       isNoPowerOfTwoAllowed = QGLFormat::openGLVersionFlags().testFlag(QGL</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Format::OpenGL_Version_2_0) || QGLFormat::openGLVersionFlags().testFlag(QGL</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock"><span class="insert">Format::OpenGL_ES_Version_2_0);</span></td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="lblock"></td><td> </td><td class="rblock">                                                                           </td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">#ifdef STELPAINTER_GL2</td><td> </td><td class="right">#ifdef STELPAINTER_GL2</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       // Basic shader: just vertex filled with plain color</td><td> </td><td class="right">       // Basic shader: just vertex filled with plain color</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       QGLShader *vshader3 = new QGLShader(QGLShader::Vertex);</td><td> </td><td class="right">       QGLShader *vshader3 = new QGLShader(QGLShader::Vertex);</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">       const char *vsrc3 =</td><td> </td><td class="right">       const char *vsrc3 =</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "attribute mediump vec3 vertex;\n"</td><td> </td><td class="right">               "attribute mediump vec3 vertex;\n"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "uniform mediump mat4 projectionMatrix;\n"</td><td> </td><td class="right">               "uniform mediump mat4 projectionMatrix;\n"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "void main(void)\n"</td><td> </td><td class="right">               "void main(void)\n"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "{\n"</td><td> </td><td class="right">               "{\n"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "    gl_Position = projectionMatrix*vec4(vertex, 1.);\n"</td><td> </td><td class="right">               "    gl_Position = projectionMatrix*vec4(vertex, 1.);\n"</td><td class="lineno" valign="top"></td></tr>
      <tr><td class="lineno" valign="top"></td><td class="left">               "}\n";</td><td> </td><td class="right">               "}\n";</td><td class="lineno" valign="top"></td></tr>

     <tr><td></td><td class="left"></td><td> </td><td class="right"></td><td></td></tr>
     <tr bgcolor="gray"><th colspan="5" align="center"><a name="end">&nbsp;End of changes. 13 change blocks.&nbsp;</a></th></tr>
     <tr class="stats"><td></td><th><i>23 lines changed or deleted</i></th><th><i> </i></th><th><i>69 lines changed or added</i></th><td></td></tr>
     <tr><td colspan="5" align="center" class="small"><br/>This html diff was produced by rfcdiff 1.41. The latest version is available from <a href="http://www.tools.ietf.org/tools/rfcdiff/" >http://tools.ietf.org/tools/rfcdiff/</a> </td></tr>
   </table>
   </body>
   </html>
